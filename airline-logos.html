<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Logos Aerolineas - Supabase</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    body{background:#f0f2f8;font-family:'Segoe UI',sans-serif}
    .page-header{background:linear-gradient(135deg,#0d47a1,#1565c0);color:#fff;padding:1.5rem 2rem}
    .page-header h1{font-size:1.5rem;font-weight:700;margin:0}
    .stats-bar{background:#fff;border-bottom:1px solid #dee2e6}
    .stat-item{text-align:center;padding:.6rem 1rem;border-right:1px solid #e9ecef}
    .stat-item:last-child{border-right:none}
    .stat-num{font-size:1.4rem;font-weight:700;color:#0d6efd;line-height:1}
    .stat-label{font-size:.68rem;text-transform:uppercase;letter-spacing:.05em;color:#6c757d}
    .toolbar{background:#fff;border-bottom:1px solid #dee2e6;padding:.6rem 1.2rem}
    .airline-card{background:#fff;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.06);transition:.15s;overflow:hidden;position:relative;cursor:pointer}
    .airline-card:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,.12)}
    .card-accent{height:5px;width:100%}
    .card-body-inner{padding:.8rem}
    .logo-box{width:100%;height:58px;display:flex;align-items:center;justify-content:center;background:#f8f9fa;border-radius:6px;margin-bottom:.6rem;border:1px dashed #dee2e6;overflow:hidden}
    .logo-box img{max-height:48px;max-width:100%;object-fit:contain}
    .airline-name{font-weight:700;font-size:.8rem;line-height:1.2;margin-bottom:.2rem}
    .iata-badge{display:inline-block;background:#e9ecef;color:#495057;font-family:monospace;font-size:.68rem;font-weight:700;padding:.08em .4em;border-radius:3px}
    .badge-type{font-size:.6rem;padding:.12em .45em;border-radius:50rem;font-weight:600;text-transform:uppercase}
    .badge-nacional{background:#d1e7dd;color:#0a3622}
    .badge-internacional{background:#cfe2ff;color:#084298}
    .badge-carga{background:#fff3cd;color:#664d03}
    .badge-pasajeros{background:#f3e8ff;color:#5b00a0}
    .dot{position:absolute;top:7px;right:7px;width:9px;height:9px;border-radius:50%}
    .dot-storage{background:#0d6efd}
    .dot-gstatic{background:#ffc107}
    .dot-none{background:#dee2e6}
    .drop-zone{border:2px dashed #c5cbe8;border-radius:8px;padding:1.25rem;text-align:center;cursor:pointer;transition:background .2s}
    .drop-zone.drag-over{background:#e8f0fe;border-color:#0d6efd}
    .drop-zone input[type=file]{display:none}
    .filter-btn.active{background:#0d6efd!important;color:#fff!important;border-color:#0d6efd!important}
    .modal-header{background:linear-gradient(135deg,#0d47a1,#1565c0);color:#fff}
    .modal-header .btn-close{filter:invert(1)}
    #loadingOverlay{position:fixed;inset:0;background:rgba(255,255,255,.8);z-index:9999;display:flex;align-items:center;justify-content:center}
  </style>
</head>
<body>

<div id="loadingOverlay">
  <div class="text-center">
    <div class="spinner-border text-primary mb-2"></div>
    <div class="small text-muted">Conectando a Supabase...</div>
  </div>
</div>

<div class="page-header d-flex align-items-center flex-wrap gap-3">
  <div>
    <h1><i class="fas fa-database me-2"></i>Logos de Aerolineas</h1>
    <p class="mb-0 small opacity-75">Supabase · tabla <code>airlines</code> · bucket <code>airline-logos</code></p>
  </div>
  <div class="ms-auto d-flex gap-2 flex-wrap">
    <span class="badge bg-success align-self-center px-3 py-2 d-none" id="connectedBadge"><i class="fas fa-check-circle me-1"></i>Conectado</span>
    <button class="btn btn-light btn-sm" onclick="reloadFromDB()"><i class="fas fa-sync-alt me-1"></i>Recargar</button>
    <button class="btn btn-warning btn-sm" onclick="openAddModal()"><i class="fas fa-plus me-1"></i>Agregar</button>
  </div>
</div>

<div class="stats-bar d-flex flex-wrap">
  <div class="stat-item"><div class="stat-num" id="stat-total">-</div><div class="stat-label">Total</div></div>
  <div class="stat-item"><div class="stat-num text-primary" id="stat-storage">-</div><div class="stat-label">En Storage</div></div>
  <div class="stat-item"><div class="stat-num text-warning" id="stat-gstatic">-</div><div class="stat-label">Logo IATA</div></div>
  <div class="stat-item"><div class="stat-num text-danger" id="stat-nologo">-</div><div class="stat-label">Sin logo</div></div>
  <div class="stat-item"><div class="stat-num" id="stat-nac">-</div><div class="stat-label">Nacionales</div></div>
  <div class="stat-item"><div class="stat-num text-info" id="stat-int">-</div><div class="stat-label">Internacionales</div></div>
</div>

<div class="toolbar d-flex flex-wrap gap-2 align-items-center">
  <div class="input-group input-group-sm" style="max-width:240px">
    <span class="input-group-text"><i class="fas fa-search text-muted"></i></span>
    <input type="text" class="form-control" id="searchInput" placeholder="Nombre, IATA..." oninput="applyFilters()">
  </div>
  <div class="btn-group btn-group-sm">
    <button class="btn btn-outline-secondary filter-btn active" data-f="all"          onclick="setFilter('all',this)">Todas</button>
    <button class="btn btn-outline-secondary filter-btn"        data-f="nacional"      onclick="setFilter('nacional',this)">Nacional</button>
    <button class="btn btn-outline-secondary filter-btn"        data-f="internacional" onclick="setFilter('internacional',this)">Internacional</button>
    <button class="btn btn-outline-secondary filter-btn"        data-f="carga"         onclick="setFilter('carga',this)">Carga</button>
  </div>
  <div class="btn-group btn-group-sm">
    <button class="btn btn-outline-secondary filter-btn active" data-l="all"     onclick="setLogoFilter('all',this)">Todos</button>
    <button class="btn btn-outline-primary   filter-btn"        data-l="storage" onclick="setLogoFilter('storage',this)"><i class="fas fa-cloud me-1"></i>Storage</button>
    <button class="btn btn-outline-warning   filter-btn"        data-l="gstatic" onclick="setLogoFilter('gstatic',this)">IATA</button>
    <button class="btn btn-outline-danger    filter-btn"        data-l="none"    onclick="setLogoFilter('none',this)">Sin logo</button>
  </div>
  <select class="form-select form-select-sm" style="width:160px" onchange="sortBy(this.value)">
    <option value="name">A-Z Nombre</option>
    <option value="iata">Codigo IATA</option>
  </select>
  <span class="ms-auto small text-muted" id="resultCount"></span>
</div>

<div class="p-3">
  <div class="row g-3" id="airlinesGrid"></div>
  <div id="emptyState" class="text-center py-5 text-muted d-none">
    <i class="fas fa-search fa-3x mb-3 opacity-25"></i><p>Sin resultados.</p>
  </div>
</div>

<!-- MODAL -->
<div class="modal fade" id="airlineModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalTitle"><i class="fas fa-plane me-2"></i>Aerolinea</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="row g-3">
          <div class="col-md-5">
            <label class="form-label small fw-semibold">Nombre *</label>
            <input type="text" class="form-control form-control-sm" id="f-name">
          </div>
          <div class="col-md-2">
            <label class="form-label small fw-semibold">IATA</label>
            <input type="text" class="form-control form-control-sm" id="f-iata" maxlength="3" style="text-transform:uppercase">
          </div>
          <div class="col-md-2">
            <label class="form-label small fw-semibold">ICAO</label>
            <input type="text" class="form-control form-control-sm" id="f-icao" maxlength="4" style="text-transform:uppercase">
          </div>
          <div class="col-md-1">
            <label class="form-label small fw-semibold">Color</label>
            <input type="color" class="form-control form-control-sm form-control-color w-100" id="f-color" value="#0d6efd">
          </div>
          <div class="col-md-2">
            <label class="form-label small fw-semibold">Tipos</label>
            <div class="d-flex flex-column gap-1 mt-1">
              <div class="form-check form-check-sm"><input class="form-check-input" type="checkbox" id="f-nac" value="nacional"><label class="form-check-label small" for="f-nac">Nacional</label></div>
              <div class="form-check form-check-sm"><input class="form-check-input" type="checkbox" id="f-int" value="internacional"><label class="form-check-label small" for="f-int">Internacional</label></div>
              <div class="form-check form-check-sm"><input class="form-check-input" type="checkbox" id="f-car" value="carga"><label class="form-check-label small" for="f-car">Carga</label></div>
              <div class="form-check form-check-sm"><input class="form-check-input" type="checkbox" id="f-pax" value="pasajeros"><label class="form-check-label small" for="f-pax">Pasajeros</label></div>
            </div>
          </div>
          <div class="col-md-6">
            <label class="form-label small fw-semibold">Aliases (uno por linea)</label>
            <textarea class="form-control form-control-sm" id="f-aliases" rows="3"></textarea>
          </div>
          <div class="col-md-6">
            <label class="form-label small fw-semibold">Logo (Supabase Storage)</label>
            <div class="drop-zone" id="dropZone" onclick="document.getElementById('f-file').click()"
              ondragover="onDragOver(event)" ondragleave="onDragLeave(event)" ondrop="onDrop(event)">
              <input type="file" id="f-file" accept="image/png,image/jpeg,image/svg+xml,image/webp" onchange="onFileSelected(event)">
              <i class="fas fa-upload fa-lg text-muted mb-1 d-block"></i>
              <div class="small text-muted" id="dropText">Arrastra una imagen o haz clic<br><span style="font-size:.7rem">PNG,JPG,SVG,WebP max 2MB</span></div>
            </div>
            <div class="mt-2 align-items-center gap-2 d-none" id="uploadProgress">
              <div class="progress" style="height:6px"><div class="progress-bar progress-bar-striped progress-bar-animated" id="uploadBar" style="width:0%"></div></div>
              <span class="small text-muted" id="uploadPct">0%</span>
            </div>
          </div>
          <div class="col-12">
            <label class="form-label small fw-semibold">Vista previa</label>
            <div class="d-flex align-items-center gap-3 p-3 rounded" style="background:#f8f9fa;border:1px dashed #dee2e6;min-height:75px" id="logoPreview">
              <span class="text-muted small">Sube un logo para ver la vista previa</span>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer justify-content-between">
        <button class="btn btn-outline-danger btn-sm d-none" id="btnDelete" onclick="deleteAirline()"><i class="fas fa-trash me-1"></i>Eliminar</button>
        <div class="d-flex gap-2">
          <button class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancelar</button>
          <button class="btn btn-primary btn-sm" onclick="saveAirline()"><i class="fas fa-save me-1"></i>Guardar</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="js/supabase-client.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
const BUCKET  = 'airline-logos';
const TABLE   = 'airlines';
const GURL    = function(iata){ return 'https://www.gstatic.com/flights/airline_logos/70px/' + iata + '.png'; };

var sb, allAirlines=[], filtered=[], activeFilter='all', logoFilter='all', sortField='name', editingId=null, pendingFile=null;

document.addEventListener('DOMContentLoaded', async function(){
  try {
    sb = window.supabaseClient;
    if (!sb) throw new Error('supabaseClient no disponible. Verifica js/supabase-client.js');
    document.getElementById('connectedBadge').classList.remove('d-none');
    await reloadFromDB();
  } catch(e){
    hideLoading();
    document.getElementById('airlinesGrid').innerHTML = '<div class="col-12"><div class="alert alert-danger"><i class="fas fa-exclamation-triangle me-2"></i>' + e.message + '</div></div>';
  }
});

async function reloadFromDB(){
  showLoading();
  var res = await sb.from(TABLE).select('*').order('name');
  hideLoading();
  if (res.error){ showError('Error: ' + res.error.message); return; }
  allAirlines = res.data || [];
  updateStats();
  applyFilters();
}

function updateStats(){
  var wS = allAirlines.filter(function(a){ return !!a.logo_url; }).length;
  var wG = allAirlines.filter(function(a){ return !a.logo_url && !!a.iata; }).length;
  var wN = allAirlines.filter(function(a){ return !a.logo_url && !a.iata; }).length;
  setEl('stat-total',   allAirlines.length);
  setEl('stat-storage', wS);
  setEl('stat-gstatic', wG);
  setEl('stat-nologo',  wN);
  setEl('stat-nac', allAirlines.filter(function(a){ return (a.types||[]).includes('nacional'); }).length);
  setEl('stat-int', allAirlines.filter(function(a){ return (a.types||[]).includes('internacional'); }).length);
}
function setEl(id,v){ document.getElementById(id).textContent = v; }

function setFilter(f,btn){
  activeFilter = f;
  document.querySelectorAll('[data-f]').forEach(function(b){ b.classList.remove('active'); });
  btn.classList.add('active'); applyFilters();
}
function setLogoFilter(f,btn){
  logoFilter = f;
  document.querySelectorAll('[data-l]').forEach(function(b){ b.classList.remove('active'); });
  btn.classList.add('active'); applyFilters();
}
function sortBy(f){ sortField=f; applyFilters(); }

function logoType(a){ return a.logo_url ? 'storage' : (a.iata ? 'gstatic' : 'none'); }

function applyFilters(){
  var q = (document.getElementById('searchInput').value||'').toLowerCase().trim();
  filtered = allAirlines.filter(function(a){
    if (activeFilter!=='all' && !(a.types||[]).includes(activeFilter)) return false;
    if (logoFilter!=='all'   && logoType(a)!==logoFilter)              return false;
    if (q){
      var hay = [a.name,a.iata,a.icao].concat(a.aliases||[]).join(' ').toLowerCase();
      if (!hay.includes(q)) return false;
    }
    return true;
  });
  filtered.sort(function(a,b){ return sortField==='iata' ? (a.iata||'ZZZ').localeCompare(b.iata||'ZZZ') : a.name.localeCompare(b.name,'es'); });
  renderGrid();
  setEl('resultCount', filtered.length + ' aerolineas');
}

function renderGrid(){
  var grid = document.getElementById('airlinesGrid');
  var empty = document.getElementById('emptyState');
  if (!filtered.length){ grid.innerHTML=''; empty.classList.remove('d-none'); return; }
  empty.classList.add('d-none');
  grid.innerHTML = filtered.map(cardHTML).join('');
}

function logoImgHTML(a){
  var style='max-height:46px;max-width:100%;object-fit:contain';
  if (a.logo_url) return '<img src="'+a.logo_url+'" alt="'+a.name+'" style="'+style+'" onerror="this.style.display=\'none\'">';
  if (a.iata)     return '<img src="'+GURL(a.iata)+'" alt="'+a.name+'" style="'+style+'" onerror="this.parentElement.innerHTML=\'<span style=\\\'font-size:.68rem;color:#adb5bd\\\'>Sin logo</span>\'">';
  return '<span style="font-size:.68rem;color:#adb5bd"><i class="fas fa-plane d-block"></i>Sin logo</span>';
}

function cardHTML(a){
  var color = a.color||'#0d6efd';
  var lt    = logoType(a);
  var dotC  = {storage:'dot-storage',gstatic:'dot-gstatic',none:'dot-none'}[lt];
  var dotT  = {storage:'Supabase Storage',gstatic:'Google IATA',none:'Sin logo'}[lt];
  var types = (a.types||[]).map(function(t){ return '<span class="badge-type badge-'+t+'">'+t+'</span>'; }).join(' ');
  return '<div class="col-6 col-sm-4 col-md-3 col-lg-2">'+
    '<div class="airline-card" onclick="openEditModal(\''+a.id+'\')">'+
      '<div class="card-accent" style="background:'+color+'"></div>'+
      '<div class="dot '+dotC+'" title="'+dotT+'"></div>'+
      '<div class="card-body-inner">'+
        '<div class="logo-box">'+logoImgHTML(a)+'</div>'+
        '<div class="airline-name">'+a.name+'</div>'+
        '<div class="d-flex gap-1 mb-1">'+
          (a.iata?'<span class="iata-badge">'+a.iata+'</span>':'')+
          (a.icao?'<span class="iata-badge" style="background:#e2e8f0">'+a.icao+'</span>':'')+
        '</div>'+
        '<div class="d-flex flex-wrap gap-1">'+types+'</div>'+
      '</div>'+
    '</div>'+
  '</div>';
}

function openAddModal(){
  editingId=null; pendingFile=null;
  document.getElementById('modalTitle').innerHTML='<i class="fas fa-plus me-2"></i>Agregar Aerolinea';
  document.getElementById('btnDelete').classList.add('d-none');
  clearForm();
  document.getElementById('logoPreview').innerHTML='<span class="text-muted small">Sube un logo para ver la vista previa</span>';
  new bootstrap.Modal(document.getElementById('airlineModal')).show();
}
function openEditModal(id){
  var a = allAirlines.find(function(x){ return x.id===id; });
  if (!a) return;
  editingId=id; pendingFile=null;
  document.getElementById('modalTitle').innerHTML='<i class="fas fa-edit me-2"></i>Editar: '+a.name;
  document.getElementById('btnDelete').classList.remove('d-none');
  fillForm(a);
  new bootstrap.Modal(document.getElementById('airlineModal')).show();
}
function clearForm(){
  ['f-name','f-iata','f-icao','f-aliases'].forEach(function(id){ document.getElementById(id).value=''; });
  ['f-nac','f-int','f-car','f-pax'].forEach(function(id){ document.getElementById(id).checked=false; });
  document.getElementById('f-color').value='#0d6efd';
  document.getElementById('f-file').value='';
  document.getElementById('dropText').innerHTML='Arrastra una imagen o haz clic<br><span style="font-size:.7rem">PNG,JPG,SVG,WebP max 2MB</span>';
}
function fillForm(a){
  document.getElementById('f-name').value    = a.name||'';
  document.getElementById('f-iata').value    = a.iata||'';
  document.getElementById('f-icao').value    = a.icao||'';
  document.getElementById('f-color').value   = a.color||'#0d6efd';
  document.getElementById('f-aliases').value = (a.aliases||[]).join('\n');
  ['f-nac','f-int','f-car','f-pax'].forEach(function(id){
    document.getElementById(id).checked = (a.types||[]).includes(document.getElementById(id).value);
  });
  var prev = document.getElementById('logoPreview');
  if (a.logo_url){
    prev.innerHTML='<img src="'+a.logo_url+'" style="max-height:65px;object-fit:contain" alt="'+a.name+'"><div class="small ms-2 text-muted">Logo actual<br><span class="text-success"><i class="fas fa-cloud me-1"></i>Supabase Storage</span></div>';
  } else if (a.iata){
    prev.innerHTML='<img src="'+GURL(a.iata)+'" style="max-height:48px;object-fit:contain" alt="'+a.name+'"><div class="small ms-2 text-muted">Logo IATA (Google)<br><span class="text-warning"><i class="fas fa-exclamation-triangle me-1"></i>No esta en Storage</span></div>';
  } else {
    prev.innerHTML='<span class="text-muted small">Sin logo - sube uno arriba</span>';
  }
  document.getElementById('dropText').innerHTML = a.logo_filename
    ? '<span class="text-success small"><i class="fas fa-check me-1"></i>'+a.logo_filename+'</span><br><span style="font-size:.7rem" class="text-muted">Haz clic para cambiar</span>'
    : 'Arrastra una imagen o haz clic<br><span style="font-size:.7rem">PNG,JPG,SVG,WebP max 2MB</span>';
}

function onDragOver(e){ e.preventDefault(); document.getElementById('dropZone').classList.add('drag-over'); }
function onDragLeave(){ document.getElementById('dropZone').classList.remove('drag-over'); }
function onDrop(e){ e.preventDefault(); document.getElementById('dropZone').classList.remove('drag-over'); var f=e.dataTransfer.files[0]; if(f) handleFile(f); }
function onFileSelected(e){ var f=e.target.files[0]; if(f) handleFile(f); }
function handleFile(file){
  if (file.size>2*1024*1024){ alert('El archivo supera 2 MB.'); return; }
  pendingFile=file;
  var url=URL.createObjectURL(file);
  document.getElementById('dropText').innerHTML='<span class="text-success small"><i class="fas fa-check me-1"></i>'+file.name+'</span><br><span style="font-size:.7rem" class="text-muted">Haz clic para cambiar</span>';
  document.getElementById('logoPreview').innerHTML='<img src="'+url+'" style="max-height:65px;object-fit:contain"><div class="small ms-2 text-muted">Vista previa<br>'+file.name+'</div>';
}

async function saveAirline(){
  var name    = document.getElementById('f-name').value.trim();
  var iata    = document.getElementById('f-iata').value.trim().toUpperCase()||null;
  var icao    = document.getElementById('f-icao').value.trim().toUpperCase()||null;
  var color   = document.getElementById('f-color').value;
  var aliases = document.getElementById('f-aliases').value.split('\n').map(function(s){ return s.trim(); }).filter(Boolean);
  var types   = ['f-nac','f-int','f-car','f-pax'].filter(function(id){ return document.getElementById(id).checked; }).map(function(id){ return document.getElementById(id).value; });
  if (!name){ alert('Nombre obligatorio.'); return; }
  var id = editingId || name.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'');
  var logo_url=null, logo_filename=null;
  if (pendingFile){
    var r=await uploadLogo(pendingFile,id); if(!r) return;
    logo_url=r.url; logo_filename=r.filename;
  } else if (editingId){
    var ex=allAirlines.find(function(a){ return a.id===editingId; });
    logo_url=ex?ex.logo_url:null; logo_filename=ex?ex.logo_filename:null;
  }
  var payload={id,name,iata,icao,color,text_color:'#ffffff',types,aliases,logo_url,logo_filename,active:true};
  var res = editingId ? await sb.from(TABLE).update(payload).eq('id',editingId) : await sb.from(TABLE).insert(payload);
  if (res.error){ alert('Error guardando: '+res.error.message); return; }
  bootstrap.Modal.getInstance(document.getElementById('airlineModal'))?.hide();
  showToast((editingId?'Actualizada':'Agregada')+': '+name,'success');
  await reloadFromDB();
}

async function uploadLogo(file,airlineId){
  var ext=file.name.split('.').pop(), filename=airlineId+'.'+ext;
  var progress=document.getElementById('uploadProgress'), bar=document.getElementById('uploadBar'), pct=document.getElementById('uploadPct');
  progress.classList.remove('d-none'); bar.style.width='30%'; pct.textContent='30%';
  await sb.storage.from(BUCKET).remove([filename]);
  bar.style.width='60%'; pct.textContent='60%';
  var up=await sb.storage.from(BUCKET).upload(filename,file,{upsert:true,contentType:file.type});
  if(up.error){ progress.classList.add('d-none'); alert('Error subiendo: '+up.error.message); return null; }
  bar.style.width='100%'; pct.textContent='100%';
  setTimeout(function(){ progress.classList.add('d-none'); },800);
  var pub=sb.storage.from(BUCKET).getPublicUrl(filename);
  return {url:pub.data.publicUrl,filename};
}

async function deleteAirline(){
  var a=allAirlines.find(function(x){ return x.id===editingId; });
  if (!confirm('Eliminar "'+( a?a.name:editingId)+'"? No se puede deshacer.')) return;
  if (a&&a.logo_filename) await sb.storage.from(BUCKET).remove([a.logo_filename]);
  var res=await sb.from(TABLE).delete().eq('id',editingId);
  if (res.error){ alert('Error eliminando: '+res.error.message); return; }
  bootstrap.Modal.getInstance(document.getElementById('airlineModal'))?.hide();
  showToast('Aerolinea eliminada.','warning');
  await reloadFromDB();
}

function showLoading(){ document.getElementById('loadingOverlay').style.display='flex'; }
function hideLoading(){ document.getElementById('loadingOverlay').style.display='none'; }
function showError(msg){ document.getElementById('airlinesGrid').innerHTML='<div class="col-12"><div class="alert alert-danger"><i class="fas fa-exclamation-triangle me-2"></i>'+msg+'</div></div>'; }
function showToast(msg,type){
  var t=document.createElement('div');
  t.className='alert alert-'+(type||'success')+' position-fixed bottom-0 end-0 m-3 shadow';
  t.style.cssText='z-index:9999;min-width:270px';
  t.textContent=msg;
  document.body.appendChild(t);
  setTimeout(function(){ t.remove(); },4000);
}
</script>
</body>
</html>