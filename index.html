<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Operaciones AIFA</title>
    <meta name="theme-color" content="#0a1f44" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Roboto+Mono:wght@400;700&family=Roboto+Condensed:wght@400;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <link rel="stylesheet" href="style.css?v=20260203">
    <link rel="stylesheet" href="visual-cards.css?v=1"> <!-- Visual Cards Styles -->
    <link rel="stylesheet" href="admin.css?v=20260203">
    <link rel="icon" type="image/png" sizes="192x192" href="images/icons/aifa-app-icon-192.png?v=20251126">
    <link rel="icon" type="image/png" sizes="512x512" href="images/icons/aifa-app-icon-512.png?v=20251126">
    <link rel="apple-touch-icon" sizes="180x180" href="images/icons/aifa-app-icon-512.png?v=20251126">
    <link rel="manifest" href="manifest.webmanifest?v=20251126">
    
    <!-- Preload Critical Images for Fluid Performance -->
    <link rel="preload" as="image" href="images/torre.jpg" fetchpriority="high">
    <link rel="preload" as="image" href="images/Analisis_pax.jpg">
    <link rel="preload" as="image" href="images/An%C3%A1lisis_carga.jpg">
    <link rel="preload" as="image" href="images/An%C3%A1lisis_priv.jpg">
    <link rel="preload" as="image" href="images/Aviones%20pax.jpeg">
    <link rel="preload" as="image" href="images/Pax.jpeg">
    <link rel="preload" as="image" href="images/Aeronaves%20carga.jpg">
    <link rel="preload" as="image" href="images/Carga%20a%C3%A9rea.jpg">
    <link rel="preload" as="image" href="images/Aviones%20FBO.png">
    <link rel="preload" as="image" href="images/Pasajero%20FBO.jpg">

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- PDF.js (CDN for stability) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>

    <script src="js/supabase-client.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> 
    <!-- Chart.js for visualizations -->

    <!-- jQuery (Required for DataTables & PivotTable.js) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    
    <!-- DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/fixedheader/3.4.0/css/fixedHeader.bootstrap5.min.css">
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/fixedheader/3.4.0/js/dataTables.fixedHeader.min.js"></script>
    
    <style>
        /* Excel-like Table Styles */
        #ops-datatable {
            width: 100% !important;
        }

        .dataTables_wrapper .dataTables_scrollHead table thead th {
            background-color: #0f5132;
            color: #ffffff;
            font-weight: 700;
            border-bottom: 2px solid #0b3d26;
            border-right: 1px solid rgba(255, 255, 255, 0.25);
            position: relative;
            padding: 0.6rem 2rem 0.6rem 0.5rem !important;
            white-space: nowrap;
            text-align: center !important;
            vertical-align: middle !important;
        }

        .dataTables_wrapper .dataTables_scrollHead table thead th:last-child {
            border-right: none;
        }

        .dataTables_scrollHead th {
            background-color: #0f5132 !important;
            color: #ffffff !important;
            text-align: center !important;
            vertical-align: middle !important;
        }

        /* Hide DataTables sorting arrows completely */
        table.dataTable thead .sorting,
        table.dataTable thead .sorting_asc,
        table.dataTable thead .sorting_desc,
        table.dataTable thead .sorting_asc_disabled,
        table.dataTable thead .sorting_desc_disabled {
            cursor: default !important;
            background-image: none !important;
        }

        table.dataTable thead .sorting:before,
        table.dataTable thead .sorting:after,
        table.dataTable thead .sorting_asc:before,
        table.dataTable thead .sorting_asc:after,
        table.dataTable thead .sorting_desc:before,
        table.dataTable thead .sorting_desc:after {
            display: none !important;
            content: "" !important;
        }

        .dataTables_wrapper .dataTables_scrollHead table thead th,
        #ops-datatable tbody td {
            box-sizing: border-box;
        }

        .dataTables_scrollHead table,
        .dataTables_scrollBody table {
            margin: 0 !important;
            table-layout: fixed !important;
        }


        #ops-datatable tbody td {
            vertical-align: middle;
            font-size: 0.85rem;
            white-space: nowrap;
            padding: 0.5rem;
            text-align: center !important;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 0;
        }

        .dataTables_wrapper .dataTables_scrollHead table thead th {
            overflow: hidden;
            text-overflow: ellipsis;
        }

        #ops-datatable tbody tr:hover {
            background-color: #e2e6ea;
        }

        /* Excel Filter Dropdown */
        .excel-filter-btn {
            position: absolute;
            right: 4px;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.85);
            cursor: pointer;
            padding: 2px 4px;
            font-size: 0.8rem;
            transition: color 0.15s;
        }

        .excel-filter-btn:hover, .excel-filter-btn.active {
            color: #ffffff;
            background-color: rgba(255, 255, 255, 0.16);
            border-radius: 4px;
        }

        .excel-filter-dropdown {
            min-width: 250px;
            padding: 0.5rem;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(0,0,0,.15);
            border-radius: 4px;
            font-size: 0.85rem;
            max-height: 400px;
            display: flex;
            flex-direction: column;
        }

        .excel-filter-search {
            margin-bottom: 0.5rem;
        }

        .excel-filter-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            margin-bottom: 0.5rem;
            padding: 0.25rem;
            background: #fff;
        }

        .excel-filter-item {
            display: flex;
            align-items: center;
            padding: 2px 4px;
            cursor: pointer;
        }
        
        .excel-filter-item:hover {
            background-color: #f8f9fa;
        }

        .excel-filter-item input {
            margin-right: 6px;
        }

        .excel-filter-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid #dee2e6;
        }
        
        .dataTables_wrapper .dataTables_filter {
            margin-bottom: 1rem;
        }

        /* Excel-like Filter Styles */
        .excel-filter-header {
            position: relative;
            cursor: pointer;
            padding-right: 22px !important;
            display: table-cell !important;
            vertical-align: middle !important;
            white-space: nowrap;
        }

        /* CSV Vuelos (Parte de Operaciones) */
        #table-ops-flights-csv tbody tr {
            cursor: pointer;
        }

        #table-ops-flights-csv tbody tr.csv-row-selected > td {
            background-color: #fff3cd !important;
        }

        #table-ops-flights-csv tbody tr:nth-child(even) > td {
            background-color: #f8f9fa;
        }

        #table-ops-flights-csv tbody tr.csv-row-selected:nth-child(even) > td {
            background-color: #fff3cd !important;
        }

        #table-ops-flights-csv tbody tr.row-validated > td {
            background-color: #d4f5e2 !important;
            border-left: 3px solid #28a745;
        }
        #table-ops-flights-csv tbody tr.row-validated.csv-row-selected > td {
            background-color: #a8e8c1 !important;
        }

        /* ── Observaciones cell ── */
        .obs-display {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            border-radius: 5px;
            padding: 3px 6px;
            min-height: 28px;
            transition: background .15s;
        }
        .obs-display:hover { background: #d4f5d4; }
        .obs-text {
            font-size: .75rem;
            color: #1a5c2a;
            flex: 1;
            white-space: pre-wrap;
            word-break: break-word;
        }
        .obs-placeholder {
            font-size: .72rem;
            color: #94a3b8;
            flex: 1;
            font-style: italic;
        }
        .obs-edit-icon {
            font-size: .6rem;
            color: #6aad7a;
            opacity: 0;
            transition: opacity .15s;
            flex-shrink: 0;
        }
        .obs-display:hover .obs-edit-icon { opacity: 1; }
        .obs-edit-wrap {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .obs-textarea {
            font-size: .75rem !important;
            resize: vertical;
            min-height: 52px;
            border-color: #28a745 !important;
            box-shadow: 0 0 0 2px rgba(40,167,69,.18) !important;
        }
        .obs-btn-row {
            display: flex;
            gap: 4px;
            justify-content: flex-end;
        }
        .btn-xs {
            font-size: .68rem;
            padding: 2px 8px;
            line-height: 1.4;
            border-radius: 4px;
        }

        #table-ops-flights-csv .csv-status {
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.2px;
        }

        #table-ops-flights-csv .csv-status-blue {
            background-color: #dbeafe;
            color: #1e40af;
        }

        #table-ops-flights-csv .csv-status-green {
            background-color: #dcfce7;
            color: #166534;
        }

        #table-ops-flights-csv .csv-status-red {
            background-color: #fee2e2;
            color: #991b1b;
        }

        #table-ops-flights-csv .csv-filter-row th {
            padding: 0.25rem;
        }

        #table-ops-flights-csv .csv-filter-row input {
            font-size: 0.7rem;
        }

        #table-ops-flights-csv td,
        #table-ops-flights-csv th {
            white-space: nowrap;
        }

        /* Scrollbar siempre visible — el contenedor tiene altura fija */
        #container-ops-flights-csv {
            max-height: calc(100vh - 280px);
            overflow: auto !important;
            /* Scrollbar horizontal siempre visible en navegadores WebKit */
            scrollbar-width: thin;
        }
        #container-ops-flights-csv::-webkit-scrollbar {
            height: 10px;
            width: 8px;
        }
        #container-ops-flights-csv::-webkit-scrollbar-track {
            background: #f1f3f5;
            border-radius: 4px;
        }
        #container-ops-flights-csv::-webkit-scrollbar-thumb {
            background: #adb5bd;
            border-radius: 4px;
        }
        #container-ops-flights-csv::-webkit-scrollbar-thumb:hover {
            background: #6c757d;
        }

        /* Solo la fila de encabezados es sticky — los filtros NO siguen el scroll */
        #table-ops-flights-csv thead tr:first-child th {
            position: sticky;
            top: 0;
            z-index: 3;
            background: #f8f9fa;
            box-shadow: 0 1px 2px rgba(0,0,0,.08);
        }

        /* Botón de filtro embudo en cada encabezado del itinerario CSV */
        .csv-ef-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-left: 4px;
            padding: 1px 3px;
            border: none;
            background: none;
            color: #6c757d;
            font-size: .62rem;
            cursor: pointer;
            vertical-align: middle;
            border-radius: 3px;
            transition: color .15s, background .15s;
        }
        .csv-ef-btn:hover { color: #212529; background: rgba(0,0,0,.08); }
        .csv-ef-btn.csv-ef-btn-active {
            color: #fff;
            background: #0d6efd;
            border-radius: 3px;
        }
        .csv-ef-btn.csv-ef-btn-active:hover { background: #0b5ed7; }

        /* Flex wrapper inside each filterable header cell */
        #table-ops-flights-csv thead tr:first-child th .csv-th-inner {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 4px;
            white-space: nowrap;
        }
        #table-ops-flights-csv thead tr:first-child th .csv-th-inner > span {
            overflow: hidden;
            text-overflow: ellipsis;
            min-width: 0;
        }

        /* Filas del dropdown de filtro Excel */
        .csv-ef-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 3px 4px;
            border-radius: 3px;
            cursor: pointer;
            font-size: .78rem;
        }
        .csv-ef-item:hover { background: #e9ecef; }
        .csv-ef-item label { cursor: pointer; margin: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        /* Label text = "solo este" click target */
        .csv-ef-label {
            cursor: pointer;
            margin: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex: 1;
            padding: 1px 4px;
            border-radius: 3px;
            transition: background .12s, color .12s;
        }
        .csv-ef-label:hover {
            background: #0d6efd;
            color: #fff;
        }

        .filter-icon {
            position: absolute;
            right: 6px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.65rem;
            color: #adb5bd;
            /* Medium gray */
            transition: all 0.2s;
            pointer-events: none;
        }

        .excel-filter-header:hover .filter-icon {
            color: #6c757d;
        }

        .filter-header-active {
            background-color: rgba(13, 110, 253, 0.1) !important;
            color: #0d6efd !important;
        }

        /* ── Board View (Llegadas / Salidas) column filters ───────── */
        .board-filter-row td {
            background: #f0f4f8 !important;
            padding: 3px !important;
        }
        .board-col-filter {
            font-size: 0.72rem !important;
            border-radius: 5px !important;
            border: 1px solid #cbd5e0 !important;
            background: #fff !important;
            padding: 2px 5px !important;
            height: 26px !important;
            text-align: center;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .board-col-filter:focus {
            outline: none;
            border-color: #2980b9 !important;
            box-shadow: 0 0 0 2px rgba(41,128,185,0.18) !important;
        }
        #table-board-arrivals .board-col-filter:focus {
            border-color: #27ae60 !important;
            box-shadow: 0 0 0 2px rgba(39,174,96,0.18) !important;
        }
        .board-col-filter.active-filter {
            border-color: #f39c12 !important;
            background: #fffde7 !important;
        }
        .board-global-search {
            max-width: 320px;
            border-radius: 8px;
            overflow: hidden;
        }
        .board-global-search .form-control:focus {
            box-shadow: none !important;
            border-color: #dee2e6;
        }

        .filter-icon.active {
            color: #0d6efd !important;
            font-weight: bold;
        }

        /* ── Flight Tables (Llegadas / Salidas) ───────────────────────── */
        .flights-card {
            border-radius: 12px !important;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.10) !important;
            border: none !important;
        }
        .flights-card .card-header {
            padding: 0.65rem 1rem !important;
            letter-spacing: 0.3px;
        }
        .flights-card .card-header.arr-header {
            background: linear-gradient(135deg, #1a7a4a 0%, #27ae60 100%) !important;
        }
        .flights-card .card-header.dep-header {
            background: linear-gradient(135deg, #0d4fa3 0%, #2980b9 100%) !important;
        }
        .flights-count-badge {
            font-size: 0.78rem !important;
            font-weight: 700 !important;
            letter-spacing: 0.5px;
            padding: 0.3em 0.7em !important;
            border-radius: 20px !important;
            opacity: 0.95;
        }
        .flights-global-search {
            border-radius: 8px !important;
            overflow: hidden;
        }
        .flights-global-search .input-group-text {
            background: #fff;
            border-right: none;
            color: #6c757d;
        }
        .flights-global-search .form-control {
            border-left: none;
            box-shadow: none !important;
        }
        .flights-global-search .form-control:focus {
            border-color: #dee2e6;
        }
        /* Filter row inside flights tables */
        #table-daily-flights-arrivals .filter-row td,
        #table-daily-flights-departures .filter-row td {
            background: #f0f4f8;
            padding: 4px 3px !important;
        }
        #table-daily-flights-arrivals .filter-row .flights-col-filter,
        #table-daily-flights-departures .filter-row .flights-col-filter {
            font-size: 0.72rem !important;
            border-radius: 5px !important;
            border: 1px solid #cbd5e0 !important;
            background: #fff !important;
            text-align: center;
            padding: 2px 5px !important;
            height: 26px !important;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        #table-daily-flights-arrivals .filter-row .flights-col-filter:focus,
        #table-daily-flights-departures .filter-row .flights-col-filter:focus {
            border-color: #27ae60 !important;
            box-shadow: 0 0 0 2px rgba(39,174,96,0.15) !important;
            outline: none;
        }
        #table-daily-flights-departures .filter-row .flights-col-filter:focus {
            border-color: #2980b9 !important;
            box-shadow: 0 0 0 2px rgba(41,128,185,0.15) !important;
        }
        #table-daily-flights-arrivals .filter-row .flights-col-filter.active-filter,
        #table-daily-flights-departures .filter-row .flights-col-filter.active-filter {
            border-color: #f39c12 !important;
            background: #fffde7 !important;
        }
        /* Table rows */
        #table-daily-flights-arrivals tbody tr,
        #table-daily-flights-departures tbody tr {
            transition: background 0.15s;
        }
        #table-daily-flights-arrivals.table-hover tbody tr:hover td,
        #table-daily-flights-departures.table-hover tbody tr:hover td {
            background: rgba(39,174,96,0.07) !important;
        }
        #table-daily-flights-departures.table-hover tbody tr:hover td {
            background: rgba(41,128,185,0.07) !important;
        }
        /* Header cells */
        #table-daily-flights-arrivals thead tr:first-child th,
        #table-daily-flights-departures thead tr:first-child th {
            background: #f8fafc;
            font-size: 0.68rem;
            font-weight: 700;
            color: #4a5568;
            letter-spacing: 0.4px;
            border-bottom: 2px solid #e2e8f0;
            white-space: nowrap;
        }
        /* ────────────────────────────────────────────────────────────── */

        /* ── Date-filter panel (shared by main-page & board-view tables) ─── */
        .board-date-panel {
            padding: 12px 16px 14px;
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.10);
            animation: dateFilterSlide .15s ease;
        }
        @keyframes dateFilterSlide {
            from { opacity: 0; transform: translateY(-6px); }
            to   { opacity: 1; transform: translateY(0); }
        }
        /* CSV Vista General date filter card (popover style) */
        .csv-date-filter-card {
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 12px 16px 14px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
            animation: dateFilterSlide .15s ease;
            min-width: 260px;
        }
        /* Arrivals panels: green accent on header text only (handled inline) */
        /* Funnel toggle button */
        .btn-date-filter-toggle {
            padding: 2px 7px !important;
            font-size: 0.8rem !important;
            border-radius: 6px !important;
            opacity: 0.85;
            transition: opacity .15s, background .15s, border-color .15s;
        }
        .btn-date-filter-toggle:hover { opacity: 1; }
        .btn-date-filter-toggle.active-date-filter {
            background: #fff3cd !important;
            border-color: #ffc107 !important;
            color: #856404 !important;
            opacity: 1;
        }
        /* Small mode-toggle buttons (Relativo / Absoluto) */
        .btn.btn-xs {
            padding: 2px 8px !important;
            font-size: 0.75rem !important;
            line-height: 1.5;
            border-radius: 5px !important;
        }
        .board-mode-btn {
            background: #e9ecef;
            border: 1px solid #ced4da;
            color: #495057;
            transition: background .15s, color .15s, border-color .15s;
        }
        .board-mode-btn.active {
            background: #0d6efd;
            color: #fff;
            border-color: #0d6efd;
        }
        /* Green active state for arrivals panels */
        #daily-date-panel-arr .board-mode-btn.active,
        #board-date-panel-arr .board-mode-btn.active {
            background: #28a745;
            border-color: #28a745;
        }
        .board-date-mode-section {
            padding-top: 6px;
        }

        .excel-filter-menu {
            position: fixed;
            z-index: 9999;
            background: white;
            border: 1px solid #ddd;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            width: 220px;
            border-radius: 4px;
            padding: 10px;
            display: none;
            font-family: 'Roboto', sans-serif;
        }

        .excel-filter-search {
            margin-bottom: 8px;
        }

        .excel-filter-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #eee;
            margin-bottom: 10px;
            padding: 5px;
        }

        .excel-filter-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 2px;
            font-size: 0.75rem;
            cursor: pointer;
        }

        .excel-filter-item:hover {
            background-color: #f8f9fa;
        }

        .excel-filter-item input {
            cursor: pointer;
        }

        .excel-filter-footer {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }

        .excel-filter-footer button {
            font-size: 0.75rem;
            padding: 4px 12px;
        }

        .filter-row {
            background-color: #f8f9fa;
        }

        .filter-row td {
            padding: 4px !important;
            border-bottom: 2px solid #dee2e6 !important;
        }

        .filter-row input {
            border: 1px solid #ced4da;
            border-radius: 4px;
            padding: 2px 5px;
            width: 100%;
            font-size: 0.75rem;
            transition: border-color 0.2s;
        }

        .filter-row input:focus {
            border-color: #0d6efd;
            outline: none;
            box-shadow: 0 0 0 2px rgba(13, 110, 253, 0.25);
        }

        .filter-row input::placeholder {
            color: #adb5bd;
            font-style: italic;
        }

        /* Map Container */
        .map-container-wrapper {
            background: #f8f9fa;
            border-radius: 4px;
            overflow: hidden;
            height: 650px;
        }

        /* Custom scrollbar and alignment for Ops Flights CSV (Parte de Operaciones) */
        #container-ops-flights-csv {
            overflow-x: scroll !important; /* Force scrollbar track to be visible always */
            width: 100%;
            display: block;
            padding-bottom: 15px; /* Ensure space for scrollbar */
        }
        
        #container-ops-flights-csv::-webkit-scrollbar {
            height: 16px; /* Slightly taller to be more visible */
            display: block !important;
            background-color: #f1f1f1; /* Ensure track has color */
        }

        #container-ops-flights-csv::-webkit-scrollbar-thumb {
            background-color: #a0a0a0; /* Darker thumb for better visibility */
            border-radius: 8px;
            border: 3px solid #f1f1f1; /* Creates padding effect */
        }
        
        #container-ops-flights-csv::-webkit-scrollbar-track {
            background: #f1f1f1; 
            border-top: 1px solid #e0e0e0;
        }

        /* Default tight style for all columns in this table to shrink them */
        #table-ops-flights-csv th, 
        #table-ops-flights-csv td {
             padding: 2px 4px !important;
             width: 1px; /* Forces shrink to fit content width */
             white-space: nowrap;
        }

        /* Specific style for Date/Time columns to give them separation and left alignment */
        /* Columns: 4 ([Arr] ALDT), 5 ([Arr] SIBT), 6 ([Arr] AIBT) */
        /* Columns: 21 ([Dep] SOBT), 22 ([Dep] AOBT), 23 ([Dep] ATOT), 24 ([Dep] ATTT) */
        #table-ops-flights-csv th:nth-child(4),
        #table-ops-flights-csv td:nth-child(4),
        #table-ops-flights-csv th:nth-child(5),
        #table-ops-flights-csv td:nth-child(5),
        #table-ops-flights-csv th:nth-child(6),
        #table-ops-flights-csv td:nth-child(6),
        #table-ops-flights-csv th:nth-child(21),
        #table-ops-flights-csv td:nth-child(21),
        #table-ops-flights-csv th:nth-child(22),
        #table-ops-flights-csv td:nth-child(22),
        #table-ops-flights-csv th:nth-child(23),
        #table-ops-flights-csv td:nth-child(23),
        #table-ops-flights-csv th:nth-child(24),
        #table-ops-flights-csv td:nth-child(24) {
             padding-left: 30px !important;
             padding-right: 30px !important;
             text-align: left !important;
             min-width: 150px;
             width: auto; /* Allow expansion for these specific columns */
        }

        /* Ultra compact columns: Airline, Flight, Baggage, Service Type */
        /* Columns: 2, 3, 10, 11, 13, 16, 17 */
        #table-ops-flights-csv th:nth-child(2), #table-ops-flights-csv td:nth-child(2),
        #table-ops-flights-csv th:nth-child(3), #table-ops-flights-csv td:nth-child(3),
        #table-ops-flights-csv th:nth-child(10), #table-ops-flights-csv td:nth-child(10),
        #table-ops-flights-csv th:nth-child(11), #table-ops-flights-csv td:nth-child(11),
        #table-ops-flights-csv th:nth-child(13), #table-ops-flights-csv td:nth-child(13),
        #table-ops-flights-csv th:nth-child(16), #table-ops-flights-csv td:nth-child(16),
        #table-ops-flights-csv th:nth-child(17), #table-ops-flights-csv td:nth-child(17) {
            padding-left: 2px !important;
            padding-right: 2px !important;
            text-align: center !important;
            max-width: 80px; /* Force constraint */
            overflow: hidden;
            text-overflow: ellipsis;
        }
    </style>
</head>

<body>

    <div id="login-screen" class="login-screen">
        <video id="login-bg-video" class="login-bg-video" autoplay muted loop playsinline
            poster="images/fondo-aifa.jpg">
            <source src="videos/Aterrizaje%20AIFA.mp4" type="video/mp4">
        </video>
        <div id="login-sky" aria-hidden="true"></div>
        <div class="login-overlay"></div>
        <div class="login-container">
            <div class="login-header">
                <img src="images/emblema-aviacion.png" alt="Emblema de la Aviación" class="login-logo" />
                <h1 id="login-title" class="h3">OPERACIONES-AIFA</h1>
                <p class="text-muted">Ingrese sus credenciales para continuar</p>
            </div>
            <form id="login-form" class="login-form">
                <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="username" name="username" required placeholder=" "
                        autocomplete="username">
                    <label for="username">Usuario</label>
                </div>
                <div class="form-floating mb-3 position-relative">
                    <input type="password" class="form-control pe-5" id="password" name="password" required placeholder=" "
                        autocomplete="current-password">
                    <label for="password">Contraseña</label>
                    <span id="toggle-password" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; z-index: 10;">
                        <i class="fas fa-eye"></i>
                    </span>
                </div>
                <button type="submit" id="login-button" class="btn btn-primary w-100 py-2" aria-label="Iniciar Sesión">
                    <span class="btn-text">Iniciar Sesión</span>
                    <span class="spinner-plane" aria-hidden="true"></span>
                </button>
                <div id="login-error" class="text-danger mt-2"></div>
            </form>
        </div>
    </div>

    <div id="main-app" class="main-app hidden">
        <header class="header p-3">
            <div id="flying-plane">
                <div class="contrail"></div>
            </div>
            <div class="container-fluid">
                <div class="header-content d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <button class="btn sidebar-toggler-btn" type="button" id="sidebar-toggler"
                            aria-label="Alternar barra lateral">
                            <i class="fas fa-bars"></i>
                        </button>
                        <img src="images/aifa-logo.png" alt="Logo AIFA" class="aifa-logo" />
                    </div>
                    <div class="text-center header-center-content">
                        <div class="d-flex align-items-center justify-content-between gap-3 header-title-row">
                            <img src="images/nlu-operacion.png" alt="Logo de Operación NLU" class="header-logo" />
                            <h1 class="main-title">AEROPUERTO INTERNACIONAL FELIPE ÁNGELES</h1>
                            <img src="images/emblema-aviacion.png" alt="Logo de Aviación" class="header-logo" />
                        </div>
                        <div class="header-subtext">
                            <div id="current-user" class="current-user-display fw-bold"></div>
                            <p id="current-date" class="current-date-display fw-bold mb-0"></p>
                        </div>
                    </div>
                    <div class="d-flex align-items-center gap-3 header-right-content">
                        <div class="clocks-wrapper d-flex gap-2 align-items-center">
                            <div class="formal-clock-container">
                                <div class="clock-label">HORA LOCAL</div>
                                <div class="formal-clock" id="formal-clock">00:00:00</div>
                            </div>
                            <div class="utc-clock-container">
                                <div class="clock-label">HORA UTC</div>
                                <div class="utc-clock" id="utc-clock">00:00:00</div>
                            </div>
                        </div>
                        <button id="btn-global-refresh"
                            class="btn btn-outline-secondary btn-sm d-flex align-items-center gap-2" type="button"
                            aria-label="Actualizar datos">
                            <i class="fas fa-sync-alt"></i>
                            <span class="d-none d-md-inline">Actualizar</span>
                        </button>
                        <button id="install-app-btn"
                            class="btn btn-outline-primary btn-sm d-none align-items-center gap-2" type="button"
                            aria-label="Instalar la app en este dispositivo">
                            <i class="fas fa-download"></i>
                            <span>Instalar app</span>
                        </button>

                        <img src="images/gobierno-mexico.png" alt="Logo del Gobierno de México" class="gob-logo" />
                        <!-- Tema fijo claro: se elimina el botón de cambio de tema -->
                        <a href="#" class="btn btn-outline-danger d-lg-none logout-button-mobile" data-action="logout"
                            title="Cerrar Sesión" aria-label="Cerrar Sesión">
                            <i class="fas fa-sign-out-alt"></i>
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Contenedor de Alertas del Sistema (Fijo) -->
        <div id="public-alerts-container" class="container-fluid"
            style="display: none; position: fixed; top: 100px; left: 0; width: auto; z-index: 9999; pointer-events: none;">
        </div>

        <div class="app-body">
            <aside class="sidebar d-flex flex-column p-2" id="sidebar">
                <nav class="nav flex-column" id="sidebar-nav">
                    <a class="menu-item active" href="#" data-section="operaciones-totales"><i
                            class="fas fa-home"></i><span>Inicio</span></a>
                    <a class="menu-item" href="#" data-section="parte-operaciones"><i
                            class="fas fa-file-invoice"></i><span>Parte de Operaciones</span></a>
                    <a class="menu-item" href="#" data-section="conciliacion"><i
                            class="fas fa-tasks"></i><span>Conciliación</span></a>
                    <a class="menu-item" href="#" data-section="analisis-operaciones"><i
                            class="fas fa-chart-pie"></i><span>Análisis de Operaciones</span></a>
                    <a class="menu-item" href="#" data-section="inicio"><i
                            class="fas fa-calendar-day"></i><span>Itinerario diario</span></a>
                    <a class="menu-item" href="#" data-section="frecuencias-semana"><i
                            class="fas fa-chart-bar"></i><span>Frecuencias Semanales</span></a>
                    <a class="menu-item" href="#" data-section="puntualidad-agosto">
                        <span class="icon-clock-check" aria-hidden="true">
                            <i class="fas fa-clock"></i>
                            <i class="fas fa-check check" aria-hidden="true"></i>
                        </span>
                        <span>Puntualidad</span>
                    </a>
                    <a class="menu-item" href="#" data-section="demoras"><i
                            class="fas fa-clock"></i><span>Demoras</span></a>
                    <a class="menu-item" id="itinerario-mensual-menu" href="#" data-section="itinerario-mensual"><i
                            class="fas fa-table"></i><span>Itinerario Mensual</span></a>
                    <a class="menu-item" href="#" data-section="comparativa"><i
                            class="fas fa-chart-line"></i><span>Comparativa</span></a>
                    <!-- <a class="menu-item" href="#" data-section="manifiestos"><i
                            class="fas fa-file-signature"></i><span>Manifiestos</span></a> -->
                    <a class="menu-item" href="#" data-section="fauna"><i
                            class="fas fa-shield-alt"></i><span>GSO</span></a>
                    <a class="menu-item" href="#" data-section="medicas"><i
                            class="fas fa-briefcase-medical"></i><span>Servicio Médico</span></a>
                    <a class="menu-item" href="#" data-section="abordadores-mecanicos"><i
                            class="fas fa-cogs"></i><span>Abordadores Mecánicos</span></a>
                    <a class="menu-item" href="#" data-section="biblioteca"><i
                            class="fas fa-book"></i><span>Biblioteca</span></a>
                    <a class="menu-item d-none" href="#" data-section="data-management" id="data-management-menu"><i
                            class="fas fa-database"></i><span>Gestión de Datos</span></a>
                    <a class="menu-item" href="#" data-section="historia"><i
                            class="fas fa-history"></i><span>Historia</span></a>
                    <a class="menu-item" href="#" data-install-app-info><i class="fas fa-download"></i><span>Instalar
                            como app</span></a>

                    <a class="menu-item logout-item" href="#" data-action="logout"><i
                            class="fas fa-sign-out-alt"></i><span>Cerrar Sesión</span></a>
                </nav>
            </aside>
            <!-- Overlay para dispositivos móviles: permite cerrar el sidebar al tocar fuera -->
            <div id="sidebar-overlay" class="sidebar-overlay"></div>
            <main class="main-content flex-grow-1 p-3 p-md-4">
                <!-- Alerts moved to fixed position -->
                <div id="file-protocol-warning" class="alert alert-warning alert-dismissible fade show d-none"
                    role="alert">
                    <strong>Advertencia:</strong> Estás abriendo el archivo directamente (file://). Para evitar errores
                    CORS al cargar CSV/JSON, inicia el servidor local y abre: <a href="http://localhost:3000"
                        target="_blank" rel="noopener">http://localhost:3000</a>.

                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
                </div>

                <!-- Biblioteca Section -->
                <div id="biblioteca-section" class="content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="section-heading mb-0"><i class="fas fa-book me-2"></i>Biblioteca Digital</h2>
                    </div>

                    <!-- Biblioteca Tabs Navigation -->
                    <ul class="nav nav-pills mb-4" id="biblioteca-tabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="bib-docs-tab" data-bs-toggle="pill"
                                data-bs-target="#bib-docs" type="button" role="tab"><i
                                    class="fas fa-file-alt me-2"></i>Documentos</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="bib-map-tab" data-bs-toggle="pill" data-bs-target="#bib-map"
                                type="button" role="tab"><i class="fas fa-satellite me-2"></i>Mapa Satelital</button>
                        </li>
                    </ul>

                    <div class="tab-content" id="biblioteca-tabs-content">
                        <!-- Documentos Tab -->
                        <div class="tab-pane fade show active" id="bib-docs" role="tabpanel">
                            <div class="row g-4" id="library-dynamic-container">
                                <div class="col-12 text-center py-5">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Cargando...</span>
                                    </div>
                                    <p class="mt-2 text-muted">Cargando biblioteca...</p>
                                </div>
                            </div>
                        </div>

                        <!-- Mapa Tab -->
                        <div class="tab-pane fade" id="bib-map" role="tabpanel">
                            <div class="card shadow-sm border-0 overflow-hidden">
                                <div
                                    class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0 text-primary"><i class="fas fa-globe-americas me-2"></i>Vista
                                        Satelital (Google Earth)</h5>
                                    <a href="https://earth.google.com/web/@19.7431,-99.0125,2247a,5010.5d,35y,0h,0t,0r"
                                        target="_blank" rel="noopener" class="btn btn-sm btn-outline-primary">
                                        <i class="fas fa-external-link-alt me-1"></i> Abrir en Google Earth
                                    </a>
                                </div>
                                <div class="card-body p-0">
                                    <div class="map-container-wrapper">
                                        <iframe width="100%" height="650" frameborder="0" style="border:0;"
                                            title="Vista Satelital Oficial AIFA"
                                            src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d14896.47195325062!2d-99.01248!3d19.7431!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e1!3m2!1ses-419!2smx!4v1715620000000!5m2!1ses-419!2smx&maptype=satellite"
                                            allowfullscreen="" loading="lazy">
                                        </iframe>
                                    </div>
                                </div>
                                <div class="card-footer bg-light py-2">
                                    <small class="text-muted"><i class="fas fa-info-circle me-1"></i> Vista satelital
                                        oficial del AIFA proporcionada por Google Maps.</small>
                                </div>
                            </div>
                        </div>
                    </div> <!-- End of tab-content -->
                </div> <!-- End of biblioteca-section -->

                <div id="data-management-section" class="content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="section-heading mb-0"><i class="fas fa-database me-2"></i>Gestión de Datos</h2>
                    </div>

                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3 border-end" id="dm-sidebar">
                                    <div class="nav flex-column nav-pills me-3" id="dataTabs" role="tablist"
                                        aria-orientation="vertical">
                                        <button class="nav-link active text-start mb-2 border shadow-sm rounded"
                                            id="tab-ops-summary" data-bs-toggle="pill"
                                            data-bs-target="#pane-ops-summary" type="button" role="tab"><i
                                                class="fas fa-calendar-alt me-2 text-primary"></i>Resumen
                                            Mensual</button>

                                        <button class="nav-link text-start mb-2 border shadow-sm rounded"
                                            id="tab-daily-ops" data-bs-toggle="pill" data-bs-target="#pane-daily-ops"
                                            type="button" role="tab"><i
                                                class="fas fa-plane-departure me-2 text-info"></i>Operaciones
                                            Diarias</button>

                                        <button class="nav-link text-start mb-2 border shadow-sm rounded"
                                            id="tab-parte-ops" data-bs-toggle="pill" data-bs-target="#pane-parte-ops"
                                            type="button" role="tab"><i
                                                class="fas fa-clipboard-list me-2 text-success"></i>Parte de
                                            Operaciones</button>

                                        <button class="nav-link text-start mb-2 border shadow-sm rounded"
                                            id="tab-library" data-bs-toggle="pill" data-bs-target="#pane-library"
                                            type="button" role="tab"><i
                                                class="fas fa-book me-2 text-info"></i>Biblioteca</button>

                                        <button class="nav-link text-start mb-2 border shadow-sm rounded"
                                            id="tab-alerts" data-bs-toggle="pill" data-bs-target="#pane-alerts"
                                            type="button" role="tab"><i
                                                class="fas fa-bullhorn me-2 text-danger"></i>Alertas / Avisos</button>

                                        <button class="nav-link text-start mb-2 border shadow-sm rounded"
                                            id="tab-itinerary" data-bs-toggle="pill" data-bs-target="#pane-itinerary"
                                            type="button" role="tab"><i
                                                class="fas fa-clock me-2 text-warning"></i>Itinerario</button>

                                        <button class="nav-link text-start mb-2 border shadow-sm rounded"
                                            id="tab-weekly-frequencies" data-bs-toggle="pill"
                                            data-bs-target="#pane-weekly-frequencies" type="button" role="tab"><i
                                                class="fas fa-map-marker-alt me-2 text-danger"></i>Frecuencias
                                            Nacionales</button>

                                        <button class="nav-link text-start mb-2 border shadow-sm rounded"
                                            id="tab-weekly-frequencies-int" data-bs-toggle="pill"
                                            data-bs-target="#pane-weekly-frequencies-int" type="button" role="tab"><i
                                                class="fas fa-globe-americas me-2 text-primary"></i>Frecuencias
                                            Internacionales</button>

                                        <button class="nav-link text-start mb-2 border shadow-sm rounded"
                                            id="tab-weekly-frequencies-cargo" data-bs-toggle="pill"
                                            data-bs-target="#pane-weekly-frequencies-cargo" type="button" role="tab"><i
                                                class="fas fa-box-open me-2 text-warning"></i>Frecuencias
                                            Carga</button>

                                        <button class="nav-link text-start mb-2 border shadow-sm rounded"
                                            id="tab-punctuality-table" data-bs-toggle="pill"
                                            data-bs-target="#pane-punctuality-table" type="button" role="tab"><i
                                                class="fas fa-stopwatch me-2 text-info"></i>Puntualidad</button>

                                        <button class="nav-link text-start mb-2 border shadow-sm rounded"
                                            id="tab-wildlife" data-bs-toggle="pill" data-bs-target="#pane-wildlife"
                                            type="button" role="tab"><i
                                                class="fas fa-dove me-2 text-success"></i>Impactos de Ave</button>

                                        <button class="nav-link text-start mb-2 border shadow-sm rounded"
                                            id="tab-rescued-wildlife" data-bs-toggle="pill"
                                            data-bs-target="#pane-rescued-wildlife" type="button" role="tab"><i
                                                class="fas fa-hand-holding-heart me-2 text-danger"></i>Fauna
                                            Rescatada</button>

                                        <button class="nav-link text-start mb-2 border shadow-sm rounded"
                                            id="tab-medical" data-bs-toggle="pill" data-bs-target="#pane-medical"
                                            type="button" role="tab"><i
                                                class="fas fa-user-md me-2 text-secondary"></i>Atenciones
                                            Médicas</button>

                                        <button class="nav-link text-start mb-2 border shadow-sm rounded"
                                            id="tab-delays" data-bs-toggle="pill" data-bs-target="#pane-delays"
                                            type="button" role="tab"><i
                                                class="fas fa-exclamation-triangle me-2 text-warning"></i>Demoras</button>

                                        <button class="nav-link text-start mb-2 border shadow-sm rounded"
                                            id="tab-comparativa" data-bs-toggle="pill"
                                            data-bs-target="#pane-comparativa" type="button" role="tab"><i
                                                class="fas fa-chart-line me-2 text-primary"></i>Comparativa</button>

                                        <button class="nav-link text-start mb-2 border shadow-sm rounded"
                                            id="tab-conciliacion-admin" data-bs-toggle="pill"
                                            data-bs-target="#pane-conciliacion-admin" type="button" role="tab"><i
                                                class="fas fa-clipboard-check me-2 text-danger"></i>Conciliación</button>
                                    </div>
                                </div>
                                <div class="col-md-9" id="dm-content">
                                    <button class="btn btn-outline-secondary mb-3 d-none" id="dm-sidebar-toggle"
                                        onclick="toggleDmSidebar()">
                                        <i class="fas fa-bars me-1"></i> Mostrar Menú
                                    </button>
                                    <div class="tab-content" id="dataTabsContent">
                                        <!-- Operations Summary Pane -->
                                        <div class="tab-pane fade show active" id="pane-ops-summary" role="tabpanel">
                                            <div class="table-responsive">
                                                <table class="table table-striped table-hover" id="table-ops-summary">
                                                    <thead>
                                                        <tr>
                                                            <th>Año</th>
                                                            <th>Mes</th>
                                                            <th>Categoría</th>
                                                            <th>Métrica</th>
                                                            <th>Valor</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>

                                            <!-- Base Mensual -->
                                            <div class="mb-3">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <h5 class="mb-0">Base Mensual</h5>
                                                    <div class="d-flex gap-2">
                                                        <select id="monthly-ops-year" class="form-select form-select-sm"
                                                            style="width:120px;"
                                                            aria-label="Seleccionar año (base mensual)"></select>
                                                        <button class="btn btn-primary btn-sm"
                                                            id="monthly-ops-add">Agregar
                                                            Mes</button>
                                                    </div>
                                                </div>
                                                <div class="table-responsive">
                                                    <table class="table table-sm table-striped" id="table-monthly-ops">
                                                        <thead class="table-light">
                                                            <tr>
                                                                <th class="text-center">Año</th>
                                                                <th class="text-center">Mes</th>
                                                                <th class="text-center text-primary">Comercial
                                                                    (Ops/Pax)
                                                                </th>
                                                                <th class="text-center text-success">General
                                                                    (Ops/Pax)
                                                                </th>
                                                                <th class="text-center text-warning">Carga (Ops/Ton)
                                                                </th>
                                                                <th></th>
                                                            </tr>
                                                        </thead>
                                                        <tbody></tbody>
                                                    </table>
                                                </div>

                                                <div
                                                    class="d-flex justify-content-between align-items-center mt-3 mb-2">
                                                    <h5 class="mb-0">Base Anual (calculada)</h5>
                                                    <button class="btn btn-outline-secondary btn-sm"
                                                        id="annual-ops-refresh">Recalcular</button>
                                                </div>
                                                <div class="table-responsive">
                                                    <table class="table table-sm table-striped" id="table-annual-ops">
                                                        <thead class="table-light">
                                                            <tr>
                                                                <th class="text-center">Año</th>
                                                                <th class="text-center text-primary">Comercial
                                                                    (Ops/Pax)
                                                                </th>
                                                                <th class="text-center text-success">General
                                                                    (Ops/Pax)
                                                                </th>
                                                                <th class="text-center text-warning">Carga (Ops/Ton)
                                                                </th>
                                                                <th></th>
                                                            </tr>
                                                        </thead>
                                                        <tbody></tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>



                                        <!-- Daily Operations Pane -->
                                        <div class="tab-pane fade" id="pane-daily-ops" role="tabpanel">
                                            <div class="d-flex justify-content-between mb-3">
                                                <div class="d-flex gap-2">
                                                    <div class="input-group w-auto">
                                                        <span class="input-group-text">Fecha</span>
                                                        <input type="date" class="form-control"
                                                            id="filter-daily-ops-date" aria-label="Filtrar por fecha">
                                                    </div>
                                                    <select class="form-select w-auto" id="filter-daily-ops-month"
                                                        aria-label="Filtrar por mes">
                                                        <option value="">Todos los meses</option>
                                                        <option value="01">Enero</option>
                                                        <option value="02">Febrero</option>
                                                        <option value="03">Marzo</option>
                                                        <option value="04">Abril</option>
                                                        <option value="05">Mayo</option>
                                                        <option value="06">Junio</option>
                                                        <option value="07">Julio</option>
                                                        <option value="08">Agosto</option>
                                                        <option value="09">Septiembre</option>
                                                        <option value="10">Octubre</option>
                                                        <option value="11">Noviembre</option>
                                                        <option value="12">Diciembre</option>
                                                    </select>
                                                </div>
                                                <button class="btn btn-primary btn-sm"
                                                    onclick="dataManagement.addItem('daily_operations')"><i
                                                        class="fas fa-plus"></i>
                                                    Agregar Día</button>
                                            </div>
                                            <div class="table-responsive">
                                                <table class="table table-striped table-hover" id="table-daily-ops">
                                                    <thead>
                                                        <tr>
                                                            <th class="text-center">Fecha</th>
                                                            <th class="text-center text-primary">Comercial (Ops/Pax)
                                                            </th>
                                                            <th class="text-center text-success">General (Ops/Pax)
                                                            </th>
                                                            <th class="text-center text-warning">Carga (Ops/Ton)
                                                            </th>
                                                            <th>Acciones</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- Parte de Operaciones Pane -->
                                        <div class="tab-pane fade" id="pane-parte-ops" role="tabpanel">
                                            <div class="d-flex justify-content-between mb-3">
                                                <div class="d-flex gap-2">
                                                    <div class="input-group w-auto">
                                                        <span class="input-group-text">Fecha</span>
                                                        <input type="date" class="form-control"
                                                            id="filter-parte-ops-date" aria-label="Filtrar por fecha">
                                                    </div>
                                                    <select class="form-select w-auto" id="filter-parte-ops-month"
                                                        aria-label="Filtrar por mes">
                                                        <option value="">Todos los meses</option>
                                                        <option value="01">Enero</option>
                                                        <option value="02">Febrero</option>
                                                        <option value="03">Marzo</option>
                                                        <option value="04">Abril</option>
                                                        <option value="05">Mayo</option>
                                                        <option value="06">Junio</option>
                                                        <option value="07">Julio</option>
                                                        <option value="08">Agosto</option>
                                                        <option value="09">Septiembre</option>
                                                        <option value="10">Octubre</option>
                                                        <option value="11">Noviembre</option>
                                                        <option value="12">Diciembre</option>
                                                    </select>
                                                </div>
                                                <div class="d-flex gap-2">
                                                    <button class="btn btn-primary btn-sm" id="btn-new-parte-ops"><i
                                                            class="fas fa-plus"></i> Nuevo Registro</button>
                                                    <button class="btn btn-outline-secondary btn-sm"
                                                        id="btn-refresh-parte-ops"><i class="fas fa-sync-alt"></i>
                                                        Actualizar</button>
                                                </div>
                                                <input type="file" id="parte-ops-pdf-input" accept="application/pdf"
                                                    style="display: none;">
                                            </div>
                                            <div class="table-responsive">
                                                <table class="table table-striped table-hover" id="table-parte-ops">
                                                    <thead>
                                                        <tr>
                                                            <th class="text-center align-middle">Fecha</th>
                                                            <th class="text-center text-primary">
                                                                <div class="mb-1"><i
                                                                        class="fas fa-user-friends fa-lg"></i>
                                                                </div>
                                                                Comercial <br><small class="text-muted fw-normal"><i
                                                                        class="fas fa-plane-arrival"></i> Arr / <i
                                                                        class="fas fa-plane-departure"></i>
                                                                    Dep</small>
                                                            </th>
                                                            <th class="text-center text-warning">
                                                                <div class="mb-1"><i class="fas fa-box-open fa-lg"></i>
                                                                </div>
                                                                Carga <br><small class="text-muted fw-normal"><i
                                                                        class="fas fa-plane-arrival"></i> Arr / <i
                                                                        class="fas fa-plane-departure"></i>
                                                                    Dep</small>
                                                            </th>
                                                            <th class="text-center text-success">
                                                                <div class="mb-1"><i
                                                                        class="fas fa-paper-plane fa-lg"></i></div>
                                                                General <br><small class="text-muted fw-normal"><i
                                                                        class="fas fa-plane-arrival"></i> Arr / <i
                                                                        class="fas fa-plane-departure"></i>
                                                                    Dep</small>
                                                            </th>
                                                            <th class="text-center align-middle fw-bold">Total
                                                                General
                                                            </th>
                                                            <th class="text-center align-middle">Reporte PDF</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="tbody-parte-ops"></tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- Itinerary Pane -->
                                        <div class="tab-pane fade" id="pane-itinerary" role="tabpanel">
                                            <div class="d-flex justify-content-between mb-3">
                                                <div class="input-group w-auto">
                                                    <span class="input-group-text">Fecha</span>
                                                    <input type="date" class="form-control" id="filter-itinerary-date"
                                                        aria-label="Filtrar por fecha">
                                                </div>
                                                <div class="d-flex gap-2">
                                                    <button class="btn btn-info btn-sm text-white"
                                                        id="btn-view-itinerary-json"><i class="fas fa-code me-1"></i>
                                                        Ver JSON</button>
                                                    <button class="btn btn-primary btn-sm"
                                                        id="btn-upload-itinerary-json"><i
                                                            class="fas fa-file-code me-1"></i> Cargar JSON</button>
                                                    <button class="btn btn-danger btn-sm"
                                                        id="btn-delete-itinerary-date"><i class="fas fa-trash-alt me-1"></i>
                                                        Borrar Día</button>
                                                    <button class="btn btn-outline-secondary btn-sm"
                                                        id="btn-refresh-itinerary"><i class="fas fa-sync-alt"></i>
                                                        Actualizar</button>
                                                </div>
                                            </div>
                                            <div class="table-responsive">
                                                <table class="table table-striped table-hover" id="table-itinerary">
                                                    <thead>
                                                        <tr>
                                                            <th>Vuelo</th>
                                                            <th>Aerolínea</th>
                                                            <th>Origen/Destino</th>
                                                            <th>Hora</th>
                                                            <th>Estado</th>
                                                            <th>Acciones</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="tbody-itinerary"></tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- Weekly Frequencies Pane -->
                                        <div class="tab-pane fade" id="pane-weekly-frequencies" role="tabpanel">
                                            <div class="d-flex justify-content-between mb-3">
                                                <div class="d-flex gap-2 flex-wrap">
                                                    <div class="input-group w-auto">
                                                        <span class="input-group-text">Semana</span>
                                                        <select class="form-select" id="filter-weekly-freq-label"
                                                            aria-label="Filtrar por semana"
                                                            onchange="dataManagement.loadWeeklyFrequencies()">
                                                            <option value="">Cargando...</option>
                                                        </select>
                                                    </div>
                                                    <div class="input-group w-auto">
                                                        <span class="input-group-text">Aerolínea</span>
                                                        <select class="form-select" id="filter-weekly-freq-airline"
                                                            aria-label="Filtrar por aerolínea"
                                                            onchange="dataManagement.loadWeeklyFrequencies()">
                                                            <option value="">Todas</option>
                                                        </select>
                                                    </div>
                                                    <div class="input-group w-auto">
                                                        <span class="input-group-text">Destino</span>
                                                        <select class="form-select" id="filter-weekly-freq-destination"
                                                            aria-label="Filtrar por destino"
                                                            onchange="dataManagement.loadWeeklyFrequencies()">
                                                            <option value="">Todos</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <button class="btn btn-primary btn-sm"
                                                    onclick="dataManagement.addItem('weekly_frequencies')"><i
                                                        class="fas fa-plus"></i> Agregar Frecuencia</button>
                                                <button class="btn btn-outline-secondary btn-sm ms-2"
                                                    onclick="dataManagement.openCopyWeekModal()"><i
                                                        class="fas fa-copy"></i>
                                                    Copiar
                                                    Plantilla</button>
                                                <button class="btn btn-outline-danger btn-sm ms-2"
                                                    onclick="dataManagement.deleteWeeklyTemplate()"><i
                                                        class="fas fa-trash"></i>
                                                    Eliminar Semana</button>
                                                <button class="btn btn-outline-primary btn-sm ms-2"
                                                    id="btn-edit-weekly-mode"
                                                    onclick="dataManagement.toggleWeeklyEditMode()"><i
                                                        class="fas fa-edit"></i>
                                                    Editar Tabla</button>
                                                <button class="btn btn-success btn-sm ms-2 d-none"
                                                    id="btn-save-weekly-changes"
                                                    onclick="dataManagement.saveWeeklyChanges()"><i
                                                        class="fas fa-save"></i>
                                                    Guardar
                                                    Cambios</button>
                                            </div>
                                            <div class="table-responsive">
                                                <table class="table table-striped table-hover"
                                                    id="table-weekly-frequencies">
                                                    <thead>
                                                        <tr>
                                                            <th style="width: 150px;">Semana</th>
                                                            <th style="width: 80px;">Id de ruta</th>
                                                            <th>Ruta</th>
                                                            <th class="text-center">Aerolínea</th>
                                                            <th class="text-center border-start" style="width: 55px;">L
                                                            </th>
                                                            <th class="text-center border-start" style="width: 55px;">M
                                                            </th>
                                                            <th class="text-center border-start" style="width: 55px;">X
                                                            </th>
                                                            <th class="text-center border-start" style="width: 55px;">J
                                                            </th>
                                                            <th class="text-center border-start" style="width: 55px;">V
                                                            </th>
                                                            <th class="text-center border-start" style="width: 55px;">S
                                                            </th>
                                                            <th class="text-center border-start" style="width: 55px;">D
                                                            </th>
                                                            <th class="text-center border-start" style="width: 70px;">
                                                                Total</th>
                                                            <th class="text-center border-start">Acciones</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- Weekly Frequencies Int Pane -->
                                        <div class="tab-pane fade" id="pane-weekly-frequencies-int" role="tabpanel">
                                            <div class="d-flex justify-content-between mb-3">
                                                <div class="d-flex gap-2 flex-wrap">
                                                    <div class="input-group w-auto">
                                                        <span class="input-group-text">Semana</span>
                                                        <select class="form-select" id="filter-weekly-freq-int-label"
                                                            aria-label="Filtrar por semana"
                                                            onchange="dataManagement.loadWeeklyFrequenciesInt()">
                                                            <option value="">Cargando...</option>
                                                        </select>
                                                    </div>
                                                    <div class="input-group w-auto">
                                                        <span class="input-group-text">Aerolínea</span>
                                                        <select class="form-select" id="filter-weekly-freq-int-airline"
                                                            aria-label="Filtrar por aerolínea"
                                                            onchange="dataManagement.loadWeeklyFrequenciesInt()">
                                                            <option value="">Todas</option>
                                                        </select>
                                                    </div>
                                                    <div class="input-group w-auto">
                                                        <span class="input-group-text">Región</span>
                                                        <select class="form-select"
                                                            id="filter-weekly-freq-int-destination"
                                                            aria-label="Filtrar por región"
                                                            onchange="dataManagement.loadWeeklyFrequenciesInt()">
                                                            <option value="">Todas</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="btn-group">
                                                    <button class="btn btn-primary btn-sm"
                                                        onclick="dataManagement.addItem('weekly_frequencies_int')"><i
                                                            class="fas fa-plus"></i> Agregar Frecuencia</button>
                                                    <button class="btn btn-outline-secondary btn-sm ms-2"
                                                        onclick="dataManagement.openCopyWeekModalInt()"><i
                                                            class="fas fa-copy"></i>
                                                        Copiar Plantilla</button>
                                                    <button class="btn btn-outline-danger btn-sm ms-2"
                                                        onclick="dataManagement.deleteWeeklyTemplateInt()"><i
                                                            class="fas fa-trash"></i> Eliminar Semana</button>
                                                    <button class="btn btn-outline-primary btn-sm ms-2"
                                                        id="btn-edit-weekly-int-mode"
                                                        onclick="dataManagement.toggleWeeklyEditModeInt()"><i
                                                            class="fas fa-edit"></i> Editar Tabla</button>
                                                    <button class="btn btn-success btn-sm ms-2 d-none"
                                                        id="btn-save-weekly-int-changes"
                                                        onclick="dataManagement.saveWeeklyChangesInt()"><i
                                                            class="fas fa-save"></i>
                                                        Guardar Cambios</button>
                                                </div>
                                            </div>
                                            <div class="table-responsive">
                                                <table class="table table-striped table-hover"
                                                    id="table-weekly-frequencies-int">
                                                    <thead>
                                                        <tr>
                                                            <th style="width: 150px;">Semana</th>
                                                            <th style="width: 80px;">Id de ruta</th>
                                                            <th>Ruta (Ciudad/País)</th>
                                                            <th class="text-center">Aerolínea</th>
                                                            <th class="text-center border-start" style="width: 55px;">L
                                                            </th>
                                                            <th class="text-center border-start" style="width: 55px;">M
                                                            </th>
                                                            <th class="text-center border-start" style="width: 55px;">X
                                                            </th>
                                                            <th class="text-center border-start" style="width: 55px;">J
                                                            </th>
                                                            <th class="text-center border-start" style="width: 55px;">V
                                                            </th>
                                                            <th class="text-center border-start" style="width: 55px;">S
                                                            </th>
                                                            <th class="text-center border-start" style="width: 55px;">D
                                                            </th>
                                                            <th class="text-center border-start" style="width: 70px;">
                                                                Total</th>
                                                            <th class="text-center border-start">Acciones</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- Weekly Frequencies Cargo Pane -->
                                        <div class="tab-pane fade" id="pane-weekly-frequencies-cargo" role="tabpanel">
                                            <div class="d-flex justify-content-between mb-3">
                                                <div class="d-flex gap-2 flex-wrap">
                                                    <div class="input-group w-auto">
                                                        <span class="input-group-text">Semana</span>
                                                        <select class="form-select" id="filter-weekly-freq-cargo-label"
                                                            aria-label="Filtrar por semana"
                                                            onchange="dataManagement.loadWeeklyFrequenciesCargo()">
                                                            <option value="">Cargando...</option>
                                                        </select>
                                                        <button class="btn btn-outline-secondary" onclick="dataManagement.loadWeeklyFrequenciesCargo(true)" title="Actualizar lista"><i class="fas fa-sync-alt"></i></button>
                                                    </div>
                                                    <div class="input-group w-auto">
                                                        <span class="input-group-text">Aerolínea</span>
                                                        <select class="form-select" id="filter-weekly-freq-cargo-airline"
                                                            aria-label="Filtrar por aerolínea"
                                                            onchange="dataManagement.loadWeeklyFrequenciesCargo()">
                                                            <option value="">Todas</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="btn-group">
                                                    <button class="btn btn-primary btn-sm"
                                                        onclick="dataManagement.addItem('weekly_frequencies_cargo')"><i
                                                            class="fas fa-plus"></i> Agregar Frecuencia</button>
                                                    <button class="btn btn-outline-secondary btn-sm ms-2"
                                                        onclick="dataManagement.openCopyWeekModalCargo()"><i
                                                            class="fas fa-copy"></i>
                                                        Copiar Plantilla</button>
                                                    <button class="btn btn-outline-danger btn-sm ms-2"
                                                        onclick="dataManagement.deleteWeeklyTemplateCargo()"><i
                                                            class="fas fa-trash"></i> Eliminar Semana</button>
                                                    <button class="btn btn-outline-primary btn-sm ms-2"
                                                        id="btn-edit-weekly-cargo-mode"
                                                        onclick="dataManagement.toggleWeeklyEditModeCargo()"><i
                                                            class="fas fa-edit"></i> Editar Tabla</button>
                                                    <button class="btn btn-success btn-sm ms-2 d-none"
                                                        id="btn-save-weekly-cargo-changes"
                                                        onclick="dataManagement.saveWeeklyChangesCargo()"><i
                                                            class="fas fa-save"></i>
                                                        Guardar Cambios</button>
                                                </div>
                                            </div>
                                            <div class="table-responsive">
                                                <table class="table table-striped table-hover"
                                                    id="table-weekly-frequencies-cargo">
                                                    <thead>
                                                        <tr>
                                                            <th style="width: 150px;">Semana</th>
                                                            <th style="width: 80px;">Id de ruta</th>
                                                            <th>Ruta (Ciudad/País)</th>
                                                            <th class="text-center">Aerolínea</th>
                                                            <th class="text-center border-start" style="width: 55px;">L
                                                            </th>
                                                            <th class="text-center border-start" style="width: 55px;">M
                                                            </th>
                                                            <th class="text-center border-start" style="width: 55px;">X
                                                            </th>
                                                            <th class="text-center border-start" style="width: 55px;">J
                                                            </th>
                                                            <th class="text-center border-start" style="width: 55px;">V
                                                            </th>
                                                            <th class="text-center border-start" style="width: 55px;">S
                                                            </th>
                                                            <th class="text-center border-start" style="width: 55px;">D
                                                            </th>
                                                            <th class="text-center border-start" style="width: 70px;">
                                                                Total</th>
                                                            <th class="text-center border-start">Acciones</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- Punctuality Pane -->
                                        <div class="tab-pane fade" id="pane-punctuality-table" role="tabpanel">
                                            <div class="d-flex justify-content-between mb-3">
                                                <div class="d-flex gap-2">
                                                    <div class="input-group w-auto">
                                                        <span class="input-group-text">Año</span>
                                                        <select class="form-select w-100px" id="filter-punctuality-year" aria-label="Seleccionar Año">
                                                            <option value="2025">2025</option>
                                                        </select>
                                                    </div>
                                                    <div class="input-group w-auto">
                                                        <span class="input-group-text">Mes</span>
                                                        <select class="form-select" id="filter-punctuality-month" aria-label="Seleccionar Mes">
                                                            <option value="">Todo</option>
                                                            <option value="1">Enero</option>
                                                            <option value="2">Febrero</option>
                                                            <option value="3">Marzo</option>
                                                            <option value="4">Abril</option>
                                                            <option value="5">Mayo</option>
                                                            <option value="6">Junio</option>
                                                            <option value="7">Julio</option>
                                                            <option value="8">Agosto</option>
                                                            <option value="9">Septiembre</option>
                                                            <option value="10">Octubre</option>
                                                            <option value="11">Noviembre</option>
                                                            <option value="12">Diciembre</option>
                                                        </select>
                                                    </div>
                                                    <button class="btn btn-outline-secondary"
                                                        onclick="dataManagement.loadPunctualityStats()"><i
                                                            class="fas fa-search"></i> Filtrar</button>
                                                </div>
                                                <button class="btn btn-primary btn-sm"
                                                    onclick="dataManagement.addItem('punctuality_stats')"><i
                                                        class="fas fa-plus"></i> Agregar Registro</button>
                                            </div>
                                            <div class="table-responsive">
                                                <table class="table table-striped table-hover"
                                                    id="table-punctuality-stats">
                                                    <thead>
                                                        <tr>
                                                            <th>Año</th>
                                                            <th>Mes</th>
                                                            <th>Aerolínea</th>
                                                            <th>Categoría</th>
                                                            <th class="text-end">A Tiempo</th>
                                                            <th class="text-end">Demorados</th>
                                                            <th class="text-end">Cancelados</th>
                                                            <th class="text-end">Total</th>
                                                            <th>Acciones</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- Wildlife Pane -->
                                        <div class="tab-pane fade" id="pane-wildlife" role="tabpanel">
                                            <h5 class="mb-3">Impactos de Ave</h5>
                                            <div class="d-flex justify-content-end mb-3" id="toolbar-wildlife">
                                                <button class="btn btn-primary btn-sm btn-add-item"
                                                    onclick="dataManagement.addItem('wildlife_strikes')"><i
                                                        class="fas fa-plus"></i>
                                                    Agregar Reporte</button>
                                            </div>
                                            <div class="table-responsive">
                                                <table class="table table-striped table-hover" id="table-wildlife">
                                                    <thead>
                                                        <tr>
                                                            <th>Fecha</th>
                                                            <th>Hora</th>
                                                            <th>Especie</th>
                                                            <th>Ubicación</th>
                                                            <th>Acciones</th>
                                                        </tr>
                                                        <tr class="filter-row">
                                                            <th><input type="text" class="form-control form-control-sm"
                                                                    placeholder="Filtrar..."
                                                                    data-column="date"
                                                                    onkeyup="dataManagement.filterWildlifeStrikes()"></th>
                                                            <th><input type="text" class="form-control form-control-sm"
                                                                    placeholder="Filtrar..."
                                                                    data-column="time"
                                                                    onkeyup="dataManagement.filterWildlifeStrikes()"></th>
                                                            <th><input type="text" class="form-control form-control-sm"
                                                                    placeholder="Filtrar..."
                                                                    data-column="species"
                                                                    onkeyup="dataManagement.filterWildlifeStrikes()"></th>
                                                            <th><input type="text" class="form-control form-control-sm"
                                                                    placeholder="Filtrar..."
                                                                    data-column="location"
                                                                    onkeyup="dataManagement.filterWildlifeStrikes()"></th>
                                                            <th></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- Medical Pane -->
                                        <div class="tab-pane fade" id="pane-medical" role="tabpanel">
                                            <ul class="nav nav-tabs mb-3" id="medicalTabs" role="tablist">
                                                <li class="nav-item" role="presentation">
                                                    <button class="nav-link active" id="tab-medical-directory"
                                                        data-bs-toggle="tab" data-bs-target="#pane-medical-directory"
                                                        type="button" role="tab">Directorio y Documentos</button>
                                                </li>
                                                <li class="nav-item" role="presentation">
                                                    <button class="nav-link" id="tab-medical-attentions"
                                                        data-bs-toggle="tab" data-bs-target="#pane-medical-attentions"
                                                        type="button" role="tab">Atenciones Mensuales</button>
                                                </li>
                                                <li class="nav-item" role="presentation">
                                                    <button class="nav-link" id="tab-medical-types" data-bs-toggle="tab"
                                                        data-bs-target="#pane-medical-types" type="button"
                                                        role="tab">Tipos de Atención</button>
                                                </li>
                                            </ul>

                                            <div class="tab-content">
                                                <!-- Atenciones Mensuales -->
                                                <div class="tab-pane fade" id="pane-medical-attentions"
                                                    role="tabpanel">
                                                    <div class="d-flex justify-content-between mb-3">
                                                        <div class="input-group w-auto">
                                                            <span class="input-group-text">Año</span>
                                                            <select class="form-select" id="filter-medical-year" aria-label="Seleccionar Año">
                                                                <option value="2024">2024</option>
                                                                <option value="2025" selected>2025</option>
                                                            </select>
                                                        </div>
                                                        <button class="btn btn-primary btn-sm"
                                                            onclick="dataManagement.addItem('medical_attentions')"><i
                                                                class="fas fa-plus"></i> Agregar Mes</button>
                                                    </div>
                                                    <div class="table-responsive">
                                                        <table class="table table-striped table-hover"
                                                            id="table-medical">
                                                            <thead>
                                                                <tr>
                                                                    <th class="text-center">Mes</th>
                                                                    <th class="text-center">Personal AIFA</th>
                                                                    <th class="text-center">Otras Empresas</th>
                                                                    <th class="text-center">Pasajeros</th>
                                                                    <th class="text-center">Visitantes</th>
                                                                    <th class="text-center">Total</th>
                                                                    <th class="text-center">Acciones</th>
                                                                </tr>
                                                                <tr class="filter-row">
                                                                    <th><input type="text" class="form-control form-control-sm" placeholder="Filtrar..." onkeyup="dataManagement.filterMedicalAttentions()"></th>
                                                                    <th><input type="text" class="form-control form-control-sm" placeholder="Filtrar..." onkeyup="dataManagement.filterMedicalAttentions()"></th>
                                                                    <th><input type="text" class="form-control form-control-sm" placeholder="Filtrar..." onkeyup="dataManagement.filterMedicalAttentions()"></th>
                                                                    <th><input type="text" class="form-control form-control-sm" placeholder="Filtrar..." onkeyup="dataManagement.filterMedicalAttentions()"></th>
                                                                    <th><input type="text" class="form-control form-control-sm" placeholder="Filtrar..." onkeyup="dataManagement.filterMedicalAttentions()"></th>
                                                                    <th><input type="text" class="form-control form-control-sm" placeholder="Filtrar..." onkeyup="dataManagement.filterMedicalAttentions()"></th>
                                                                    <th></th>
                                                                </tr>
                                                            </thead>
                                                            <tbody></tbody>
                                                        </table>
                                                    </div>
                                                </div>

                                                <!-- Tipos de Atencion -->
                                                <div class="tab-pane fade" id="pane-medical-types" role="tabpanel">
                                                    <div class="d-flex justify-content-between mb-3">
                                                        <div class="input-group w-auto">
                                                            <span class="input-group-text">Año</span>
                                                            <select class="form-select" id="filter-medical-types-year" aria-label="Seleccionar Año">
                                                                <option value="2024">2024</option>
                                                                <option value="2025" selected>2025</option>
                                                            </select>
                                                        </div>
                                                        <button class="btn btn-primary btn-sm"
                                                            onclick="dataManagement.addItem('medical_types')"><i
                                                                class="fas fa-plus"></i> Agregar Registro</button>
                                                    </div>
                                                    <div class="table-responsive">
                                                        <table class="table table-striped table-hover"
                                                            id="table-medical-types">
                                                            <thead>
                                                                <tr>
                                                                    <th class="text-center">Mes</th>
                                                                    <th class="text-center">Traslado</th>
                                                                    <th class="text-center">Ambulatorio</th>
                                                                    <th class="text-center">Total</th>
                                                                    <th class="text-center">Acciones</th>
                                                                </tr>
                                                                <tr class="filter-row">
                                                                    <th><input type="text" class="form-control form-control-sm" placeholder="Filtrar..." onkeyup="dataManagement.filterMedicalTypes()"></th>
                                                                    <th><input type="text" class="form-control form-control-sm" placeholder="Filtrar..." onkeyup="dataManagement.filterMedicalTypes()"></th>
                                                                    <th><input type="text" class="form-control form-control-sm" placeholder="Filtrar..." onkeyup="dataManagement.filterMedicalTypes()"></th>
                                                                    <th><input type="text" class="form-control form-control-sm" placeholder="Filtrar..." onkeyup="dataManagement.filterMedicalTypes()"></th>
                                                                    <th></th>
                                                                </tr>
                                                            </thead>
                                                            <tbody></tbody>
                                                        </table>
                                                    </div>
                                                </div>

                                                <!-- Directorio -->
                                                <div class="tab-pane fade show active" id="pane-medical-directory" role="tabpanel">
                                                    <div class="d-flex justify-content-end mb-3">
                                                        <button class="btn btn-primary btn-sm"
                                                            onclick="dataManagement.addItem('medical_directory')"><i
                                                                class="fas fa-plus"></i> Nuevo
                                                            Contacto/Asunto</button>
                                                    </div>
                                                    <div class="table-responsive">
                                                        <table class="table table-striped table-hover"
                                                            id="table-medical-directory">
                                                            <thead>
                                                                <tr>
                                                                    <th class="w-80px">Orden</th>
                                                                    <th>Asunto</th>
                                                                    <th>Responsable</th>
                                                                    <th>Estado</th>
                                                                    <th>Documentos (PDF)</th>
                                                                    <th>Acciones</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody></tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Rescued Wildlife Pane -->
                                        <div class="tab-pane fade" id="pane-rescued-wildlife" role="tabpanel">
                                            <h5 class="mb-3">Fauna Rescatada</h5>
                                            <div class="d-flex justify-content-end mb-3" id="toolbar-rescued-wildlife">
                                                <button class="btn btn-primary btn-sm btn-add-item"
                                                    onclick="dataManagement.addItem('rescued_wildlife')"><i
                                                        class="fas fa-plus"></i>
                                                    Agregar Rescate</button>
                                            </div>
                                            <div class="table-responsive">
                                                <table class="table table-striped table-hover"
                                                    id="table-rescued-wildlife">
                                                    <thead>
                                                        <tr>
                                                            <th>Fecha</th>
                                                            <th>Hora</th>
                                                            <th>Nombre común</th>
                                                            <th>Clase</th>
                                                            <th>Disposición final</th>
                                                            <th>Acciones</th>
                                                        </tr>
                                                        <tr class="filter-row">
                                                            <th><input type="text" class="form-control form-control-sm"
                                                                    placeholder="Filtrar..."
                                                                    data-column="date"
                                                                    onkeyup="dataManagement.filterRescuedWildlife()"></th>
                                                            <th><input type="text" class="form-control form-control-sm"
                                                                    placeholder="Filtrar..."
                                                                    data-column="time"
                                                                    onkeyup="dataManagement.filterRescuedWildlife()"></th>
                                                            <th><input type="text" class="form-control form-control-sm"
                                                                    placeholder="Filtrar..."
                                                                    data-column="common_name"
                                                                    onkeyup="dataManagement.filterRescuedWildlife()"></th>
                                                            <th><input type="text" class="form-control form-control-sm"
                                                                    placeholder="Filtrar..."
                                                                    data-column="class"
                                                                    onkeyup="dataManagement.filterRescuedWildlife()"></th>
                                                            <th><input type="text" class="form-control form-control-sm"
                                                                    placeholder="Filtrar..."
                                                                    data-column="final_disposition"
                                                                    onkeyup="dataManagement.filterRescuedWildlife()"></th>
                                                            <th></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- Daily Flights Ops Pane -->
                                        <!-- pane-daily-flights-ops removed: content moved to Conciliación section -->
                                        <div class="tab-pane fade d-none" id="pane-daily-flights-ops" role="tabpanel">
                                            <div class="d-flex justify-content-between align-items-center mb-3">
                                                <h5 class="mb-0"><i class="fas fa-tasks me-2 text-primary"></i>Conciliación — Itinerario de Vuelos</h5>
                                                <div class="d-flex gap-2">
                                                    <input type="date" class="form-control form-control-sm"
                                                        id="filter-daily-flights-date" aria-label="Filtrar por fecha"
                                                        onchange="dataManagement.loadDailyFlightsOps()">
                                                    <button class="btn btn-outline-danger btn-sm"
                                                        onclick="dataManagement.deleteDailyOpsByDate()"
                                                        title="Eliminar todos los vuelos de la fecha seleccionada"><i
                                                            class="fas fa-trash-alt"></i></button>

                                                    <button class="btn btn-outline-success btn-sm"
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#loadOpsItineraryJsonModal"><i
                                                            class="fas fa-file-code me-1"></i> Importar
                                                        JSON</button>
                                                    <input type="file" id="daily-ops-json-input" accept=".json"
                                                        style="display: none;"
                                                        onchange="window.opsFlights.importJson(this)">

                                                    <button class="btn btn-outline-danger btn-sm" data-bs-toggle="modal"
                                                        data-bs-target="#uploadOpsItineraryModal"><i
                                                            class="fas fa-file-pdf me-1"></i> Importar PDF</button>

                                                    <button class="btn btn-outline-primary btn-sm"
                                                        id="btn-dm-toggle-edit"
                                                        onclick="dataManagement.toggleEditMode()">
                                                        <i class="fas fa-edit me-1"></i> Editar
                                                    </button>
                                                    <button class="btn btn-success btn-sm d-none" id="btn-dm-save-edit"
                                                        onclick="dataManagement.saveEditedData()">
                                                        <i class="fas fa-save me-1"></i> Guardar
                                                    </button>

                                                    <div class="dropdown d-inline-block">
                                                        <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" id="dropdownMenuButtonColumns" data-bs-toggle="dropdown" aria-expanded="false" title="Seleccionar columnas visibles">
                                                            <i class="fas fa-columns me-1"></i>
                                                        </button>
                                                        <ul class="dropdown-menu p-3 shadow" aria-labelledby="dropdownMenuButtonColumns" style="min-width: 250px;" onclick="event.stopPropagation()">
                                                            <li><h6 class="dropdown-header text-primary fw-bold">Columnas Visibles</h6></li>
                                                            <li><hr class="dropdown-divider"></li>
                                                            <li class="form-check mb-1">
                                                                <input class="form-check-input col-toggle" type="checkbox" value="" id="chk-col-no" data-col="col-no" checked onchange="dataManagement.toggleColumn('col-no', this.checked)">
                                                                <label class="form-check-label" for="chk-col-no">No. (Seq)</label>
                                                            </li>
                                                            <li class="form-check mb-1">
                                                                <input class="form-check-input col-toggle" type="checkbox" value="" id="chk-col-aerolinea" data-col="col-aerolinea" checked onchange="dataManagement.toggleColumn('col-aerolinea', this.checked)">
                                                                <label class="form-check-label" for="chk-col-aerolinea">Aerolínea</label>
                                                            </li>
                                                            <li class="form-check mb-1">
                                                                <input class="form-check-input col-toggle" type="checkbox" value="" id="chk-col-vuelo" data-col="col-vuelo" checked onchange="dataManagement.toggleColumn('col-vuelo', this.checked)">
                                                                <label class="form-check-label" for="chk-col-vuelo">Vuelo</label>
                                                            </li>
                                                            <li class="form-check mb-1">
                                                                <input class="form-check-input col-toggle" type="checkbox" value="" id="chk-col-route" data-col="col-route" checked onchange="dataManagement.toggleColumn('col-route', this.checked)">
                                                                <label class="form-check-label" for="chk-col-route">Origen / Destino</label>
                                                            </li>
                                                            <li class="form-check mb-1">
                                                                <input class="form-check-input col-toggle" type="checkbox" value="" id="chk-col-prog" data-col="col-prog" checked onchange="dataManagement.toggleColumn('col-prog', this.checked)">
                                                                <label class="form-check-label" for="chk-col-prog">Hora Programada</label>
                                                            </li>
                                                            <li class="form-check mb-1">
                                                                <input class="form-check-input col-toggle" type="checkbox" value="" id="chk-col-real" data-col="col-real" checked onchange="dataManagement.toggleColumn('col-real', this.checked)">
                                                                <label class="form-check-label" for="chk-col-real">Hora Real</label>
                                                            </li>
                                                            <li class="form-check mb-1">
                                                                <input class="form-check-input col-toggle" type="checkbox" value="" id="chk-col-pax" data-col="col-pax" checked onchange="dataManagement.toggleColumn('col-pax', this.checked)">
                                                                <label class="form-check-label" for="chk-col-pax">Pasajeros (Pax)</label>
                                                            </li>
                                                            <li class="form-check mb-1">
                                                                <input class="form-check-input col-toggle" type="checkbox" value="" id="chk-col-matricula" data-col="col-matricula" checked onchange="dataManagement.toggleColumn('col-matricula', this.checked)">
                                                                <label class="form-check-label" for="chk-col-matricula">Matrícula</label>
                                                            </li>
                                                        </ul>
                                                    </div>

                                                    <button class="btn btn-primary btn-sm"
                                                        onclick="dataManagement.addItem('daily_flights_ops')"><i
                                                            class="fas fa-plus"></i> Agregar Vuelo</button>
                                                </div>
                                            </div>

                                            <div class="row g-3">
                                                <!-- ── Global search bar ── -->
                                                <div class="col-12">
                                                    <div class="input-group input-group-sm shadow-sm flights-global-search">
                                                        <span class="input-group-text border-end-0">
                                                            <i class="fas fa-search"></i>
                                                        </span>
                                                        <input type="text" class="form-control"
                                                            id="search-flights-global"
                                                            placeholder="🔍  Buscar en llegadas y salidas (aerolínea, vuelo, origen, destino, matrícula…)"
                                                            oninput="dataManagement.filterFlightsGlobal(this.value)">
                                                        <button class="btn btn-outline-secondary btn-sm" type="button"
                                                            title="Limpiar búsqueda"
                                                            onclick="dataManagement.clearFlightsSearch()">
                                                            <i class="fas fa-times"></i>
                                                        </button>
                                                    </div>
                                                </div>

                                                <!-- Arrivals Column -->
                                                <div class="col-lg-6">
                                                    <div class="card h-100 border-0 shadow-sm flights-card">
                                                        <div class="card-header arr-header text-white py-2 d-flex justify-content-between align-items-center">
                                                            <h6 class="mb-0"><i class="fas fa-plane-arrival me-2"></i>Llegadas</h6>
                                                            <div class="d-flex align-items-center gap-2">
                                                                <span class="badge bg-white text-success flights-count-badge" id="arrivals-count-badge">— vuelos</span>
                                                                <button class="btn btn-sm btn-light btn-date-filter-toggle" id="btn-date-daily-arr"
                                                                    onclick="dataManagement.toggleDailyDatePanel('arrival')" title="Filtrar por fecha">
                                                                    <i class="fas fa-filter"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                        <div id="daily-date-panel-arr" class="board-date-panel d-none">
                                                            <div class="d-flex align-items-center justify-content-between mb-2 pb-2 border-bottom">
                                                                <span class="small fw-semibold text-success" style="letter-spacing:.03em"><i class="fas fa-calendar-week me-1"></i>Ventana de Fecha &mdash; Llegadas</span>
                                                                <button type="button" class="btn-close" style="font-size:.65rem" title="Cerrar" onclick="dataManagement.toggleDailyDatePanel('arrival')"></button>
                                                            </div>
                                                            <div class="d-flex align-items-center gap-2 flex-wrap">
                                                                <span class="small fw-semibold text-muted" style="white-space:nowrap">Modo:</span>
                                                                <div class="btn-group btn-group-sm" role="group">
                                                                    <button class="btn btn-outline-success active" type="button" id="daily-arr-mode-rel"
                                                                        onclick="dataManagement.setDailyDateMode('arrival','rel')">Relative</button>
                                                                    <button class="btn btn-outline-success" type="button" id="daily-arr-mode-abs"
                                                                        onclick="dataManagement.setDailyDateMode('arrival','abs')">Absolute</button>
                                                                </div>
                                                                <div id="daily-arr-rel-mode" class="d-flex flex-column">
                                                                    <div class="d-flex align-items-center gap-1">
                                                                        <button class="btn btn-sm btn-outline-secondary" type="button"
                                                                            onclick="dataManagement.stepDailyOffset('arrival','start',-1)">-</button>
                                                                        <input type="number" class="form-control form-control-sm text-center" id="daily-arr-rel-start"
                                                                            value="-4" style="width:60px" oninput="dataManagement.applyDailyDateFilter('arrival')">
                                                                        <button class="btn btn-sm btn-outline-secondary" type="button"
                                                                            onclick="dataManagement.stepDailyOffset('arrival','start',1)">+</button>
                                                                        <span class="small text-muted">to</span>
                                                                        <button class="btn btn-sm btn-outline-secondary" type="button"
                                                                            onclick="dataManagement.stepDailyOffset('arrival','end',-1)">-</button>
                                                                        <input type="number" class="form-control form-control-sm text-center" id="daily-arr-rel-end"
                                                                            value="0" style="width:60px" oninput="dataManagement.applyDailyDateFilter('arrival')">
                                                                        <button class="btn btn-sm btn-outline-secondary" type="button"
                                                                            onclick="dataManagement.stepDailyOffset('arrival','end',1)">+</button>
                                                                    </div>
                                                                    <div class="d-flex align-items-center gap-1 small text-muted mt-1">
                                                                        <span id="daily-arr-rel-start-label">—</span>
                                                                        <span>to</span>
                                                                        <span id="daily-arr-rel-end-label">—</span>
                                                                    </div>
                                                                </div>
                                                                <div id="daily-arr-abs-mode" class="d-flex align-items-center gap-2 d-none">
                                                                    <input type="date" class="form-control form-control-sm" id="daily-arr-abs-from"
                                                                        style="width:135px" oninput="dataManagement.applyDailyDateFilter('arrival')">
                                                                    <span class="small text-muted">to</span>
                                                                    <input type="date" class="form-control form-control-sm" id="daily-arr-abs-to"
                                                                        style="width:135px" oninput="dataManagement.applyDailyDateFilter('arrival')">
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="card-body p-0">
                                                            <div class="table-responsive">
                                                                <table
                                                                    class="table table-hover table-bordered table-sm align-middle mb-0 table-fixed-small"
                                                                    id="table-daily-flights-arrivals">
                                                                    <thead class="table-light">
                                                                        <tr
                                                                            class="text-center small text-muted text-uppercase">
                                                                            <th class="w-30px col-no">No.</th>
                                                                            <th class="w-75px col-aerolinea">Aerolínea</th>
                                                                            <th class="w-60px col-vuelo">Vuelo</th>
                                                                            <th class="w-85px col-route">Origen</th>
                                                                            <th class="col-prog">Prog</th>
                                                                            <th class="col-real">Real</th>
                                                                            <th class="w-65px col-pax">Pax</th>
                                                                            <th class="col-conciliacion d-none w-40px"><i
                                                                                    class="fas fa-check-circle"></i>
                                                                            </th>
                                                                            <th class="w-40px col-actions"></th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody class="text-center bg-white"></tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Departures Column -->
                                                <div class="col-lg-6">
                                                    <div class="card h-100 border-0 shadow-sm flights-card">
                                                        <div class="card-header dep-header text-white py-2 d-flex justify-content-between align-items-center">
                                                            <h6 class="mb-0"><i class="fas fa-plane-departure me-2"></i>Salidas</h6>
                                                            <div class="d-flex align-items-center gap-2">
                                                                <span class="badge bg-white text-primary flights-count-badge" id="departures-count-badge">— vuelos</span>
                                                                <button class="btn btn-sm btn-light btn-date-filter-toggle" id="btn-date-daily-dep"
                                                                    onclick="dataManagement.toggleDailyDatePanel('departure')" title="Filtrar por fecha">
                                                                    <i class="fas fa-filter"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                        <div id="daily-date-panel-dep" class="board-date-panel d-none">
                                                            <div class="d-flex align-items-center justify-content-between mb-2 pb-2 border-bottom">
                                                                <span class="small fw-semibold text-primary" style="letter-spacing:.03em"><i class="fas fa-calendar-week me-1"></i>Ventana de Fecha &mdash; Salidas</span>
                                                                <button type="button" class="btn-close" style="font-size:.65rem" title="Cerrar" onclick="dataManagement.toggleDailyDatePanel('departure')"></button>
                                                            </div>
                                                            <div class="d-flex align-items-center gap-2 flex-wrap">
                                                                <span class="small fw-semibold text-muted" style="white-space:nowrap">Modo:</span>
                                                                <div class="btn-group btn-group-sm" role="group">
                                                                    <button class="btn btn-outline-primary active" type="button" id="daily-dep-mode-rel"
                                                                        onclick="dataManagement.setDailyDateMode('departure','rel')">Relative</button>
                                                                    <button class="btn btn-outline-primary" type="button" id="daily-dep-mode-abs"
                                                                        onclick="dataManagement.setDailyDateMode('departure','abs')">Absolute</button>
                                                                </div>
                                                                <div id="daily-dep-rel-mode" class="d-flex flex-column">
                                                                    <div class="d-flex align-items-center gap-1">
                                                                        <button class="btn btn-sm btn-outline-secondary" type="button"
                                                                            onclick="dataManagement.stepDailyOffset('departure','start',-1)">-</button>
                                                                        <input type="number" class="form-control form-control-sm text-center" id="daily-dep-rel-start"
                                                                            value="-4" style="width:60px" oninput="dataManagement.applyDailyDateFilter('departure')">
                                                                        <button class="btn btn-sm btn-outline-secondary" type="button"
                                                                            onclick="dataManagement.stepDailyOffset('departure','start',1)">+</button>
                                                                        <span class="small text-muted">to</span>
                                                                        <button class="btn btn-sm btn-outline-secondary" type="button"
                                                                            onclick="dataManagement.stepDailyOffset('departure','end',-1)">-</button>
                                                                        <input type="number" class="form-control form-control-sm text-center" id="daily-dep-rel-end"
                                                                            value="0" style="width:60px" oninput="dataManagement.applyDailyDateFilter('departure')">
                                                                        <button class="btn btn-sm btn-outline-secondary" type="button"
                                                                            onclick="dataManagement.stepDailyOffset('departure','end',1)">+</button>
                                                                    </div>
                                                                    <div class="d-flex align-items-center gap-1 small text-muted mt-1">
                                                                        <span id="daily-dep-rel-start-label">—</span>
                                                                        <span>to</span>
                                                                        <span id="daily-dep-rel-end-label">—</span>
                                                                    </div>
                                                                </div>
                                                                <div id="daily-dep-abs-mode" class="d-flex align-items-center gap-2 d-none">
                                                                    <input type="date" class="form-control form-control-sm" id="daily-dep-abs-from"
                                                                        style="width:135px" oninput="dataManagement.applyDailyDateFilter('departure')">
                                                                    <span class="small text-muted">to</span>
                                                                    <input type="date" class="form-control form-control-sm" id="daily-dep-abs-to"
                                                                        style="width:135px" oninput="dataManagement.applyDailyDateFilter('departure')">
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="card-body p-0">
                                                            <div class="table-responsive">
                                                                <table
                                                                    class="table table-hover table-bordered table-sm align-middle mb-0 table-fixed-small"
                                                                    id="table-daily-flights-departures">
                                                                    <thead class="table-light">
                                                                        <tr
                                                                            class="text-center small text-muted text-uppercase">
                                                                            <th class="w-75px col-aerolinea">Aerolínea</th>
                                                                            <th class="w-60px col-vuelo">Vuelo</th>
                                                                            <th class="w-85px col-route">Destino</th>
                                                                            <th class="col-prog">Prog</th>
                                                                            <th class="col-real">Real</th>
                                                                            <th class="w-50px col-pax">Pax</th>
                                                                            <th class="w-75px col-matricula">Matrícula</th>
                                                                            <th class="col-conciliacion d-none w-40px"><i
                                                                                    class="fas fa-check-circle"></i>
                                                                            </th>
                                                                            <th class="w-40px col-actions"></th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody class="text-center bg-white"></tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>



                                        <!-- Delays Pane -->
                                        <div class="tab-pane fade" id="pane-delays" role="tabpanel">
                                            <div class="d-flex justify-content-between mb-3">
                                                <div class="d-flex gap-2">
                                                    <select class="form-select w-auto" id="filter-delays-year"
                                                        aria-label="Filtrar por año">
                                                        <option value="2025">2025</option>
                                                    </select>
                                                    <select class="form-select w-auto" id="filter-delays-month"
                                                        aria-label="Filtrar por mes">
                                                        <option value="">Todos los meses</option>
                                                        <option value="Enero">Enero</option>
                                                        <option value="Febrero">Febrero</option>
                                                        <!-- Add more months -->
                                                    </select>
                                                </div>
                                                <button class="btn btn-primary btn-sm"
                                                    onclick="dataManagement.addItem('delays')"><i
                                                        class="fas fa-plus"></i>
                                                    Agregar Demora</button>
                                            </div>
                                            <div class="table-responsive">
                                                <table class="table table-striped table-hover" id="table-delays">
                                                    <thead>
                                                        <tr>
                                                            <th>Mes</th>
                                                            <th>Causa</th>
                                                            <th>Cantidad</th>
                                                            <th>Descripción</th>
                                                            <th>Acciones</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- Comparativa Pane -->
                                        <div class="tab-pane fade" id="pane-comparativa" role="tabpanel">
                                            <div class="row align-items-center">
                                                <div class="col-md-6">
                                                    <h5 class="mb-3">Reporte de Análisis Comparativo</h5>
                                                    <p class="text-muted small">Sube aquí el archivo PDF actualizado
                                                        para la sección de Análisis Comparativo.</p>
                                                    <div class="mb-3">
                                                        <label for="comparativa-pdf-upload" class="form-label">Archivo
                                                            PDF</label>
                                                        <input class="form-control" type="file"
                                                            id="comparativa-pdf-upload" accept="application/pdf">
                                                    </div>
                                                    <button id="btn-upload-comparativa" class="btn btn-primary"><i
                                                            class="fas fa-cloud-upload-alt me-2"></i>Subir y
                                                        Actualizar</button>
                                                    <div id="comparativa-upload-status" class="mt-2"></div>
                                                </div>
                                                <div class="col-md-6">
                                                    <h6 class="text-muted mb-2">Vista Previa Actual</h6>
                                                    <div class="ratio ratio-16x9 border rounded bg-light">
                                                        <iframe id="preview-comparativa-admin" src="" title="Vista previa comparativa"></iframe>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Pane Conciliación (Administración) -->
                                        <div class="tab-pane fade" id="pane-conciliacion-admin" role="tabpanel">

                                            <div class="d-flex justify-content-between align-items-center mb-3">
                                                <h5 class="mb-0 text-primary"><i class="fas fa-plane me-2"></i>Itinerario de Vuelos del Día</h5>
                                                <div class="d-flex gap-2 align-items-center flex-wrap">
                                                    <button class="btn btn-sm btn-outline-secondary" onclick="window.opsFlightsAdmin.loadData()" title="Actualizar"><i class="fas fa-sync-alt me-1"></i>Actualizar</button>
                                                    <button class="btn btn-sm btn-danger d-none" id="btn-delete-admin-selected" onclick="window.opsFlightsAdmin.deleteSelected()">
                                                        <i class="fas fa-trash me-1"></i>Eliminar seleccionados (<span id="admin-selected-count">0</span>)
                                                    </button>
                                                </div>
                                            </div>

                                            <!-- Danger zone strip -->
                                            <div class="alert alert-danger border-danger py-2 px-3 mb-2 flex-wrap" role="alert" style="font-size:.85rem">
                                                <div class="d-flex align-items-center gap-3 flex-wrap">
                                                    <i class="fas fa-exclamation-triangle fa-lg"></i>
                                                    <span><strong>Zona de Administración</strong> — Los cambios son permanentes e irreversibles.</span>
                                                </div>
                                                <!-- Row 1: single day -->
                                                <div class="d-flex align-items-center gap-2 mt-2 flex-wrap">
                                                    <i class="fas fa-calendar-day text-danger" style="width:16px"></i>
                                                    <label class="mb-0 fw-semibold" for="admin-delete-date">Eliminar día:</label>
                                                    <input type="date" class="form-control form-control-sm" id="admin-delete-date" style="width:145px" oninput="window.opsFlightsAdmin.filterByDeleteDate()">
                                                    <button class="btn btn-sm btn-danger" onclick="window.opsFlightsAdmin.deleteByDate()">
                                                        <i class="fas fa-trash-alt me-1"></i>Eliminar día
                                                    </button>
                                                </div>
                                                <!-- Row 2: date range -->
                                                <div class="d-flex align-items-center gap-2 mt-2 flex-wrap">
                                                    <i class="fas fa-calendar-week text-danger" style="width:16px"></i>
                                                    <label class="mb-0 fw-semibold">Eliminar rango:</label>
                                                    <input type="date" class="form-control form-control-sm" id="admin-range-start" style="width:145px" oninput="window.opsFlightsAdmin.previewRange()">
                                                    <span class="text-muted">al</span>
                                                    <input type="date" class="form-control form-control-sm" id="admin-range-end" style="width:145px" oninput="window.opsFlightsAdmin.previewRange()">
                                                    <span id="admin-range-preview" class="badge bg-warning text-dark d-none" style="font-size:.78rem"></span>
                                                    <button class="btn btn-sm btn-danger" onclick="window.opsFlightsAdmin.deleteByRange()">
                                                        <i class="fas fa-trash-alt me-1"></i>Eliminar rango
                                                    </button>
                                                </div>
                                            </div>

                                            <!-- Status message -->
                                            <div id="admin-status-msg" class="d-none mb-2"></div>

                                            <!-- Days Summary Card -->
                                            <div class="card shadow-sm border-0 mb-3" id="admin-days-summary-card">
                                                <div class="card-header bg-light d-flex justify-content-between align-items-center py-2">
                                                    <div class="d-flex align-items-center gap-2">
                                                        <i class="fas fa-calendar-alt text-primary"></i>
                                                        <h6 class="mb-0 text-uppercase small text-muted fw-bold">Días con Vuelos Cargados</h6>
                                                    </div>
                                                    <small class="text-muted" style="font-size:.75rem">Haz clic en un día para filtrar la tabla</small>
                                                </div>
                                                <div class="card-body py-3 px-3">
                                                    <div id="admin-days-grid">
                                                        <p class="text-muted small mb-0"><i class="fas fa-spinner fa-spin me-1"></i>Cargando...</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Admin Table (same design as Conciliación) -->
                                            <div class="row">
                                                <div class="col-12 mb-4">
                                                    <div class="card shadow-sm border-0">
                                                        <div class="card-header bg-light d-flex justify-content-between align-items-center">
                                                            <div class="d-flex align-items-center gap-2">
                                                                <h6 class="mb-0 text-uppercase small text-muted">Vuelos importados desde CSV</h6>
                                                                <span id="admin-flight-count-badge" class="badge rounded-pill bg-primary" style="font-size:.75rem;display:none">0 vuelos</span>
                                                            </div>
                                                        </div>
                                                        <div class="table-responsive" id="container-admin-flights-csv"
                                                            style="max-height:calc(100vh - 320px);overflow:auto;scrollbar-width:thin;scrollbar-color:#b0b8c8 #f4f6fa;">
                                                            <table class="table table-hover table-bordered table-sm align-middle mb-0 table-csv-fixed" id="table-admin-flights-csv">
                                                                <thead class="table-light">
                                                                    <tr class="text-center small text-muted text-uppercase" style="position:sticky;top:0;z-index:3;background:#f8f9fa">
                                                                        <th style="width:36px;background:#f8f9fa">
                                                                            <input type="checkbox" class="form-check-input" id="admin-select-all" title="Seleccionar todo" onchange="window.opsFlightsAdmin.toggleSelectAll(this.checked)">
                                                                        </th>
                                                                        <th>Status</th>
                                                                        <th><i class="fas fa-arrow-down text-success me-1 rotate-n45"></i>[Arr] Airline</th>
                                                                        <th><i class="fas fa-arrow-down text-success me-1 rotate-n45"></i>[Arr] Flight</th>
                                                                        <th><i class="fas fa-arrow-down text-success me-1 rotate-n45"></i>[Arr] ALDT</th>
                                                                        <th><i class="fas fa-arrow-down text-success me-1 rotate-n45"></i>[Arr] SIBT</th>
                                                                        <th><i class="fas fa-arrow-down text-success me-1 rotate-n45"></i>[Arr] AIBT</th>
                                                                        <th><i class="fas fa-arrow-down text-success me-1 rotate-n45"></i>[Arr] Stand</th>
                                                                        <th><i class="fas fa-arrow-down text-success me-1 rotate-n45"></i>[Arr] Gates</th>
                                                                        <th><i class="fas fa-arrow-down text-success me-1 rotate-n45"></i>[Arr] Boarded</th>
                                                                        <th><i class="fas fa-arrow-down text-success me-1 rotate-n45"></i>[Arr] Type <button type="button" class="btn btn-link p-0 border-0" style="font-size:.6em;opacity:.8;vertical-align:middle;line-height:1;color:inherit;" onclick="event.stopPropagation();new bootstrap.Modal(document.getElementById('modalFlightServiceType')).show()" title="Ver catálogo de tipos de servicio"><i class="fas fa-circle-question"></i></button></th>
                                                                        <th>Routing</th>
                                                                        <th><i class="fas fa-arrow-up text-primary me-1 rotate-45"></i>[Dep] Type <button type="button" class="btn btn-link p-0 border-0" style="font-size:.6em;opacity:.8;vertical-align:middle;line-height:1;color:inherit;" onclick="event.stopPropagation();new bootstrap.Modal(document.getElementById('modalFlightServiceType')).show()" title="Ver catálogo de tipos de servicio"><i class="fas fa-circle-question"></i></button></th>
                                                                        <th>Aircraft type</th>
                                                                        <th>Registration</th>
                                                                        <th><i class="fas fa-arrow-up text-primary me-1 rotate-45"></i>[Dep] Airline</th>
                                                                        <th><i class="fas fa-arrow-up text-primary me-1 rotate-45"></i>[Dep] Flight</th>
                                                                        <th><i class="fas fa-arrow-up text-primary me-1 rotate-45"></i>[Dep] Stand</th>
                                                                        <th><i class="fas fa-arrow-up text-primary me-1 rotate-45"></i>[Dep] Gates</th>
                                                                        <th><i class="fas fa-arrow-up text-primary me-1 rotate-45"></i>[Dep] Boarded</th>
                                                                        <th><i class="fas fa-arrow-up text-primary me-1 rotate-45"></i>[Dep] SOBT</th>
                                                                        <th><i class="fas fa-arrow-up text-primary me-1 rotate-45"></i>[Dep] AOBT</th>
                                                                        <th><i class="fas fa-arrow-up text-primary me-1 rotate-45"></i>[Dep] ATOT</th>
                                                                        <th><i class="fas fa-arrow-up text-primary me-1 rotate-45"></i>[Dep] ATTT</th>
                                                                        <th style="min-width:80px;background:#fff0f0;border-left:2px solid #f5c6c6">Acción</th>
                                                                    </tr>
                                                                    <tr class="csv-filter-row">
                                                                        <th style="background:#f8f9fa"></th>
                                                                        <th><input type="text" class="form-control form-control-sm" data-admin-field="Status" placeholder="Filtrar..."></th>
                                                                        <th><input type="text" class="form-control form-control-sm" data-admin-field="[Arr] Airline code" placeholder="Filtrar..."></th>
                                                                        <th><input type="text" class="form-control form-control-sm" data-admin-field="[Arr] Flight Designator" placeholder="Filtrar..."></th>
                                                                        <th><input type="text" class="form-control form-control-sm" data-admin-field="[Arr] ALDT" placeholder="Filtrar..."></th>
                                                                        <th><input type="text" class="form-control form-control-sm" data-admin-field="[Arr] SIBT" placeholder="Filtrar..."></th>
                                                                        <th><input type="text" class="form-control form-control-sm" data-admin-field="[Arr] AIBT" placeholder="Filtrar..."></th>
                                                                        <th><input type="text" class="form-control form-control-sm" data-admin-field="[Arr] Stand" placeholder="Filtrar..."></th>
                                                                        <th><input type="text" class="form-control form-control-sm" data-admin-field="[Arr] Gates" placeholder="Filtrar..."></th>
                                                                        <th><input type="text" class="form-control form-control-sm" data-admin-field="[Arr] Boarded" placeholder="Filtrar..."></th>
                                                                        <th><input type="text" class="form-control form-control-sm" data-admin-field="[Arr] Service Type" placeholder="Filtrar..."></th>
                                                                        <th><input type="text" class="form-control form-control-sm" data-admin-field="Routing" placeholder="Filtrar..."></th>
                                                                        <th><input type="text" class="form-control form-control-sm" data-admin-field="[Dep] Service Type" placeholder="Filtrar..."></th>
                                                                        <th><input type="text" class="form-control form-control-sm" data-admin-field="Aircraft type" placeholder="Filtrar..."></th>
                                                                        <th><input type="text" class="form-control form-control-sm" data-admin-field="Registration" placeholder="Filtrar..."></th>
                                                                        <th><input type="text" class="form-control form-control-sm" data-admin-field="[Dep] Airline code" placeholder="Filtrar..."></th>
                                                                        <th><input type="text" class="form-control form-control-sm" data-admin-field="[Dep] Flight Designator" placeholder="Filtrar..."></th>
                                                                        <th><input type="text" class="form-control form-control-sm" data-admin-field="[Dep] Stand" placeholder="Filtrar..."></th>
                                                                        <th><input type="text" class="form-control form-control-sm" data-admin-field="[Dep] Gates" placeholder="Filtrar..."></th>
                                                                        <th><input type="text" class="form-control form-control-sm" data-admin-field="[Dep] Boarded" placeholder="Filtrar..."></th>
                                                                        <th><input type="text" class="form-control form-control-sm" data-admin-field="[Dep] SOBT" placeholder="Filtrar..."></th>
                                                                        <th><input type="text" class="form-control form-control-sm" data-admin-field="[Dep] AOBT" placeholder="Filtrar..."></th>
                                                                        <th><input type="text" class="form-control form-control-sm" data-admin-field="[Dep] ATOT" placeholder="Filtrar..."></th>
                                                                        <th><input type="text" class="form-control form-control-sm" data-admin-field="[Dep] ATTT" placeholder="Filtrar..."></th>
                                                                        <th style="background:#fff0f0;border-left:2px solid #f5c6c6"></th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody id="tbody-admin-flights-csv" class="text-center bg-white">
                                                                    <tr>
                                                                        <td colspan="25" class="text-muted py-4"><i class="fas fa-spinner fa-spin me-2"></i>Cargando vuelos...</td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div><!-- /pane-conciliacion-admin -->



                                        <!-- Pane Biblioteca -->
                                        <div class="tab-pane fade" id="pane-library" role="tabpanel">
                                            <div class="d-flex justify-content-between align-items-center mb-4">
                                                <h4 class="mb-0"><i class="fas fa-book me-2"></i>Gestión de
                                                    Biblioteca Digital</h4>
                                            </div>

                                            <ul class="nav nav-tabs mb-3" id="libraryTabs" role="tablist">
                                                <li class="nav-item" role="presentation">
                                                    <button class="nav-link active" id="library-cats-tab"
                                                        data-bs-toggle="tab" data-bs-target="#subpane-library-cats"
                                                        type="button" role="tab">Cuadros / Categorías</button>
                                                </li>
                                                <li class="nav-item" role="presentation">
                                                    <button class="nav-link" id="library-items-tab" data-bs-toggle="tab"
                                                        data-bs-target="#subpane-library-items" type="button"
                                                        role="tab">Ítems / Contenido</button>
                                                </li>
                                            </ul>

                                            <div class="tab-content" id="libraryTabsContent">
                                                <div class="tab-pane fade show active" id="subpane-library-cats"
                                                    role="tabpanel">
                                                    <div class="mb-3 d-flex justify-content-end">
                                                        <button class="btn btn-primary btn-sm"
                                                            onclick="dataManagement.addItem('library_categories')"><i
                                                                class="fas fa-plus me-1"></i> Nueva
                                                            Categoría</button>
                                                    </div>
                                                    <div class="table-responsive">
                                                        <table class="table table-sm table-striped"
                                                            id="table-library-categories">
                                                            <thead>
                                                                <tr>
                                                                    <th>Icono</th>
                                                                    <th>Título</th>
                                                                    <th>Descripción</th>
                                                                    <th>Orden</th>
                                                                    <th>Acciones</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody></tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                                <div class="tab-pane fade" id="subpane-library-items" role="tabpanel">
                                                    <div class="mb-3 d-flex justify-content-end">
                                                        <button class="btn btn-primary btn-sm"
                                                            onclick="dataManagement.addItem('library_items')"><i
                                                                class="fas fa-plus me-1"></i> Nuevo Ítem</button>
                                                    </div>
                                                    <div class="table-responsive">
                                                        <table class="table table-sm table-striped"
                                                            id="table-library-items">
                                                            <thead>
                                                                <tr>
                                                                    <th>Categoría</th>
                                                                    <th>Título</th>
                                                                    <th>Tipo</th>
                                                                    <th>URL</th>
                                                                    <th>Orden</th>
                                                                    <th>Acciones</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody></tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Pane Alertas -->
                                        <div class="tab-pane fade" id="pane-alerts" role="tabpanel">
                                            <div class="d-flex justify-content-between align-items-center mb-4">
                                                <h4 class="mb-0 text-danger"><i class="fas fa-bullhorn me-2"></i>Gestión
                                                    de Avisos y Alertas</h4>
                                                <button class="btn btn-primary btn-sm"
                                                    onclick="dataManagement.addItem('system_alerts')"><i
                                                        class="fas fa-plus me-1"></i> Nueva Alerta</button>
                                            </div>

                                            <div class="alert alert-info border-start border-4 border-info shadow-sm">
                                                <i class="fas fa-info-circle me-2"></i> Las alertas activas aparecerán
                                                en la parte superior de la aplicación para todos los usuarios.
                                            </div>

                                            <div class="table-responsive">
                                                <table class="table table-striped table-hover" id="table-system-alerts">
                                                    <thead>
                                                        <tr>
                                                            <th>Nivel</th>
                                                            <th>Título</th>
                                                            <th>Mensaje</th>
                                                            <th>Activo</th>
                                                            <th>Expira</th>
                                                            <th>Acciones</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="historia-section" class="content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="section-heading mb-0"><i class="fas fa-history me-2"></i>Historial de Cambios
                        </h2>
                        <div>
                            <button class="btn btn-outline-secondary btn-sm me-2" onclick="testHistoryConnection()"><i
                                    class="fas fa-plug me-1"></i>Probar
                                Conexión</button>
                            <button class="btn btn-outline-primary btn-sm" onclick="loadHistory()"><i
                                    class="fas fa-sync-alt me-1"></i>Actualizar</button>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle" id="history-table">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Fecha</th>
                                            <th>Usuario</th>
                                            <th>Acción</th>
                                            <th>Entidad</th>
                                            <th>Detalles</th>
                                        </tr>
                                    </thead>
                                    <tbody id="history-table-body">
                                        <tr>
                                            <td colspan="5" class="text-center text-muted">Cargando historial...
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="inicio-section" class="content-section">
                    <div class="card">
                        <div class="card-header">
                            <ul class="nav nav-tabs card-header-tabs" id="inicioTab" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="interactivo-inicio-tab" data-bs-toggle="tab"
                                        data-bs-target="#interactivo-inicio-pane" type="button" role="tab"
                                        aria-controls="interactivo-inicio-pane" aria-selected="true"><i
                                            class="fas fa-table me-2"></i>Vista Interactiva</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="graficas-itinerario-tab" data-bs-toggle="tab"
                                        data-bs-target="#graficas-itinerario-pane" type="button" role="tab"
                                        aria-controls="graficas-itinerario-pane" aria-selected="false"><i
                                            class="fas fa-chart-area me-2"></i>Gráficas Itinerario</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="radar-operativo-tab" data-bs-toggle="tab"
                                        data-bs-target="#radar-operativo-pane" type="button" role="tab"
                                        aria-controls="radar-operativo-pane" aria-selected="false"><i
                                            class="fas fa-satellite-dish me-2"></i>Radar Operativo</button>
                                </li>
                                
                            </ul>
                        </div>
                        <div class="card-body">
                            <div class="tab-content" id="inicioTabContent">
                                <div class="tab-pane fade show active" id="interactivo-inicio-pane" role="tabpanel"
                                    aria-labelledby="interactivo-inicio-tab" tabindex="0">
                                    <!-- Tablero de Aerolíneas removido a petición -->
                                    <div class="row">
                                        <div class="col-12">
                                            <div id="filter-controls" class="filter-container mb-4">
                                                <div class="filter-header">
                                                    <i class="fas fa-filter me-2"></i>
                                                    <h5 class="mb-0">Filtros de Búsqueda</h5>
                                                </div>
                                                <div class="filters-bar">
                                                    <!-- Fecha (Único filtro original conservado) -->
                                                    <div class="chip">
                                                        <label for="date-filter"><i class="fas fa-calendar-day me-1"></i>Fecha</label>
                                                        <input type="date" id="date-filter" class="form-control">
                                                    </div>

                                                    <!-- Botón Limpiar (Opcional, pero útil) -->
                                                    <div class="chip">
                                                        <button id="clear-filters-btn" class="btn btn-outline-secondary btn-sm h-100" aria-label="Limpiar filtros">
                                                            <i class="fas fa-eraser"></i>
                                                        </button>
                                                    </div>

                                                    <!-- Hidden Legacy Inputs to prevent JS errors if referenced directly without check -->
                                                    <input type="hidden" id="claim-filter">
                                                    <input type="hidden" id="global-search"> 
                                                    <select id="position-filter" class="d-none" aria-label="Filtro Posición"><option value="all">Todas</option></select>
                                                    <select id="origin-filter" class="d-none" aria-label="Filtro Origen"><option value="all">Todos</option></select>
                                                    <select id="destination-filter" class="d-none" aria-label="Filtro Destino"><option value="all">Todos</option></select>
                                                    <select id="hour-filter" class="d-none" aria-label="Filtro Hora"><option value="all">Todas</option></select>
                                                    <select id="hour-type-filter" class="d-none" aria-label="Filtro Tipo Hora"><option value="both">Ambas</option></select>
                                                </div>
                                                    <div class="filters-actions">
                                                        <button id="clear-filters"
                                                            class="btn btn-outline-secondary btn-sm">Limpiar</button>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div id="summary-table-container" class="mb-4"></div>

                                            <div class="itinerary-airline-toolbar d-none">
                                                <!--
                                                <div class="itinerary-airline-picker">
                                                    <label for="airline-filter" class="airline-picker-label"><i
                                                            class="fas fa-plane me-1"></i>Aerolínea</label>
                                                    <select id="airline-filter" class="form-select"
                                                        aria-label="Filtrar por aerolínea">
                                                        <option value="all" selected>Todas las Aerolíneas</option>
                                                    </select>
                                                </div>
                                                -->
                                                <div class="airline-summary-card is-empty" id="airline-summary-card"
                                                    aria-live="polite">
                                                    <div class="airline-summary-placeholder"><i
                                                            class="fas fa-plane-arrival me-2"></i>Selecciona una
                                                        aerolínea para ver su resumen diario.</div>
                                                </div>
                                            </div>
                                            <div id="itinerary-airline-detail" class="itinerary-airline-detail d-none"
                                                aria-live="polite"></div>
                                            <div class="itinerary-table-block" id="itinerary-passenger-block">
                                                <div id="passenger-itinerary-container" class="itinerary-general-host">
                                                </div>
                                            </div>

                                            <div class="itinerary-table-block" id="itinerary-cargo-block">
                                                <div id="cargo-itinerary-container" class="itinerary-general-host">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="graficas-itinerario-pane" role="tabpanel"
                                    aria-labelledby="graficas-itinerario-tab" tabindex="0">
                                    <div class="pt-3">
                                        <div id="itinerario-section">
                                            <div class="card">
                                                <div
                                                    class="card-header flex-column flex-md-row d-flex justify-content-between align-items-center">
                                                    <h2 class="section-title mb-3 mb-md-0">ITINERARIO DETALLADO
                                                        <small id="it-stats-badge"
                                                            class="text-muted ms-2 text-small-8"></small>
                                                    </h2>
                                                    <div class="d-flex gap-2">
                                                        <a href="excel/itinerario_completo.xlsx"
                                                            class="btn btn-success download-btn" download><i
                                                                class="fas fa-file-excel me-2"></i><span
                                                                class="btn-text">Descargar
                                                                Excel</span></a>
                                                    </div>
                                                </div>
                                                <div class="card-body">
                                                    <!-- Controles de fecha (vuelos del día) -->
                                                    <div class="d-flex flex-wrap align-items-center justify-content-end gap-2 mb-2"
                                                        id="itinerary-day-controls">
                                                        <button class="btn btn-sm btn-outline-secondary"
                                                            id="it-day-prev" title="Día anterior"><i
                                                                class="fas fa-chevron-left"></i></button>
                                                        <input type="date" id="it-day-input"
                                                            class="form-control form-control-sm"
                                                            aria-label="Seleccionar fecha del itinerario" />
                                                        <button class="btn btn-sm btn-outline-secondary"
                                                            id="it-day-next" title="Día siguiente"><i
                                                                class="fas fa-chevron-right"></i></button>
                                                        <button class="btn btn-sm btn-outline-primary" id="it-day-today"
                                                            title="Hoy"><i
                                                                class="fas fa-calendar-day me-1"></i>Hoy</button>
                                                    </div>

                                                    <ul class="nav nav-tabs" id="itineraryTab" role="tablist">
                                                        <li class="nav-item" role="presentation"><button
                                                                class="nav-link active" id="pasajeros-grafica-tab"
                                                                data-bs-toggle="tab"
                                                                data-bs-target="#pasajeros-grafica-pane" type="button"
                                                                role="tab" aria-controls="pasajeros-grafica-pane"
                                                                aria-selected="true">1.
                                                                Gráfica (Pasajeros)</button>
                                                        </li>
                                                        <li class="nav-item" role="presentation"><button
                                                                class="nav-link" id="carga-grafica-tab"
                                                                data-bs-toggle="tab"
                                                                data-bs-target="#carga-grafica-pane" type="button"
                                                                role="tab" aria-controls="carga-grafica-pane"
                                                                aria-selected="false">2.
                                                                Gráfica
                                                                (Carga)</button></li>
                                                        <li class="nav-item" role="presentation"><button
                                                                class="nav-link" id="general-grafica-tab"
                                                                data-bs-toggle="tab"
                                                                data-bs-target="#general-grafica-pane" type="button"
                                                                role="tab" aria-controls="general-grafica-pane"
                                                                aria-selected="false"><i class="fas fa-globe me-1"></i>3.
                                                                Vista General</button></li>
                                                    </ul>
                                                    <div class="tab-content pt-3" id="itineraryTabContent">
                                                        <!-- Pasajeros: Llegadas/Salidas del día -->
                                                        <div class="tab-pane fade show active"
                                                            id="pasajeros-grafica-pane">
                                                            <div
                                                                class="itinerary-charts-scroll itinerary-pane-block charts-block">
                                                                <div class="row g-3 chart-row-mobile-scroll">
                                                                    <div class="col-lg-6">
                                                                        <h6 class="text-muted mb-2"><i
                                                                                class="fas fa-person-walking me-1"></i>Llegadas
                                                                            (Pasajeros) por hora</h6>
                                                                        <div class="chart-container chart-height-360">
                                                                            <canvas id="paxArrivalsChart"></canvas>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-lg-6">
                                                                        <h6 class="text-muted mb-2"><i
                                                                                class="fas fa-person-walking-luggage me-1"></i>Salidas
                                                                            (Pasajeros) por hora</h6>
                                                                        <div class="chart-container chart-height-360">
                                                                            <canvas id="paxDeparturesChart"></canvas>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div
                                                                class="itinerary-top-block itinerary-pane-block top-hours-widget">
                                                                <div class="top-hours-header">
                                                                    <div class="top-hours-title">
                                                                        <span class="top-hours-eyebrow">Radar
                                                                            horario</span>
                                                                        <div class="d-flex align-items-center gap-2">
                                                                            <i class="fas fa-star text-warning"></i>
                                                                            <span class="top-hours-heading">Top
                                                                                horas
                                                                                (Pasajeros)</span>
                                                                        </div>
                                                                        <p class="mb-0 top-hours-subtitle text-muted">
                                                                            Haz clic en una franja para abrir los
                                                                            vuelos
                                                                            identificados en esa hora.</p>
                                                                    </div>
                                                                    <div class="top-hours-controls">
                                                                        <label for="pax-topN"
                                                                            class="top-hours-label text-muted mb-0">Mostrar</label>
                                                                        <select id="pax-topN"
                                                                            class="form-select form-select-sm top-hours-select"
                                                                            aria-label="Seleccionar top N pasajeros">
                                                                            <option value="3">Top 3</option>
                                                                            <option value="5">Top 5</option>
                                                                            <option value="10" selected>Top 10</option>
                                                                            <option value="24">Todas (24h)</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="row g-3 top-hours-grid">
                                                                    <div class="col-md-6">
                                                                        <div class="top-hours-card arrivals-theme">
                                                                            <div class="top-hours-card-header">
                                                                                <span
                                                                                    class="top-hours-chip chip-arrivals"><i
                                                                                        class="fas fa-plane-arrival me-1"></i>Llegadas</span>
                                                                                <small class="text-muted">Tráfico
                                                                                    entrante del día</small>
                                                                            </div>
                                                                            <ol id="pax-top-arr"
                                                                                class="top-hours-list mb-0">
                                                                            </ol>
                                                                            <p
                                                                                class="top-hours-footnote text-muted mb-0">
                                                                                <i
                                                                                    class="fas fa-mouse-pointer me-1"></i>Selecciona
                                                                                la hora para ver los vuelos.
                                                                            </p>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-6">
                                                                        <div class="top-hours-card departures-theme">
                                                                            <div class="top-hours-card-header">
                                                                                <span
                                                                                    class="top-hours-chip chip-departures"><i
                                                                                        class="fas fa-plane-departure me-1"></i>Salidas</span>
                                                                                <small class="text-muted">Tráfico
                                                                                    saliente programado</small>
                                                                            </div>
                                                                            <ol id="pax-top-dep"
                                                                                class="top-hours-list mb-0">
                                                                            </ol>
                                                                            <p
                                                                                class="top-hours-footnote text-muted mb-0">
                                                                                <i
                                                                                    class="fas fa-mouse-pointer me-1"></i>Haz
                                                                                clic para abrir la lista de vuelos.
                                                                            </p>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- Carga: Llegadas/Salidas del día -->
                                                        <div class="tab-pane fade" id="carga-grafica-pane">
                                                            <div
                                                                class="itinerary-charts-scroll itinerary-pane-block charts-block">
                                                                <div class="row g-3 chart-row-mobile-scroll">
                                                                    <div class="col-lg-6">
                                                                        <h6 class="text-muted mb-2"><i
                                                                                class="fas fa-box-open me-1"></i>Llegadas
                                                                            (Carga) por hora</h6>
                                                                        <div class="chart-container chart-height-360">
                                                                            <canvas id="cargoArrivalsChart"></canvas>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-lg-6">
                                                                        <h6 class="text-muted mb-2"><i
                                                                                class="fas fa-truck-ramp-box me-1"></i>Salidas
                                                                            (Carga) por hora</h6>
                                                                        <div class="chart-container chart-height-360">
                                                                            <canvas id="cargoDeparturesChart"></canvas>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div
                                                                class="itinerary-top-block itinerary-pane-block top-hours-widget">
                                                                <div class="top-hours-header">
                                                                    <div class="top-hours-title">
                                                                        <span class="top-hours-eyebrow">Radar
                                                                            horario</span>
                                                                        <div class="d-flex align-items-center gap-2">
                                                                            <i class="fas fa-star text-warning"></i>
                                                                            <span class="top-hours-heading">Top
                                                                                horas
                                                                                (Carga)</span>
                                                                        </div>
                                                                        <p class="mb-0 top-hours-subtitle text-muted">
                                                                            Explora las ventanas más cargadas y
                                                                            consulta
                                                                            los vuelos con un clic.</p>
                                                                    </div>
                                                                    <div class="top-hours-controls">
                                                                        <label for="cargo-topN"
                                                                            class="top-hours-label text-muted mb-0">Mostrar</label>
                                                                        <select id="cargo-topN"
                                                                            class="form-select form-select-sm top-hours-select"
                                                                            aria-label="Seleccionar top N carga">
                                                                            <option value="3">Top 3</option>
                                                                            <option value="5">Top 5</option>
                                                                            <option value="10" selected>Top 10</option>
                                                                            <option value="24">Todas (24h)</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="row g-3 top-hours-grid">
                                                                    <div class="col-md-6">
                                                                        <div
                                                                            class="top-hours-card arrivals-theme cargo-accent">
                                                                            <div class="top-hours-card-header">
                                                                                <span
                                                                                    class="top-hours-chip chip-arrivals"><i
                                                                                        class="fas fa-box-open me-1"></i>Llegadas</span>
                                                                                <small class="text-muted">Picos de
                                                                                    recepción de carga</small>
                                                                            </div>
                                                                            <ol id="cargo-top-arr"
                                                                                class="top-hours-list mb-0">
                                                                            </ol>
                                                                            <p
                                                                                class="top-hours-footnote text-muted mb-0">
                                                                                <i
                                                                                    class="fas fa-mouse-pointer me-1"></i>Selecciona
                                                                                una franja horaria para detallar.
                                                                            </p>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-6">
                                                                        <div
                                                                            class="top-hours-card departures-theme cargo-accent">
                                                                            <div class="top-hours-card-header">
                                                                                <span
                                                                                    class="top-hours-chip chip-departures"><i
                                                                                        class="fas fa-truck-ramp-box me-1"></i>Salidas</span>
                                                                                <small class="text-muted">Despachos
                                                                                    prioritarios</small>
                                                                            </div>
                                                                            <ol id="cargo-top-dep"
                                                                                class="top-hours-list mb-0">
                                                                            </ol>
                                                                            <p
                                                                                class="top-hours-footnote text-muted mb-0">
                                                                                <i
                                                                                    class="fas fa-mouse-pointer me-1"></i>Haz
                                                                                clic para ver los vuelos
                                                                                programados.
                                                                            </p>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                        <!-- Vista General: Pasajeros + Carga combinados -->
                                        <div class="tab-pane fade" id="general-grafica-pane">
                                            <!-- Controles (topN selector) -->
                                            <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 px-1 pt-2 pb-1 general-split-controls">
                                                <div class="d-flex align-items-center gap-2">
                                                    <i class="fas fa-globe text-primary"></i>
                                                    <span class="fw-semibold" id="general-top-hours-heading">Vista General — Pasajeros + Carga</span>
                                                    <span class="badge bg-light text-muted border small" id="general-top-hours-subtitle">Haz clic en una franja para ver los vuelos</span>
                                                </div>
                                                <div class="d-flex align-items-center gap-2">
                                                    <label for="general-topN" class="top-hours-label text-muted mb-0 small">Mostrar</label>
                                                    <select id="general-topN" class="form-select form-select-sm top-hours-select" style="width:auto" aria-label="Seleccionar top N vista general">
                                                        <option value="3">Top 3</option>
                                                        <option value="5">Top 5</option>
                                                        <option value="10" selected>Top 10</option>
                                                        <option value="24">Todas (24h)</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <!-- Split 50/50 — gráfica + lista en cada mitad -->
                                            <div class="row g-0 general-split-row">

                                                <!-- ── LLEGADAS (mitad izquierda) ── -->
                                                <div class="col-6 general-split-col general-split-arr">
                                                    <div class="general-split-header arr">
                                                        <i class="fas fa-plane-arrival me-2"></i>Llegadas totales
                                                        <small class="ms-2 opacity-75">Pax + Carga</small>
                                                    </div>
                                                    <div class="general-split-chart">
                                                        <canvas id="generalArrivalsChart"></canvas>
                                                    </div>
                                                    <div class="general-split-list">
                                                        <ol id="general-all-arr" class="top-hours-list mb-0"></ol>
                                                        <p class="top-hours-footnote text-muted mb-0 px-3 pb-2"><i class="fas fa-mouse-pointer me-1"></i>Clic para ver los vuelos de esa hora.</p>
                                                    </div>
                                                </div>

                                                <!-- ── SALIDAS (mitad derecha) ── -->
                                                <div class="col-6 general-split-col general-split-dep">
                                                    <div class="general-split-header dep">
                                                        <i class="fas fa-plane-departure me-2"></i>Salidas totales
                                                        <small class="ms-2 opacity-75">Pax + Carga</small>
                                                    </div>
                                                    <div class="general-split-chart">
                                                        <canvas id="generalDeparturesChart"></canvas>
                                                    </div>
                                                    <div class="general-split-list">
                                                        <ol id="general-all-dep" class="top-hours-list mb-0"></ol>
                                                        <p class="top-hours-footnote text-muted mb-0 px-3 pb-2"><i class="fas fa-mouse-pointer me-1"></i>Clic para ver los vuelos de esa hora.</p>
                                                    </div>
                                                </div>

                                            </div>
                                            <!-- /Split -->
                                            <!-- ╔══════════════════════════════════════════╗ -->
                                            <!-- ║  RESUMEN POR RANGO HORARIO (para envío) ║ -->
                                            <!-- ╚══════════════════════════════════════════╝ -->
                                            <div class="itinerary-top-block itinerary-pane-block range-report-block" id="general-range-report-block">
                                                <div class="top-hours-header">
                                                    <div class="top-hours-title">
                                                        <span class="top-hours-eyebrow">Resumen operativo</span>
                                                        <div class="d-flex align-items-center gap-2">
                                                            <i class="fas fa-paper-plane text-primary"></i>
                                                            <span class="fw-semibold" style="font-size:1rem">Resumen para compartir</span>
                                                        </div>
                                                        <p class="mb-0 small text-muted">Selecciona un rango horario y genera un resumen de vuelos listo para enviar por mensaje.</p>
                                                    </div>
                                                </div>
                                                <div class="range-report-controls d-flex flex-wrap align-items-end gap-3 mt-3">
                                                    <div>
                                                        <label for="range-from-hour" class="form-label small fw-semibold mb-1 text-muted"><i class="fas fa-clock me-1"></i>Desde</label>
                                                        <select id="range-from-hour" class="form-select form-select-sm range-hour-select"></select>
                                                    </div>
                                                    <div>
                                                        <label for="range-to-hour" class="form-label small fw-semibold mb-1 text-muted"><i class="fas fa-clock me-1"></i>Hasta</label>
                                                        <select id="range-to-hour" class="form-select form-select-sm range-hour-select"></select>
                                                    </div>
                                                    <button id="range-report-btn" class="btn btn-primary btn-sm px-4">
                                                        <i class="fas fa-search me-2"></i>Generar resumen
                                                    </button>
                                                </div>
                                                <div id="general-range-report-result" class="mt-4 d-none"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                                </div>
                                <div class="tab-pane fade" id="radar-operativo-pane" role="tabpanel"
                                    aria-labelledby="radar-operativo-tab" tabindex="0">
                                    <div class="pt-3">
                                        <div class="card">
                                            <div
                                                class="card-header flex-column flex-md-row d-flex justify-content-between align-items-center">
                                                <div>
                                                    <h2 class="section-title mb-1">Radar operativo inteligente</h2>
                                                    <p class="text-muted mb-0 small">Explora hallazgos, aerolíneas
                                                        dominantes y conexiones destacadas.</p>
                                                </div>
                                            </div>
                                            <div class="card-body">
                                                <div class="itinerary-intelligence mb-4">
                                                    <div
                                                        class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
                                                        <div>
                                                            <h5 class="mb-1">Radar operativo inteligente</h5>
                                                            <p class="small text-muted mb-0">Cambia de pestaña para
                                                                ver
                                                                los hallazgos de pasajeros o carga.</p>
                                                        </div>
                                                        <span class="badge intel-scope-badge"
                                                            id="it-intelligence-scope-badge">Pasajeros</span>
                                                    </div>
                                                    <div class="row g-3 intel-metrics-row">
                                                        <div class="col-6 col-lg-3">
                                                            <div class="intel-metric-card shadow-sm h-100">
                                                                <div class="intel-metric-icon icon-primary"><i
                                                                        class="fas fa-plane-departure"></i></div>
                                                                <div class="intel-metric-copy">
                                                                    <span class="intel-metric-label">Operaciones del
                                                                        día</span>
                                                                    <div class="intel-metric-value"
                                                                        id="it-metric-total">-</div>
                                                                    <div class="intel-metric-detail"
                                                                        id="it-metric-total-detail">Sin
                                                                        datos</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-6 col-lg-3">
                                                            <div class="intel-metric-card shadow-sm h-100">
                                                                <div class="intel-metric-icon icon-success"><i
                                                                        class="fas fa-person-arrival"></i></div>
                                                                <div class="intel-metric-copy">
                                                                    <span class="intel-metric-label">Llegadas</span>
                                                                    <div class="intel-metric-value"
                                                                        id="it-metric-arrivals">-
                                                                    </div>
                                                                    <div class="intel-metric-detail"
                                                                        id="it-metric-arrivals-detail">
                                                                        Sin datos</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-6 col-lg-3">
                                                            <div class="intel-metric-card shadow-sm h-100">
                                                                <div class="intel-metric-icon icon-warning"><i
                                                                        class="fas fa-person-walking-luggage"></i>
                                                                </div>
                                                                <div class="intel-metric-copy">
                                                                    <span class="intel-metric-label">Salidas</span>
                                                                    <div class="intel-metric-value"
                                                                        id="it-metric-departures">-
                                                                    </div>
                                                                    <div class="intel-metric-detail"
                                                                        id="it-metric-departures-detail">Sin datos
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row g-3 mt-1">
                                                        <div class="col-12 col-lg-7">
                                                            <div class="card shadow-sm h-100 intel-peak-card">
                                                                <div
                                                                    class="card-header d-flex align-items-center justify-content-between flex-wrap gap-2">
                                                                    <div class="d-flex align-items-center gap-2">
                                                                        <span class="intel-header-pill pill-primary"><i
                                                                                class="fas fa-business-time"></i></span>
                                                                        <div>
                                                                            <span class="fw-semibold d-block">Horas
                                                                                pico
                                                                                por aerolínea</span>
                                                                            <small class="text-muted">Identifica qué
                                                                                aerolínea domina cada hora</small>
                                                                        </div>
                                                                    </div>
                                                                    <span
                                                                        class="badge bg-primary-subtle text-primary small">Haz
                                                                        clic para ver vuelos</span>
                                                                </div>
                                                                <div class="card-body p-0">
                                                                    <div class="table-responsive">
                                                                        <table
                                                                            class="table table-sm align-middle mb-0 intel-table"
                                                                            id="it-peak-airlines">
                                                                            <thead>
                                                                                <tr>
                                                                                    <th scope="col">Aerolínea</th>
                                                                                    <th scope="col" class="text-center">
                                                                                        Operaciones</th>
                                                                                    <th scope="col" class="text-center">
                                                                                        Llegadas</th>
                                                                                    <th scope="col" class="text-center">
                                                                                        Salidas</th>
                                                                                    <th scope="col">Hora pico</th>
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody id="it-peak-airlines-table">
                                                                                <tr>
                                                                                    <td colspan="5"
                                                                                        class="text-center text-muted small">
                                                                                        Cargando información...</td>
                                                                                </tr>
                                                                            </tbody>
                                                                        </table>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-12 col-lg-5">
                                                            <div class="card shadow-sm h-100 intel-connections-card">
                                                                <div
                                                                    class="card-header d-flex align-items-center gap-2">
                                                                    <span class="intel-header-pill pill-success"><i
                                                                            class="fas fa-route"></i></span>
                                                                    <div>
                                                                        <span class="fw-semibold d-block">Conexiones
                                                                            destacadas</span>
                                                                        <small class="text-muted">Top rutas de
                                                                            llegada y
                                                                            salida</small>
                                                                    </div>
                                                                </div>
                                                                <div class="card-body">
                                                                    <div class="row g-3">
                                                                        <div class="col-12 col-md-6">
                                                                            <h6 class="text-muted text-uppercase small mb-2"
                                                                                id="it-top-origins-title">
                                                                                Principales
                                                                                orígenes</h6>
                                                                            <ol class="intel-connection-list"
                                                                                id="it-top-origins">
                                                                                <li class="text-muted small">Sin
                                                                                    datos
                                                                                </li>
                                                                            </ol>
                                                                        </div>
                                                                        <div class="col-12 col-md-6">
                                                                            <h6 class="text-muted text-uppercase small mb-2"
                                                                                id="it-top-destinations-title">
                                                                                Principales destinos</h6>
                                                                            <ol class="intel-connection-list"
                                                                                id="it-top-destinations">
                                                                                <li class="text-muted small">Sin
                                                                                    datos
                                                                                </li>
                                                                            </ol>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card shadow-sm border-0 d-none intel-results-card mt-3" id="it-peak-results-card">
                    <div class="card-header d-flex align-items-center justify-content-between flex-wrap gap-2">
                        <div>
                            <h6 class="mb-0" id="it-peak-results-title"></h6>
                            <p class="small text-muted mb-0" id="it-peak-results-subtitle">Selecciona una aerolínea
                                u
                                horario para detallar los vuelos.</p>
                        </div>
                        <button class="btn btn-link text-decoration-none text-muted p-0" id="it-peak-results-close"
                            type="button"><i class="fas fa-times me-1"></i>Cerrar</button>
                    </div>
                    <div class="card-body">
                        <div class="intel-flight-results" id="it-peak-results-body">
                            <div class="intel-flight-placeholder text-center text-muted small">Selecciona una
                                aerolínea
                                o franja horaria para ver los vuelos relacionados.</div>
                        </div>
                    </div>
                </div>

                <div id="parte-operaciones-section" class="content-section">
                    <div class="card">
                        <div
                            class="card-header flex-column flex-md-row d-flex justify-content-between align-items-center">
                            <h2 class="section-title mb-3 mb-md-0" id="operations-summary-title"
                                data-default-title="Resumen de operaciones">Resumen de operaciones</h2>
                        </div>
                        <div class="card-body">
                            <ul class="nav nav-tabs" id="operationsTab" role="tablist">
                                <li class="nav-item" role="presentation"><button class="nav-link active" data-bs-toggle="tab"
                                        data-bs-target="#resumen1-pane" type="button" role="tab">Parte de
                                        Operaciones</button></li>
                                <!-- Conciliación tab moved to sidebar -->
                                <li class="nav-item" role="presentation"><button class="nav-link"
                                        data-bs-toggle="tab" data-bs-target="#analisis-mensual-pane" type="button" role="tab"
                                        id="tab-analisis-mensual">Análisis mensual</button></li>
                                <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab"
                                        data-bs-target="#analisis-anual-pane" type="button" role="tab">Análisis
                                        anual</button></li>
                            </ul>
                            <div class="tab-content pt-3" id="operationsTabContent">
                                <div class="tab-pane active" id="resumen1-pane">
                                    <div class="alert alert-info d-flex align-items-center gap-2 ops-calendar-hint"
                                        role="note">
                                        <i class="fas fa-calendar-day" aria-hidden="true"></i>
                                        <span class="small mb-0">Elige cualquier día del 2025 con los controles o el
                                            calendario para consultar su parte operativo.</span>
                                    </div>
                                    <div class="ops-calendar-controls d-flex flex-wrap align-items-center justify-content-between gap-3 mb-3"
                                        data-ops-calendar-controls>
                                        <div class="d-flex flex-wrap align-items-center gap-2">
                                            <button class="btn btn-outline-secondary btn-sm" type="button"
                                                id="operations-summary-prev" aria-label="Día anterior"><i
                                                    class="fas fa-chevron-left"></i></button>
                                            <input type="date" class="form-control form-control-sm"
                                                id="operations-summary-date"
                                                aria-label="Seleccionar fecha del parte de operaciones">
                                            <button class="btn btn-outline-secondary btn-sm" type="button"
                                                id="operations-summary-next" aria-label="Día siguiente"><i
                                                    class="fas fa-chevron-right"></i></button>
                                            <button class="btn btn-outline-primary btn-sm" type="button"
                                                id="operations-summary-today"><i
                                                    class="fas fa-calendar-day me-1"></i>Hoy</button>
                                        </div>
                                        <div class="small text-muted d-flex align-items-center gap-2"
                                            id="operations-summary-date-label">
                                            <i class="fas fa-calendar-alt"></i>
                                            <span id="operations-summary-date-human">Selecciona una fecha</span>
                                        </div>
                                    </div>
                                    <div class="ops-summary-wrapper" id="operations-summary-wrapper">
                                        <div class="section-loader hidden" id="operations-summary-loader" role="status"
                                            aria-live="polite" aria-busy="false" aria-hidden="true">
                                            <div class="loader-content text-center">
                                                <div class="plane-orbit">
                                                    <span class="orbit-ring"></span>
                                                    <span class="plane-icon" aria-hidden="true">✈</span>
                                                    <img src="images/logo_aifa.jpg" alt="AIFA" class="loader-aifa-logo">
                                                </div>
                                                <div class="loader-text" id="operations-summary-loader-text">
                                                    Preparando
                                                    el total de vuelos del día...</div>
                                            </div>
                                        </div>
                                        <div id="operations-summary-table"></div>
                                    </div>
                                    <div class="ops-pdf-viewer mt-4" id="operations-pdf-viewer" aria-live="polite">
                                        <div
                                            class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-2 ops-pdf-header">
                                            <div>
                                                <h3 class="h6 mb-1 d-flex align-items-center gap-2"><i
                                                        class="fas fa-file-pdf text-danger"></i><span>Parte de
                                                        operaciones (PDF)</span></h3>
                                                <p class="small text-muted mb-0" id="operations-pdf-label">
                                                    Selecciona
                                                    una fecha para mostrar el documento.</p>
                                            </div>
                                            <a class="btn btn-outline-danger btn-sm d-none" id="operations-pdf-download"
                                                target="_blank" rel="noopener">
                                                <i class="fas fa-external-link-alt me-1"></i>Abrir en otra pestaña
                                            </a>
                                        </div>
                                        <div class="ops-pdf-frame position-relative border rounded"
                                            id="operations-pdf-frame-wrapper">
                                            <div class="ops-pdf-placeholder text-center text-muted"
                                                id="operations-pdf-placeholder">
                                                <i class="fas fa-calendar-day fa-2x mb-2"></i>
                                                <p class="mb-0">Selecciona un día con parte disponible para mostrar
                                                    el
                                                    PDF.</p>
                                            </div>
                                            <iframe id="operations-pdf-frame" class="ops-pdf-iframe d-none"
                                                title="PDF del parte de operaciones" loading="lazy"></iframe>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane" id="analisis-mensual-pane" role="tabpanel">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <h4 class="mb-0">Análisis Operativo Mensual</h4>
                                        <div class="d-flex gap-2">
                                            <select class="form-select form-select-sm" id="analysis-month-select" style="width: auto;" aria-label="Seleccionar Mes">
                                                <option value="0">Enero</option>
                                                <option value="1">Febrero</option>
                                                <option value="2">Marzo</option>
                                                <option value="3">Abril</option>
                                                <option value="4">Mayo</option>
                                                <option value="5">Junio</option>
                                                <option value="6">Julio</option>
                                                <option value="7">Agosto</option>
                                                <option value="8">Septiembre</option>
                                                <option value="9">Octubre</option>
                                                <option value="10">Noviembre</option>
                                                <option value="11">Diciembre</option>
                                            </select>
                                            <input type="number" class="form-control form-control-sm" id="analysis-year-select" value="2026" style="width: 80px;" aria-label="Seleccionar Año">
                                            <button class="btn btn-primary btn-sm" id="btn-update-analysis">
                                                <i class="fas fa-sync-alt me-1"></i>Actualizar
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Summary Cards -->
                                    <div class="row g-3 mb-4">
                                        <div class="col-md-4">
                                            <div class="card h-100 border-primary border-start border-3 shadow-sm">
                                                <div class="card-body">
                                                    <h6 class="text-uppercase text-muted small mb-2">Total Operaciones</h6>
                                                    <h2 class="mb-0 display-6 fw-bold text-primary" id="stat-total-ops">-</h2>
                                                    <p class="mb-0 text-muted small mt-1" id="stat-total-subtitle">en el mes seleccionado</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="card h-100 border-warning border-start border-3 shadow-sm">
                                                <div class="card-body">
                                                    <h6 class="text-uppercase text-muted small mb-2">Día con más operaciones</h6>
                                                    <h2 class="mb-0 display-6 fw-bold text-warning" id="stat-peak-day">-</h2>
                                                    <p class="mb-0 text-muted small mt-1" id="stat-peak-day-val">- operaciones</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="card h-100 border-success border-start border-3 shadow-sm">
                                                <div class="card-body">
                                                    <h6 class="text-uppercase text-muted small mb-2">Semana con más operaciones</h6>
                                                    <h2 class="mb-0 display-6 fw-bold text-success" id="stat-peak-week">-</h2>
                                                    <p class="mb-0 text-muted small mt-1" id="stat-peak-week-val">- operaciones</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Charts Row 1 -->
                                    <div class="row g-4 mb-4">
                                        <div class="col-12">
                                            <div class="card shadow-sm h-100">
                                                <div class="card-header bg-transparent py-3">
                                                    <h6 class="m-0 fw-bold text-primary">Evolución de Operaciones Diarias</h6>
                                                </div>
                                                <div class="card-body">
                                                    <canvas id="chart-daily-ops" height="350"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                     <!-- Charts Row 2 -->
                                    <div class="row g-4 mb-4">
                                        <div class="col-md-6">
                                            <div class="card shadow-sm">
                                               <div class="card-header bg-transparent py-3">
                                                    <h6 class="m-0 fw-bold text-primary">Operaciones por Tipo de Servicio</h6>
                                                </div>
                                                <div class="card-body">
                                                     <canvas id="chart-service-type"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card shadow-sm h-100 bg-light border-0">
                                                <div class="card-body">
                                                    <h5 class="card-title text-primary mb-3"><i class="fas fa-search-dollar me-2"></i>Insights del Mes</h5>
                                                    <div id="analysis-insights" class="fs-6 text-dark" style="line-height: 1.6;">
                                                        Seleccione un mes y presione actualizar para ver el análisis.
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane" id="analisis-anual-pane">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h5 class="mb-0 text-primary"><i class="fas fa-calendar-alt me-2"></i>Análisis Anual</h5>
                                        <div class="d-flex gap-2 align-items-center">
                                            <select class="form-select form-select-sm" id="annual-year-select" style="width: auto;" aria-label="Año">
                                                <option value="2025" selected>2025</option>
                                                <option value="2024">2024</option>
                                                <option value="2023">2023</option>
                                                <option value="2022">2022</option>
                                            </select>
                                            <button class="btn btn-outline-secondary btn-sm" id="btn-refresh-annual">
                                                <i class="fas fa-sync-alt me-1"></i>Recargar
                                            </button>
                                        </div>
                                    </div>

                                    <!-- ─── Datos Clave del Año ─── -->
                                    <div class="mb-4" id="annual-kpi-cards">
                                        <div class="text-center py-3 text-muted small">
                                            <div class="spinner-border spinner-border-sm me-2"></div>Cargando datos clave...
                                        </div>
                                    </div>

                                    <!-- ─── Promedios mensuales por tipo (parte_operations) ─── -->
                                    <div class="mb-4" id="ops-annual-averages-cards"></div>

                                    <div class="card shadow-sm border-0 mb-3">
                                        <div class="card-header bg-white border-0 pb-0">
                                            <span class="fw-bold"><i class="fas fa-chart-bar me-2 text-primary"></i>Distribución Mensual de Operaciones</span>
                                        </div>
                                        <div class="card-body p-3">
                                            <div class="chart-container annual-analysis-chart" style="height: 350px; position: relative;">
                                                <canvas id="ops-annual-averages-chart" aria-label="Promedio mensual por tipo" role="img"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="table-responsive mb-4" id="ops-annual-averages-table"></div>

                                    <!-- ─── Pasajeros por Aerolínea ─── -->
                                    <div class="card shadow-sm border-0 mb-3" id="airline-pax-section">
                                        <div class="card-header bg-white border-0 pb-0 d-flex align-items-center justify-content-between">
                                            <h6 class="fw-bold mb-0">
                                                <i class="fas fa-users me-2 text-success"></i>Pasajeros por Aerolínea
                                            </h6>
                                            <span class="badge bg-primary" id="airline-pax-year-badge">2025</span>
                                        </div>
                                        <div class="card-body pt-2">
                                            <div id="airline-pax-loading" class="text-center py-4 text-muted small">
                                                <div class="spinner-border spinner-border-sm me-2"></div>Calculando pasajeros por aerolínea...
                                            </div>
                                            <div id="airline-pax-content" class="d-none">
                                                <div class="row g-3">
                                                    <div class="col-lg-7">
                                                        <div style="position: relative; min-height: 420px;">
                                                            <canvas id="chart-airline-annual-pax"></canvas>
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-5">
                                                        <div class="table-responsive" style="max-height: 440px; overflow-y: auto;">
                                                            <table class="table table-sm table-hover table-bordered mb-0" id="table-airline-pax">
                                                                <thead class="table-light" style="position: sticky; top: 0; z-index: 1;">
                                                                    <tr>
                                                                        <th class="text-center">#</th>
                                                                        <th>Aerolínea</th>
                                                                        <th class="text-end">Pasajeros</th>
                                                                        <th class="text-end">% Total</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody id="tbody-airline-pax"></tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="airline-pax-empty" class="d-none alert alert-info mb-0">
                                                No hay datos de pasajeros por aerolínea disponibles para este año en <code>daily_flights_ops</code>.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Conciliación Section -->
                <div id="conciliacion-section" class="content-section">
                    <div class="card shadow-sm">
                        <div class="card-header border-bottom bg-white d-flex align-items-center justify-content-between py-3">
                            <h2 class="section-title mb-0 fs-4 fw-bold text-primary"><i class="fas fa-tasks me-2"></i>Conciliación</h2>
                        </div>
                        <div class="card-body p-0" id="conciliacion-content">

                                    <!-- Conciliación Tabs -->
                                    <ul class="nav nav-tabs px-4 pt-3 border-bottom bg-white" id="conciliacion-tabs" role="tablist">
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link active fw-semibold" id="tab-conci-itinerario" data-bs-toggle="tab" data-bs-target="#pane-conci-itinerario" type="button" role="tab">
                                                <i class="fas fa-plane me-2 text-primary"></i>Itinerario de Vuelos
                                            </button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link fw-semibold" id="tab-conci-comercial" data-bs-toggle="tab" data-bs-target="#pane-conci-comercial" type="button" role="tab">
                                                <i class="fas fa-store me-2 text-success"></i>Comercial
                                            </button>
                                        </li>
                                    </ul>

                                    <div class="tab-content">

                                    <!-- ═══ Tab: Itinerario ═══ -->
                                    <div class="tab-pane fade show active p-4" id="pane-conci-itinerario" role="tabpanel">

                                    <div class="alert shadow-sm border-0 d-flex align-items-center mb-4 p-3 maintenance-alert" role="alert">
                                        <div class="d-flex align-items-center justify-content-center flex-shrink-0 me-3 maintenance-icon-wrapper">
                                            <i class="fas fa-tools fs-4"></i>
                                        </div>
                                        <div>
                                            <h6 class="alert-heading mb-1 fw-bold maintenance-text">Sección en Mantenimiento</h6>
                                            <p class="mb-0 small maintenance-text-sub">
                                                Estamos implementando mejoras y actualizaciones en este módulo para optimizar la precisión de los datos.
                                            </p>
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h5 class="mb-0 text-primary"><i class="fas fa-plane me-2"></i>Itinerario de
                                            Vuelos del Día</h5>
                                        <div class="d-flex gap-2 align-items-center flex-wrap">
                                            <!-- Funnel toggle: always visible -->
                                            <button class="btn btn-sm btn-outline-secondary" id="btn-csv-date-filter-toggle"
                                                title="Filtrar por fecha"
                                                onclick="(function(){var p=document.getElementById('csv-date-filter-panel');p.classList.toggle('d-none');document.getElementById('btn-csv-date-filter-toggle').classList.toggle('active');})()">
                                                <i class="fas fa-filter"></i>
                                            </button>
                                            <!-- Collapsible date filter card -->
                                            <div id="csv-date-filter-panel" class="d-none csv-date-filter-card">
                                                <div class="d-flex align-items-center justify-content-between mb-2 pb-2 border-bottom">
                                                    <span class="small fw-semibold text-primary" style="letter-spacing:.03em">
                                                        <i class="fas fa-calendar-week me-1"></i>Ventana de Fecha
                                                    </span>
                                                    <button type="button" class="btn-close" style="font-size:.65rem" title="Cerrar"
                                                        onclick="(function(){document.getElementById('csv-date-filter-panel').classList.add('d-none');document.getElementById('btn-csv-date-filter-toggle').classList.remove('active');})()"></button>
                                                </div>
                                                <div class="d-flex align-items-center gap-2 mb-2">
                                                    <span class="small text-muted" style="white-space:nowrap">Modo:</span>
                                                    <div class="btn-group btn-group-sm" role="group" aria-label="Filtro de fecha">
                                                        <button class="btn btn-outline-primary active" type="button" id="btn-date-mode-relative">Relativo</button>
                                                        <button class="btn btn-outline-primary" type="button" id="btn-date-mode-absolute">Absoluto</button>
                                                    </div>
                                                </div>
                                                <div class="d-flex flex-column" id="ops-date-relative">
                                                    <div class="d-flex align-items-center gap-1">
                                                        <button class="btn btn-sm btn-outline-secondary" type="button" id="rel-start-dec">-</button>
                                                        <input type="number" class="form-control form-control-sm text-center" style="width:58px" id="rel-start" value="-4" aria-label="Inicio relativo">
                                                        <button class="btn btn-sm btn-outline-secondary" type="button" id="rel-start-inc">+</button>
                                                        <span class="small text-muted px-1">a</span>
                                                        <button class="btn btn-sm btn-outline-secondary" type="button" id="rel-end-dec">-</button>
                                                        <input type="number" class="form-control form-control-sm text-center" style="width:58px" id="rel-end" value="0" aria-label="Fin relativo">
                                                        <button class="btn btn-sm btn-outline-secondary" type="button" id="rel-end-inc">+</button>
                                                    </div>
                                                    <div class="d-flex align-items-center gap-2 small text-muted mt-1">
                                                        <i class="fas fa-calendar-day" style="opacity:.5"></i>
                                                        <span id="rel-start-label">—</span>
                                                        <span>→</span>
                                                        <span id="rel-end-label">—</span>
                                                    </div>
                                                </div>
                                                <div class="d-flex align-items-center gap-2 d-none" id="ops-date-absolute">
                                                    <input type="date" class="form-control form-control-sm" style="width:135px" id="ops-date-start" aria-label="Fecha inicio">
                                                    <span class="small text-muted">→</span>
                                                    <input type="date" class="form-control form-control-sm" style="width:135px" id="ops-date-end" aria-label="Fecha fin">
                                                </div>
                                            </div><!-- /csv-date-filter-panel -->
                                            <button class="btn btn-sm btn-outline-secondary"
                                                onclick="window.opsFlights && window.opsFlights.loadFlights()"><i
                                                    class="fas fa-sync-alt me-1"></i>Actualizar</button>
                                            <button class="btn btn-sm btn-outline-success" id="btn-import-ops-csv"
                                                data-bs-toggle="modal" data-bs-target="#uploadOpsCsvModal"><i
                                                    class="fas fa-file-csv me-1"></i>Importar CSV</button>
                                            <button id="btn-conciliacion-board"
                                                class="btn btn-sm btn-outline-primary"
                                                onclick="toggleConciliacionBoard()"
                                                title="Vista Llegadas / Salidas">
                                                <i class="fas fa-plane" style="transform:rotate(-90deg);display:inline-block;"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Charts Row -->
                                    <!-- Chart Removed: Horarios Pico (Salidas vs Llegadas) -->
                                    <!--
                                    <div class="row mb-4">
                                        <div class="col-12">
                                            <div class="card shadow-sm border-0">
                                                <div class="card-header bg-white border-bottom-0">
                                                    <h6 class="mb-0 text-muted small text-uppercase">Horarios Pico
                                                        (Salidas vs Llegadas)</h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="chart-container-fixed">
                                                        <canvas id="chart-peak-hours-ops"></canvas>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    -->

                                    <!-- CSV Table (Operaciones) -->
                                    <div id="conciliacion-csv-view">
                                    <div class="row">
                                        <div class="col-12 mb-4">
                                            <div class="card shadow-sm border-0">
                                                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                                                    <div class="d-flex align-items-center gap-2">
                                                        <h6 class="mb-0 text-uppercase small text-muted">Vuelos importados desde CSV</h6>
                                                        <span id="csv-flight-count-badge" class="badge rounded-pill bg-primary" style="font-size:.75rem;display:none">0 vuelos</span>
                                                    </div>
                                                    
                                                    <div class="dropdown">
                                                        <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" id="dropdownMenuButtonCsvColumns" data-bs-toggle="dropdown" aria-expanded="false" title="Seleccionar columnas visibles">
                                                            <i class="fas fa-columns me-1"></i>
                                                        </button>
                                                        <ul class="dropdown-menu p-3 shadow dropdown-menu-end" aria-labelledby="dropdownMenuButtonCsvColumns" style="min-width: 300px; max-height: 400px; overflow-y: auto;" onclick="event.stopPropagation()">
                                                            <li><h6 class="dropdown-header text-primary fw-bold">Columnas Visibles</h6></li>
                                                            <li><hr class="dropdown-divider"></li>
                                                            <!-- Checkboxes generated dynamically or static -->
                                                            <li class="form-check mb-1"><input class="form-check-input col-toggle-csv" type="checkbox" checked id="chk-csv-status" data-col="col-cvs-status" onchange="window.opsFlights.toggleColumn('col-cvs-status', this.checked)"><label class="form-check-label" for="chk-csv-status">Status</label></li>
                                                            <li class="form-check mb-1"><input class="form-check-input col-toggle-csv" type="checkbox" checked id="chk-csv-arr-airline" data-col="col-cvs-arr-airline" onchange="window.opsFlights.toggleColumn('col-cvs-arr-airline', this.checked)"><label class="form-check-label" for="chk-csv-arr-airline">[Arr] Airline</label></li>
                                                            <li class="form-check mb-1"><input class="form-check-input col-toggle-csv" type="checkbox" checked id="chk-csv-arr-flight" data-col="col-cvs-arr-flight" onchange="window.opsFlights.toggleColumn('col-cvs-arr-flight', this.checked)"><label class="form-check-label" for="chk-csv-arr-flight">[Arr] Flight</label></li>
                                                            <li class="form-check mb-1"><input class="form-check-input col-toggle-csv" type="checkbox" checked id="chk-csv-arr-aldt" data-col="col-cvs-arr-aldt" onchange="window.opsFlights.toggleColumn('col-cvs-arr-aldt', this.checked)"><label class="form-check-label" for="chk-csv-arr-aldt">[Arr] ALDT</label></li>
                                                            <li class="form-check mb-1"><input class="form-check-input col-toggle-csv" type="checkbox" checked id="chk-csv-arr-sibt" data-col="col-cvs-arr-sibt" onchange="window.opsFlights.toggleColumn('col-cvs-arr-sibt', this.checked)"><label class="form-check-label" for="chk-csv-arr-sibt">[Arr] SIBT</label></li>
                                                            <li class="form-check mb-1"><input class="form-check-input col-toggle-csv" type="checkbox" checked id="chk-csv-arr-aibt" data-col="col-cvs-arr-aibt" onchange="window.opsFlights.toggleColumn('col-cvs-arr-aibt', this.checked)"><label class="form-check-label" for="chk-csv-arr-aibt">[Arr] AIBT</label></li>
                                                            <li class="form-check mb-1"><input class="form-check-input col-toggle-csv" type="checkbox" checked id="chk-csv-arr-stand" data-col="col-cvs-arr-stand" onchange="window.opsFlights.toggleColumn('col-cvs-arr-stand', this.checked)"><label class="form-check-label" for="chk-csv-arr-stand">[Arr] Stand</label></li>
                                                            <li class="form-check mb-1"><input class="form-check-input col-toggle-csv" type="checkbox" checked id="chk-csv-arr-gates" data-col="col-cvs-arr-gates" onchange="window.opsFlights.toggleColumn('col-cvs-arr-gates', this.checked)"><label class="form-check-label" for="chk-csv-arr-gates">[Arr] Gates</label></li>
                                                            <li class="form-check mb-1"><input class="form-check-input col-toggle-csv" type="checkbox" checked id="chk-csv-arr-boarded" data-col="col-cvs-arr-boarded" onchange="window.opsFlights.toggleColumn('col-cvs-arr-boarded', this.checked)"><label class="form-check-label" for="chk-csv-arr-boarded">[Arr] Boarded</label></li>
                                                            <li class="form-check mb-1"><input class="form-check-input col-toggle-csv" type="checkbox" checked id="chk-csv-arr-belts" data-col="col-cvs-arr-belts" onchange="window.opsFlights.toggleColumn('col-cvs-arr-belts', this.checked)"><label class="form-check-label" for="chk-csv-arr-belts">[Arr] Belts</label></li>
                                                            <li class="form-check mb-1"><input class="form-check-input col-toggle-csv" type="checkbox" checked id="chk-csv-arr-type" data-col="col-cvs-arr-type" onchange="window.opsFlights.toggleColumn('col-cvs-arr-type', this.checked)"><label class="form-check-label" for="chk-csv-arr-type">[Arr] Type</label></li>
                                                            <li class="form-check mb-1"><input class="form-check-input col-toggle-csv" type="checkbox" checked id="chk-csv-routing" data-col="col-cvs-routing" onchange="window.opsFlights.toggleColumn('col-cvs-routing', this.checked)"><label class="form-check-label" for="chk-csv-routing">Routing</label></li>
                                                            <li class="form-check mb-1"><input class="form-check-input col-toggle-csv" type="checkbox" checked id="chk-csv-dep-type" data-col="col-cvs-dep-type" onchange="window.opsFlights.toggleColumn('col-cvs-dep-type', this.checked)"><label class="form-check-label" for="chk-csv-dep-type">[Dep] Type</label></li>
                                                            <li class="form-check mb-1"><input class="form-check-input col-toggle-csv" type="checkbox" checked id="chk-csv-aircraft" data-col="col-cvs-aircraft" onchange="window.opsFlights.toggleColumn('col-cvs-aircraft', this.checked)"><label class="form-check-label" for="chk-csv-aircraft">Aircraft Type</label></li>
                                                            <li class="form-check mb-1"><input class="form-check-input col-toggle-csv" type="checkbox" checked id="chk-csv-reg" data-col="col-cvs-reg" onchange="window.opsFlights.toggleColumn('col-cvs-reg', this.checked)"><label class="form-check-label" for="chk-csv-reg">Registration</label></li>
                                                            <li class="form-check mb-1"><input class="form-check-input col-toggle-csv" type="checkbox" checked id="chk-csv-dep-airline" data-col="col-cvs-dep-airline" onchange="window.opsFlights.toggleColumn('col-cvs-dep-airline', this.checked)"><label class="form-check-label" for="chk-csv-dep-airline">[Dep] Airline</label></li>
                                                            <li class="form-check mb-1"><input class="form-check-input col-toggle-csv" type="checkbox" checked id="chk-csv-dep-flight" data-col="col-cvs-dep-flight" onchange="window.opsFlights.toggleColumn('col-cvs-dep-flight', this.checked)"><label class="form-check-label" for="chk-csv-dep-flight">[Dep] Flight</label></li>
                                                            <li class="form-check mb-1"><input class="form-check-input col-toggle-csv" type="checkbox" checked id="chk-csv-dep-stand" data-col="col-cvs-dep-stand" onchange="window.opsFlights.toggleColumn('col-cvs-dep-stand', this.checked)"><label class="form-check-label" for="chk-csv-dep-stand">[Dep] Stand</label></li>
                                                            <li class="form-check mb-1"><input class="form-check-input col-toggle-csv" type="checkbox" checked id="chk-csv-dep-gates" data-col="col-cvs-dep-gates" onchange="window.opsFlights.toggleColumn('col-cvs-dep-gates', this.checked)"><label class="form-check-label" for="chk-csv-dep-gates">[Dep] Gates</label></li>
                                                            <li class="form-check mb-1"><input class="form-check-input col-toggle-csv" type="checkbox" checked id="chk-csv-dep-boarded" data-col="col-cvs-dep-boarded" onchange="window.opsFlights.toggleColumn('col-cvs-dep-boarded', this.checked)"><label class="form-check-label" for="chk-csv-dep-boarded">[Dep] Boarded</label></li>
                                                            <li class="form-check mb-1"><input class="form-check-input col-toggle-csv" type="checkbox" checked id="chk-csv-dep-sobt" data-col="col-cvs-dep-sobt" onchange="window.opsFlights.toggleColumn('col-cvs-dep-sobt', this.checked)"><label class="form-check-label" for="chk-csv-dep-sobt">[Dep] SOBT</label></li>
                                                            <li class="form-check mb-1"><input class="form-check-input col-toggle-csv" type="checkbox" checked id="chk-csv-dep-aobt" data-col="col-cvs-dep-aobt" onchange="window.opsFlights.toggleColumn('col-cvs-dep-aobt', this.checked)"><label class="form-check-label" for="chk-csv-dep-aobt">[Dep] AOBT</label></li>
                                                            <li class="form-check mb-1"><input class="form-check-input col-toggle-csv" type="checkbox" checked id="chk-csv-dep-atot" data-col="col-cvs-dep-atot" onchange="window.opsFlights.toggleColumn('col-cvs-dep-atot', this.checked)"><label class="form-check-label" for="chk-csv-dep-atot">[Dep] ATOT</label></li>
                                                            <li class="form-check mb-1"><input class="form-check-input col-toggle-csv" type="checkbox" checked id="chk-csv-dep-attt" data-col="col-cvs-dep-attt" onchange="window.opsFlights.toggleColumn('col-cvs-dep-attt', this.checked)"><label class="form-check-label" for="chk-csv-dep-attt">[Dep] ATTT</label></li>
                                                            <li class="form-check mb-1"><input class="form-check-input col-toggle-csv" type="checkbox" checked id="chk-csv-observaciones" data-col="col-cvs-observaciones" onchange="window.opsFlights.toggleColumn('col-cvs-observaciones', this.checked)"><label class="form-check-label" for="chk-csv-observaciones">Observaciones</label></li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                </div>
                                                <div class="table-responsive" id="container-ops-flights-csv">
                                                    <table
                                                        class="table table-hover table-bordered table-sm align-middle mb-0 table-csv-fixed"
                                                        id="table-ops-flights-csv">
                                                        <thead class="table-light">
                                                            <tr class="text-center small text-muted text-uppercase">
                                                                <th class="col-cvs-status" data-csv-filter-field="Status" data-col-help="status" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Estado del vuelo: En Tiempo, Retrasado, Cancelado..."><div class="csv-th-inner"><span>Status <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></span><button class="csv-ef-btn" title="Filtrar Status"><i class="fas fa-filter"></i></button></div></th>
                                                                <th class="col-cvs-arr-airline" data-csv-filter-field="[Arr] Airline code" data-col-help="arr-airline" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Código de aerolínea del vuelo de llegada"><div class="csv-th-inner"><span><i class="fas fa-arrow-down text-success me-1 rotate-n45"></i>[Arr] Airline <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></span><button class="csv-ef-btn" title="Filtrar Aerolínea Arr"><i class="fas fa-filter"></i></button></div></th>
                                                                <th class="col-cvs-arr-flight" data-csv-filter-field="[Arr] Flight Designator" data-col-help="arr-flight" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Designador del vuelo de llegada (ej: AM100)"><div class="csv-th-inner"><span><i class="fas fa-arrow-down text-success me-1 rotate-n45"></i>[Arr] Flight <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></span><button class="csv-ef-btn" title="Filtrar Flight Arr"><i class="fas fa-filter"></i></button></div></th>
                                                                <th class="col-cvs-arr-aldt" data-csv-filter-field="[Arr] ALDT" data-col-help="arr-aldt" data-bs-toggle="tooltip" data-bs-placement="bottom" title="ALDT: Actual Landing Time - Hora real de aterrizaje"><div class="csv-th-inner"><span><i class="fas fa-arrow-down text-success me-1 rotate-n45"></i>[Arr] ALDT <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></span><button class="csv-ef-btn" title="Filtrar ALDT"><i class="fas fa-filter"></i></button></div></th>
                                                                <th class="col-cvs-arr-sibt" data-csv-filter-field="[Arr] SIBT" data-col-help="arr-sibt" data-bs-toggle="tooltip" data-bs-placement="bottom" title="SIBT: Scheduled In-Block Time - Hora programada de llegada a la posición"><div class="csv-th-inner"><span><i class="fas fa-arrow-down text-success me-1 rotate-n45"></i>[Arr] SIBT <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></span><button class="csv-ef-btn" title="Filtrar SIBT"><i class="fas fa-filter"></i></button></div></th>
                                                                <th class="col-cvs-arr-aibt" data-csv-filter-field="[Arr] AIBT" data-col-help="arr-aibt" data-bs-toggle="tooltip" data-bs-placement="bottom" title="AIBT: Actual In-Block Time - Hora real de llegada a la posición"><div class="csv-th-inner"><span><i class="fas fa-arrow-down text-success me-1 rotate-n45"></i>[Arr] AIBT <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></span><button class="csv-ef-btn" title="Filtrar AIBT"><i class="fas fa-filter"></i></button></div></th>
                                                                <th class="col-cvs-arr-stand" data-csv-filter-field="[Arr] Stand" data-col-help="arr-stand" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Posición de estacionamiento asignada al llegar"><div class="csv-th-inner"><span><i class="fas fa-arrow-down text-success me-1 rotate-n45"></i>[Arr] Stand <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></span><button class="csv-ef-btn" title="Filtrar Stand Arr"><i class="fas fa-filter"></i></button></div></th>
                                                                <th class="col-cvs-arr-gates" data-csv-filter-field="[Arr] Gates" data-col-help="arr-gates" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Puerta de desembarque del vuelo de llegada"><div class="csv-th-inner"><span><i class="fas fa-arrow-down text-success me-1 rotate-n45"></i>[Arr] Gates <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></span><button class="csv-ef-btn" title="Filtrar Gates Arr"><i class="fas fa-filter"></i></button></div></th>
                                                                <th class="col-cvs-arr-boarded" data-csv-filter-field="[Arr] Boarded" data-col-help="arr-boarded" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Pasajeros del vuelo de llegada"><div class="csv-th-inner"><span><i class="fas fa-arrow-down text-success me-1 rotate-n45"></i>[Arr] Boarded <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></span><button class="csv-ef-btn" title="Filtrar Boarded Arr"><i class="fas fa-filter"></i></button></div></th>
                                                                <th class="col-cvs-arr-belts" data-csv-filter-field="[Arr] Baggage Belts" data-col-help="arr-belts" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Banda/cinta de equipaje asignada"><div class="csv-th-inner"><span><i class="fas fa-arrow-down text-success me-1 rotate-n45"></i>[Arr] Belts <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></span><button class="csv-ef-btn" title="Filtrar Belts"><i class="fas fa-filter"></i></button></div></th>
                                                                <th class="col-cvs-arr-type" data-csv-filter-field="[Arr] Service Type" data-col-help="arr-type" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Tipo de servicio de llegada — haz clic en ? para ver el catálogo completo"><div class="csv-th-inner"><span><i class="fas fa-arrow-down text-success me-1 rotate-n45"></i>[Arr] Type <button type="button" class="btn btn-link p-0 border-0" style="font-size:.6em;opacity:.8;vertical-align:middle;line-height:1;color:inherit;" onclick="event.stopPropagation();new bootstrap.Modal(document.getElementById('modalFlightServiceType')).show()" title="Ver catálogo de tipos de servicio"><i class="fas fa-circle-question"></i></button></span><button class="csv-ef-btn" title="Filtrar Tipo Arr"><i class="fas fa-filter"></i></button></div></th>
                                                                <th class="col-cvs-routing" data-csv-filter-field="Routing" data-col-help="routing" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Ruta completa: origen &gt; AIFA &gt; destino"><div class="csv-th-inner"><span>Routing <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></span><button class="csv-ef-btn" title="Filtrar Routing"><i class="fas fa-filter"></i></button></div></th>
                                                                <th class="col-cvs-dep-type" data-csv-filter-field="[Dep] Service Type" data-col-help="dep-type" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Tipo de servicio de salida — haz clic en ? para ver el catálogo completo"><div class="csv-th-inner"><span><i class="fas fa-arrow-up text-primary me-1 rotate-45"></i>[Dep] Type <button type="button" class="btn btn-link p-0 border-0" style="font-size:.6em;opacity:.8;vertical-align:middle;line-height:1;color:inherit;" onclick="event.stopPropagation();new bootstrap.Modal(document.getElementById('modalFlightServiceType')).show()" title="Ver catálogo de tipos de servicio"><i class="fas fa-circle-question"></i></button></span><button class="csv-ef-btn" title="Filtrar Tipo Dep"><i class="fas fa-filter"></i></button></div></th>
                                                                <th class="col-cvs-aircraft" data-csv-filter-field="Aircraft type" data-col-help="aircraft" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Modelo de la aeronave (ej: Boeing 737, Airbus A321)"><div class="csv-th-inner"><span>Aircraft type <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></span><button class="csv-ef-btn" title="Filtrar Aircraft"><i class="fas fa-filter"></i></button></div></th>
                                                                <th class="col-cvs-reg" data-csv-filter-field="Registration" data-col-help="registration" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Matrícula del avión - identifica al mismo avión en llegada y salida"><div class="csv-th-inner"><span>Registration <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></span><button class="csv-ef-btn" title="Filtrar Matrícula"><i class="fas fa-filter"></i></button></div></th>
                                                                <th class="col-cvs-dep-airline" data-csv-filter-field="[Dep] Airline code" data-col-help="dep-airline" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Código de aerolínea del vuelo de salida"><div class="csv-th-inner"><span><i class="fas fa-arrow-up text-primary me-1 rotate-45"></i>[Dep] Airline <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></span><button class="csv-ef-btn" title="Filtrar Aerolínea Dep"><i class="fas fa-filter"></i></button></div></th>
                                                                <th class="col-cvs-dep-flight" data-csv-filter-field="[Dep] Flight Designator" data-col-help="dep-flight" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Designador del vuelo de salida (ej: AM101)"><div class="csv-th-inner"><span><i class="fas fa-arrow-up text-primary me-1 rotate-45"></i>[Dep] Flight <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></span><button class="csv-ef-btn" title="Filtrar Flight Dep"><i class="fas fa-filter"></i></button></div></th>
                                                                <th class="col-cvs-dep-stand" data-csv-filter-field="[Dep] Stand" data-col-help="dep-stand" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Posición de estacionamiento asignada al salir"><div class="csv-th-inner"><span><i class="fas fa-arrow-up text-primary me-1 rotate-45"></i>[Dep] Stand <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></span><button class="csv-ef-btn" title="Filtrar Stand Dep"><i class="fas fa-filter"></i></button></div></th>
                                                                <th class="col-cvs-dep-gates" data-csv-filter-field="[Dep] Gates" data-col-help="dep-gates" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Puerta de abordaje asignada para el vuelo de salida"><div class="csv-th-inner"><span><i class="fas fa-arrow-up text-primary me-1 rotate-45"></i>[Dep] Gates <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></span><button class="csv-ef-btn" title="Filtrar Gates Dep"><i class="fas fa-filter"></i></button></div></th>
                                                                <th class="col-cvs-dep-boarded" data-csv-filter-field="[Dep] Boarded" data-col-help="dep-boarded" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Pasajeros embarcados en el vuelo de salida"><div class="csv-th-inner"><span><i class="fas fa-arrow-up text-primary me-1 rotate-45"></i>[Dep] Boarded <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></span><button class="csv-ef-btn" title="Filtrar Boarded Dep"><i class="fas fa-filter"></i></button></div></th>
                                                                <th class="col-cvs-dep-sobt" data-csv-filter-field="[Dep] SOBT" data-col-help="dep-sobt" data-bs-toggle="tooltip" data-bs-placement="bottom" title="SOBT: Scheduled Off-Block Time - Hora programada de salida de posición"><div class="csv-th-inner"><span><i class="fas fa-arrow-up text-primary me-1 rotate-45"></i>[Dep] SOBT <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></span><button class="csv-ef-btn" title="Filtrar SOBT"><i class="fas fa-filter"></i></button></div></th>
                                                                <th class="col-cvs-dep-aobt" data-csv-filter-field="[Dep] AOBT" data-col-help="dep-aobt" data-bs-toggle="tooltip" data-bs-placement="bottom" title="AOBT: Actual Off-Block Time - Hora real de salida de posición"><div class="csv-th-inner"><span><i class="fas fa-arrow-up text-primary me-1 rotate-45"></i>[Dep] AOBT <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></span><button class="csv-ef-btn" title="Filtrar AOBT"><i class="fas fa-filter"></i></button></div></th>
                                                                <th class="col-cvs-dep-atot" data-csv-filter-field="[Dep] ATOT" data-col-help="dep-atot" data-bs-toggle="tooltip" data-bs-placement="bottom" title="ATOT: Actual Take-Off Time - Hora real de despegue"><div class="csv-th-inner"><span><i class="fas fa-arrow-up text-primary me-1 rotate-45"></i>[Dep] ATOT <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></span><button class="csv-ef-btn" title="Filtrar ATOT"><i class="fas fa-filter"></i></button></div></th>
                                                                <th class="col-cvs-dep-attt" data-csv-filter-field="[Dep] ATTT" data-col-help="dep-attt" data-bs-toggle="tooltip" data-bs-placement="bottom" title="ATTT: Actual Turnaround Time - Tiempo total del avión en tierra entre llegada y salida"><div class="csv-th-inner"><span><i class="fas fa-arrow-up text-primary me-1 rotate-45"></i>[Dep] ATTT <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></span><button class="csv-ef-btn" title="Filtrar ATTT"><i class="fas fa-filter"></i></button></div></th>
                                                                <th class="col-cvs-observaciones" style="min-width:180px;background:#f0fff4;border-left:2px solid #b7dfca;"><i class="fas fa-comment-alt me-1" style="color:#28a745"></i>Observaciones</th>
                                                                <th class="col-cvs-validation text-center" style="min-width:120px;background:#eef4ff;border-left:2px solid #c8d9f8;"><i class="fas fa-clipboard-check me-1" style="color:#4575c4"></i>Conciliación</th>
                                                            </tr>
                                                            <tr class="csv-filter-row">
                                                                <th class="col-cvs-status"><input type="text" class="form-control form-control-sm" data-field="Status" placeholder="Filtrar..."></th>
                                                                <th class="col-cvs-arr-airline"><input type="text" class="form-control form-control-sm" data-field="[Arr] Airline code" placeholder="Filtrar..."></th>
                                                                <th class="col-cvs-arr-flight"><input type="text" class="form-control form-control-sm" data-field="[Arr] Flight Designator" placeholder="Filtrar..."></th>
                                                                <th class="col-cvs-arr-aldt"><input type="text" class="form-control form-control-sm" data-field="[Arr] ALDT" placeholder="Filtrar..."></th>
                                                                <th class="col-cvs-arr-sibt"><input type="text" class="form-control form-control-sm" data-field="[Arr] SIBT" placeholder="Filtrar..."></th>
                                                                <th class="col-cvs-arr-aibt"><input type="text" class="form-control form-control-sm" data-field="[Arr] AIBT" placeholder="Filtrar..."></th>
                                                                <th class="col-cvs-arr-stand"><input type="text" class="form-control form-control-sm" data-field="[Arr] Stand" placeholder="Filtrar..."></th>
                                                                <th class="col-cvs-arr-gates"><input type="text" class="form-control form-control-sm" data-field="[Arr] Gates" placeholder="Filtrar..."></th>
                                                                <th class="col-cvs-arr-boarded"><input type="text" class="form-control form-control-sm" data-field="[Arr] Boarded" placeholder="Filtrar..."></th>
                                                                <th class="col-cvs-arr-belts"><input type="text" class="form-control form-control-sm" data-field="[Arr] Baggage Belts" placeholder="Filtrar..."></th>
                                                                <th class="col-cvs-arr-type"><input type="text" class="form-control form-control-sm" data-field="[Arr] Service Type" placeholder="Filtrar..."></th>
                                                                <th class="col-cvs-routing"><input type="text" class="form-control form-control-sm" data-field="Routing" placeholder="Filtrar..."></th>
                                                                <th class="col-cvs-dep-type"><input type="text" class="form-control form-control-sm" data-field="[Dep] Service Type" placeholder="Filtrar..."></th>
                                                                <th class="col-cvs-aircraft"><input type="text" class="form-control form-control-sm" data-field="Aircraft type" placeholder="Filtrar..."></th>
                                                                <th class="col-cvs-reg"><input type="text" class="form-control form-control-sm" data-field="Registration" placeholder="Filtrar..."></th>
                                                                <th class="col-cvs-dep-airline"><input type="text" class="form-control form-control-sm" data-field="[Dep] Airline code" placeholder="Filtrar..."></th>
                                                                <th class="col-cvs-dep-flight"><input type="text" class="form-control form-control-sm" data-field="[Dep] Flight Designator" placeholder="Filtrar..."></th>
                                                                <th class="col-cvs-dep-stand"><input type="text" class="form-control form-control-sm" data-field="[Dep] Stand" placeholder="Filtrar..."></th>
                                                                <th class="col-cvs-dep-gates"><input type="text" class="form-control form-control-sm" data-field="[Dep] Gates" placeholder="Filtrar..."></th>
                                                                <th class="col-cvs-dep-boarded"><input type="text" class="form-control form-control-sm" data-field="[Dep] Boarded" placeholder="Filtrar..."></th>
                                                                <th class="col-cvs-dep-sobt"><input type="text" class="form-control form-control-sm" data-field="[Dep] SOBT" placeholder="Filtrar..."></th>
                                                                <th class="col-cvs-dep-aobt"><input type="text" class="form-control form-control-sm" data-field="[Dep] AOBT" placeholder="Filtrar..."></th>
                                                                <th class="col-cvs-dep-atot"><input type="text" class="form-control form-control-sm" data-field="[Dep] ATOT" placeholder="Filtrar..."></th>
                                                                <th class="col-cvs-dep-attt"><input type="text" class="form-control form-control-sm" data-field="[Dep] ATTT" placeholder="Filtrar..."></th>
                                                                <th class="col-cvs-observaciones" style="background:#f0fff4;border-left:2px solid #b7dfca;"><input type="text" class="form-control form-control-sm" data-field="_observaciones" placeholder="Filtrar..."></th>
                                                                <th class="col-cvs-validation" style="background:#eef4ff;border-left:2px solid #c8d9f8;"></th>
                                                            </tr>
                                                        </thead>
                                                        <tbody class="text-center bg-white"
                                                            id="tbody-ops-flights-csv">
                                                            <tr>
                                                                <td colspan="26" class="text-muted py-4">Cargando vuelos...</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    </div><!-- /conciliacion-csv-view -->

                                    <!-- Vista Board: Llegadas y Salidas -->
                                    <div id="conciliacion-board-view" class="d-none mt-2">
                                        <div class="d-flex align-items-center mb-3 gap-2 flex-wrap">
                                            <button class="btn btn-sm btn-outline-secondary" onclick="toggleConciliacionBoard()">
                                                <i class="fas fa-table me-1"></i>Regresar al CSV
                                            </button>
                                            <span class="text-muted small"><i class="fas fa-plane me-1"></i>Vista Llegadas / Salidas</span>
                                            <div class="input-group input-group-sm ms-auto board-global-search">
                                                <span class="input-group-text border-end-0 bg-white"><i class="fas fa-search text-muted"></i></span>
                                                <input type="text" class="form-control border-start-0" id="board-global-search"
                                                    placeholder="Buscar en llegadas y salidas…"
                                                    oninput="filterBoardTables()">
                                                <button class="btn btn-outline-secondary" type="button" onclick="document.getElementById('board-global-search').value='';filterBoardTables();" title="Limpiar">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                            <span class="badge bg-warning text-dark ms-auto" style="font-size:.75rem;font-weight:500;">
                                                <i class="fas fa-link me-1"></i>Haz clic en un vuelo para ver su enlace por matrícula
                                            </span>
                                        </div>
                                        <div class="row g-3">
                                            <!-- Llegadas -->
                                            <div class="col-xl-6">
                                                <div class="card shadow-sm border-0 h-100">
                                                    <div class="card-header bg-success text-white d-flex align-items-center justify-content-between py-2">
                                                        <span class="fw-bold"><i class="fas fa-plane-arrival me-2"></i>Llegadas</span>
                                                        <div class="d-flex align-items-center gap-2">
                                                            <span class="badge bg-white text-success fw-bold" id="board-arr-count">0 vuelos</span>
                                                            <button class="btn btn-sm btn-light btn-date-filter-toggle" id="btn-board-date-arr"
                                                                onclick="toggleBoardDatePanel('arr')" title="Filtrar por fecha">
                                                                <i class="fas fa-filter"></i>
                                                            </button>
                                                            <button class="btn btn-sm btn-outline-light" title="Limpiar filtros de columna"
                                                                onclick="clearBoardColFilters('arr')">
                                                                <i class="fas fa-broom"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <!-- Date Window Panel: Llegadas -->
                                                    <div id="board-date-panel-arr" class="board-date-panel d-none">
                                                        <div class="d-flex align-items-center gap-2 flex-wrap">
                                                            <span class="small fw-semibold text-muted" style="white-space:nowrap">Date Window</span>
                                                            <div class="btn-group btn-group-sm" role="group">
                                                                <button class="btn btn-outline-success active" type="button" id="board-arr-mode-rel"
                                                                    onclick="setBoardDateMode('arr','rel')">Relative</button>
                                                                <button class="btn btn-outline-success" type="button" id="board-arr-mode-abs"
                                                                    onclick="setBoardDateMode('arr','abs')">Absolute</button>
                                                            </div>
                                                            <div id="board-arr-rel-mode" class="d-flex flex-column">
                                                                <div class="d-flex align-items-center gap-1">
                                                                    <button class="btn btn-sm btn-outline-secondary" type="button"
                                                                        onclick="stepBoardOffset('arr','start',-1)">-</button>
                                                                    <input type="number" class="form-control form-control-sm text-center" id="board-arr-rel-start"
                                                                        value="-4" style="width:60px">
                                                                    <button class="btn btn-sm btn-outline-secondary" type="button"
                                                                        onclick="stepBoardOffset('arr','start',1)">+</button>
                                                                    <span class="small text-muted">a</span>
                                                                    <button class="btn btn-sm btn-outline-secondary" type="button"
                                                                        onclick="stepBoardOffset('arr','end',-1)">-</button>
                                                                    <input type="number" class="form-control form-control-sm text-center" id="board-arr-rel-end"
                                                                        value="0" style="width:60px">
                                                                    <button class="btn btn-sm btn-outline-secondary" type="button"
                                                                        onclick="stepBoardOffset('arr','end',1)">+</button>
                                                                    <button class="btn btn-sm btn-success ms-1" type="button"
                                                                        onclick="applyBoardDateFilter('arr')"><i class="fas fa-check me-1"></i>Aplicar</button>
                                                                </div>
                                                                <div class="d-flex align-items-center gap-1 small text-muted mt-1">
                                                                    <span id="board-arr-rel-start-label">—</span>
                                                                    <span>a</span>
                                                                    <span id="board-arr-rel-end-label">—</span>
                                                                </div>
                                                            </div>
                                                            <div id="board-arr-abs-mode" class="d-flex align-items-center gap-2 d-none">
                                                                <input type="date" class="form-control form-control-sm" id="board-arr-abs-date"
                                                                    style="width:150px" oninput="applyBoardDateFilter('arr')">
                                                                <span class="small text-muted fst-italic">— solo este día</span>
                                                            </div>
                                                            <button class="btn btn-xs btn-outline-secondary ms-auto"
                                                                onclick="clearBoardDateFilter('arr')" title="Quitar filtro">
                                                                <i class="fas fa-times"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div class="card-body p-0">
                                                        <div class="table-responsive" style="max-height:600px;overflow-y:auto;">
                                                            <table class="table table-hover table-bordered table-sm align-middle mb-0" id="table-board-arrivals">
                                                                <thead class="table-light sticky-top">
                                                                    <tr class="text-center small text-uppercase text-muted">
                                                                        <th data-bs-toggle="tooltip" data-bs-placement="bottom" title="Estado actual del vuelo" data-col-help="b-arr-status">Status <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></th>
                                                                        <th data-bs-toggle="tooltip" data-bs-placement="bottom" title="Designador del vuelo de llegada (ej: AM100)" data-col-help="b-arr-flight">Flight <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></th>
                                                                        <th data-bs-toggle="tooltip" data-bs-placement="bottom" title="SIBT: Scheduled In-Block Time - Hora programada de llegada a la posición" data-col-help="arr-sibt">SIBT <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></th>
                                                                        <th data-bs-toggle="tooltip" data-bs-placement="bottom" title="AIBT: Actual In-Block Time - Hora real de llegada a la posición" data-col-help="arr-aibt">AIBT <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></th>
                                                                        <th data-bs-toggle="tooltip" data-bs-placement="bottom" title="Aeropuerto de origen del vuelo" data-col-help="b-arr-routing">Routing <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></th>
                                                                        <th data-bs-toggle="tooltip" data-bs-placement="bottom" title="Modelo o tipo de aeronave (ej: Boeing 737, Airbus A321)" data-col-help="aircraft">Aircraft <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></th>
                                                                        <th data-bs-toggle="tooltip" data-bs-placement="bottom" title="Matrícula del avión - permite enlazar la llegada con la salida del mismo avión" data-col-help="registration">Registration <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></th>
                                                                    </tr>
                                                                    <tr class="board-filter-row">
                                                                        <td><input type="text" class="board-col-filter w-100" data-table="arr" placeholder="Status…" oninput="filterBoardTables()"></td>
                                                                        <td><input type="text" class="board-col-filter w-100" data-table="arr" placeholder="Flight…" oninput="filterBoardTables()"></td>
                                                                        <td><input type="text" class="board-col-filter w-100" data-table="arr" placeholder="SIBT…" oninput="filterBoardTables()"></td>
                                                                        <td><input type="text" class="board-col-filter w-100" data-table="arr" placeholder="AIBT…" oninput="filterBoardTables()"></td>
                                                                        <td><input type="text" class="board-col-filter w-100" data-table="arr" placeholder="Routing…" oninput="filterBoardTables()"></td>
                                                                        <td><input type="text" class="board-col-filter w-100" data-table="arr" placeholder="Aircraft…" oninput="filterBoardTables()"></td>
                                                                        <td><input type="text" class="board-col-filter w-100" data-table="arr" placeholder="Reg…" oninput="filterBoardTables()"></td>
                                                                    </tr>
                                                                </thead>
                                                                <tbody id="tbody-board-arrivals" class="text-center">
                                                                    <tr><td colspan="7" class="text-muted py-4">Haz clic en el botón para cargar datos.</td></tr>
                                                                </tbody>
                                                                <tfoot>
                                                                    <tr class="table-light">
                                                                        <td colspan="7" class="text-end small text-muted py-2 pe-3">
                                                                            <i class="fas fa-plane-arrival me-1"></i>
                                                                            <span id="board-arr-footer">0</span> vuelos
                                                                        </td>
                                                                    </tr>
                                                                </tfoot>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Salidas -->
                                            <div class="col-xl-6">
                                                <div class="card shadow-sm border-0 h-100">
                                                    <div class="card-header bg-primary text-white d-flex align-items-center justify-content-between py-2">
                                                        <span class="fw-bold"><i class="fas fa-plane-departure me-2"></i>Salidas</span>
                                                        <div class="d-flex align-items-center gap-2">
                                                            <span class="badge bg-white text-primary fw-bold" id="board-dep-count">0 vuelos</span>
                                                            <button class="btn btn-sm btn-light btn-date-filter-toggle" id="btn-board-date-dep"
                                                                onclick="toggleBoardDatePanel('dep')" title="Filtrar por fecha">
                                                                <i class="fas fa-filter"></i>
                                                            </button>
                                                            <button class="btn btn-sm btn-outline-light" title="Limpiar filtros de columna"
                                                                onclick="clearBoardColFilters('dep')">
                                                                <i class="fas fa-broom"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <!-- Date Window Panel: Salidas -->
                                                    <div id="board-date-panel-dep" class="board-date-panel d-none">
                                                        <div class="d-flex align-items-center gap-2 flex-wrap">
                                                            <span class="small fw-semibold text-muted" style="white-space:nowrap">Date Window</span>
                                                            <div class="btn-group btn-group-sm" role="group">
                                                                <button class="btn btn-outline-primary active" type="button" id="board-dep-mode-rel"
                                                                    onclick="setBoardDateMode('dep','rel')">Relative</button>
                                                                <button class="btn btn-outline-primary" type="button" id="board-dep-mode-abs"
                                                                    onclick="setBoardDateMode('dep','abs')">Absolute</button>
                                                            </div>
                                                            <div id="board-dep-rel-mode" class="d-flex flex-column">
                                                                <div class="d-flex align-items-center gap-1">
                                                                    <button class="btn btn-sm btn-outline-secondary" type="button"
                                                                        onclick="stepBoardOffset('dep','start',-1)">-</button>
                                                                    <input type="number" class="form-control form-control-sm text-center" id="board-dep-rel-start"
                                                                        value="-4" style="width:60px">
                                                                    <button class="btn btn-sm btn-outline-secondary" type="button"
                                                                        onclick="stepBoardOffset('dep','start',1)">+</button>
                                                                    <span class="small text-muted">a</span>
                                                                    <button class="btn btn-sm btn-outline-secondary" type="button"
                                                                        onclick="stepBoardOffset('dep','end',-1)">-</button>
                                                                    <input type="number" class="form-control form-control-sm text-center" id="board-dep-rel-end"
                                                                        value="0" style="width:60px">
                                                                    <button class="btn btn-sm btn-outline-secondary" type="button"
                                                                        onclick="stepBoardOffset('dep','end',1)">+</button>
                                                                    <button class="btn btn-sm btn-primary ms-1" type="button"
                                                                        onclick="applyBoardDateFilter('dep')"><i class="fas fa-check me-1"></i>Aplicar</button>
                                                                </div>
                                                                <div class="d-flex align-items-center gap-1 small text-muted mt-1">
                                                                    <span id="board-dep-rel-start-label">—</span>
                                                                    <span>a</span>
                                                                    <span id="board-dep-rel-end-label">—</span>
                                                                </div>
                                                            </div>
                                                            <div id="board-dep-abs-mode" class="d-flex align-items-center gap-2 d-none">
                                                                <input type="date" class="form-control form-control-sm" id="board-dep-abs-date"
                                                                    style="width:150px" oninput="applyBoardDateFilter('dep')">
                                                                <span class="small text-muted fst-italic">— solo este día</span>
                                                            </div>
                                                            <button class="btn btn-xs btn-outline-secondary ms-auto"
                                                                onclick="clearBoardDateFilter('dep')" title="Quitar filtro">
                                                                <i class="fas fa-times"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div class="card-body p-0">
                                                        <div class="table-responsive" style="max-height:600px;overflow-y:auto;">
                                                            <table class="table table-hover table-bordered table-sm align-middle mb-0" id="table-board-departures">
                                                                <thead class="table-light sticky-top">
                                                                    <tr class="text-center small text-uppercase text-muted">
                                                                        <th data-bs-toggle="tooltip" data-bs-placement="bottom" title="Estado actual del vuelo" data-col-help="b-arr-status">Status <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></th>
                                                                        <th data-bs-toggle="tooltip" data-bs-placement="bottom" title="Designador del vuelo de salida (ej: AM101)" data-col-help="b-dep-flight">Flight <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></th>
                                                                        <th data-bs-toggle="tooltip" data-bs-placement="bottom" title="SOBT: Scheduled Off-Block Time - Hora programada de salida de posición" data-col-help="dep-sobt">SOBT <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></th>
                                                                        <th data-bs-toggle="tooltip" data-bs-placement="bottom" title="AOBT: Actual Off-Block Time - Hora real de salida de posición" data-col-help="dep-aobt">AOBT <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></th>
                                                                        <th data-bs-toggle="tooltip" data-bs-placement="bottom" title="Aeropuerto de destino del vuelo" data-col-help="b-dep-routing">Routing <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></th>
                                                                        <th data-bs-toggle="tooltip" data-bs-placement="bottom" title="Modelo o tipo de aeronave (ej: Boeing 737, Airbus A321)" data-col-help="aircraft">Aircraft <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></th>
                                                                        <th data-bs-toggle="tooltip" data-bs-placement="bottom" title="Matrícula del avión - permite enlazar la salida con la llegada del mismo avión" data-col-help="registration">Registration <i class="fas fa-circle-question" style="font-size:.6em;opacity:.4;vertical-align:middle"></i></th>
                                                                    </tr>
                                                                    <tr class="board-filter-row">
                                                                        <td><input type="text" class="board-col-filter w-100" data-table="dep" placeholder="Status…" oninput="filterBoardTables()"></td>
                                                                        <td><input type="text" class="board-col-filter w-100" data-table="dep" placeholder="Flight…" oninput="filterBoardTables()"></td>
                                                                        <td><input type="text" class="board-col-filter w-100" data-table="dep" placeholder="SOBT…" oninput="filterBoardTables()"></td>
                                                                        <td><input type="text" class="board-col-filter w-100" data-table="dep" placeholder="AOBT…" oninput="filterBoardTables()"></td>
                                                                        <td><input type="text" class="board-col-filter w-100" data-table="dep" placeholder="Routing…" oninput="filterBoardTables()"></td>
                                                                        <td><input type="text" class="board-col-filter w-100" data-table="dep" placeholder="Aircraft…" oninput="filterBoardTables()"></td>
                                                                        <td><input type="text" class="board-col-filter w-100" data-table="dep" placeholder="Reg…" oninput="filterBoardTables()"></td>
                                                                    </tr>
                                                                </thead>
                                                                <tbody id="tbody-board-departures" class="text-center">
                                                                    <tr><td colspan="7" class="text-muted py-4">Haz clic en el botón para cargar datos.</td></tr>
                                                                </tbody>
                                                                <tfoot>
                                                                    <tr class="table-light">
                                                                        <td colspan="7" class="text-end small text-muted py-2 pe-3">
                                                                            <i class="fas fa-plane-departure me-1"></i>
                                                                            <span id="board-dep-footer">0</span> vuelos
                                                                        </td>
                                                                    </tr>
                                                                </tfoot>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div><!-- /conciliacion-board-view -->

                                    </div><!-- /pane-conci-itinerario -->

                                    <!-- ═══ Tab: Comercial ═══ -->
                                    <div class="tab-pane fade" id="pane-conci-comercial" role="tabpanel">
                                        <div class="p-4">

                                            <!-- Cabecera Comercial -->
                                            <div class="d-flex align-items-center gap-3 mb-4">
                                                <div class="rounded-3 d-flex align-items-center justify-content-center" style="width:48px;height:48px;background:linear-gradient(135deg,#16a34a,#22c55e);">
                                                    <i class="fas fa-store text-white fs-5"></i>
                                                </div>
                                                <div>
                                                    <h5 class="mb-0 fw-bold text-success">Datos Comerciales</h5>
                                                    <small class="text-muted">Información de ingresos, concesiones y operaciones comerciales del aeropuerto</small>
                                                </div>
                                            </div>

                                            <!-- KPI Cards -->
                                            <div class="row g-3 mb-4">
                                                <div class="col-sm-6 col-lg-3">
                                                    <div class="card border-0 shadow-sm h-100" style="border-left:4px solid #16a34a !important;">
                                                        <div class="card-body py-3">
                                                            <div class="d-flex align-items-center gap-2 mb-1">
                                                                <i class="fas fa-coins text-success"></i>
                                                                <small class="text-muted text-uppercase fw-semibold" style="font-size:.7rem;">Ingresos Comerciales</small>
                                                            </div>
                                                            <div class="fs-5 fw-bold text-success" id="kpi-comercial-ingresos">—</div>
                                                            <small class="text-muted" style="font-size:.72rem;">Período actual</small>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-6 col-lg-3">
                                                    <div class="card border-0 shadow-sm h-100" style="border-left:4px solid #2563eb !important;">
                                                        <div class="card-body py-3">
                                                            <div class="d-flex align-items-center gap-2 mb-1">
                                                                <i class="fas fa-store text-primary"></i>
                                                                <small class="text-muted text-uppercase fw-semibold" style="font-size:.7rem;">Locales Activos</small>
                                                            </div>
                                                            <div class="fs-5 fw-bold text-primary" id="kpi-comercial-locales">—</div>
                                                            <small class="text-muted" style="font-size:.72rem;">Concesiones vigentes</small>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-6 col-lg-3">
                                                    <div class="card border-0 shadow-sm h-100" style="border-left:4px solid #d97706 !important;">
                                                        <div class="card-body py-3">
                                                            <div class="d-flex align-items-center gap-2 mb-1">
                                                                <i class="fas fa-chart-line" style="color:#d97706;"></i>
                                                                <small class="text-muted text-uppercase fw-semibold" style="font-size:.7rem;">Ocupación Comercial</small>
                                                            </div>
                                                            <div class="fs-5 fw-bold" style="color:#d97706;" id="kpi-comercial-ocupacion">—</div>
                                                            <small class="text-muted" style="font-size:.72rem;">% de m² ocupados</small>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-6 col-lg-3">
                                                    <div class="card border-0 shadow-sm h-100" style="border-left:4px solid #8b5cf6 !important;">
                                                        <div class="card-body py-3">
                                                            <div class="d-flex align-items-center gap-2 mb-1">
                                                                <i class="fas fa-users" style="color:#8b5cf6;"></i>
                                                                <small class="text-muted text-uppercase fw-semibold" style="font-size:.7rem;">Pax por Local</small>
                                                            </div>
                                                            <div class="fs-5 fw-bold" style="color:#8b5cf6;" id="kpi-comercial-pax-local">—</div>
                                                            <small class="text-muted" style="font-size:.72rem;">Pasajeros promedio/día</small>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Placeholder content -->
                                            <div class="row g-4">
                                                <div class="col-lg-7">
                                                    <div class="card border-0 shadow-sm h-100">
                                                        <div class="card-header bg-white border-bottom d-flex align-items-center justify-content-between">
                                                            <h6 class="mb-0 fw-semibold"><i class="fas fa-list-ul me-2 text-success"></i>Registro de Concesiones</h6>
                                                            <button class="btn btn-sm btn-outline-success" disabled title="Próximamente">
                                                                <i class="fas fa-plus me-1"></i>Agregar
                                                            </button>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="text-center py-5 text-muted">
                                                                <i class="fas fa-store fa-3x mb-3 opacity-25"></i>
                                                                <p class="fw-semibold mb-1">Módulo en desarrollo</p>
                                                                <small>Aquí se mostrará el registro de concesiones y locales comerciales del aeropuerto.</small>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-5">
                                                    <div class="card border-0 shadow-sm h-100">
                                                        <div class="card-header bg-white border-bottom">
                                                            <h6 class="mb-0 fw-semibold"><i class="fas fa-chart-pie me-2 text-success"></i>Distribución por Tipo</h6>
                                                        </div>
                                                        <div class="card-body d-flex align-items-center justify-content-center">
                                                            <div class="text-center py-4 text-muted">
                                                                <i class="fas fa-chart-pie fa-3x mb-3 opacity-25"></i>
                                                                <p class="fw-semibold mb-1">Sin datos</p>
                                                                <small>Gráfico disponible al registrar concesiones.</small>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div><!-- /pane-conci-comercial -->

                                    </div><!-- /tab-content -->

                        </div><!-- /conciliacion-content card-body -->
                    </div><!-- /card -->
                </div><!-- /conciliacion-section -->

                <!-- GSO Section (Impactos de Ave + Fauna Rescatada) -->
                <div id="fauna-section" class="content-section">
                    <div class="card border-0">
                        <div class="card-body px-0">
                            <div class="gso-media-wrapper mb-4 px-3 px-md-0">
                                <div class="ratio ratio-16x9 gso-hero">
                                    <video class="gso-hero-media" src="videos/Aterrizaje%20Cargo.mp4" autoplay muted
                                        loop playsinline preload="metadata"
                                        aria-label="Gerencia de Seguridad Operacional"></video>
                                    <div class="gso-hero-overlay">
                                        <div class="gso-hero-inner">
                                            <div class="gso-hero-copy text-center">
                                                <h3 class="gso-hero-title mb-0">Gerencia de Seguridad Operacional
                                                    (GSO)
                                                </h3>
                                                <p class="gso-hero-caption mb-0"><i
                                                        class="fas fa-plane-departure me-2"></i>Selecciona la opción
                                                    en
                                                    la que deseas navegar</p>
                                            </div>
                                            <div class="gso-hero-actions">
                                                <div class="gso-tab-buttons">
                                                    <button type="button" class="gso-nav-btn"
                                                        data-nav-button="gso-impactos-tab">
                                                        <span class="gso-nav-icon"><i class="fas fa-dove"
                                                                aria-hidden="true"></i></span>
                                                        <span class="gso-nav-label">Impactos de Ave</span>
                                                    </button>
                                                    <button type="button" class="gso-nav-btn"
                                                        data-nav-button="gso-rescate-tab">
                                                        <span class="gso-nav-icon"><i class="fas fa-paw"
                                                                aria-hidden="true"></i></span>
                                                        <span class="gso-nav-label">Fauna Rescatada</span>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <ul class="nav nav-tabs d-none" id="gsoTab" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="gso-impactos-tab" data-bs-toggle="tab"
                                        data-bs-target="#gso-impactos-pane" type="button" role="tab"
                                        aria-controls="gso-impactos-pane" aria-selected="false" tabindex="-1"><i
                                            class="fas fa-dove me-2"></i>Registro de Impactos de Ave</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="gso-rescate-tab" data-bs-toggle="tab"
                                        data-bs-target="#gso-fauna-rescate-pane" type="button" role="tab"
                                        aria-controls="gso-fauna-rescate-pane" aria-selected="false" tabindex="-1"><i
                                            class="fas fa-paw me-2"></i>Fauna Rescatada</button>
                                </li>
                            </ul>
                            <div class="tab-content pt-3 d-none" id="gsoTabContent">
                                <div class="tab-pane fade" id="gso-impactos-pane" role="tabpanel"
                                    aria-labelledby="gso-impactos-tab" tabindex="0">
                                    <div class="gso-return mb-3">
                                        <button type="button" class="btn btn-outline-secondary btn-sm gso-return-btn"><i
                                                class="fas fa-arrow-left me-2"></i>Regresar al menú GSO</button>
                                    </div>
                                    <div class="text-center mb-3">
                                        <h3 class="fw-bold mb-0"><i class="fas fa-dove me-2"></i>Registros de
                                            Impactos
                                            de Ave 2025</h3>
                                    </div>
                                    <div class="card">
                                        <div
                                            class="card-header d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-2">
                                            <div
                                                class="d-flex flex-wrap align-items-center gap-2 fauna-filters filters-bar">
                                                <div class="chip">
                                                    <label class="me-1" for="fauna-date-from"><i
                                                            class="fas fa-calendar-alt me-1"></i>Fecha</label>
                                                    <input type="date" id="fauna-date-from"
                                                        class="form-control form-control-sm"
                                                        aria-label="Fecha inicio" />
                                                    <span class="mx-1">a</span>
                                                    <input type="date" id="fauna-date-to"
                                                        class="form-control form-control-sm" aria-label="Fecha fin" />
                                                </div>
                                                <div class="chip">
                                                    <label class="me-1" for="fauna-month"><i
                                                            class="fas fa-calendar me-1"></i>Mes</label>
                                                    <select id="fauna-month" class="form-select form-select-sm"
                                                        aria-label="Filtrar fauna por mes">
                                                        <option value="all" selected>Todos</option>
                                                        <option value="01">Enero</option>
                                                        <option value="02">Febrero</option>
                                                        <option value="03">Marzo</option>
                                                        <option value="04">Abril</option>
                                                        <option value="05">Mayo</option>
                                                        <option value="06">Junio</option>
                                                        <option value="07">Julio</option>
                                                        <option value="08">Agosto</option>
                                                        <option value="09">Septiembre</option>
                                                        <option value="10">Octubre</option>
                                                        <option value="11">Noviembre</option>
                                                        <option value="12">Diciembre</option>
                                                    </select>
                                                </div>
                                                <div class="chip">
                                                    <label class="me-1" for="fauna-species"><i
                                                            class="fas fa-paw me-1"></i>Especie</label>
                                                    <select id="fauna-species" class="form-select form-select-sm"
                                                        aria-label="Filtrar fauna por especie">
                                                        <option value="all" selected>Todas</option>
                                                    </select>
                                                </div>
                                                <div class="chip">
                                                    <label class="me-1" for="fauna-size"><i
                                                            class="fas fa-arrows-to-dot me-1"></i>Tamaño</label>
                                                    <select id="fauna-size" class="form-select form-select-sm"
                                                        aria-label="Filtrar fauna por tamaño">
                                                        <option value="all" selected>Todos</option>
                                                    </select>
                                                </div>
                                                <div class="chip">
                                                    <label class="me-1" for="fauna-phase"><i
                                                            class="fas fa-plane-departure me-1"></i>Fase</label>
                                                    <select id="fauna-phase" class="form-select form-select-sm"
                                                        aria-label="Filtrar fauna por fase">
                                                        <option value="all" selected>Todas</option>
                                                    </select>
                                                </div>
                                                <div class="chip">
                                                    <label class="me-1" for="fauna-airline"><i
                                                            class="fas fa-plane me-1"></i>Aerolínea</label>
                                                    <select id="fauna-airline" class="form-select form-select-sm"
                                                        aria-label="Filtrar fauna por aerolínea">
                                                        <option value="all" selected>Todas</option>
                                                    </select>
                                                </div>
                                                <div class="chip chip-actions">
                                                    <label class="me-1"><i
                                                            class="fas fa-broom me-1"></i>Acciones</label>
                                                    <button id="fauna-clear"
                                                        class="btn btn-outline-secondary btn-sm">Restablecer</button>
                                                    <button id="fauna-export-csv"
                                                        class="btn btn-outline-primary btn-sm"><i
                                                            class="fas fa-file-csv me-1"></i>CSV</button>
                                                </div>
                                                <div class="chip chip-actions ms-auto">
                                                    <button class="btn btn-primary btn-sm admin-edit-btn" style="display:none;" onclick="dataManagement.addItem('wildlife_strikes')">
                                                        <i class="fas fa-plus me-1"></i>Agregar Registro
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="d-flex flex-wrap align-items-center gap-3 mb-2">
                                                <span class="badge bg-primary" id="fauna-total-badge">Total:
                                                    0</span>
                                                <span class="badge bg-info text-dark" id="fauna-period-badge">Periodo:
                                                    Todos</span>
                                                <button class="btn btn-outline-primary btn-sm active"
                                                    id="fauna-summary-toggle" data-bs-toggle="collapse"
                                                    data-bs-target="#fauna-summary-collapse" aria-expanded="true"
                                                    aria-controls="fauna-summary-collapse">
                                                    <i class="fas fa-list-ul me-1"></i>Resumen por Aerolínea
                                                </button>
                                            </div>
                                            <div class="collapse show" id="fauna-summary-collapse">
                                                <h6 class="mb-2"><i class="fas fa-plane me-2"></i>Resumen por
                                                    Aerolínea
                                                </h6>
                                                <div id="fauna-summary-container" class="table-container-tech">
                                                </div>
                                            </div>
                                            <!-- Top horas críticas arriba -->
                                            <div class="mb-3">
                                                <div class="d-flex align-items-center gap-2">
                                                    <i class="fas fa-bolt text-warning"></i>
                                                    <strong>Top horas críticas</strong>
                                                    <span class="small text-muted">(con filtros aplicados)</span>
                                                </div>
                                                <div id="fauna-top-hours" class="mt-2 d-flex flex-wrap gap-2"></div>
                                            </div>
                                            <!-- Resumen despegues vs aterrizajes -->
                                            <div class="mb-3">
                                                <div class="d-flex align-items-center gap-2">
                                                    <i class="fas fa-plane me-1 text-primary"></i>
                                                    <strong>Resumen por fase de operación</strong>
                                                </div>
                                                <div id="fauna-phase-summary" class="mt-2 d-flex flex-wrap gap-2">
                                                </div>
                                            </div>
                                            <!-- Resumen visual: gráficas -->
                                            <div class="row g-3 mb-3">
                                                <div class="col-lg-6">
                                                    <h6 class="text-muted mb-2"><i
                                                            class="fas fa-chart-column me-1"></i>Eventos
                                                        por
                                                        mes</h6>
                                                    <div class="chart-container chart-height-360"><canvas
                                                            id="fauna-by-month"></canvas></div>
                                                </div>
                                                <div class="col-lg-6">
                                                    <h6 class="text-muted mb-2"><i class="fas fa-paw me-1"></i>Eventos
                                                        por nombre común</h6>
                                                    <div class="chart-container chart-height-360"><canvas
                                                            id="fauna-by-species"></canvas></div>
                                                </div>
                                                <div class="col-12">
                                                    <h6 class="text-muted mb-2"><i
                                                            class="fas fa-grip-vertical me-1"></i>Matriz
                                                        Mes
                                                        ×
                                                        Condiciones (Heatmap)</h6>
                                                    <div class="chart-container heatmap-container chart-height-420">
                                                        <div id="fauna-heatmap" class="w-100 h-100"></div>
                                                    </div>
                                                </div>
                                                <div class="col-12">
                                                    <h6 class="text-muted mb-2"><i
                                                            class="fas fa-clock me-1"></i>Distribución
                                                        por
                                                        hora del día
                                                    </h6>
                                                    <div class="chart-container chart-height-360"><canvas
                                                            id="fauna-by-hour"></canvas></div>
                                                </div>
                                            </div>
                                            <!-- Tabla completa sin paginación -->
                                            <div class="table-responsive" id="fauna-table-container"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="gso-fauna-rescate-pane" role="tabpanel"
                                    aria-labelledby="gso-rescate-tab" tabindex="0">
                                    <div class="gso-return mb-3">
                                        <button type="button" class="btn btn-outline-secondary btn-sm gso-return-btn"><i
                                                class="fas fa-arrow-left me-2"></i>Regresar al menú GSO</button>
                                    </div>
                                    <div class="text-center mb-3">
                                        <h3 class="fw-bold mb-1"><i class="fas fa-paw me-2"></i>Fauna Rescatada
                                            <span id="fauna-rescate-year-label"></span>
                                        </h3>
                                        <div class="btn-group btn-group-sm fauna-rescate-year-switch"
                                            id="fauna-rescate-year-switch" role="group" aria-label="Selecciona año">
                                            <!-- botones dinámicos -->
                                        </div>
                                    </div>
                                    <div class="card">
                                        <div
                                            class="card-header d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-2">
                                            <div
                                                class="d-grid d-md-flex flex-wrap align-items-center gap-2 fauna-rescate-filters filters-bar">
                                                <div class="chip">
                                                    <label class="me-1" for="fauna-rescate-date-from"><i
                                                            class="fas fa-calendar-day me-1"></i>Desde</label>
                                                    <input type="date" id="fauna-rescate-date-from"
                                                        class="form-control form-control-sm" />
                                                </div>
                                                <div class="chip">
                                                    <label class="me-1" for="fauna-rescate-date-to"><i
                                                            class="fas fa-calendar-day me-1"></i>Hasta</label>
                                                    <input type="date" id="fauna-rescate-date-to"
                                                        class="form-control form-control-sm" />
                                                </div>
                                                <div class="chip">
                                                    <label class="me-1" for="fauna-rescate-month"><i
                                                            class="fas fa-calendar-alt me-1"></i>Mes</label>
                                                    <select id="fauna-rescate-month" class="form-select form-select-sm"
                                                        aria-label="Filtrar rescates por mes">
                                                        <option value="all" selected>Todos</option>
                                                    </select>
                                                </div>
                                                <div class="chip">
                                                    <label class="me-1" for="fauna-rescate-class"><i
                                                            class="fas fa-paw me-1"></i>Clase</label>
                                                    <select id="fauna-rescate-class" class="form-select form-select-sm"
                                                        aria-label="Filtrar rescates por clase">
                                                        <option value="all" selected>Todas</option>
                                                    </select>
                                                </div>
                                                <div class="chip">
                                                    <label class="me-1" for="fauna-rescate-method"><i
                                                            class="fas fa-tools me-1"></i>Método</label>
                                                    <select id="fauna-rescate-method" class="form-select form-select-sm"
                                                        aria-label="Filtrar rescates por método">
                                                        <option value="all" selected>Todos</option>
                                                    </select>
                                                </div>
                                                <div class="chip">
                                                    <label class="me-1" for="fauna-rescate-quadrant"><i
                                                            class="fas fa-route me-1"></i>Cuadrante</label>
                                                    <select id="fauna-rescate-quadrant"
                                                        class="form-select form-select-sm"
                                                        aria-label="Filtrar rescates por cuadrante">
                                                        <option value="all" selected>Todos</option>
                                                    </select>
                                                </div>
                                                <div class="chip">
                                                    <label class="me-1" for="fauna-rescate-disposal"><i
                                                            class="fas fa-warehouse me-1"></i>Disposición</label>
                                                    <select id="fauna-rescate-disposal"
                                                        class="form-select form-select-sm"
                                                        aria-label="Filtrar rescates por disposición">
                                                        <option value="all" selected>Todas</option>
                                                    </select>
                                                </div>
                                                <div class="chip chip-actions">
                                                    <label class="me-1"><i
                                                            class="fas fa-broom me-1"></i>Acciones</label>
                                                    <button id="fauna-rescate-clear"
                                                        class="btn btn-outline-secondary btn-sm">Restablecer</button>
                                                </div>
                                                <div class="chip chip-actions ms-auto">
                                                    <button class="btn btn-primary btn-sm admin-edit-btn" style="display:none;" onclick="dataManagement.addItem('rescued_wildlife')">
                                                        <i class="fas fa-plus me-1"></i>Agregar Rescate
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div
                                                class="fauna-rescate-badges d-flex flex-wrap align-items-center gap-3 mb-4">
                                                <span class="fauna-rescate-metric metric-total"
                                                    id="fauna-rescate-total-badge" role="status" aria-live="polite">
                                                    <span class="fauna-rescate-label">Total rescates</span>
                                                    <span class="fauna-rescate-value">0</span>
                                                </span>
                                                <span class="fauna-rescate-metric metric-individuals"
                                                    id="fauna-rescate-individuals-badge" role="status"
                                                    aria-live="polite">
                                                    <span class="fauna-rescate-label">Individuos atendidos</span>
                                                    <span class="fauna-rescate-value">0</span>
                                                </span>
                                                <span class="badge bg-info-subtle text-info fw-semibold d-none"
                                                    id="fauna-rescate-active-filter"></span>
                                            </div>
                                            <div class="row g-3 mb-4">
                                                <div class="col-lg-6">
                                                    <h6 class="text-muted mb-2"><i
                                                            class="fas fa-calendar-alt me-1"></i>Capturas
                                                        por
                                                        mes</h6>
                                                    <div class="chart-container chart-height-320">
                                                        <div id="fauna-rescate-by-month" class="echart-host"></div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-6">
                                                    <h6 class="text-muted mb-2"><i class="fas fa-paw me-1"></i>Eventos
                                                        por clase</h6>
                                                    <div class="chart-container chart-height-320">
                                                        <div id="fauna-rescate-by-class" class="echart-host"></div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-6">
                                                    <h6 class="text-muted mb-2"><i
                                                            class="fas fa-map-location-dot me-1"></i>Sitios
                                                        de
                                                        reubicación</h6>
                                                    <div class="chart-container chart-height-320">
                                                        <div id="fauna-rescate-by-relocation"
                                                            class="echart-host fauna-relocation-chart"></div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-6">
                                                    <h6 class="text-muted mb-2"><i class="fas fa-tools me-1"></i>Método
                                                        de rescate</h6>
                                                    <div class="chart-container chart-height-320">
                                                        <div id="fauna-rescate-by-method" class="echart-host"></div>
                                                    </div>
                                                </div>
                                                <div class="col-12">
                                                    <h6 class="text-muted mb-2"><i
                                                            class="fas fa-clock me-1"></i>Distribución
                                                        por
                                                        hora del día
                                                    </h6>
                                                    <div class="chart-container chart-height-320">
                                                        <div id="fauna-rescate-by-hour" class="echart-host"></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="fauna-rescate-top-chipset mb-4">
                                                <h6 class="text-muted mb-2"><i class="fas fa-leaf me-1"></i>Especies
                                                    más
                                                    frecuentes</h6>
                                                <div id="fauna-rescate-top-species" class="d-flex flex-wrap gap-2">
                                                </div>
                                            </div>
                                            <div class="d-flex justify-content-end mb-3">
                                                <button class="btn btn-outline-primary btn-sm"
                                                    id="fauna-rescate-export"><i
                                                        class="fas fa-file-csv me-1"></i>Exportar CSV</button>
                                            </div>
                                            <div id="fauna-rescate-table" class="table-responsive"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="medicas-section" class="content-section">
                    <div class="card border-0">
                        <div
                            class="card-header bg-transparent d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between">
                            <div>
                                <h2 class="section-title mb-1">Servicio Médico</h2>
                            </div>
                            <a id="servicio-medico-open" class="btn btn-outline-primary btn-sm d-none" href="#"
                                target="_blank" rel="noopener">
                                <i class="fas fa-external-link-alt me-1"></i>Abrir en Google Docs
                            </a>
                        </div>
                        <div class="card-body">
                            <ul class="nav nav-tabs mb-3" id="medicasTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="medicas-directorio-tab" data-bs-toggle="tab"
                                        data-bs-target="#medicas-directorio-pane" type="button" role="tab"
                                        aria-controls="medicas-directorio-pane" aria-selected="true"><i
                                            class="fas fa-address-book me-2"></i>Directorio</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="medicas-comp-tab" data-bs-toggle="tab"
                                        data-bs-target="#medicas-comp-pane" type="button" role="tab"
                                        aria-controls="medicas-comp-pane" aria-selected="false"><i
                                            class="fas fa-chart-area me-2"></i>Atenciones Médicas (Comparación
                                        Mensual)</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="medicas-tipo-tab" data-bs-toggle="tab"
                                        data-bs-target="#medicas-tipo-pane" type="button" role="tab"
                                        aria-controls="medicas-tipo-pane" aria-selected="false"><i
                                            class="fas fa-user-nurse me-2"></i>Tipo de Atención</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="medicas-atenciones-tab" data-bs-toggle="tab"
                                        data-bs-target="#medicas-atenciones-pane" type="button" role="tab"
                                        aria-controls="medicas-atenciones-pane" aria-selected="false"><i
                                            class="fas fa-chart-column me-2"></i>Atenciones médicas AIFA</button>
                                </li>
                            </ul>
                            <div class="tab-content" id="medicasTabsContent">
                                <div id="medicas-directorio-pane" class="tab-pane fade show active" role="tabpanel"
                                    aria-labelledby="medicas-directorio-tab" tabindex="0">
                                    <div class="card border-0 shadow-sm medicas-directorio-card">
                                        <div class="card-body">
                                            <div
                                                class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-between gap-3 mb-3">
                                                <div>
                                                    <h3 class="h6 mb-1 text-uppercase text-muted">Directorio
                                                        operativo
                                                        2025</h3>
                                                    <p class="mb-0 small text-muted">Haz clic en el nombre de cada
                                                        documento para abrir el PDF correspondiente.</p>
                                                </div>
                                                <div class="d-flex flex-wrap gap-2">
                                                    <button type="button" class="btn btn-outline-secondary btn-sm"
                                                        id="medicas-directorio-reload">
                                                        <i class="fas fa-rotate-right me-1"></i>Actualizar
                                                    </button>
                                                </div>
                                            </div>
                                            <div id="medicas-directorio-alert" class="alert alert-info d-none"
                                                role="status">
                                            </div>
                                            <div id="medicas-directorio-loader" class="text-center py-4" role="status"
                                                aria-live="polite">
                                                <div class="spinner-border text-primary" role="status"
                                                    aria-hidden="true"></div>
                                                <div class="mt-2 small text-muted">Cargando directorio...</div>
                                            </div>
                                            <div id="medicas-directorio-list" class="row g-3"
                                                data-doc-base="pdfs/directorio">
                                            </div>
                                            <div id="medicas-directorio-empty" class="alert alert-warning d-none mb-0"
                                                role="status">
                                                No hay registros de directorio disponibles. Verifica el archivo
                                                <code>data/directorio.json</code> y vuelve a intentarlo.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="medicas-atenciones-pane" class="tab-pane fade" role="tabpanel"
                                    aria-labelledby="medicas-atenciones-tab" tabindex="0">
                                    <div class="card border-0 shadow-sm">
                                        <div class="card-body">
                                            <div class="d-flex flex-wrap align-items-center gap-3 mb-3">
                                                <div class="d-flex flex-column">
                                                    <span class="text-uppercase text-muted small fw-semibold">Vista
                                                        histórica</span>
                                                    <span class="fw-semibold" id="medicas-atenciones-resumen">-</span>
                                                </div>
                                                <div class="ms-auto d-flex flex-wrap align-items-center gap-2">
                                                    <label for="medicas-atenciones-year"
                                                        class="small text-muted fw-semibold mb-0"><i
                                                            class="fas fa-filter me-1"></i>Año</label>
                                                    <select id="medicas-atenciones-year"
                                                        class="form-select form-select-sm" aria-label="Filtrar por año">
                                                        <option value="all" selected>Todos</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="chart-container chart-height-420">
                                                <div id="medicasAtencionesChart" class="echart-host w-100 h-100">
                                                </div>
                                            </div>
                                            <p class="small text-muted mt-3 mb-0">Fuente: Servicio Médico AIFA.
                                                Datos
                                                2022 a 2025 (cifras preliminares).</p>
                                            <div class="mt-4">
                                                <h6 class="text-muted mb-2"><i class="fas fa-table me-1"></i>Detalle
                                                    de
                                                    registros</h6>
                                                <div id="medicas-atenciones-table" class="table-container-tech">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="medicas-tipo-pane" class="tab-pane fade" role="tabpanel"
                                    aria-labelledby="medicas-tipo-tab" tabindex="0">
                                    <div class="card border-0 shadow-sm">
                                        <div class="card-body">
                                            <div class="d-flex flex-wrap align-items-center gap-3 mb-3">
                                                <div class="d-flex flex-column">
                                                    <span class="text-uppercase text-muted small fw-semibold">Tipo
                                                        de
                                                        atención</span>
                                                    <span class="fw-semibold" id="medicas-tipo-resumen">-</span>
                                                </div>
                                                <div class="ms-auto d-flex flex-wrap align-items-center gap-2">
                                                    <label for="medicas-tipo-year"
                                                        class="small text-muted fw-semibold mb-0"><i
                                                            class="fas fa-filter me-1"></i>Año</label>
                                                    <select id="medicas-tipo-year" class="form-select form-select-sm"
                                                        aria-label="Filtrar por año">
                                                        <option value="all" selected>Todos</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="chart-container chart-height-420">
                                                <div id="medicasTipoChart" class="echart-host w-100 h-100"></div>
                                            </div>
                                            <p class="small text-muted mt-3 mb-0">Fuente: Servicio Médico AIFA.
                                                Traslados vs. atenciones ambulatorias.</p>
                                            <div class="mt-4">
                                                <h6 class="text-muted mb-2"><i class="fas fa-table me-1"></i>Detalle
                                                    de
                                                    registros</h6>
                                                <div id="medicas-tipo-table" class="table-container-tech"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="medicas-comp-pane" class="tab-pane fade" role="tabpanel"
                                    aria-labelledby="medicas-comp-tab" tabindex="0">
                                    <div class="card border-0 shadow-sm">
                                        <div class="card-body">
                                            <div class="d-flex flex-wrap align-items-start gap-3 mb-3">
                                                <div class="d-flex flex-column">
                                                    <span
                                                        class="text-uppercase text-muted small fw-semibold">Comparación
                                                        mensual</span>
                                                    <span class="fw-semibold" id="medicas-comp-resumen">-</span>
                                                </div>
                                                <div
                                                    class="ms-auto d-flex flex-column flex-lg-row align-items-lg-center gap-2 w-100 w-lg-auto">
                                                    <div class="d-flex flex-wrap align-items-center gap-2">
                                                        <span class="small text-muted fw-semibold"><i
                                                                class="fas fa-filter me-1"></i>Años</span>
                                                        <div id="medicas-comp-years" class="d-flex flex-wrap gap-2">
                                                        </div>
                                                    </div>
                                                    <div class="btn-group btn-group-sm mt-2 mt-lg-0" role="group"
                                                        aria-label="Selección de años">
                                                        <button type="button" class="btn btn-outline-secondary"
                                                            id="medicas-comp-select-all">Todos</button>
                                                        <button type="button" class="btn btn-outline-secondary"
                                                            id="medicas-comp-select-none">Ninguno</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="chart-container chart-height-420">
                                                <div id="medicasCompChart" class="echart-host w-100 h-100"></div>
                                            </div>
                                            <p class="small text-muted mt-3 mb-0">Fuente: Servicio Médico AIFA.
                                                Totales
                                                mensuales comparados por año.</p>
                                            <div class="mt-4">
                                                <h6 class="text-muted mb-2"><i class="fas fa-table me-1"></i>Base de
                                                    datos mensual</h6>
                                                <div id="medicas-comp-table" class="table-container-tech"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="demoras-section" class="content-section">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h2 class="section-title mb-0" id="demoras-title">Análisis de Demoras</h2>
                        </div>
                        <div class="card-body">
                            <div
                                class="demoras-period-toolbar d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3 mb-3">
                                <div class="demoras-period-summary">
                                    <span class="demoras-period-caption">Periodo seleccionado</span>
                                    <span class="demoras-period-value" id="demoras-period-active-label">--</span>
                                </div>
                                <div class="demoras-period-controls" id="demoras-period-controls" role="group"
                                    aria-label="Selecciona un periodo de demoras"></div>
                            </div>
                            <div class="demoras-interactive-hint" id="demoras-interactive-hint" role="note">
                                <div class="hint-icon" aria-hidden="true"><i class="fas fa-compass"></i></div>
                                <div>
                                    <strong class="d-block">Explora las causas</strong>
                                    <span class="small">Selecciona una fila o una porción de la gráfica para ver
                                        motivos, incidentes y observaciones.</span>
                                </div>
                                <button type="button" class="btn btn-sm btn-light demoras-hint-cta ms-auto"
                                    id="demoras-hint-cta">
                                    <i class="fas fa-hand-pointer me-1" aria-hidden="true"></i>Recorrer ahora
                                </button>
                            </div>
                            <div class="row g-4 align-items-start">
                                <div class="col-12 col-xl-6">
                                    <div class="mb-4">
                                        <h3 class="h5 text-center mb-3">Demoras en vuelos de salida</h3>
                                        <div class="table-responsive">
                                            <table class="table table-bordered table-sm align-middle text-center">
                                                <thead class="table-dark">
                                                    <tr>
                                                        <th>Causa</th>
                                                        <th>Demoras</th>
                                                        <th>Porcentaje</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="demoras-tbody"></tbody>
                                                <tfoot id="demoras-tfoot"></tfoot>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="demoras-detail card border-0 shadow-sm" id="demoras-detail-card">
                                        <div class="card-body">
                                            <div class="demoras-detail-header">
                                                <div class="demoras-detail-icon" id="demoras-detail-icon"
                                                    aria-hidden="true">
                                                    <i class="fas fa-chart-pie"></i>
                                                </div>
                                                <div class="demoras-detail-titles">
                                                    <span class="demoras-detail-badge">Detalle interactivo</span>
                                                    <h3 class="demoras-detail-title" id="demoras-detail-title">
                                                        Selecciona una causa</h3>
                                                    <p class="demoras-detail-description text-muted"
                                                        id="demoras-detail-description">Haz clic en la tabla o en la
                                                        gráfica para ver el motivo y observaciones.</p>
                                                </div>
                                                <div class="demoras-detail-metric" id="demoras-detail-metric"
                                                    aria-live="polite">--
                                                </div>
                                            </div>
                                            <div class="demoras-detail-tags d-none" id="demoras-detail-tags"
                                                aria-live="polite">
                                            </div>
                                            <div class="demoras-incidentes demoras-detail-section d-none"
                                                id="demoras-detail-incidentes">
                                                <h4 class="demoras-detail-section-title">Casos registrados</h4>
                                                <ul class="demoras-timeline" id="demoras-detail-incidentes-list">
                                                </ul>
                                            </div>
                                            <div class="demoras-observaciones demoras-detail-section d-none"
                                                id="demoras-detail-observaciones">
                                                <h4 class="demoras-detail-section-title">Observaciones</h4>
                                                <div class="demoras-detail-observacion"
                                                    id="demoras-detail-observaciones-text">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 col-xl-6">
                                    <div class="demoras-chart-wrapper position-relative" id="demoras-chart-wrapper">
                                        <div class="demoras-chart-hint" id="demoras-chart-hint">
                                            <i class="fas fa-chart-pie me-2" aria-hidden="true"></i>
                                            <span>Interactúa con la gráfica</span>
                                        </div>
                                        <div class="chart-container"><canvas id="delaysPieChart"></canvas></div>
                                        <div class="demoras-chart-legend" id="demoras-chart-legend" aria-live="polite">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Análisis de Operaciones Section -->
                <div id="analisis-operaciones-section" class="content-section">
                    <div class="card shadow-sm border-0">

                        <!-- Main Section Tabs: Slots | Manifiestos -->
                        <div class="card-header bg-white py-0 border-bottom">
                            <ul class="nav nav-tabs card-header-tabs" id="aops-main-tabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active fw-semibold" id="aops-tab-slots" data-bs-toggle="tab"
                                        data-bs-target="#aops-pane-slots" type="button" role="tab">
                                        <i class="fas fa-database me-2 text-primary"></i>Slots
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link fw-semibold" id="aops-tab-manifiestos" data-bs-toggle="tab"
                                        data-bs-target="#aops-pane-manifiestos" type="button" role="tab"
                                        id="btn-open-manifiestos-db">
                                        <i class="fas fa-file-signature me-2 text-success"></i>Manifiestos
                                    </button>
                                </li>
                            </ul>
                        </div>

                        <div class="tab-content" id="aops-main-content">

                        <!-- ═══ SLOTS PANE ═══ -->
                        <div class="tab-pane fade show active" id="aops-pane-slots" role="tabpanel">
                        <div class="p-2 border-bottom d-flex justify-content-between align-items-center bg-white">
                            <span class="fw-semibold text-muted small"><i class="fas fa-database me-1"></i>Base de Datos de Operaciones (Demoras)</span>
                            <!-- Year Selection (Top Level) -->
                            <ul class="nav nav-pills" id="ops-year-tabs" role="tablist">
                                <li class="nav-item">
                                    <button class="nav-link active" id="tab-year-2025" data-bs-toggle="pill" data-bs-target="#content-year-2025" type="button" role="tab" onclick="loadOperationsYear(2025)">2025</button>
                                </li>
                                <!-- More years can be added here -->
                            </ul>
                        </div>

                        <div class="card-body bg-light p-3">
                            <!-- Year Content -->
                            <div class="tab-content" id="ops-year-content">
                                
                                <!-- 2025 Content -->
                                <div class="tab-pane fade show active" id="content-year-2025" role="tabpanel">
                                    
                                    <!-- Month Tabs (Scrollable on mobile) -->
                                    <div class="d-flex align-items-center mb-3 overflow-auto border-bottom pb-2">
                                        <ul class="nav nav-tabs flex-nowrap w-100" id="ops-month-tabs-2025" role="tablist">
                                            <!-- Generated by JS -->
                                        </ul>
                                    </div>

                                    <!-- Month Content Container -->
                                    <div class="tab-content" id="ops-month-content-2025">
                                        <div class="tab-pane fade show active" id="month-view-container" role="tabpanel">
                                            
                                            <!-- Toolbar -->
                                            <div class="d-flex justify-content-between align-items-center mb-3 bg-white p-2 rounded shadow-sm">
                                                <div class="d-flex gap-2 align-items-center">
                                                    <span class="badge bg-primary fs-6" id="current-month-badge">Enero 2025</span>
                                                    <span class="text-muted small" id="record-count-badge">Cargando...</span>
                                                </div>
                                                <div class="btn-group" role="group">
                                                    <input type="radio" class="btn-check" name="viewmode" id="view-table" autocomplete="off" checked onchange="toggleViewMode('table')">
                                                    <label class="btn btn-outline-secondary btn-sm" for="view-table"><i class="fas fa-table me-1"></i>Tabla Detallada</label>

                                                    <input type="radio" class="btn-check" name="viewmode" id="view-charts" autocomplete="off" onchange="toggleViewMode('charts')">
                                                    <label class="btn btn-outline-secondary btn-sm" for="view-charts"><i class="fas fa-chart-pie me-1"></i>Estadísticas</label>
                                                </div>
                                                <button class="btn btn-success btn-sm" onclick="exportCurrentTable()"><i class="fas fa-file-excel me-1"></i>Exportar Excel</button>
                                            </div>

                                            <!-- Data Table View -->
                                            <div id="ops-table-wrapper" class="bg-white p-3 rounded shadow-sm" style="min-height: 400px;">
                                                <div class="table-responsive">
                                                    <table id="ops-datatable" class="table table-striped table-hover table-bordered w-100" style="font-size: 0.85rem;">
                                                        <thead class="table-light">
                                                            <!-- Headers will be dynamic -->
                                                        </thead>
                                                        <tbody></tbody>
                                                    </table>
                                                </div>
                                            </div>

                                            <!-- Charts View (New) -->
                                            <div id="ops-charts-wrapper" class="d-none" style="min-height: 400px;">
                                                <div class="row g-3">
                                                    <!-- KPI Cards -->
                                                    <div class="col-md-3">
                                                        <div class="card h-100 border-0 shadow-sm text-center p-3">
                                                            <div class="text-muted small text-uppercase">Total Operaciones</div>
                                                            <div class="fs-2 fw-bold text-primary" id="kpi-total-ops">-</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="card h-100 border-0 shadow-sm text-center p-3">
                                                            <div class="text-muted small text-uppercase">Promedio Diario</div>
                                                            <div class="fs-2 fw-bold text-success" id="kpi-avg-daily">-</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                         <div class="card h-100 border-0 shadow-sm text-center p-3">
                                                            <div class="text-muted small text-uppercase">Día Más Activo</div>
                                                            <div class="fs-4 fw-bold text-info" id="kpi-busiest-day">-</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="card h-100 border-0 shadow-sm text-center p-3">
                                                            <div class="text-muted small text-uppercase">Hora Pico (Moda)</div>
                                                            <div class="fs-2 fw-bold text-warning" id="kpi-peak-hour">-</div>
                                                        </div>
                                                    </div>

                                                    <!-- Charts -->
                                                    <div class="col-12">
                                                        <div class="card border-0 shadow-sm">
                                                            <div class="card-header bg-white fw-bold d-flex align-items-center gap-3">
                                                                <span>Uso de Posiciones</span>
                                                                <span class="d-flex gap-2 flex-wrap ms-auto" style="font-size:0.78rem;font-weight:400">
                                                                    <span><span style="display:inline-block;width:12px;height:12px;background:#198754;border-radius:2px"></span> Contacto</span>
                                                                    <span><span style="display:inline-block;width:12px;height:12px;background:#20c997;border-radius:2px"></span> Contacto Intl.</span>
                                                                    <span><span style="display:inline-block;width:12px;height:12px;background:#fd7e14;border-radius:2px"></span> Semicontacto</span>
                                                                    <span><span style="display:inline-block;width:12px;height:12px;background:#0d6efd;border-radius:2px"></span> Remota</span>
                                                                    <span><span style="display:inline-block;width:12px;height:12px;background:#6c757d;border-radius:2px"></span> Hangar</span>
                                                                    <span><span style="display:inline-block;width:12px;height:12px;background:#adb5bd;border-radius:2px"></span> Sin clasificar</span>
                                                                </span>
                                                            </div>
                                                            <div class="card-body" style="overflow-y:auto;max-height:600px;padding-bottom:8px">
                                                                <div id="chart-positions-wrapper" style="position:relative;min-height:350px">
                                                                    <canvas id="chart-positions"></canvas>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-12" id="chart-aircrafts-col">
                                                        <div class="card border-0 shadow-sm">
                                                            <div class="card-header bg-white d-flex align-items-center justify-content-between flex-wrap gap-2">
                                                                <span class="fw-bold">Operaciones por Tipo de Aeronave</span>
                                                                <div class="d-flex align-items-center gap-2">
                                                                    <label for="ac-mov-service-filter" class="text-muted small mb-0">Filtrar por tipo de servicio:</label>
                                                                    <select id="ac-mov-service-filter" class="form-select form-select-sm" style="min-width:190px;">
                                                                        <option value="">Todos los servicios</option>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <div class="card-body">
                                                                <div class="row g-3">
                                                                    <div class="col-md-6">
                                                                        <h6 class="text-primary fw-bold text-center mb-2">&#x1F6EC; Aterrizajes</h6>
                                                                        <div id="chart-arr-body" style="position:relative;min-height:400px;">
                                                                            <canvas id="chart-ac-arrivals"></canvas>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-6">
                                                                        <h6 class="text-success fw-bold text-center mb-2">&#x1F6EB; Despegues</h6>
                                                                        <div id="chart-dep-body" style="position:relative;min-height:400px;">
                                                                            <canvas id="chart-ac-departures"></canvas>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                        </div><!-- /aops-pane-slots -->

                        <!-- ═══ MANIFIESTOS PANE ═══ -->
                        <div class="tab-pane fade" id="aops-pane-manifiestos" role="tabpanel">

                            <!-- ══ BARRA DE FILTROS (compartida entre sub-pestañas) ══ -->
                            <div class="border-bottom" style="background:linear-gradient(135deg,#f8f9ff 0%,#eef1fb 100%);">
                                <!-- Cabecera de filtros -->
                                <div class="px-4 pt-3 pb-1 d-flex align-items-center gap-2">
                                    <i class="fas fa-filter text-primary"></i>
                                    <span class="fw-bold text-primary small text-uppercase" style="letter-spacing:.05em">Filtros de búsqueda</span>
                                    <span class="badge rounded-pill text-bg-primary ms-1 d-none" id="mdb-active-filter-count" title="Filtros activos">0</span>
                                    <div class="ms-auto d-flex gap-2 align-items-center">
                                        <span class="badge px-3 py-2 fw-semibold" id="mdb-record-count" style="background:#1e3a8a;font-size:.8rem;letter-spacing:.03em">— reg.</span>
                                        <button class="btn btn-sm btn-outline-secondary" id="mdb-btn-reload" title="Recargar datos desde la base de datos">
                                            <i class="fas fa-database me-1"></i>Recargar
                                        </button>
                                        <button class="btn btn-sm btn-outline-success" id="mdb-btn-export" title="Exportar a Excel">
                                            <i class="fas fa-file-excel me-1"></i>Excel
                                        </button>
                                    </div>
                                </div>
                                <!-- Fila de filtros -->
                                <div class="px-4 pb-3 pt-1">
                                    <div class="row g-3 align-items-end">

                                        <!-- Año -->
                                        <div class="col-auto">
                                            <label class="d-flex align-items-center gap-1 form-label small fw-semibold mb-1 text-secondary">
                                                <i class="fas fa-calendar-alt text-primary"></i> Año
                                            </label>
                                            <select class="form-select form-select-sm shadow-sm" id="mdb-filter-year" style="width:95px;border-color:#c5cbe8;">
                                                <option value="" selected>Todos</option>
                                                <option value="2025">2025</option>
                                                <option value="2026">2026</option>
                                            </select>
                                        </div>

                                        <!-- Mes -->
                                        <div class="col-auto">
                                            <label class="d-flex align-items-center gap-1 form-label small fw-semibold mb-1 text-secondary">
                                                <i class="fas fa-calendar-day text-primary"></i> Mes
                                            </label>
                                            <select class="form-select form-select-sm shadow-sm" id="mdb-filter-month" style="width:130px;border-color:#c5cbe8;">
                                                <option value="">Todos</option>
                                                <option value="01">Enero</option><option value="02">Febrero</option>
                                                <option value="03">Marzo</option><option value="04">Abril</option>
                                                <option value="05">Mayo</option><option value="06">Junio</option>
                                                <option value="07">Julio</option><option value="08">Agosto</option>
                                                <option value="09">Septiembre</option><option value="10">Octubre</option>
                                                <option value="11">Noviembre</option><option value="12">Diciembre</option>
                                            </select>
                                        </div>

                                        <!-- Separador visual -->
                                        <div class="col-auto d-none d-md-block">
                                            <div style="width:1px;height:38px;background:#d0d5ea;margin-bottom:2px;"></div>
                                        </div>

                                        <!-- Dirección — botones toggle -->
                                        <div class="col-auto">
                                            <label class="d-flex align-items-center gap-1 form-label small fw-semibold mb-1 text-secondary">
                                                <i class="fas fa-arrows-alt-v text-info"></i> Dirección
                                            </label>
                                            <!-- select oculto para mantener compatibilidad con JS -->
                                            <select class="d-none" id="mdb-filter-direction">
                                                <option value="">Todas</option>
                                                <option value="Llegada">Llegada</option>
                                                <option value="Salida">Salida</option>
                                            </select>
                                            <div class="btn-group btn-group-sm shadow-sm" role="group" aria-label="Dirección" id="mdb-dir-btngroup">
                                                <button type="button" class="btn btn-primary mdb-dir-btn" data-val="" title="Ver llegadas y salidas">
                                                    <i class="fas fa-layer-group me-1"></i>Todas
                                                </button>
                                                <button type="button" class="btn btn-outline-primary mdb-dir-btn" data-val="Llegada" title="Solo vuelos de llegada">
                                                    <i class="fas fa-plane-arrival me-1"></i>Llegadas
                                                </button>
                                                <button type="button" class="btn btn-outline-primary mdb-dir-btn" data-val="Salida" title="Solo vuelos de salida">
                                                    <i class="fas fa-plane-departure me-1"></i>Salidas
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Separador visual -->
                                        <div class="col-auto d-none d-md-block">
                                            <div style="width:1px;height:38px;background:#d0d5ea;margin-bottom:2px;"></div>
                                        </div>

                                        <!-- Tipo de Op. — botones toggle -->
                                        <div class="col-auto">
                                            <label class="d-flex align-items-center gap-1 form-label small fw-semibold mb-1 text-secondary">
                                                <i class="fas fa-globe text-success"></i> Tipo de Op.
                                            </label>
                                            <!-- select oculto para mantener compatibilidad con JS -->
                                            <select class="d-none" id="mdb-filter-optype">
                                                <option value="">Todos</option>
                                                <option value="Nacional">Nacional</option>
                                                <option value="Internacional">Internacional</option>
                                            </select>
                                            <div class="btn-group btn-group-sm shadow-sm" role="group" aria-label="Tipo de operación" id="mdb-optype-btngroup">
                                                <button type="button" class="btn btn-success mdb-optype-btn" data-val="" title="Todos los tipos de operación">
                                                    <i class="fas fa-th me-1"></i>Todos
                                                </button>
                                                <button type="button" class="btn btn-outline-success mdb-optype-btn" data-val="Nacional" title="Solo vuelos nacionales">
                                                    <i class="fas fa-flag me-1"></i>Nacional
                                                </button>
                                                <button type="button" class="btn btn-outline-success mdb-optype-btn" data-val="Internacional" title="Solo vuelos internacionales">
                                                    <i class="fas fa-globe-americas me-1"></i>Internacional
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Separador visual -->
                                        <div class="col-auto d-none d-md-block">
                                            <div style="width:1px;height:38px;background:#d0d5ea;margin-bottom:2px;"></div>
                                        </div>

                                        <!-- Aerolínea -->
                                        <div class="col-auto">
                                            <label class="d-flex align-items-center gap-1 form-label small fw-semibold mb-1 text-secondary">
                                                <i class="fas fa-plane text-warning"></i> Aerolínea
                                            </label>
                                            <select class="form-select form-select-sm shadow-sm" id="mdb-filter-airline" style="width:175px;border-color:#c5cbe8;">
                                                <option value="">Todas las aerolíneas</option>
                                            </select>
                                        </div>

                                        <!-- Separador visual -->
                                        <div class="col-auto d-none d-md-block">
                                            <div style="width:1px;height:38px;background:#d0d5ea;margin-bottom:2px;"></div>
                                        </div>

                                        <!-- Acciones -->
                                        <div class="col-auto d-flex gap-2">
                                            <button class="btn btn-primary btn-sm px-3 shadow-sm" id="mdb-btn-apply-filters" title="Aplicar los filtros seleccionados">
                                                <i class="fas fa-search me-1"></i>Aplicar
                                            </button>
                                            <button class="btn btn-outline-secondary btn-sm" id="mdb-btn-clear-filters" title="Limpiar todos los filtros">
                                                <i class="fas fa-times me-1"></i>Limpiar
                                            </button>
                                        </div>

                                    </div>
                                </div>
                            </div>

                            <!-- Script inline para los botones toggle de filtros -->
                            <script>
                            (function() {
                                function setupToggleGroup(groupId, selectId, activeClass, outlineClass) {
                                    const group = document.getElementById(groupId);
                                    const sel   = document.getElementById(selectId);
                                    if (!group || !sel) return;
                                    group.querySelectorAll('button').forEach(btn => {
                                        btn.addEventListener('click', function() {
                                            group.querySelectorAll('button').forEach(b => {
                                                b.className = b.className.replace(activeClass, outlineClass);
                                            });
                                            this.className = this.className.replace(outlineClass, activeClass);
                                            sel.value = this.dataset.val;
                                            updateActiveFilterCount();
                                        });
                                    });
                                }
                                function updateActiveFilterCount() {
                                    const ids = ['mdb-filter-year','mdb-filter-month','mdb-filter-direction','mdb-filter-optype','mdb-filter-airline'];
                                    let count = 0;
                                    ids.forEach(id => { const el = document.getElementById(id); if (el && el.value) count++; });
                                    const badge = document.getElementById('mdb-active-filter-count');
                                    if (!badge) return;
                                    if (count > 0) { badge.textContent = count; badge.classList.remove('d-none'); }
                                    else { badge.classList.add('d-none'); }
                                }
                                function syncToggleGroup(groupId, selectId, activeClass, outlineClass) {
                                    const group = document.getElementById(groupId);
                                    const sel   = document.getElementById(selectId);
                                    if (!group || !sel) return;
                                    group.querySelectorAll('button').forEach(b => {
                                        const isActive = b.dataset.val === sel.value;
                                        if (isActive) { b.className = b.className.replace(outlineClass, activeClass); }
                                        else          { b.className = b.className.replace(activeClass, outlineClass); }
                                    });
                                }

                                document.addEventListener('DOMContentLoaded', function() {
                                    setupToggleGroup('mdb-dir-btngroup',    'mdb-filter-direction', 'btn-primary',   'btn-outline-primary');
                                    setupToggleGroup('mdb-optype-btngroup', 'mdb-filter-optype',    'btn-success',   'btn-outline-success');

                                    // Sincronizar badge al cambiar selects de año/mes/aerolínea
                                    ['mdb-filter-year','mdb-filter-month','mdb-filter-airline'].forEach(id => {
                                        const el = document.getElementById(id);
                                        if (el) el.addEventListener('change', updateActiveFilterCount);
                                    });

                                    // Sincronizar al limpiar filtros (después de que el JS principal limpie los selects)
                                    const clearBtn = document.getElementById('mdb-btn-clear-filters');
                                    if (clearBtn) {
                                        clearBtn.addEventListener('click', function() {
                                            setTimeout(function() {
                                                syncToggleGroup('mdb-dir-btngroup',    'mdb-filter-direction', 'btn-primary',  'btn-outline-primary');
                                                syncToggleGroup('mdb-optype-btngroup', 'mdb-filter-optype',   'btn-success',  'btn-outline-success');
                                                updateActiveFilterCount();
                                            }, 50);
                                        }, true);
                                    }
                                });
                            })();
                            </script>

                            <!-- ══ SUB-PESTAÑAS DE ANÁLISIS ══ -->
                            <div class="px-3 pt-2 pb-0 border-bottom">
                                <ul class="nav nav-tabs border-0" id="mdb-sub-tabs" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active px-3 py-2 small fw-semibold" id="mdb-sub-tab-resumen" data-bs-toggle="tab" data-bs-target="#mdb-sub-resumen" type="button" role="tab">
                                            <i class="fas fa-tachometer-alt me-1 text-primary"></i>Resumen
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link px-3 py-2 small fw-semibold" id="mdb-sub-tab-pasajeros" data-bs-toggle="tab" data-bs-target="#mdb-sub-pasajeros" type="button" role="tab">
                                            <i class="fas fa-users me-1 text-success"></i>Pasajeros
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link px-3 py-2 small fw-semibold" id="mdb-sub-tab-aerolineas" data-bs-toggle="tab" data-bs-target="#mdb-sub-aerolineas" type="button" role="tab">
                                            <i class="fas fa-plane me-1 text-warning"></i>Aerolíneas
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link px-3 py-2 small fw-semibold" id="mdb-sub-tab-rutas" data-bs-toggle="tab" data-bs-target="#mdb-sub-rutas" type="button" role="tab">
                                            <i class="fas fa-route me-1 text-danger"></i>Rutas
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link px-3 py-2 small fw-semibold" id="mdb-sub-tab-equipaje" data-bs-toggle="tab" data-bs-target="#mdb-sub-equipaje" type="button" role="tab">
                                            <i class="fas fa-suitcase me-1 text-secondary"></i>Equipaje
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link px-3 py-2 small fw-semibold" id="mdb-sub-tab-datos" data-bs-toggle="tab" data-bs-target="#mdb-sub-datos" type="button" role="tab">
                                            <i class="fas fa-table me-1 text-info"></i>Datos
                                        </button>
                                    </li>
                                </ul>
                            </div>

                            <div class="tab-content p-3" id="mdb-sub-content">

                                <!-- ══════ SUB-PESTAÑA: RESUMEN ══════ -->
                                <div class="tab-pane fade show active" id="mdb-sub-resumen" role="tabpanel">
                                    <!-- KPIs -->
                                    <div class="row g-3 mb-3">
                                        <div class="col-6 col-md-3">
                                            <div class="card border-0 shadow-sm h-100" style="border-left:4px solid #0d6efd!important">
                                                <div class="card-body py-3 ps-3">
                                                    <div class="text-muted small text-uppercase fw-semibold mb-1"><i class="fas fa-file-alt me-1 text-primary"></i>Manifiestos</div>
                                                    <div class="fs-2 fw-bold text-primary lh-1" id="mdb-kpi-total">—</div>
                                                    <div class="text-muted small mt-1" id="mdb-kpi-total-sub">registros</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-3">
                                            <div class="card border-0 shadow-sm h-100" style="border-left:4px solid #198754!important">
                                                <div class="card-body py-3 ps-3">
                                                    <div class="text-muted small text-uppercase fw-semibold mb-1"><i class="fas fa-users me-1 text-success"></i>Total Pasajeros</div>
                                                    <div class="fs-2 fw-bold text-success lh-1" id="mdb-kpi-pax">—</div>
                                                    <div class="text-muted small mt-1" id="mdb-kpi-pax-sub">—</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-3">
                                            <div class="card border-0 shadow-sm h-100" style="border-left:4px solid #ffc107!important">
                                                <div class="card-body py-3 ps-3">
                                                    <div class="text-muted small text-uppercase fw-semibold mb-1"><i class="fas fa-chart-line me-1 text-warning"></i>Pax Prom./Vuelo</div>
                                                    <div class="fs-2 fw-bold text-warning lh-1" id="mdb-kpi-avg-pax">—</div>
                                                    <div class="text-muted small mt-1">por manifiesto</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-3">
                                            <div class="card border-0 shadow-sm h-100" style="border-left:4px solid #0dcaf0!important">
                                                <div class="card-body py-3 ps-3">
                                                    <div class="text-muted small text-uppercase fw-semibold mb-1"><i class="fas fa-trophy me-1 text-info"></i>Aerolínea Líder</div>
                                                    <div class="fs-6 fw-bold text-info lh-1" id="mdb-kpi-top-airline">—</div>
                                                    <div class="text-muted small mt-1" id="mdb-kpi-top-airline-pax">—</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-3">
                                            <div class="card border-0 shadow-sm h-100" style="border-left:4px solid #d63384!important">
                                                <div class="card-body py-3 ps-3">
                                                    <div class="text-muted small text-uppercase fw-semibold mb-1"><i class="fas fa-plane-arrival me-1" style="color:#d63384"></i>Pax Llegadas</div>
                                                    <div class="fs-2 fw-bold lh-1" id="mdb-kpi-arr-pax" style="color:#d63384">—</div>
                                                    <div class="text-muted small mt-1" id="mdb-kpi-arr-count">—</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-3">
                                            <div class="card border-0 shadow-sm h-100" style="border-left:4px solid #6610f2!important">
                                                <div class="card-body py-3 ps-3">
                                                    <div class="text-muted small text-uppercase fw-semibold mb-1"><i class="fas fa-plane-departure me-1" style="color:#6610f2"></i>Pax Salidas</div>
                                                    <div class="fs-2 fw-bold lh-1" id="mdb-kpi-dep-pax" style="color:#6610f2">—</div>
                                                    <div class="text-muted small mt-1" id="mdb-kpi-dep-count">—</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-3">
                                            <div class="card border-0 shadow-sm h-100" style="border-left:4px solid #fd7e14!important">
                                                <div class="card-body py-3 ps-3">
                                                    <div class="text-muted small text-uppercase fw-semibold mb-1"><i class="fas fa-flag me-1" style="color:#fd7e14"></i>Pax Nacional</div>
                                                    <div class="fs-2 fw-bold lh-1" id="mdb-kpi-dom-pax" style="color:#fd7e14">—</div>
                                                    <div class="text-muted small mt-1" id="mdb-kpi-dom-pct">—</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-3">
                                            <div class="card border-0 shadow-sm h-100" style="border-left:4px solid #20c997!important">
                                                <div class="card-body py-3 ps-3">
                                                    <div class="text-muted small text-uppercase fw-semibold mb-1"><i class="fas fa-globe me-1" style="color:#20c997"></i>Pax Internacional</div>
                                                    <div class="fs-2 fw-bold lh-1" id="mdb-kpi-int-pax" style="color:#20c997">—</div>
                                                    <div class="text-muted small mt-1" id="mdb-kpi-int-pct">—</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Gráficas resumen -->
                                    <div class="row g-3 mb-3">
                                        <div class="col-lg-8">
                                            <div class="card border-0 shadow-sm h-100">
                                                <div class="card-header bg-white border-0 pb-0"><span class="fw-bold small"><i class="fas fa-chart-bar me-2 text-primary"></i>Pasajeros por Mes (Llegadas vs Salidas)</span></div>
                                                <div class="card-body pt-2"><div style="position:relative;height:240px;"><canvas id="mdb-chart-monthly-pax"></canvas></div></div>
                                            </div>
                                        </div>
                                        <div class="col-lg-4">
                                            <div class="card border-0 shadow-sm h-100">
                                                <div class="card-header bg-white border-0 pb-0"><span class="fw-bold small"><i class="fas fa-chart-pie me-2 text-success"></i>Llegadas vs Salidas</span></div>
                                                <div class="card-body pt-2 d-flex align-items-center justify-content-center"><div style="position:relative;height:220px;width:100%;"><canvas id="mdb-chart-dir-donut"></canvas></div></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row g-3">
                                        <div class="col-lg-8">
                                            <div class="card border-0 shadow-sm h-100">
                                                <div class="card-header bg-white border-0 pb-0"><span class="fw-bold small"><i class="fas fa-trophy me-2 text-warning"></i>Top 15 Aerolíneas por Pasajeros</span></div>
                                                <div class="card-body pt-2"><div style="position:relative;min-height:340px;"><canvas id="mdb-chart-airline-pax"></canvas></div></div>
                                            </div>
                                        </div>
                                        <div class="col-lg-4">
                                            <div class="card border-0 shadow-sm h-100">
                                                <div class="card-header bg-white border-0 pb-0"><span class="fw-bold small"><i class="fas fa-globe me-2 text-info"></i>Dom. vs Internacional</span></div>
                                                <div class="card-body pt-2 d-flex align-items-center justify-content-center"><div style="position:relative;height:220px;width:100%;"><canvas id="mdb-chart-optype-donut"></canvas></div></div>
                                            </div>
                                        </div>
                                    </div>
                                </div><!-- /mdb-sub-resumen -->

                                <!-- ══════ SUB-PESTAÑA: PASAJEROS ══════ -->
                                <div class="tab-pane fade" id="mdb-sub-pasajeros" role="tabpanel">
                                    <!-- KPIs pasajeros especiales -->
                                    <div class="row g-3 mb-3">
                                        <div class="col-6 col-md-2">
                                            <div class="card border-0 shadow-sm text-center py-3 h-100" style="border-top:3px solid #0d6efd!important">
                                                <div class="text-muted small text-uppercase fw-semibold mb-1">Pagan TUA</div>
                                                <div class="fs-4 fw-bold text-primary" id="pax-kpi-tua">—</div>
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-2">
                                            <div class="card border-0 shadow-sm text-center py-3 h-100" style="border-top:3px solid #fd7e14!important">
                                                <div class="text-muted small text-uppercase fw-semibold mb-1">Infantes</div>
                                                <div class="fs-4 fw-bold" style="color:#fd7e14" id="pax-kpi-inf">—</div>
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-2">
                                            <div class="card border-0 shadow-sm text-center py-3 h-100" style="border-top:3px solid #20c997!important">
                                                <div class="text-muted small text-uppercase fw-semibold mb-1">Tránsitos</div>
                                                <div class="fs-4 fw-bold" style="color:#20c997" id="pax-kpi-trans">—</div>
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-2">
                                            <div class="card border-0 shadow-sm text-center py-3 h-100" style="border-top:3px solid #0dcaf0!important">
                                                <div class="text-muted small text-uppercase fw-semibold mb-1">Conexiones</div>
                                                <div class="fs-4 fw-bold text-info" id="pax-kpi-conex">—</div>
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-2">
                                            <div class="card border-0 shadow-sm text-center py-3 h-100" style="border-top:3px solid #d63384!important">
                                                <div class="text-muted small text-uppercase fw-semibold mb-1">Diplomáticos</div>
                                                <div class="fs-4 fw-bold" style="color:#d63384" id="pax-kpi-dip">—</div>
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-2">
                                            <div class="card border-0 shadow-sm text-center py-3 h-100" style="border-top:3px solid #6610f2!important">
                                                <div class="text-muted small text-uppercase fw-semibold mb-1">Total Exentos</div>
                                                <div class="fs-4 fw-bold" style="color:#6610f2" id="pax-kpi-exent">—</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row g-3 mb-3">
                                        <div class="col-lg-7">
                                            <div class="card border-0 shadow-sm h-100">
                                                <div class="card-header bg-white border-0 pb-0"><span class="fw-bold small"><i class="fas fa-users-cog me-2 text-secondary"></i>Composición de Pasajeros por Categoría</span></div>
                                                <div class="card-body pt-2"><div style="position:relative;height:280px;"><canvas id="mdb-chart-pax-breakdown"></canvas></div></div>
                                            </div>
                                        </div>
                                        <div class="col-lg-5">
                                            <div class="card border-0 shadow-sm h-100">
                                                <div class="card-header bg-white border-0 pb-0"><span class="fw-bold small"><i class="fas fa-receipt me-2 text-primary"></i>TUA vs Exentos</span></div>
                                                <div class="card-body pt-2 d-flex align-items-center justify-content-center"><div style="position:relative;height:260px;width:100%;"><canvas id="mdb-chart-tua-exent-donut"></canvas></div></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row g-3">
                                        <div class="col-lg-6">
                                            <div class="card border-0 shadow-sm h-100">
                                                <div class="card-header bg-white border-0 pb-0"><span class="fw-bold small"><i class="fas fa-chart-area me-2 text-success"></i>Tendencia Mensual: TUA vs Exentos</span></div>
                                                <div class="card-body pt-2"><div style="position:relative;height:240px;"><canvas id="mdb-chart-tua-monthly"></canvas></div></div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="card border-0 shadow-sm h-100">
                                                <div class="card-header bg-white border-0 pb-0"><span class="fw-bold small"><i class="fas fa-baby me-2 text-warning"></i>Infantes & Tránsitos por Mes</span></div>
                                                <div class="card-body pt-2"><div style="position:relative;height:240px;"><canvas id="mdb-chart-inf-trans-monthly"></canvas></div></div>
                                            </div>
                                        </div>
                                    </div>
                                </div><!-- /mdb-sub-pasajeros -->

                                <!-- ══════ SUB-PESTAÑA: AEROLÍNEAS ══════ -->
                                <div class="tab-pane fade" id="mdb-sub-aerolineas" role="tabpanel">
                                    <div class="row g-3 mb-3">
                                        <div class="col-lg-6">
                                            <div class="card border-0 shadow-sm h-100">
                                                <div class="card-header bg-white border-0 pb-0"><span class="fw-bold small"><i class="fas fa-chart-bar me-2 text-warning"></i>Pasajeros por Aerolínea: Dom. vs Int.</span></div>
                                                <div class="card-body pt-2"><div style="position:relative;min-height:360px;"><canvas id="mdb-chart-airline-domint"></canvas></div></div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="card border-0 shadow-sm h-100">
                                                <div class="card-header bg-white border-0 pb-0"><span class="fw-bold small"><i class="fas fa-chart-line me-2 text-primary"></i>Evolución Mensual Top 5 Aerolíneas</span></div>
                                                <div class="card-body pt-2"><div style="position:relative;height:360px;"><canvas id="mdb-chart-airline-trend"></canvas></div></div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Ranking completo de aerolíneas -->
                                    <div class="card border-0 shadow-sm">
                                        <div class="card-header bg-white border-0 d-flex align-items-center justify-content-between">
                                            <span class="fw-bold small"><i class="fas fa-list-ol me-2 text-primary"></i>Ranking Completo de Aerolíneas</span>
                                            <span class="badge bg-secondary" id="mdb-airline-count-badge">—</span>
                                        </div>
                                        <div class="card-body p-0">
                                            <div class="table-responsive" style="max-height:400px;overflow-y:auto;">
                                                <table class="table table-sm table-hover table-bordered mb-0" id="mdb-table-airline-ranking">
                                                    <thead class="table-light" style="position:sticky;top:0;z-index:1;">
                                                        <tr>
                                                            <th class="text-center">#</th>
                                                            <th>Aerolínea</th>
                                                            <th class="text-end">Vuelos</th>
                                                            <th class="text-end">Pax Total</th>
                                                            <th class="text-end">Pax Prom.</th>
                                                            <th class="text-end">Pax Llegadas</th>
                                                            <th class="text-end">Pax Salidas</th>
                                                            <th class="text-end">% Total</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="mdb-tbody-airline-ranking">
                                                        <tr><td colspan="8" class="text-center text-muted py-4"><div class="spinner-border spinner-border-sm me-2"></div>Cargando...</td></tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div><!-- /mdb-sub-aerolineas -->

                                <!-- ══════ SUB-PESTAÑA: RUTAS ══════ -->
                                <div class="tab-pane fade" id="mdb-sub-rutas" role="tabpanel">
                                    <div class="row g-3 mb-3">
                                        <div class="col-lg-7">
                                            <div class="card border-0 shadow-sm h-100">
                                                <div class="card-header bg-white border-0 pb-0"><span class="fw-bold small"><i class="fas fa-route me-2 text-danger"></i>Top 15 Rutas por Pasajeros</span></div>
                                                <div class="card-body pt-2"><div style="position:relative;min-height:380px;"><canvas id="mdb-chart-routes"></canvas></div></div>
                                            </div>
                                        </div>
                                        <div class="col-lg-5">
                                            <div class="card border-0 shadow-sm h-100">
                                                <div class="card-header bg-white border-0 pb-0"><span class="fw-bold small"><i class="fas fa-chart-pie me-2 text-primary"></i>Dom. vs Int. por Ruta</span></div>
                                                <div class="card-body pt-2 d-flex align-items-center justify-content-center"><div style="position:relative;height:340px;width:100%;"><canvas id="mdb-chart-route-optype"></canvas></div></div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Tabla detalle rutas -->
                                    <div class="card border-0 shadow-sm">
                                        <div class="card-header bg-white border-0 d-flex align-items-center"><span class="fw-bold small"><i class="fas fa-table me-2 text-danger"></i>Detalle por Ruta</span></div>
                                        <div class="card-body p-0">
                                            <div class="table-responsive" style="max-height:360px;overflow-y:auto;">
                                                <table class="table table-sm table-hover table-bordered mb-0">
                                                    <thead class="table-light" style="position:sticky;top:0;z-index:1;">
                                                        <tr>
                                                            <th>#</th><th>Ruta</th>
                                                            <th class="text-end">Vuelos</th>
                                                            <th class="text-end">Pax Total</th>
                                                            <th class="text-end">Pax Prom.</th>
                                                            <th class="text-end">Doméstica</th>
                                                            <th class="text-end">Internacional</th>
                                                            <th class="text-end">% Total</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="mdb-tbody-rutas">
                                                        <tr><td colspan="8" class="text-center py-3 text-muted">Cargando...</td></tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div><!-- /mdb-sub-rutas -->

                                <!-- ══════ SUB-PESTAÑA: EQUIPAJE ══════ -->
                                <div class="tab-pane fade" id="mdb-sub-equipaje" role="tabpanel">
                                    <!-- KPIs equipaje -->
                                    <div class="row g-3 mb-3">
                                        <div class="col-6 col-md-3">
                                            <div class="card border-0 shadow-sm text-center py-3 h-100" style="border-top:3px solid #6c757d!important">
                                                <div class="text-muted small text-uppercase fw-semibold mb-1"><i class="fas fa-suitcase me-1"></i>Total Kgs Equipaje</div>
                                                <div class="fs-3 fw-bold text-secondary" id="kgs-kpi-total">—</div>
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-3">
                                            <div class="card border-0 shadow-sm text-center py-3 h-100" style="border-top:3px solid #0d6efd!important">
                                                <div class="text-muted small text-uppercase fw-semibold mb-1">Kgs Prom./Vuelo</div>
                                                <div class="fs-3 fw-bold text-primary" id="kgs-kpi-avg">—</div>
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-3">
                                            <div class="card border-0 shadow-sm text-center py-3 h-100" style="border-top:3px solid #d63384!important">
                                                <div class="text-muted small text-uppercase fw-semibold mb-1">Kgs Llegadas</div>
                                                <div class="fs-3 fw-bold" style="color:#d63384" id="kgs-kpi-arr">—</div>
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-3">
                                            <div class="card border-0 shadow-sm text-center py-3 h-100" style="border-top:3px solid #6610f2!important">
                                                <div class="text-muted small text-uppercase fw-semibold mb-1">Kgs Salidas</div>
                                                <div class="fs-3 fw-bold" style="color:#6610f2" id="kgs-kpi-dep">—</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row g-3 mb-3">
                                        <div class="col-lg-8">
                                            <div class="card border-0 shadow-sm h-100">
                                                <div class="card-header bg-white border-0 pb-0"><span class="fw-bold small"><i class="fas fa-weight-hanging me-2 text-secondary"></i>Kgs de Equipaje por Mes</span></div>
                                                <div class="card-body pt-2"><div style="position:relative;height:260px;"><canvas id="mdb-chart-kgs-monthly"></canvas></div></div>
                                            </div>
                                        </div>
                                        <div class="col-lg-4">
                                            <div class="card border-0 shadow-sm h-100">
                                                <div class="card-header bg-white border-0 pb-0"><span class="fw-bold small"><i class="fas fa-chart-pie me-2 text-info"></i>Kgs Llegadas vs Salidas</span></div>
                                                <div class="card-body pt-2 d-flex align-items-center justify-content-center"><div style="position:relative;height:240px;width:100%;"><canvas id="mdb-chart-kgs-dir-donut"></canvas></div></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row g-3">
                                        <div class="col-12">
                                            <div class="card border-0 shadow-sm">
                                                <div class="card-header bg-white border-0 pb-0"><span class="fw-bold small"><i class="fas fa-trophy me-2 text-warning"></i>Top 15 Aerolíneas por Kgs de Equipaje</span></div>
                                                <div class="card-body pt-2"><div style="position:relative;min-height:320px;"><canvas id="mdb-chart-kgs-airline"></canvas></div></div>
                                            </div>
                                        </div>
                                    </div>
                                </div><!-- /mdb-sub-equipaje -->

                                <!-- ══════ SUB-PESTAÑA: DATOS ══════ -->
                                <div class="tab-pane fade" id="mdb-sub-datos" role="tabpanel">
                                    <div class="d-flex align-items-center justify-content-between mb-3 flex-wrap gap-2">
                                        <span class="fw-bold small"><i class="fas fa-table me-2 text-success"></i>Base de Datos Completa — Manifiestos 2025</span>
                                        <div class="d-flex gap-2 align-items-center">
                                            <input type="text" class="form-control form-control-sm" id="mdb-search-input" placeholder="Buscar en tabla..." style="width:220px;">
                                        </div>
                                    </div>
                                    <div class="card border-0 shadow-sm">
                                        <div class="card-body p-0">
                                            <div class="table-responsive">
                                                <table class="table table-sm table-striped table-hover table-bordered mb-0 w-100" id="mdb-main-table" style="font-size:0.82rem;">
                                                    <thead class="table-light" id="mdb-main-thead"></thead>
                                                    <tbody id="mdb-main-tbody">
                                                        <tr><td colspan="20" class="text-center py-5 text-muted"><div class="spinner-border spinner-border-sm me-2"></div>Consultando base de datos...</td></tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-center px-3 py-2 border-top bg-light">
                                                <span class="small text-muted" id="mdb-table-info">—</span>
                                                <div class="d-flex gap-1" id="mdb-pagination"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div><!-- /mdb-sub-datos -->

                            </div><!-- /tab-content -->

                            <!-- Loading overlay -->
                            <div id="mdb-overlay" class="d-none" style="position:absolute;inset:0;background:rgba(255,255,255,.85);z-index:20;display:flex!important;align-items:center;justify-content:center;">
                                <div class="text-center">
                                    <div class="spinner-border text-primary mb-2" style="width:3rem;height:3rem;"></div>
                                    <div class="small fw-semibold text-muted" id="mdb-overlay-text">Cargando...</div>
                                </div>
                            </div>
                        </div><!-- /aops-pane-manifiestos -->

                        </div><!-- /aops-main-content tab-content -->
                    </div><!-- /card -->
                </div><!-- /analisis-operaciones-section -->
                    </div>
                </div>

                <div id="operaciones-totales-section" class="content-section active">
                    <div class="card border-0">
                        <div
                            class="card-header bg-transparent d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
                            <div class="d-flex flex-column">
                                <h2 class="section-title mb-2 mb-md-0">Operaciones Totales</h2>
                            </div>

                        </div>
                        <div class="card-body">
                            <ul class="nav nav-tabs mb-3" id="opsTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="ops-resumen-tab" data-bs-toggle="tab"
                                        data-bs-target="#ops-resumen-pane" type="button" role="tab"
                                        aria-controls="ops-resumen-pane" aria-selected="true"><i
                                            class="fas fa-chart-line me-2"></i>Resumen general</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="aviacion-comercial-tab" data-bs-toggle="tab"
                                        data-bs-target="#aviacion-comercial-pane" type="button" role="tab"
                                        aria-controls="aviacion-comercial-pane" aria-selected="false"><i
                                            class="fas fa-plane-up me-2"></i>Aviación comercial</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="aviacion-general-tab" data-bs-toggle="tab"
                                        data-bs-target="#aviacion-general-pane" type="button" role="tab"
                                        aria-controls="aviacion-general-pane" aria-selected="false"><i
                                            class="fas fa-paper-plane me-2"></i>Aviación general</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="aviacion-carga-tab" data-bs-toggle="tab"
                                        data-bs-target="#aviacion-carga-pane" type="button" role="tab"
                                        aria-controls="aviacion-carga-pane" aria-selected="false"><i
                                            class="fas fa-box-open me-2"></i>Aviación de carga</button>
                                </li>
                            </ul>
                            <div class="tab-content pt-3" id="opsTabsContent">
                                <div class="tab-pane fade show active" id="ops-resumen-pane" role="tabpanel"
                                    aria-labelledby="ops-resumen-tab" tabindex="0">
                                    <!-- Toolbar compacta -->
                                    <div class="d-flex flex-wrap align-items-center gap-2 mb-3">
                                        <div id="ops-summary" class="ops-summary-slot me-auto"></div>
                                        <div class="d-flex gap-2 ms-auto">
                                            <button class="btn btn-outline-secondary btn-sm"
                                                id="ops-tooltips-toggle-btn" type="button" aria-pressed="false"
                                                title="Mostrar tooltips siempre visibles">
                                                <i class="fas fa-eye-slash me-1"></i>Tooltips fijos
                                            </button>
                                            <button class="btn btn-outline-secondary btn-sm" data-bs-toggle="modal"
                                                data-bs-target="#opsFiltersModal"><i
                                                    class="fas fa-sliders-h me-1"></i>Configurar
                                                vista</button>
                                            <button class="btn btn-outline-primary btn-sm" id="ops-export-all-btn"
                                                type="button" title="Descargar todas las gráficas en PDF"><i
                                                    class="fas fa-file-pdf me-1"></i>Descargar todas</button>
                                        </div>
                                    </div>

                                    <!-- Modal de Filtros de Operaciones Totales -->
                                    <div class="modal fade" id="opsFiltersModal" tabindex="-1"
                                        aria-labelledby="opsFiltersModalLabel" aria-hidden="true">
                                        <div class="modal-dialog modal-lg modal-dialog-scrollable">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="opsFiltersModalLabel"><i
                                                            class="fas fa-sliders-h me-2"></i>Configurar
                                                        visualización
                                                    </h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                        aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <div class="mb-3">
                                                        <h6 class="text-muted">Visual</h6>
                                                        <div class="d-flex flex-wrap align-items-center gap-3">
                                                            <div class="form-check form-switch m-0"
                                                                title="Comparativo semanal reciente">
                                                                <input class="form-check-input" type="checkbox"
                                                                    id="toggle-weekly-view">
                                                                <label class="form-check-label small"
                                                                    for="toggle-weekly-view">Semanal</label>
                                                            </div>
                                                            <div class="d-flex align-items-center gap-2">
                                                                <div class="form-check form-switch m-0"
                                                                    title="Activa los filtros por meses del año seleccionado">
                                                                    <input class="form-check-input" type="checkbox"
                                                                        id="toggle-monthly-view">
                                                                    <label class="form-check-label small"
                                                                        for="toggle-monthly-view">Mensual</label>
                                                                </div>
                                                                <select id="ops-filter-year"
                                                                    class="form-select form-select-sm d-none"
                                                                    style="width: auto;" aria-label="Año a visualizar">
                                                                    <option value="2022">2022</option>
                                                                    <option value="2023">2023</option>
                                                                    <option value="2024">2024</option>
                                                                    <option value="2025">2025</option>
                                                                    <option value="2026">2026</option>
                                                                </select>
                                                                <span class="badge bg-info text-dark ms-2 d-none"
                                                                    id="years-disabled-hint">Años inactivos</span>
                                                            </div>
                                                            <div class="form-check form-switch m-0"
                                                                title="Vista acumulada por año">
                                                                <input class="form-check-input" type="checkbox"
                                                                    id="toggle-yearly-view">
                                                                <label class="form-check-label small"
                                                                    for="toggle-yearly-view">Anual</label>
                                                            </div>
                                                            <div id="weekly-week-filter"
                                                                class="d-none flex-column gap-2 w-100">
                                                                <div class="d-flex align-items-center gap-2 flex-wrap">
                                                                    <label for="weekly-week-select"
                                                                        id="weekly-week-label"
                                                                        class="small text-muted fw-semibold mb-0"><i
                                                                            class="fas fa-calendar-week me-1"></i>Semana</label>
                                                                    <select id="weekly-week-select"
                                                                        class="form-select form-select-sm d-none"
                                                                        aria-describedby="weekly-week-hint"></select>
                                                                    <span class="small text-muted"
                                                                        id="weekly-week-hint">Selecciona
                                                                        la semana que desees analizar en la lista.</span>
                                                                </div>
                                                                <div id="weekly-week-picker" class="weekly-week-picker"
                                                                    role="listbox" aria-labelledby="weekly-week-label">
                                                                </div>
                                                            </div>
                                                            <div id="weekly-day-filter"
                                                                class="d-none d-flex align-items-center gap-2">
                                                                <label for="weekly-day-select"
                                                                    class="small text-muted fw-semibold mb-0">Día</label>
                                                                <select id="weekly-day-select"
                                                                    class="form-select form-select-sm"
                                                                    aria-label="Seleccionar día de la semana"></select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <h6 class="text-muted">Vistas rápidas</h6>
                                                        <div class="d-flex flex-wrap align-items-center gap-2">
                                                            <button type="button"
                                                                class="btn btn-outline-secondary btn-sm"
                                                                id="preset-ops"><i
                                                                    class="fas fa-tachometer-alt me-1"></i>Operaciones</button>
                                                            <button type="button"
                                                                class="btn btn-outline-secondary btn-sm"
                                                                id="preset-passengers"><i
                                                                    class="fas fa-users me-1"></i>Pasajeros</button>
                                                            <button type="button"
                                                                class="btn btn-outline-secondary btn-sm"
                                                                id="preset-cargo-ton"><i
                                                                    class="fas fa-weight-hanging me-1"></i>Toneladas
                                                                Carga</button>
                                                            <button type="button"
                                                                class="btn btn-outline-secondary btn-sm"
                                                                id="preset-full"><i
                                                                    class="fas fa-layer-group me-1"></i>Completa</button>
                                                        </div>
                                                    </div>
                                                    <div class="row g-3">
                                                        <div class="col-12 col-lg-6">
                                                            <h6 class="text-muted">Secciones</h6>
                                                            <div class="d-flex flex-wrap gap-3"
                                                                id="ops-sections-filters">
                                                                <div class="form-check m-0">
                                                                    <input class="form-check-input" type="checkbox"
                                                                        id="filter-section-comercial" checked>
                                                                    <label class="form-check-label"
                                                                        for="filter-section-comercial">Comercial</label>
                                                                </div>
                                                                <div class="form-check m-0">
                                                                    <input class="form-check-input" type="checkbox"
                                                                        id="filter-section-carga" checked>
                                                                    <label class="form-check-label"
                                                                        for="filter-section-carga">Carga</label>
                                                                </div>
                                                                <div class="form-check m-0">
                                                                    <input class="form-check-input" type="checkbox"
                                                                        id="filter-section-general" checked>
                                                                    <label class="form-check-label"
                                                                        for="filter-section-general">General</label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-12 col-lg-6">
                                                            <h6 class="text-muted">Años <small class="text-muted">(se
                                                                    desactivan en modo mensual)</small></h6>
                                                            <div class="d-flex flex-wrap gap-3" id="ops-years-filters">
                                                                <div class="form-check m-0">
                                                                    <input class="form-check-input" type="checkbox"
                                                                        id="filter-year-2022" data-year="2022" checked>
                                                                    <label class="form-check-label"
                                                                        for="filter-year-2022">2022</label>
                                                                </div>
                                                                <div class="form-check m-0">
                                                                    <input class="form-check-input" type="checkbox"
                                                                        id="filter-year-2023" data-year="2023" checked>
                                                                    <label class="form-check-label"
                                                                        for="filter-year-2023">2023</label>
                                                                </div>
                                                                <div class="form-check m-0">
                                                                    <input class="form-check-input" type="checkbox"
                                                                        id="filter-year-2024" data-year="2024" checked>
                                                                    <label class="form-check-label"
                                                                        for="filter-year-2024">2024</label>
                                                                </div>
                                                                <div class="form-check m-0">
                                                                    <input class="form-check-input" type="checkbox"
                                                                        id="filter-year-2025" data-year="2025" checked>
                                                                    <label class="form-check-label"
                                                                        for="filter-year-2025">2025</label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="mt-4 d-none" id="ops-months-panel">
                                                        <h6 class="text-muted">Meses <span
                                                                id="ops-months-year-label">2025</span>
                                                        </h6>
                                                        <p class="small text-muted mb-2" id="ops-months-year-helper">
                                                            Selecciona los meses que deseas visualizar; las gráficas
                                                            solo mostrarán datos de los meses marcados.</p>
                                                        <div class="d-flex flex-wrap align-items-center gap-2">
                                                            <div class="months-chips d-flex flex-wrap gap-1">
                                                                <label class="chip"><input type="checkbox"
                                                                        data-month="01" checked><span
                                                                        class="chip-text">Ene</span></label>
                                                                <label class="chip"><input type="checkbox"
                                                                        data-month="02" checked><span
                                                                        class="chip-text">Feb</span></label>
                                                                <label class="chip"><input type="checkbox"
                                                                        data-month="03" checked><span
                                                                        class="chip-text">Mar</span></label>
                                                                <label class="chip"><input type="checkbox"
                                                                        data-month="04" checked><span
                                                                        class="chip-text">Abr</span></label>
                                                                <label class="chip"><input type="checkbox"
                                                                        data-month="05" checked><span
                                                                        class="chip-text">May</span></label>
                                                                <label class="chip"><input type="checkbox"
                                                                        data-month="06" checked><span
                                                                        class="chip-text">Jun</span></label>
                                                                <label class="chip"><input type="checkbox"
                                                                        data-month="07" checked><span
                                                                        class="chip-text">Jul</span></label>
                                                                <label class="chip"><input type="checkbox"
                                                                        data-month="08" checked><span
                                                                        class="chip-text">Ago</span></label>
                                                                <label class="chip"><input type="checkbox"
                                                                        data-month="09" checked><span
                                                                        class="chip-text">Sep</span></label>
                                                                <label class="chip"><input type="checkbox"
                                                                        data-month="10" checked><span
                                                                        class="chip-text">Oct</span></label>
                                                                <label class="chip"><input type="checkbox"
                                                                        data-month="11" checked><span
                                                                        class="chip-text">Nov</span></label>
                                                                <label class="chip"><input type="checkbox"
                                                                        data-month="12" checked><span
                                                                        class="chip-text">Dic</span></label>
                                                            </div>
                                                            <div class="ms-auto d-flex gap-2">
                                                                <button class="btn btn-sm btn-outline-secondary"
                                                                    id="months-select-all">Todos</button>
                                                                <button class="btn btn-sm btn-outline-secondary"
                                                                    id="months-select-none">Ninguno</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                        data-bs-dismiss="modal">Cerrar</button>
                                                    <button type="button" class="btn btn-primary"
                                                        data-bs-dismiss="modal">Aplicar</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <h5 class="text-uppercase text-muted fw-bold mb-3" id="commercial-heading"><span
                                            class="section-icon icon-commercial">✈</span>Aviación Comercial</h5>
                                    <div class="row g-3 mb-4" id="commercial-group">
                                        <div class="col-12">
                                            <div class="chart-container ops-chart"><canvas
                                                    id="commercialOpsChart"></canvas>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="chart-container ops-chart"><canvas
                                                    id="commercialPaxChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                    <h5 class="text-uppercase text-muted fw-bold mb-3 mt-4" id="cargo-heading"><span
                                            class="section-icon icon-cargo">⛟</span>Operaciones de Carga</h5>
                                    <div class="update-note d-flex align-items-center mb-2" id="cargo-update-note">
                                        <i class="fas fa-calendar-check me-2" aria-hidden="true"></i>
                                        <small>Datos actualizados al <strong>31 de octubre 2025</strong></small>
                                    </div>
                                    <div class="row g-3 mb-4" id="cargo-group">
                                        <div class="col-12">
                                            <div class="chart-container ops-chart"><canvas id="cargoOpsChart"></canvas>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="chart-container ops-chart"><canvas id="cargoTonsChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                    <h5 class="text-uppercase text-muted fw-bold mb-3 mt-4" id="general-heading">
                                        <span class="section-icon icon-general">🛩</span>Aviación General
                                    </h5>
                                    <div class="row g-3 mb-4" id="general-group">
                                        <div class="col-12">
                                            <div class="chart-container ops-chart"><canvas
                                                    id="generalOpsChart"></canvas></div>
                                        </div>
                                        <div class="col-12">
                                            <div class="chart-container ops-chart"><canvas
                                                    id="generalPaxChart"></canvas></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="aviacion-comercial-pane" role="tabpanel"
                                    aria-labelledby="aviacion-comercial-tab" tabindex="0">
                                    <div class="ag-wrapper">
                                        <div class="row g-3 align-items-stretch" id="ag-controls-row">
                                            <div class="col-12 col-lg-4 col-xxl-3">
                                                <div class="card ag-controls-card h-100">
                                                    <div class="card-body">
                                                        <div
                                                            class="d-flex align-items-center justify-content-between mb-3">
                                                            <div
                                                                class="d-flex align-items-center gap-2 text-uppercase small fw-semibold text-muted">
                                                                <i class="fas fa-sliders-h text-primary"></i>
                                                                <span>Configuración</span>
                                                            </div>
                                                            <button class="btn btn-outline-secondary btn-sm"
                                                                id="ag-reset-btn"><i
                                                                    class="fas fa-rotate-left me-1"></i>Restablecer</button>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="ag-metric-select"
                                                                class="form-label text-uppercase small fw-semibold"><i
                                                                    class="fas fa-chart-column me-1"></i>Indicador</label>
                                                            <select id="ag-metric-select"
                                                                class="form-select form-select-sm"
                                                                aria-label="Seleccionar métrica (agregados)">
                                                                <option value="operaciones" selected>Operaciones
                                                                </option>
                                                                <option value="pasajeros">Pasajeros</option>
                                                            </select>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="ag-view-select"
                                                                class="form-label text-uppercase small fw-semibold"><i
                                                                    class="fas fa-layer-group me-1"></i>Detalle</label>
                                                            <select id="ag-view-select"
                                                                class="form-select form-select-sm"
                                                                aria-label="Seleccionar vista (agregados)">
                                                                <option value="anual" selected>Vista anual</option>
                                                                <option value="mensual">Detalle mensual</option>
                                                            </select>
                                                        </div>
                                                        <div class="mb-3 d-none" id="ag-year-group">
                                                            <label for="ag-year-select"
                                                                class="form-label text-uppercase small fw-semibold"><i
                                                                    class="fas fa-calendar me-1"></i>Año
                                                                base</label>
                                                            <select id="ag-year-select"
                                                                class="form-select form-select-sm"
                                                                aria-label="Seleccionar año (agregados)"></select>
                                                        </div>
                                                        <div class="mb-0 d-none" id="ag-comparison-group">
                                                            <label for="ag-comparison-select"
                                                                class="form-label text-uppercase small fw-semibold"><i
                                                                    class="fas fa-balance-scale me-1"></i>Comparar
                                                                con</label>
                                                            <select id="ag-comparison-select"
                                                                class="form-select form-select-sm"
                                                                aria-label="Seleccionar comparación (agregados)"></select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-lg-8 col-xxl-9">
                                                <div class="card h-100 insight-card--visual" style="background-image: url('images/Analisis_pax.jpg');">
                                                    <div class="card-body">
                                                        <div class="d-flex flex-column gap-3">
                                                            <div>
                                                                <h5 class="mb-1 d-flex align-items-center gap-2">
                                                                    <i class="fas fa-chart-area text-primary"></i>
                                                                    <span>Inteligencia operacional</span>
                                                                </h5>
                                                                <p class="text-muted small mb-0">Explora la
                                                                    evolución de
                                                                    operaciones y pasajeros en aviación comercial
                                                                    con
                                                                    comparativos automáticos y contexto histórico.
                                                                </p>
                                                            </div>
                                                            <ul class="list-unstyled small text-muted mb-0">
                                                                <li class="d-flex align-items-center gap-2"><i
                                                                        class="fas fa-arrow-trend-up text-success"></i><span>Detecta
                                                                        variaciones contra años anteriores en
                                                                        segundos.</span></li>
                                                                <li class="d-flex align-items-center gap-2"><i
                                                                        class="fas fa-calendar-alt text-primary"></i><span>Activa
                                                                        el detalle mensual para un seguimiento
                                                                        puntual.</span></li>
                                                                <li class="d-flex align-items-center gap-2"><i
                                                                        class="fas fa-lightbulb text-warning"></i><span>Recibe
                                                                        hallazgos clave generados
                                                                        automáticamente.</span></li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row g-3">
                                            <div class="col-12">
                                                <div class="row g-3" id="ag-summary-cards"></div>
                                            </div>
                                        </div>
                                        <div class="row g-3 align-items-start">
                                            <div class="col-12 col-xxl-6">
                                                <div class="card h-100">
                                                    <div class="card-body">
                                                        <div
                                                            class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
                                                            <span
                                                                class="badge bg-primary-subtle text-primary fw-semibold"
                                                                id="ag-chart-tag">Vista anual</span>
                                                            <small class="text-muted" id="ag-chart-subtitle"></small>
                                                        </div>
                                                        <div class="chart-container chart-height-420"><canvas
                                                                id="ag-chart"></canvas></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-xxl-6">
                                                <div class="card h-100">
                                                    <div class="card-body">
                                                        <div
                                                            class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
                                                            <span
                                                                class="badge bg-secondary-subtle text-secondary fw-semibold"
                                                                id="ag-table-tag">Variación interanual</span>
                                                            <small class="text-muted" id="ag-table-caption"></small>
                                                        </div>
                                                        <div id="ag-table-wrapper">
                                                            <div class="table-responsive">
                                                                <table class="table table-sm align-middle mb-0"
                                                                    id="ag-data-table">
                                                                    <thead></thead>
                                                                    <tbody></tbody>
                                                                </table>
                                                            </div>
                                                            <div class="ag-table-meta mt-2" id="ag-footnote"></div>
                                                        </div>
                                                        <div class="alert alert-info d-none mt-2 mb-0"
                                                            id="ag-empty-state">
                                                            No hay datos para el periodo seleccionado.
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ag-insights d-none mt-3" id="ag-insights"></div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="aviacion-general-pane" role="tabpanel"
                                    aria-labelledby="aviacion-general-tab" tabindex="0">
                                    <div class="ag-wrapper">
                                        <div class="row g-3 align-items-stretch" id="gen-controls-row">
                                            <div class="col-12 col-lg-4 col-xxl-3">
                                                <div class="card ag-controls-card h-100">
                                                    <div class="card-body">
                                                        <div
                                                            class="d-flex align-items-center justify-content-between mb-3">
                                                            <div
                                                                class="d-flex align-items-center gap-2 text-uppercase small fw-semibold text-muted">
                                                                <i class="fas fa-sliders-h text-primary"></i>
                                                                <span>Configuración</span>
                                                            </div>
                                                            <button class="btn btn-outline-secondary btn-sm"
                                                                id="gen-reset-btn"><i
                                                                    class="fas fa-rotate-left me-1"></i>Restablecer</button>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="gen-metric-select"
                                                                class="form-label text-uppercase small fw-semibold"><i
                                                                    class="fas fa-chart-column me-1"></i>Indicador</label>
                                                            <select id="gen-metric-select"
                                                                class="form-select form-select-sm"
                                                                aria-label="Seleccionar métrica (general)">
                                                                <option value="operaciones" selected>Operaciones
                                                                </option>
                                                                <option value="pasajeros">Pasajeros</option>
                                                            </select>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="gen-view-select"
                                                                class="form-label text-uppercase small fw-semibold"><i
                                                                    class="fas fa-layer-group me-1"></i>Detalle</label>
                                                            <select id="gen-view-select"
                                                                class="form-select form-select-sm"
                                                                aria-label="Seleccionar vista (general)">
                                                                <option value="anual" selected>Vista anual</option>
                                                                <option value="mensual">Detalle mensual</option>
                                                            </select>
                                                        </div>
                                                        <div class="mb-3 d-none" id="gen-year-group">
                                                            <label for="gen-year-select"
                                                                class="form-label text-uppercase small fw-semibold"><i
                                                                    class="fas fa-calendar me-1"></i>Año
                                                                base</label>
                                                            <select id="gen-year-select"
                                                                class="form-select form-select-sm"
                                                                aria-label="Seleccionar año (general)"></select>
                                                        </div>
                                                        <div class="mb-0 d-none" id="gen-comparison-group">
                                                            <label for="gen-comparison-select"
                                                                class="form-label text-uppercase small fw-semibold"><i
                                                                    class="fas fa-balance-scale me-1"></i>Comparar
                                                                con</label>
                                                            <select id="gen-comparison-select"
                                                                class="form-select form-select-sm"
                                                                aria-label="Seleccionar comparación (general)"></select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-lg-8 col-xxl-9">
                                                <div class="card h-100 insight-card--visual" style="background-image: url('images/An%C3%A1lisis_priv.jpg'); background-position: left bottom;">
                                                    <div class="card-body">
                                                        <div class="d-flex flex-column gap-3">
                                                            <div>
                                                                <h5 class="mb-1 d-flex align-items-center gap-2">
                                                                    <i class="fas fa-chart-area text-white"></i>
                                                                    <span class="text-white">Panorama táctico</span>
                                                                </h5>
                                                                <p class="text-white-50 small mb-0">Monitorea el pulso
                                                                    operativo de la aviación general con métricas
                                                                    históricas y comparativos inmediatos.</p>
                                                            </div>
                                                            <ul class="list-unstyled small text-white-50 mb-0">
                                                                <li class="d-flex align-items-center gap-2"><i
                                                                        class="fas fa-compass text-info"></i><span>Identifica
                                                                        variaciones relevantes por temporada.</span>
                                                                </li>
                                                                <li class="d-flex align-items-center gap-2"><i
                                                                        class="fas fa-calendar-alt text-info"></i><span>Activa
                                                                        el detalle mensual para detectar meses
                                                                        pico.</span></li>
                                                                <li class="d-flex align-items-center gap-2"><i
                                                                        class="fas fa-lightbulb text-warning"></i><span>Recibe
                                                                        hallazgos clave calculados
                                                                        automáticamente.</span></li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row g-3">
                                            <div class="col-12">
                                                <div class="row g-3" id="gen-summary-cards"></div>
                                            </div>
                                        </div>
                                        <div class="row g-3 align-items-start">
                                            <div class="col-12 col-xxl-6">
                                                <div class="card h-100">
                                                    <div class="card-body">
                                                        <div
                                                            class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
                                                            <span
                                                                class="badge bg-primary-subtle text-primary fw-semibold"
                                                                id="gen-chart-tag">Vista anual</span>
                                                            <small class="text-muted" id="gen-chart-subtitle"></small>
                                                        </div>
                                                        <div class="chart-container chart-height-420"><canvas
                                                                id="gen-chart"></canvas></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-xxl-6">
                                                <div class="card h-100">
                                                    <div class="card-body">
                                                        <div
                                                            class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
                                                            <span
                                                                class="badge bg-secondary-subtle text-secondary fw-semibold"
                                                                id="gen-table-tag">Variación interanual</span>
                                                            <small class="text-muted" id="gen-table-caption"></small>
                                                        </div>
                                                        <div id="gen-table-wrapper">
                                                            <div class="table-responsive">
                                                                <table class="table table-sm align-middle mb-0"
                                                                    id="gen-data-table">
                                                                    <thead></thead>
                                                                    <tbody></tbody>
                                                                </table>
                                                            </div>
                                                            <div class="ag-table-meta mt-2" id="gen-footnote"></div>
                                                        </div>
                                                        <div class="alert alert-info d-none mt-2 mb-0"
                                                            id="gen-empty-state">
                                                            No hay datos para el periodo seleccionado.
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ag-insights d-none mt-3" id="gen-insights"></div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="aviacion-carga-pane" role="tabpanel"
                                    aria-labelledby="aviacion-carga-tab" tabindex="0">
                                    <div class="ag-wrapper">
                                        <div class="row g-3 align-items-stretch" id="cargo-controls-row">
                                            <div class="col-12 col-lg-4 col-xxl-3">
                                                <div class="card ag-controls-card h-100">
                                                    <div class="card-body">
                                                        <div
                                                            class="d-flex align-items-center justify-content-between mb-3">
                                                            <div
                                                                class="d-flex align-items-center gap-2 text-uppercase small fw-semibold text-muted">
                                                                <i class="fas fa-sliders-h text-primary"></i>
                                                                <span>Configuración</span>
                                                            </div>
                                                            <button class="btn btn-outline-secondary btn-sm"
                                                                id="cargo-reset-btn"><i
                                                                    class="fas fa-rotate-left me-1"></i>Restablecer</button>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="cargo-metric-select"
                                                                class="form-label text-uppercase small fw-semibold"><i
                                                                    class="fas fa-chart-column me-1"></i>Indicador</label>
                                                            <select id="cargo-metric-select"
                                                                class="form-select form-select-sm"
                                                                aria-label="Seleccionar métrica (carga)">
                                                                <option value="operaciones" selected>Operaciones
                                                                </option>
                                                                <option value="tons_transportadas">Toneladas
                                                                    transportadas</option>
                                                            </select>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="cargo-view-select"
                                                                class="form-label text-uppercase small fw-semibold"><i
                                                                    class="fas fa-layer-group me-1"></i>Detalle</label>
                                                            <select id="cargo-view-select"
                                                                class="form-select form-select-sm"
                                                                aria-label="Seleccionar vista (carga)">
                                                                <option value="anual" selected>Vista anual</option>
                                                                <option value="mensual">Detalle mensual</option>
                                                            </select>
                                                        </div>
                                                        <div class="mb-3 d-none" id="cargo-year-group">
                                                            <label for="cargo-year-select"
                                                                class="form-label text-uppercase small fw-semibold"><i
                                                                    class="fas fa-calendar me-1"></i>Año
                                                                base</label>
                                                            <select id="cargo-year-select"
                                                                class="form-select form-select-sm"
                                                                aria-label="Seleccionar año (carga)"></select>
                                                        </div>
                                                        <div class="mb-0 d-none" id="cargo-comparison-group">
                                                            <label for="cargo-comparison-select"
                                                                class="form-label text-uppercase small fw-semibold"><i
                                                                    class="fas fa-balance-scale me-1"></i>Comparar
                                                                con</label>
                                                            <select id="cargo-comparison-select"
                                                                class="form-select form-select-sm"
                                                                aria-label="Seleccionar comparación (carga)"></select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-lg-8 col-xxl-9">
                                                <div class="card h-100 insight-card--visual" style="background-image: url('images/An%C3%A1lisis_carga.jpg');">
                                                    <div class="card-body">
                                                        <div class="d-flex flex-column gap-3">
                                                            <div>
                                                                <h5 class="mb-1 d-flex align-items-center gap-2">
                                                                    <i class="fas fa-chart-area text-primary"></i>
                                                                    <span>Visión logística</span>
                                                                </h5>
                                                                <p class="text-muted small mb-0">Supervisa el
                                                                    desempeño
                                                                    de la aviación de carga con comparativos
                                                                    históricos
                                                                    de operaciones y toneladas transportadas.</p>
                                                            </div>
                                                            <ul class="list-unstyled small text-muted mb-0">
                                                                <li class="d-flex align-items-center gap-2"><i
                                                                        class="fas fa-dolly text-primary"></i><span>Evalúa
                                                                        la tracción mensual y acumulada de las
                                                                        operaciones de carga.</span></li>
                                                                <li class="d-flex align-items-center gap-2"><i
                                                                        class="fas fa-weight-hanging text-secondary"></i><span>Contrasta
                                                                        las toneladas transportadas contra periodos
                                                                        previos.</span></li>
                                                                <li class="d-flex align-items-center gap-2"><i
                                                                        class="fas fa-lightbulb text-warning"></i><span>Obtén
                                                                        hallazgos clave generados
                                                                        automáticamente.</span></li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row g-3">
                                            <div class="col-12">
                                                <div class="row g-3" id="cargo-summary-cards"></div>
                                            </div>
                                        </div>
                                        <div class="row g-3 align-items-start">
                                            <div class="col-12 col-xxl-6">
                                                <div class="card h-100">
                                                    <div class="card-body">
                                                        <div
                                                            class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
                                                            <span
                                                                class="badge bg-primary-subtle text-primary fw-semibold"
                                                                id="cargo-chart-tag">Vista anual</span>
                                                            <small class="text-muted" id="cargo-chart-subtitle"></small>
                                                        </div>
                                                        <div class="chart-container chart-height-420"><canvas
                                                                id="cargo-chart"></canvas></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-xxl-6">
                                                <div class="card h-100">
                                                    <div class="card-body">
                                                        <div
                                                            class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
                                                            <span
                                                                class="badge bg-secondary-subtle text-secondary fw-semibold"
                                                                id="cargo-table-tag">Variación interanual</span>
                                                            <small class="text-muted" id="cargo-table-caption"></small>
                                                        </div>
                                                        <div id="cargo-table-wrapper">
                                                            <div class="table-responsive">
                                                                <table class="table table-sm align-middle mb-0"
                                                                    id="cargo-data-table">
                                                                    <thead></thead>
                                                                    <tbody></tbody>
                                                                </table>
                                                            </div>
                                                            <div class="ag-table-meta mt-2" id="cargo-footnote">
                                                            </div>
                                                        </div>
                                                        <div class="alert alert-info d-none mt-2 mb-0"
                                                            id="cargo-empty-state">
                                                            No hay datos para el periodo seleccionado.
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ag-insights d-none mt-3" id="cargo-insights"></div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- Frecuencias de la semana (tabbed PDFs) -->
                <div id="frecuencias-semana-section" class="content-section">
                    <div class="card border-0">
                        <div
                            class="card-header bg-transparent d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">

                            <div class="small text-muted">Documentos oficiales (PDF)</div>
                        </div>
                        <div class="card-body pdf-container">
                            <ul class="nav nav-tabs" id="frecuenciasTab" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="frecuencias-auto-tab" data-bs-toggle="tab"
                                        data-bs-target="#frecuencias-auto-pane" type="button" role="tab"
                                        aria-controls="frecuencias-auto-pane" aria-selected="true">Frecuencias
                                        Nacionales</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="frecuencias-auto-int-tab" data-bs-toggle="tab"
                                        data-bs-target="#frecuencias-auto-int-pane" type="button" role="tab"
                                        aria-controls="frecuencias-auto-int-pane" aria-selected="false">Frecuencias
                                        Internacionales</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="frecuencias-cargo-tab" data-bs-toggle="tab"
                                        data-bs-target="#frecuencias-cargo-pane" type="button" role="tab"
                                        aria-controls="frecuencias-cargo-pane" aria-selected="false">Frecuencias
                                        Carga</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="frecuencias-upload-tab" data-bs-toggle="tab"
                                        data-bs-target="#frecuencias-upload-pane" type="button" role="tab"
                                        aria-controls="frecuencias-upload-pane" aria-selected="false">Subir Archivos</button>
                                </li>
                            </ul>
                            <div class="tab-content pt-3" id="frecuenciasTabContent">
                                <div class="tab-pane fade show active" id="frecuencias-auto-pane" role="tabpanel"
                                    aria-labelledby="frecuencias-auto-tab" tabindex="0">
                                    <div class="frecuencias-auto-wrapper" data-module="frecuencias-auto">


                                        <div id="frecuencias-error" class="alert alert-danger d-none" role="alert">
                                        </div>
                                        <div id="frecuencias-loading" class="frecuencias-loading-state" role="status"
                                            aria-live="polite">
                                            <div class="spinner-border text-primary" role="presentation"></div>
                                            <div>
                                                <strong>Cargando frecuencias...</strong>
                                                <p class="mb-0 small text-muted">Si tarda demasiado, verifica que el
                                                    servidor local esté en ejecución para permitir la lectura de
                                                    archivos JSON.</p>
                                            </div>
                                        </div>
                                        <div id="frecuencias-content" class="frecuencias-auto-content d-none">
                                            <div class="frecuencias-meta card shadow-sm mb-3">
                                                <div
                                                    class="card-body d-flex flex-column flex-md-row justify-content-between gap-3">
                                                    <div>
                                                        <div class="text-uppercase text-muted fw-semibold small">
                                                            Frecuencias semanales de:</div>
                                                        <div class="fw-bold fs-5 text-primary" data-week-range>—
                                                        </div>
                                                    </div>
                                                    <div class="text-md-end">
                                                        <div class="text-uppercase text-muted fw-semibold small">
                                                            Última
                                                            referencia</div>
                                                        <div class="fw-semibold" data-last-updated>—</div>
                                                        <small class="text-muted">Origen: Direcc. Operaciones
                                                            AIFA</small>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row g-3 mb-4">
                                                <div class="col-12 transition-all" id="frecuencias-map-col">
                                                    <div class="card shadow-sm h-100">
                                                        <div
                                                            class="card-header d-flex align-items-center justify-content-between">
                                                            <div>
                                                                <h3 class="section-subheading mb-0">Mapa interactivo
                                                                </h3>
                                                                <small class="text-muted">Tamaño del marcador
                                                                    proporcional a los frecuencias
                                                                    semanales.</small>
                                                            </div>




                                                            <button class="btn btn-outline-primary btn-sm"
                                                                id="frecuencias-fit-map"><i
                                                                    class="fas fa-expand me-1"></i>Enfocar
                                                                país</button>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="frecuencias-map-shell">
                                                                <div id="frecuencias-map" class="frecuencias-map"
                                                                    role="img"
                                                                    aria-label="Mapa de frecuencias semanales">
                                                                </div>
                                                                <div id="frecuencias-map-empty"
                                                                    class="frecuencias-map-empty d-none">Sin
                                                                    destinos
                                                                    para mostrar con los filtros actuales.</div>
                                                            </div>
                                                            <p class="small text-muted mb-0 mt-2">Haz clic en un
                                                                destino
                                                                para ver detalles.</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-12 col-lg-5 d-none" id="frecuencias-details-col">
                                                    <div class="card shadow-sm h-100">
                                                        <div
                                                            class="card-header bg-light d-flex justify-content-between align-items-center">
                                                            <div class="d-flex align-items-center gap-2">
                                                                <h5 class="mb-0 text-primary" id="frecuencias-details-title">
                                                                    Detalles
                                                                </h5>
                                                                <button class="btn btn-sm btn-outline-success" id="frecuencias-copy-whatsapp" title="Copiar para WhatsApp">
                                                                    <i class="fab fa-whatsapp me-1"></i> Copiar
                                                                </button>
                                                            </div>
                                                            <button type="button" class="btn-close"
                                                                aria-label="Cerrar detalles"
                                                                id="frecuencias-details-close"></button>
                                                        </div>
                                                        <div class="card-body p-0">
                                                            <div id="frecuencias-details-body"
                                                                class="list-group list-group-flush">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row g-3 frecuencias-kpi-row mb-4">
                                                <div class="col-12 col-md-4">
                                                    <div class="frecuencia-kpi-card h-100">
                                                        <span class="kpi-label">Frecuencias programadas</span>
                                                        <span class="kpi-value" data-kpi="flights">—</span>
                                                        <small class="text-muted" data-kpi-note="flights">Conteo
                                                            semanal
                                                            por aerolínea</small>
                                                    </div>
                                                </div>
                                                <div class="col-12 col-md-4">
                                                    <div class="frecuencia-kpi-card h-100">
                                                        <span class="kpi-label">Destinos atendidos</span>
                                                        <span class="kpi-value" data-kpi="destinations">—</span>
                                                        <small class="text-muted" data-kpi-note="destinations">Cobertura
                                                            nacional</small>
                                                    </div>
                                                </div>
                                                <div class="col-12 col-md-4">
                                                    <div class="frecuencia-kpi-card h-100">
                                                        <span class="kpi-label">Aerolíneas operando</span>
                                                        <span class="kpi-value" data-kpi="airlines">—</span>
                                                        <small class="text-muted" data-kpi-note="airlines">Incluye
                                                            pax y
                                                            carga</small>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="card shadow-sm mb-4">
                                                <div class="card-body">
                                                    <div class="row g-3 align-items-end">
                                                        <div class="col-12 col-lg-3">
                                                            <label for="frecuencias-airline-filter"
                                                                class="form-label small text-uppercase text-muted">Filtrar
                                                                por aerolínea</label>
                                                            <select id="frecuencias-airline-filter"
                                                                class="form-select form-select-sm"
                                                                aria-label="Filtrar frecuencias por aerolínea"></select>
                                                        </div>
                                                        <div class="col-12 col-lg-3">
                                                            <label for="frecuencias-destination-filter"
                                                                class="form-label small text-uppercase text-muted">Filtrar
                                                                por destino</label>
                                                            <select id="frecuencias-destination-filter"
                                                                class="form-select form-select-sm"
                                                                aria-label="Filtrar frecuencias por destino"></select>
                                                        </div>
                                                        <div class="col-12 col-lg-3">
                                                            <label for="frecuencias-day-filter"
                                                                class="form-label small text-uppercase text-muted">Día
                                                                con operación</label>
                                                            <select id="frecuencias-day-filter"
                                                                class="form-select form-select-sm"
                                                                aria-label="Filtrar frecuencias por día"></select>
                                                        </div>
                                                        <div class="col-12 col-lg-3">
                                                            <label for="frecuencias-search"
                                                                class="form-label small text-uppercase text-muted">Buscar</label>
                                                            <input type="search" id="frecuencias-search"
                                                                class="form-control form-control-sm"
                                                                placeholder="Ciudad, estado o aerolínea">
                                                        </div>
                                                    </div>
                                                    <div class="d-flex flex-wrap align-items-center gap-2 mt-3">
                                                        <button class="btn btn-outline-secondary btn-sm"
                                                            id="frecuencias-reset-filters"><i
                                                                class="fas fa-eraser me-1"></i>Limpiar
                                                            filtros</button>
                                                        <button class="btn btn-outline-success btn-sm"
                                                            id="frecuencias-download-excel"><i
                                                                class="fas fa-file-excel me-1"></i>Descargar Excel</button>
                                                        <span class="small text-muted"
                                                            id="frecuencias-active-filters">Mostrando
                                                            todos los
                                                            destinos.</span>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row g-3 mb-4">
                                                <div class="col-12">
                                                    <div class="card shadow-sm h-100">
                                                        <div class="card-header">
                                                            <h3 class="section-subheading mb-0">Distribución semanal
                                                            </h3>
                                                        </div>
                                                        <div class="card-body">
                                                            <div id="frecuencias-dow-list" class="frecuencias-dow-list">
                                                            </div>
                                                            <div id="frecuencias-insights"
                                                                class="frecuencias-insights mt-3">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="card shadow-sm mt-4">
                                                <div
                                                    class="card-header d-flex flex-column flex-lg-row align-items-lg-center justify-content-between gap-2">
                                                    <div>
                                                        <h3 class="section-subheading mb-0">Tabla por destino y
                                                            aerolínea</h3>
                                                        <small class="text-muted">Frecuencias expresadas por
                                                            día.</small>
                                                    </div>
                                                    <span class="badge bg-secondary-subtle text-secondary"
                                                        id="frecuencias-table-count">— destinos listados</span>
                                                </div>
                                                <div class="table-responsive">
                                                    <table class="table table-hover table-bordered align-middle"
                                                        id="frecuencias-destinos-table">
                                                        <thead>
                                                            <tr>
                                                                <th scope="col">Id de ruta</th>
                                                                <th scope="col">Destino</th>
                                                                <th scope="col">Aerolínea</th>
                                                                <th scope="col">Lun</th>
                                                                <th scope="col">Mar</th>
                                                                <th scope="col">Mie</th>
                                                                <th scope="col">Jue</th>
                                                                <th scope="col">Vie</th>
                                                                <th scope="col">Sab</th>
                                                                <th scope="col">Dom</th>
                                                                <th scope="col">Total</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody></tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="frecuencias-auto-int-pane" role="tabpanel"
                                    aria-labelledby="frecuencias-auto-int-tab" tabindex="0">
                                    <div class="frecuencias-auto-wrapper" data-module="frecuencias-auto-int">

                                        <div id="frecuencias-int-error" class="alert alert-danger d-none" role="alert">
                                        </div>
                                        <div id="frecuencias-int-loading" class="frecuencias-loading-state"
                                            role="status" aria-live="polite">
                                            <div class="spinner-border text-primary" role="presentation"></div>
                                            <div>
                                                <strong>Cargando frecuencias internacionales...</strong>
                                                <p class="mb-0 small text-muted">Asegúrese de haber cargado datos en
                                                    el
                                                    panel de Gestión.</p>
                                            </div>
                                        </div>
                                        <div id="frecuencias-int-content" class="frecuencias-auto-content d-none">
                                            <div class="frecuencias-meta card shadow-sm mb-3">
                                                <div
                                                    class="card-body d-flex flex-column flex-md-row justify-content-between gap-3">
                                                    <div>
                                                        <div class="text-uppercase text-muted fw-semibold small">
                                                            Frecuencias semanales de:</div>
                                                        <div class="fw-bold fs-5 text-primary" data-week-range>—
                                                        </div>
                                                    </div>
                                                    <div class="text-md-end">
                                                        <div class="text-uppercase text-muted fw-semibold small">
                                                            Última
                                                            referencia</div>
                                                        <div class="fw-semibold" data-last-updated>—</div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row g-3 mb-4">
                                                <div class="col-12 transition-all" id="frecuencias-int-map-col">
                                                    <div class="card shadow-sm h-100">
                                                        <div
                                                            class="card-header d-flex align-items-center justify-content-between">
                                                            <div>
                                                                <h3 class="section-subheading mb-0">Mapa interactivo
                                                                    Internacional</h3>
                                                                <small class="text-muted">Tamaño del marcador
                                                                    proporcional a los frecuencias
                                                                    semanales.</small>
                                                            </div>
                                                            <button class="btn btn-outline-primary btn-sm"
                                                                id="frecuencias-int-fit-map"><i
                                                                    class="fas fa-globe-americas me-1"></i>Vista
                                                                Global</button>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="frecuencias-map-shell">
                                                                <div id="frecuencias-int-map" class="frecuencias-map"
                                                                    role="img"
                                                                    aria-label="Mapa de frecuencias internacionales">
                                                                </div>
                                                                <div id="frecuencias-int-map-empty"
                                                                    class="frecuencias-map-empty d-none">Sin
                                                                    destinos
                                                                    para mostrar.</div>
                                                            </div>
                                                            <p class="small text-muted mb-0 mt-2">Haz clic en un
                                                                destino
                                                                para ver detalles.</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-12 col-lg-5 d-none" id="frecuencias-int-details-col">
                                                    <div class="card shadow-sm h-100">
                                                        <div
                                                            class="card-header bg-light d-flex justify-content-between align-items-center">
                                                            <h5 class="mb-0 text-primary"
                                                                id="frecuencias-int-details-title">
                                                                Detalles</h5>
                                                            <button type="button" class="btn-close"
                                                                aria-label="Cerrar detalles"
                                                                id="frecuencias-int-details-close"></button>
                                                        </div>
                                                        <div class="card-body p-0 overflow-auto"
                                                            style="max-height: 500px;">
                                                            <div id="frecuencias-int-details-body"
                                                                class="list-group list-group-flush"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row g-3 frecuencias-kpi-row mb-4">
                                                <div class="col-12 col-md-4">
                                                    <div class="frecuencia-kpi-card h-100">
                                                        <span class="kpi-label">Frecuencias programadas</span>
                                                        <span class="kpi-value" data-kpi="flights">—</span>
                                                        <small class="text-muted" data-kpi-note="flights">Conteo
                                                            semanal</small>
                                                    </div>
                                                </div>
                                                <div class="col-12 col-md-4">
                                                    <div class="frecuencia-kpi-card h-100">
                                                        <span class="kpi-label">Destinos Int.</span>
                                                        <span class="kpi-value" data-kpi="destinations">—</span>
                                                        <small class="text-muted" data-kpi-note="destinations">Cobertura
                                                            global</small>
                                                    </div>
                                                </div>
                                                <div class="col-12 col-md-4">
                                                    <div class="frecuencia-kpi-card h-100">
                                                        <span class="kpi-label">Aerolíneas operando</span>
                                                        <span class="kpi-value" data-kpi="airlines">—</span>
                                                        <small class="text-muted" data-kpi-note="airlines">Incluye
                                                            pax y
                                                            carga</small>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="card shadow-sm mb-4">
                                                <div class="card-body">
                                                    <div class="row g-3 align-items-end">
                                                        <div class="col-12 col-lg-3">
                                                            <label for="frecuencias-int-airline-filter"
                                                                class="form-label small text-uppercase text-muted">Filtrar
                                                                por aerolínea</label>
                                                            <select id="frecuencias-int-airline-filter"
                                                                class="form-select form-select-sm"
                                                                aria-label="Filtrar por aerolínea"></select>
                                                        </div>
                                                        <div class="col-12 col-lg-3">
                                                            <label for="frecuencias-int-destination-filter"
                                                                class="form-label small text-uppercase text-muted">Filtrar
                                                                por región</label>
                                                            <select id="frecuencias-int-destination-filter"
                                                                class="form-select form-select-sm"
                                                                aria-label="Filtrar por región"></select>
                                                        </div>
                                                        <div class="col-12 col-lg-3">
                                                            <label for="frecuencias-int-search"
                                                                class="form-label small text-uppercase text-muted">Buscar</label>
                                                            <input type="search" id="frecuencias-int-search"
                                                                class="form-control form-control-sm"
                                                                placeholder="Ciudad, país o aerolínea">
                                                        </div>
                                                        <div class="col-12 col-lg-3 d-flex gap-2">
                                                            <button class="btn btn-outline-secondary btn-sm flex-fill"
                                                                id="frecuencias-int-reset-filters"><i
                                                                    class="fas fa-eraser me-1"></i>Limpiar</button>
                                                            <button class="btn btn-outline-success btn-sm flex-fill"
                                                                id="frecuencias-int-download-excel"><i
                                                                    class="fas fa-file-excel me-1"></i>Excel</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row g-3 mb-4">
                                                <div class="col-12">
                                                    <div class="card shadow-sm h-100">
                                                        <div class="card-header">
                                                            <h3 class="section-subheading mb-0">Distribución semanal
                                                            </h3>
                                                        </div>
                                                        <div class="card-body">
                                                            <div id="frecuencias-int-dow-list"
                                                                class="frecuencias-dow-list">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="card shadow-sm mt-4">
                                                <div
                                                    class="card-header d-flex flex-column flex-lg-row align-items-lg-center justify-content-between gap-2">
                                                    <div>
                                                        <h3 class="section-subheading mb-0">Tabla por destino y
                                                            aerolínea</h3>
                                                        <small class="text-muted">Frecuencias expresadas por
                                                            día.</small>
                                                    </div>
                                                    <span class="badge bg-secondary-subtle text-secondary"
                                                        id="frecuencias-int-table-count">— destinos listados</span>
                                                </div>
                                                <div class="table-responsive">
                                                    <table class="table table-hover table-bordered align-middle"
                                                        id="frecuencias-int-destinos-table">
                                                        <thead>
                                                            <tr>
                                                                <th scope="col">Id de ruta</th>
                                                                <th scope="col">Destino (País)</th>
                                                                <th scope="col">Aerolínea</th>
                                                                <th scope="col">Lun</th>
                                                                <th scope="col">Mar</th>
                                                                <th scope="col">Mie</th>
                                                                <th scope="col">Jue</th>
                                                                <th scope="col">Vie</th>
                                                                <th scope="col">Sab</th>
                                                                <th scope="col">Dom</th>
                                                                <th scope="col">Total</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody></tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- CARGO PANE -->
                                <div class="tab-pane fade" id="frecuencias-cargo-pane" role="tabpanel"
                                    aria-labelledby="frecuencias-cargo-tab" tabindex="0">
                                    <div class="frecuencias-auto-wrapper" data-module="frecuencias-auto-cargo">

                                        <div id="frecuencias-cargo-error" class="alert alert-danger d-none" role="alert">
                                        </div>
                                        <div id="frecuencias-cargo-loading" class="frecuencias-loading-state"
                                            role="status" aria-live="polite">
                                            <div class="spinner-border text-primary" role="presentation"></div>
                                            <div>
                                                <strong>Cargando frecuencias de carga...</strong>
                                                <p class="mb-0 small text-muted">Asegúrese de haber cargado datos en
                                                    el
                                                    panel de Gestión.</p>
                                            </div>
                                        </div>
                                        <div id="frecuencias-cargo-content" class="frecuencias-auto-content d-none">
                                            <div class="frecuencias-meta card shadow-sm mb-3">
                                                <div
                                                    class="card-body d-flex flex-column flex-md-row justify-content-between gap-3">
                                                    <div>
                                                        <div class="text-uppercase text-muted fw-semibold small">
                                                            Frecuencias semanales de:</div>
                                                        <div class="fw-bold fs-5 text-primary" data-week-range>—
                                                        </div>
                                                    </div>
                                                    <div class="text-md-end">
                                                        <div class="text-uppercase text-muted fw-semibold small">
                                                            Última
                                                            referencia</div>
                                                        <div class="fw-semibold" data-last-updated>—</div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row g-3 mb-4">
                                                <div class="col-12 transition-all" id="frecuencias-cargo-map-col">
                                                    <div class="card shadow-sm h-100">
                                                        <div
                                                            class="card-header d-flex align-items-center justify-content-between">
                                                            <div>
                                                                <h3 class="section-subheading mb-0">Mapa interactivo
                                                                    Carga</h3>
                                                                <small class="text-muted">Tamaño del marcador
                                                                    proporcional a las frecuencias
                                                                    semanales.</small>
                                                            </div>
                                                            <button class="btn btn-outline-primary btn-sm"
                                                                id="frecuencias-cargo-fit-map"><i
                                                                    class="fas fa-globe-americas me-1"></i>Vista
                                                                Global</button>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="frecuencias-map-shell">
                                                                <div id="frecuencias-cargo-map" class="frecuencias-map"
                                                                    role="img"
                                                                    aria-label="Mapa de frecuencias de carga">
                                                                </div>
                                                                <div id="frecuencias-cargo-map-empty"
                                                                    class="frecuencias-map-empty d-none">Sin
                                                                    destinos
                                                                    para mostrar.</div>
                                                            </div>
                                                            <p class="small text-muted mb-0 mt-2">Haz clic en un
                                                                destino
                                                                para ver detalles.</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-12 col-lg-5 d-none" id="frecuencias-cargo-details-col">
                                                    <div class="card shadow-sm h-100">
                                                        <div
                                                            class="card-header bg-light d-flex justify-content-between align-items-center">
                                                            <div class="d-flex align-items-center gap-2">
                                                                <h5 class="mb-0 text-primary" id="frecuencias-cargo-details-title">
                                                                    Detalles
                                                                </h5>
                                                                <button class="btn btn-sm btn-outline-success" id="frecuencias-cargo-copy-whatsapp" title="Copiar para WhatsApp">
                                                                    <i class="fab fa-whatsapp me-1"></i> Copiar
                                                                </button>
                                                            </div>
                                                            <button type="button" class="btn-close"
                                                                aria-label="Cerrar detalles"
                                                                id="frecuencias-cargo-details-close"></button>
                                                        </div>
                                                        <div class="card-body p-0 overflow-auto">
                                                            <div id="frecuencias-cargo-details-body"
                                                                class="list-group list-group-flush"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row g-3 frecuencias-kpi-row mb-4">
                                                <div class="col-12 col-md-4">
                                                    <div class="frecuencia-kpi-card h-100">
                                                        <span class="kpi-label">Frecuencias programadas</span>
                                                        <span class="kpi-value" data-kpi="flights">—</span>
                                                        <small class="text-muted" data-kpi-note="flights">Conteo
                                                            semanal</small>
                                                    </div>
                                                </div>
                                                <div class="col-12 col-md-4">
                                                    <div class="frecuencia-kpi-card h-100">
                                                        <span class="kpi-label">Destinos Carga</span>
                                                        <span class="kpi-value" data-kpi="destinations">—</span>
                                                        <small class="text-muted" data-kpi-note="destinations">Cobertura
                                                            operativa</small>
                                                    </div>
                                                </div>
                                                <div class="col-12 col-md-4">
                                                    <div class="frecuencia-kpi-card h-100">
                                                        <span class="kpi-label">Aerolíneas operando</span>
                                                        <span class="kpi-value" data-kpi="airlines">—</span>
                                                        <small class="text-muted" data-kpi-note="airlines">Incluye
                                                            carga</small>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="card shadow-sm mb-4">
                                                <div class="card-body">
                                                    <div class="row g-3 align-items-end">
                                                        <div class="col-12 col-lg-3">
                                                            <label for="frecuencias-cargo-airline-filter"
                                                                class="form-label small text-uppercase text-muted">Filtrar
                                                                por aerolínea</label>
                                                            <select id="frecuencias-cargo-airline-filter"
                                                                class="form-select form-select-sm"
                                                                aria-label="Filtrar por aerolínea"></select>
                                                        </div>
                                                        <div class="col-12 col-lg-3">
                                                            <label for="frecuencias-cargo-destination-filter"
                                                                class="form-label small text-uppercase text-muted">Filtrar
                                                                por país</label>
                                                            <select id="frecuencias-cargo-destination-filter"
                                                                class="form-select form-select-sm"
                                                                aria-label="Filtrar por país"></select>
                                                        </div>
                                                        <div class="col-12 col-lg-3">
                                                            <label for="frecuencias-cargo-search"
                                                                class="form-label small text-uppercase text-muted">Buscar</label>
                                                            <input type="search" id="frecuencias-cargo-search"
                                                                class="form-control form-control-sm"
                                                                placeholder="Ciudad, país o aerolínea">
                                                        </div>
                                                        <div class="col-12 col-lg-3 d-flex gap-2">
                                                            <button class="btn btn-outline-secondary btn-sm flex-fill"
                                                                id="frecuencias-cargo-reset-filters"><i
                                                                    class="fas fa-eraser me-1"></i>Limpiar</button>
                                                            <button class="btn btn-outline-success btn-sm flex-fill"
                                                                id="frecuencias-cargo-download-excel"><i
                                                                    class="fas fa-file-excel me-1"></i>Excel</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row g-3 mb-4">
                                                <div class="col-12">
                                                    <div class="card shadow-sm h-100">
                                                        <div class="card-header">
                                                            <h3 class="section-subheading mb-0">Distribución semanal
                                                            </h3>
                                                        </div>
                                                        <div class="card-body">
                                                            <div id="frecuencias-cargo-dow-list"
                                                                class="frecuencias-dow-list">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="card shadow-sm mt-4">
                                                <div
                                                    class="card-header d-flex flex-column flex-lg-row align-items-lg-center justify-content-between gap-2">
                                                    <div>
                                                        <h3 class="section-subheading mb-0">Tabla Carga por destino y
                                                            aerolínea</h3>
                                                        <small class="text-muted">Frecuencias expresadas por
                                                            día.</small>
                                                    </div>
                                                    <span class="badge bg-secondary-subtle text-secondary"
                                                        id="frecuencias-cargo-table-count">— destinos listados</span>
                                                </div>
                                                <div class="table-responsive">
                                                    <table class="table table-hover table-bordered align-middle"
                                                        id="frecuencias-cargo-destinos-table">
                                                        <thead>
                                                            <tr>
                                                                <th scope="col">Id de ruta</th>
                                                                <th scope="col">Destino (País)</th>
                                                                <th scope="col">Aerolínea</th>
                                                                <th scope="col">Lun</th>
                                                                <th scope="col">Mar</th>
                                                                <th scope="col">Mie</th>
                                                                <th scope="col">Jue</th>
                                                                <th scope="col">Vie</th>
                                                                <th scope="col">Sab</th>
                                                                <th scope="col">Dom</th>
                                                                <th scope="col">Total</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody></tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="frecuencias-upload-pane" role="tabpanel" aria-labelledby="frecuencias-upload-tab" tabindex="0">
                                    <div class="card shadow-sm mb-4">
                                        <div class="card-body">
                                            <h4 class="card-title"><i class="fas fa-upload me-2"></i>Cargar Frecuencias Semanales (CSV)</h4>
                                            <p class="text-muted small">Sube el archivo CSV de visitas y selecciona la fecha de inicio de la semana para generar el reporte.</p>
                                            <div class="row g-3 align-items-end">
                                                <div class="col-md-4">
                                                    <label for="frecuencias-csv-file" class="form-label">Archivo CSV (Visits)</label>
                                                    <input class="form-control" type="file" id="frecuencias-csv-file" accept=".csv">
                                                </div>
                                                <div class="col-md-3">
                                                    <label for="frecuencias-type-select" class="form-label">Tipo de Reporte</label>
                                                    <select class="form-select" id="frecuencias-type-select">
                                                        <option value="passenger" selected>Pasajeros (Nac/Int)</option>
                                                        <option value="cargo">Carga</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3">
                                                    <label for="frecuencias-week-start" class="form-label">Inicio de la Semana</label>
                                                    <input type="date" class="form-control" id="frecuencias-week-start">
                                                    <div class="form-text">Semana: <span id="frecuencias-week-display" class="fw-bold">-</span></div>
                                                </div>
                                                <div class="col-md-2">
                                                    <button class="btn btn-primary w-100" id="btn-process-frecuencias">
                                                        <i class="fas fa-cog me-1"></i> Procesar
                                                    </button>
                                                </div>
                                            </div>
                                            <div id="frecuencias-upload-error" class="alert alert-danger mt-3 d-none"></div>
                                        </div>
                                    </div>

                                    <!-- Results Area -->
                                    <div id="frecuencias-upload-results" class="d-none">
                                         <div class="d-flex justify-content-between align-items-center mb-3">
                                            <h5 class="mb-0">Resultados del Procesamiento</h5>
                                            <span class="badge bg-info text-dark" id="total-ops-badge">0 Operaciones</span>
                                         </div>
                                         <div class="table-responsive">
                                            <table class="table table-striped table-hover table-bordered align-middle" id="table-frecuencias-upload">
                                                <thead class="table-light">
                                                    <tr>
                                                         <th>Ruta (Destino)</th>
                                                         <th>Aerolínea</th>
                                                         <th class="text-center">Frecuencia Semanal</th>
                                                         <th class="text-center">Acciones</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="tbody-frecuencias-upload">
                                                    <!-- Content injected here -->
                                                </tbody>
                                            </table>
                                         </div>
                                    </div>
                                    
                                    <!-- Detail Modal -->
                                    <div class="modal fade" id="modalFrecuenciasDetalle" tabindex="-1" aria-hidden="true">
                                      <div class="modal-dialog modal-lg">
                                        <div class="modal-content">
                                          <div class="modal-header">
                                            <h5 class="modal-title">Detalle de Vuelos - <span id="modal-route-title"></span></h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                          </div>
                                          <div class="modal-body">
                                             <div class="table-responsive">
                                                 <table class="table table-sm table-hover" id="table-frecuencias-detalle">
                                                    <thead>
                                                        <tr>
                                                            <th>Fecha</th>
                                                            <th>Hora (SOBT)</th>
                                                            <th>Vuelo</th>
                                                            <th>Aerolínea</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="tbody-frecuencias-detalle"></tbody>
                                                 </table>
                                             </div>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="frecuencias-auto-pane-legacy" role="tabpanel"
                                    aria-labelledby="frecuencias-auto-tab" tabindex="0">
                                    <div class="frecuencias-auto-wrapper" data-module="frecuencias-auto-legacy">
                                        <div class="alert alert-info d-flex align-items-center gap-2 mb-3"
                                            role="status">
                                            <i class="fas fa-database" aria-hidden="true"></i>
                                            <div>
                                                <strong>Fuente dinámica:</strong> los datos provienen de la base de
                                                datos (Supabase) y se actualizan con cada semana operativa.
                                            </div>
                                        </div>
                                        <div class="alert alert-warning d-flex align-items-center gap-2 mb-3"
                                            role="alert">
                                            <i class="fas fa-hard-hat" aria-hidden="true"></i>
                                            <div>
                                                <strong>En construcción:</strong> Se está trabajando en la sección
                                                de
                                                automatización de frecuencias. Datos solo para uso práctico.
                                            </div>
                                        </div>
                                        <div id="frecuencias-error-legacy" class="alert alert-danger d-none" role="alert">
                                        </div>
                                        <div id="frecuencias-loading-legacy" class="frecuencias-loading-state" role="status"
                                            aria-live="polite">
                                            <div class="spinner-border text-primary" role="presentation"></div>
                                            <div>
                                                <strong>Cargando frecuencias...</strong>
                                                <p class="mb-0 small text-muted">Si tarda demasiado, verifica que el
                                                    servidor local esté en ejecución para permitir la lectura de
                                                    archivos JSON.</p>
                                            </div>
                                        </div>
                                        <div id="frecuencias-content-legacy" class="frecuencias-auto-content d-none">
                                            <div class="frecuencias-meta card shadow-sm mb-3">
                                                <div
                                                    class="card-body d-flex flex-column flex-md-row justify-content-between gap-3">
                                                    <div>
                                                        <div class="text-uppercase text-muted fw-semibold small">
                                                            Semana
                                                            operacional</div>
                                                        <div class="d-flex align-items-center gap-2 flex-wrap">
                                                            <span class="badge bg-primary-subtle text-primary"
                                                                data-week-label>Semana —</span>
                                                            <span class="text-muted" data-week-range>Vigencia
                                                                —</span>
                                                        </div>
                                                    </div>
                                                    <div class="text-md-end">
                                                        <div class="text-uppercase text-muted fw-semibold small">
                                                            Última
                                                            referencia</div>
                                                        <div class="fw-semibold" data-last-updated>—</div>
                                                        <small class="text-muted">Origen: Direcc. Operaciones
                                                            AIFA</small>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row g-3 mb-4">
                                                <div class="col-12 transition-all" id="frecuencias-map-col-legacy">
                                                    <div class="card shadow-sm h-100">
                                                        <div
                                                            class="card-header d-flex align-items-center justify-content-between">
                                                            <div>
                                                                <h3 class="section-subheading mb-0">Mapa interactivo
                                                                </h3>
                                                                <small class="text-muted">Tamaño del marcador
                                                                    proporcional a los frecuencias
                                                                    semanales.</small>
                                                            </div>




                                                            <button class="btn btn-outline-primary btn-sm"
                                                                id="frecuencias-fit-map-legacy"><i
                                                                    class="fas fa-expand me-1"></i>Enfocar
                                                                país</button>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="frecuencias-map-shell">
                                                                <div id="frecuencias-map-legacy" class="frecuencias-map"
                                                                    role="img"
                                                                    aria-label="Mapa de frecuencias semanales">
                                                                </div>
                                                                <div id="frecuencias-map-empty-legacy"
                                                                    class="frecuencias-map-empty d-none">Sin
                                                                    destinos
                                                                    para mostrar con los filtros actuales.</div>
                                                            </div>
                                                            <p class="small text-muted mb-0 mt-2">Haz clic en un
                                                                destino
                                                                para ver detalles.</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-12 col-lg-5 d-none" id="frecuencias-details-col-legacy">
                                                    <div class="card shadow-sm h-100">
                                                        <div
                                                            class="card-header bg-light d-flex justify-content-between align-items-center">
                                                            <h5 class="mb-0 text-primary"
                                                                id="frecuencias-details-title-legacy">
                                                                Detalles
                                                            </h5>
                                                            <button type="button" class="btn-close"
                                                                aria-label="Cerrar detalles"
                                                                id="frecuencias-details-close-legacy"></button>
                                                        </div>
                                                        <div class="card-body p-0 overflow-auto"
                                                            style="max-height: 500px;">
                                                            <div id="frecuencias-details-body-legacy"
                                                                class="list-group list-group-flush">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row g-3 frecuencias-kpi-row mb-4">
                                                <div class="col-12 col-md-4">
                                                    <div class="frecuencia-kpi-card h-100">
                                                        <span class="kpi-label">Frecuencias programadas</span>
                                                        <span class="kpi-value" data-kpi="flights">—</span>
                                                        <small class="text-muted" data-kpi-note="flights">Conteo
                                                            semanal
                                                            por aerolínea</small>
                                                    </div>
                                                </div>
                                                <div class="col-12 col-md-4">
                                                    <div class="frecuencia-kpi-card h-100">
                                                        <span class="kpi-label">Destinos atendidos</span>
                                                        <span class="kpi-value" data-kpi="destinations">—</span>
                                                        <small class="text-muted" data-kpi-note="destinations">Cobertura
                                                            nacional</small>
                                                    </div>
                                                </div>
                                                <div class="col-12 col-md-4">
                                                    <div class="frecuencia-kpi-card h-100">
                                                        <span class="kpi-label">Aerolíneas operando</span>
                                                        <span class="kpi-value" data-kpi="airlines">—</span>
                                                        <small class="text-muted" data-kpi-note="airlines">Incluye
                                                            pax y
                                                            carga</small>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="card shadow-sm mb-4">
                                                <div class="card-body">
                                                    <div class="row g-3 align-items-end">
                                                        <div class="col-12 col-lg-3">
                                                            <label for="frecuencias-airline-filter-legacy"
                                                                class="form-label small text-uppercase text-muted">Filtrar
                                                                por aerolínea</label>
                                                            <select id="frecuencias-airline-filter-legacy"
                                                                class="form-select form-select-sm"
                                                                aria-label="Filtrar frecuencias por aerolínea"></select>
                                                        </div>
                                                        <div class="col-12 col-lg-3">
                                                            <label for="frecuencias-destination-filter-legacy"
                                                                class="form-label small text-uppercase text-muted">Filtrar
                                                                por destino</label>
                                                            <select id="frecuencias-destination-filter-legacy"
                                                                class="form-select form-select-sm"
                                                                aria-label="Filtrar frecuencias por destino"></select>
                                                        </div>
                                                        <div class="col-12 col-lg-3">
                                                            <label for="frecuencias-day-filter-legacy"
                                                                class="form-label small text-uppercase text-muted">Día
                                                                con operación</label>
                                                            <select id="frecuencias-day-filter-legacy"
                                                                class="form-select form-select-sm"
                                                                aria-label="Filtrar frecuencias por día"></select>
                                                        </div>
                                                        <div class="col-12 col-lg-3">
                                                            <label for="frecuencias-search-legacy"
                                                                class="form-label small text-uppercase text-muted">Buscar</label>
                                                            <input type="search" id="frecuencias-search-legacy"
                                                                class="form-control form-control-sm"
                                                                placeholder="Ciudad, estado o aerolínea">
                                                        </div>
                                                    </div>
                                                    <div class="d-flex flex-wrap align-items-center gap-2 mt-3">
                                                        <button class="btn btn-outline-secondary btn-sm"
                                                            id="frecuencias-reset-filters-legacy"><i
                                                                class="fas fa-eraser me-1"></i>Limpiar
                                                            filtros</button>
                                                        <span class="small text-muted"
                                                            id="frecuencias-active-filters-legacy">Mostrando
                                                            todos los
                                                            destinos.</span>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row g-3 mb-4">
                                                <div class="col-12">
                                                    <div class="card shadow-sm h-100">
                                                        <div class="card-header">
                                                            <h3 class="section-subheading mb-0">Distribución semanal
                                                            </h3>
                                                        </div>
                                                        <div class="card-body">
                                                            <div id="frecuencias-dow-list-legacy" class="frecuencias-dow-list">
                                                            </div>
                                                            <div id="frecuencias-insights-legacy"
                                                                class="frecuencias-insights mt-3">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="card shadow-sm mt-4">
                                                <div
                                                    class="card-header d-flex flex-column flex-lg-row align-items-lg-center justify-content-between gap-2">
                                                    <div>
                                                        <h3 class="section-subheading mb-0">Tabla por destino y
                                                            aerolínea</h3>
                                                        <small class="text-muted">Frecuencias expresadas por
                                                            día.</small>
                                                    </div>
                                                    <span class="badge bg-secondary-subtle text-secondary"
                                                        id="frecuencias-table-count-legacy">— destinos listados</span>
                                                </div>
                                                <div class="table-responsive">
                                                    <table class="table table-hover table-bordered align-middle"
                                                        id="frecuencias-destinos-table-legacy">
                                                        <thead>
                                                            <tr>
                                                                <th scope="col">Destino</th>
                                                                <th scope="col">Aerolínea</th>
                                                                <th scope="col">Lun</th>
                                                                <th scope="col">Mar</th>
                                                                <th scope="col">Mie</th>
                                                                <th scope="col">Jue</th>
                                                                <th scope="col">Vie</th>
                                                                <th scope="col">Sab</th>
                                                                <th scope="col">Dom</th>
                                                                <th scope="col">Total</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody></tbody>
                                                    </table>
                                                </div>
                                                <div id="frecuencias-empty-legacy" class="frecuencias-empty d-none">No hay
                                                    destinos que coincidan con los filtros seleccionados.</div>
                                                <div class="card-footer bg-light text-muted small">
                                                    <div id="frecuencias-table-footnote-legacy">Valores generados
                                                        automáticamente a partir del archivo JSON semanal.</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="itinerario-mensual-section" class="content-section">
                    <div class="card">
                        <div class="card-header text-center">
                            <h2 class="section-title mb-0">ITINERARIO MENSUAL DEL MES DE DICIEMBRE </h2>
                        </div>
                        <div class="card-body pdf-container">
                            <iframe id="pdf-itinerario-mensual" title="Itinerario Mensual"
                                src="pdfs/itinerario_mensual.pdf" width="100%" height="800px" class="border-0"></iframe>
                            <button class="btn btn-outline-primary w-100 mt-2"
                                data-fullscreen-target="#pdf-itinerario-mensual"><i class="fas fa-expand me-2"></i>Ver
                                en Pantalla Completa</button>
                        </div>
                    </div>
                </div>
                <div id="puntualidad-agosto-section" class="content-section">
                    <div class="card">
                        <div class="card-header d-flex align-items-center justify-content-center">
                            <i class="fas fa-clock-check fa-2x text-primary me-3"></i>
                            <h2 id="puntualidad-header-title" class="section-title mb-0">PUNTUALIDAD DE AEROLÍNEAS</h2>
                        </div>
                        <div class="card-body">
                            <ul class="nav nav-tabs" id="puntualidadTab" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="punc-interactivo-tab" data-bs-toggle="tab"
                                        data-bs-target="#punc-interactivo-pane" type="button" role="tab"
                                        aria-controls="punc-interactivo-pane" aria-selected="true"><i
                                            class="fas fa-table me-2"></i>Vista Interactiva</button>
                                </li>
                            </ul>
                            <div class="tab-content pt-3" id="puntualidadTabContent">
                                <div class="tab-pane fade show active" id="punc-interactivo-pane" role="tabpanel"
                                    aria-labelledby="punc-interactivo-tab" tabindex="0">
                                    <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
                                        <div class="d-flex align-items-center gap-2">
                                            <span class="small text-muted">Umbral puntualidad:</span>
                                            <span class="badge bg-success">≥ 85% Puntual</span>
                                            <span class="badge bg-danger">&lt; 85% Impuntual</span>
                                        </div>
                                        <div class="d-flex flex-wrap align-items-center gap-2">
                                            <label for="puntualidad-minflights" class="small text-muted m-0">Mín.
                                                vuelos
                                                <i id="minflights-help" class="fas fa-circle-question ms-1 text-muted"
                                                    data-bs-toggle="tooltip" data-bs-placement="top"
                                                    title="Sólo afecta los TOPs: excluye aerolíneas con menos vuelos que este mínimo."></i>
                                            </label>
                                            <select id="puntualidad-minflights"
                                                class="form-select form-select-sm w-auto"
                                                aria-label="Seleccionar mínimo vuelos para puntualidad">
                                                <option value="1">1</option>
                                                <option value="3">3</option>
                                                <option value="5" selected>5</option>
                                                <option value="10">10</option>
                                            </select>
                                            <button type="button" class="btn btn-outline-danger btn-sm"
                                                id="puntualidad-toggle-worst" aria-pressed="false"
                                                aria-expanded="false">
                                                <span class="punc-toggle-active-icon-show"><i
                                                        class="fas fa-eye me-1"></i>Mostrar
                                                    impuntuales</span>
                                                <span class="punc-toggle-active-icon-hide"><i
                                                        class="fas fa-eye-slash me-1"></i>Ocultar impuntuales</span>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="row g-3 mb-3">
                                        <div class="col-12 col-lg-6">
                                            <div class="card h-100 punc-card punc-passengers">
                                                <div class="card-header d-flex align-items-center gap-2"><i
                                                        class="fas fa-user-friends text-primary"></i><strong>Pasajeros</strong>
                                                </div>
                                                <div class="card-body">
                                                    <div class="row g-3">
                                                        <div class="col-12 col-md-6 punc-best-col">
                                                            <h6 class="text-success mb-2 punc-col-title punc-col-best">
                                                                <i class="fas fa-trophy me-1"></i>Más puntuales
                                                            </h6>
                                                            <ol id="puntualidad-top-pax-best" class="m-0"></ol>
                                                            <div class="mt-2"><canvas id="punc-pax-best-chart"
                                                                    height="140"></canvas></div>
                                                        </div>
                                                        <div class="col-12 col-md-6 punc-worst-col" data-punc-worst>
                                                            <h6 class="text-danger mb-2 punc-col-title punc-col-worst">
                                                                <i class="fas fa-triangle-exclamation me-1"></i>Más
                                                                impuntuales
                                                            </h6>
                                                            <ol id="puntualidad-top-pax-worst" class="m-0"></ol>
                                                            <div class="mt-2"><canvas id="punc-pax-worst-chart"
                                                                    height="140"></canvas></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12 col-lg-6">
                                            <div class="card h-100 punc-card punc-cargo">
                                                <div class="card-header d-flex align-items-center gap-2"><i
                                                        class="fas fa-box-open text-warning"></i><strong>Carga</strong>
                                                </div>
                                                <div class="card-body">
                                                    <div class="row g-3">
                                                        <div class="col-12 col-md-6 punc-best-col">
                                                            <h6 class="text-success mb-2 punc-col-title punc-col-best">
                                                                <i class="fas fa-trophy me-1"></i>Más puntuales
                                                            </h6>
                                                            <ol id="puntualidad-top-cargo-best" class="m-0"></ol>
                                                            <div class="mt-2"><canvas id="punc-cargo-best-chart"
                                                                    height="140"></canvas></div>
                                                        </div>
                                                        <div class="col-12 col-md-6 punc-worst-col" data-punc-worst>
                                                            <h6 class="text-danger mb-2 punc-col-title punc-col-worst">
                                                                <i class="fas fa-triangle-exclamation me-1"></i>Más
                                                                impuntuales
                                                            </h6>
                                                            <ol id="puntualidad-top-cargo-worst" class="m-0"></ol>
                                                            <div class="mt-2"><canvas id="punc-cargo-worst-chart"
                                                                    height="140"></canvas></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="table-responsive" id="puntualidad-table-container"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="comparativa-section" class="content-section">
                    <div class="card border-0">
                        <div class="card-header bg-transparent">
                            <h2 class="section-title mb-0">Análisis Comparativo</h2>
                        </div>
                        <div class="card-body">
                            <div class="pdf-preview-container shadow-sm">
                                <iframe id="pdf-preview-2" title="Análisis Comparativo" src=""></iframe>
                            </div>
                            <button class="btn btn-outline-primary w-100 mt-2"
                                data-fullscreen-target="#pdf-preview-2"><i class="fas fa-expand me-2"></i>Ver en
                                Pantalla Completa</button>
                        </div>
                    </div>
                </div>

                <!-- Manifiestos -->
                <!-- SECCION MANIFIESTOS COMENTADA -->
                <template id="manifiestos-section-disabled">
                    <div id="manifiestos-section" class="content-section">
                        <div class="card border-0">
                            <div class="card-header bg-transparent text-center">
                                <h2
                                    class="section-title mb-1 d-inline-flex align-items-center justify-content-center gap-2">
                                    <span>Manifiestos</span>
                                </h2>

                            </div>
                            <div class="card-body">
                                <div class="row g-3 manifest-layout">
                                    <div class="col-12 col-lg-5">
                                        <div class="manifest-sidebar d-flex flex-column gap-3">
                                            <div class="manifest-pane manifest-pane-controls">
                                                <div
                                                    class="manifest-controls mb-2 d-flex gap-2 flex-wrap align-items-center">
                                                    <label for="manifest-upload" class="visually-hidden">Subir
                                                        manifiesto</label>
                                                    <input type="file" id="manifest-upload"
                                                        accept=".pdf,application/pdf,image/*"
                                                        class="form-control form-control-sm max-w-320">
                                                    <div class="d-flex gap-2">
                                                        <button id="manifest-upload-btn-pdf" type="button"
                                                            class="btn btn-outline-secondary btn-sm"><i
                                                                class="fas fa-file-pdf me-1"></i>Adjuntar
                                                            PDF</button>
                                                        <button id="manifest-upload-btn-img" type="button"
                                                            class="btn btn-outline-secondary btn-sm"><i
                                                                class="fas fa-image me-1"></i>Adjuntar
                                                            imagen</button>
                                                    </div>
                                                    <button id="manifest-scan-pdf"
                                                        class="btn btn-primary btn-sm ms-2"><i
                                                            class="fas fa-wand-magic-sparkles me-1"></i>Escanear
                                                        PDF</button>
                                                    <div class="form-check form-switch ms-2">
                                                        <input class="form-check-input" type="checkbox"
                                                            id="manifest-fast-mode" checked>
                                                        <label class="form-check-label small" for="manifest-fast-mode"
                                                            title="Usa texto del PDF primero y OCR dirigido solo si faltan campos clave. Igual de preciso, más rápido.">Modo
                                                            rápido</label>
                                                    </div>
                                                    <button id="manifest-scan-ocr"
                                                        class="btn btn-outline-secondary btn-sm"><i
                                                            class="fas fa-magic me-1"></i>Escaneo alternativo
                                                        (OCR)</button>
                                                    <label for="manifest-ocr-pages" class="visually-hidden">Páginas
                                                        a
                                                        escanear</label>
                                                    <select id="manifest-ocr-pages"
                                                        class="form-select form-select-sm w-auto d-inline-block"
                                                        aria-label="Seleccionar páginas OCR del manifiesto">
                                                        <option value="1">1 pág</option>
                                                        <option value="2" selected>2 págs</option>
                                                        <option value="3">3 págs</option>
                                                        <option value="5">5 págs</option>
                                                    </select>

                                                </div>
                                                <div class="manifest-mobile-hint small text-muted mb-2">En móviles:
                                                    usa
                                                    “Adjuntar PDF” para abrir Archivos/Files y seleccionar
                                                    documentos
                                                    .pdf;
                                                    usa “Adjuntar imagen” para abrir Fotos/Cámara.</div>
                                            </div>
                                            <div class="manifest-pane manifest-pane-preview">
                                                <!-- Progreso estilo avión (arriba de la previsualización) -->
                                                <div id="manifest-plane-progress" class="plane-progress mb-2 d-none"
                                                    aria-hidden="false">
                                                    <div class="plane-progress-track">
                                                        <div class="plane-progress-fill" id="manifest-plane-fill">
                                                        </div>
                                                        <div class="plane-progress-plane" id="manifest-plane-icon"
                                                            title="Procesando">✈</div>
                                                    </div>
                                                    <div class="plane-progress-label small text-muted"
                                                        id="manifest-plane-label">0%
                                                    </div>
                                                </div>
                                                <div class="manifest-preview-shell">
                                                    <div id="manifest-preview-container"
                                                        class="manifest-preview-card manifest-preview-container">
                                                        <!-- Loader de sección Manifiestos (tipo login con avión orbitando) -->
                                                        <div id="manifiestos-loader" class="section-loader hidden"
                                                            role="alert" aria-live="assertive" aria-busy="true">
                                                            <div class="loader-content text-center">
                                                                <div class="plane-orbit">
                                                                    <span class="orbit-ring"></span>
                                                                    <span class="plane-icon">✈</span>
                                                                    <img src="images/logo_aifa.jpg" alt="AIFA"
                                                                        class="loader-aifa-logo" />
                                                                </div>
                                                                <div class="loader-text">Escaneando…</div>
                                                            </div>
                                                        </div>
                                                        <div id="manifest-preview-placeholder" class="text-muted small">
                                                            Seleccione un PDF de manifiesto y presione "Escanear
                                                            PDF"
                                                            para
                                                            procesarlo automáticamente.</div>
                                                        <!-- Previsualización: imagen (para JPG/PNG) o canvas (para PDF) -->
                                                        <img id="manifest-preview" alt="Previsualización"
                                                            class="img-fluid d-none manifest-preview-img" />
                                                        <canvas id="manifest-preview-canvas"
                                                            class="d-none manifest-preview-canvas"></canvas>
                                                        <div id="manifest-text-layer" class="manifest-text-layer">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="manifest-status-stack">
                                                    <div id="manifest-ocr-status" class="small text-muted"></div>
                                                    <div class="progress my-1 d-none h-18px"
                                                        id="manifest-progress-bar-container">
                                                        <div class="progress-bar progress-bar-striped progress-bar-animated w-0"
                                                            id="manifest-progress-bar" role="progressbar"
                                                            aria-label="Progreso de escaneo" aria-valuenow="0"
                                                            aria-valuemin="0" aria-valuemax="100">Escaneando PDF...
                                                        </div>
                                                    </div>
                                                    <div id="manifest-pdf-status" class="small text-info"></div>
                                                    <details class="mt-1 manifest-debug-toggle">
                                                        <summary class="small">Ver texto detectado (debug)</summary>
                                                        <label for="manifest-ocr-debug" class="visually-hidden">Debug
                                                            OCR</label>
                                                        <textarea id="manifest-ocr-debug"
                                                            class="form-control form-control-sm mt-2 font-roboto-mono"
                                                            rows="8"></textarea>
                                                    </details>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-12 col-lg-7">
                                        <div class="manifest-pane manifest-pane-form h-100">
                                            <div class="mf-sheet mf-ntp manifest-form-shell">
                                                <div
                                                    class="mf-header d-flex align-items-center justify-content-between flex-wrap gap-2">
                                                    <div class="d-flex align-items-center gap-2">
                                                        <img src="images/logo_aifa.jpg" alt="AIFA"
                                                            class="mf-header-logo" />
                                                        <div>
                                                            <div class="mf-header-title">Manifiestos</div>
                                                            <div class="mf-header-subtitle">Aeropuerto Internacional
                                                                Felipe
                                                                Ángeles</div>
                                                        </div>
                                                    </div>
                                                    <div class="d-flex align-items-end gap-2 mf-header-meta">
                                                        <div>
                                                            <label class="form-label small mb-1 text-light-ntp"
                                                                for="mf-doc-date">Fecha del Documento</label>
                                                            <input type="date"
                                                                class="form-control form-control-sm mf-header-input"
                                                                id="mf-doc-date" />
                                                        </div>
                                                        <div>
                                                            <label class="form-label small mb-1 text-light-ntp"
                                                                for="mf-folio">Folio</label>
                                                            <input type="text"
                                                                class="form-control form-control-sm mf-header-input"
                                                                id="mf-folio" />
                                                        </div>
                                                    </div>
                                                </div>
                                                <form id="manifest-form" class="row g-2 mf-body">
                                                    <div class="col-12">
                                                        <label class="form-label me-3">Tipo de Manifiesto</label>
                                                        <div class="btn-group" role="group"
                                                            aria-label="Tipo de Manifiesto">
                                                            <input type="radio" class="btn-check" name="mf-dir"
                                                                id="mf-dir-arr" autocomplete="off" checked>
                                                            <label class="btn btn-outline-secondary" for="mf-dir-arr"><i
                                                                    class="fas fa-plane-arrival me-1"></i>Llegada</label>
                                                            <input type="radio" class="btn-check" name="mf-dir"
                                                                id="mf-dir-dep" autocomplete="off">
                                                            <label class="btn btn-outline-secondary" for="mf-dir-dep"><i
                                                                    class="fas fa-plane-departure me-1"></i>Salida</label>
                                                        </div>
                                                    </div>
                                                    <!-- Encabezado del documento (cuerpo) -->
                                                    <div class="col-12">
                                                        <div class="d-flex flex-wrap align-items-end gap-3">
                                                            <div class="flex-grow-1">
                                                                <label class="form-label" for="mf-title">Título</label>
                                                                <input type="text" class="form-control" id="mf-title"
                                                                    value="MANIFIESTO DE LLEGADA" readonly>
                                                            </div>
                                                        </div>
                                                        <hr />
                                                    </div>
                                                    <!-- Sección 1: Datos generales (en orden solicitado) -->
                                                    <div class="col-12">
                                                        <h6 class="mb-2"><i class="fas fa-list me-1"></i>Datos
                                                            generales
                                                        </h6>
                                                    </div>
                                                    <!-- Nuevos primeros campos en Datos generales -->
                                                    <div class="col-12 col-md-6 mb-2">
                                                        <label class="form-label" id="mf-airport-main-label"
                                                            for="mf-airport-main">Aeropuerto de Llegada</label>
                                                        <input type="text" class="form-control text-uppercase"
                                                            id="mf-airport-main" placeholder="IATA (3 letras)"
                                                            maxlength="3" list="airports-iata-list" />
                                                    </div>
                                                    <div class="col-12 col-md-6 mb-2">
                                                        <label class="form-label" for="mf-flight-type">Tipo de
                                                            vuelo</label>
                                                        <input type="text" class="form-control text-uppercase"
                                                            id="mf-flight-type"
                                                            placeholder="Escribe la letra del tipo (A–Z)" maxlength="1"
                                                            pattern="[A-Za-z]" list="flight-type-list"
                                                            autocomplete="off" />
                                                        <datalist id="flight-type-list"></datalist>
                                                        <div id="mf-flight-type-info"
                                                            class="form-text small text-muted">
                                                        </div>
                                                    </div>

                                                    <div class="col-12 col-md-4 mb-2">
                                                        <label class="form-label" for="mf-carrier-3l">Transportista
                                                            (OACI -
                                                            3 letras)</label>
                                                        <input type="text" class="form-control text-uppercase"
                                                            id="mf-carrier-3l" maxlength="3" placeholder="Ej. AMX"
                                                            list="airlines-icao-list" pattern="[A-Za-z]{3}"
                                                            autocomplete="off" />
                                                        <datalist id="airlines-icao-list"></datalist>
                                                        <div class="form-text">Usa el código OACI (ICAO) de 3
                                                            letras.
                                                            Ejemplos: AMX (Aeroméxico), CLX (Cargolux), THY
                                                            (Turkish).
                                                        </div>
                                                    </div>
                                                    <div class="col-12 col-md-8 mb-2">
                                                        <label class="form-label" for="mf-operator-name">Nombre o
                                                            razón
                                                            social del transportista / operador aéreo</label>
                                                        <input type="text" class="form-control" id="mf-operator-name" />
                                                    </div>
                                                    <div class="col-12 col-md-4 mb-2">
                                                        <label class="form-label" for="mf-airline">Transportista /
                                                            Operador
                                                            (Nombre comercial)</label>
                                                        <input type="text" class="form-control" id="mf-airline" />
                                                    </div>
                                                    <div class="col-12 col-md-4 mb-2">
                                                        <label class="form-label" for="mf-tail">Matrícula</label>
                                                        <input type="text" class="form-control text-uppercase"
                                                            id="mf-tail" list="aircraft-reg-list"
                                                            placeholder="Ej. N851GT / XAABC" autocomplete="off" />
                                                        <datalist id="aircraft-reg-list"></datalist>
                                                        <div class="form-text">Selecciona una matrícula del catálogo
                                                            o
                                                            escríbela manualmente.</div>
                                                        <div id="mf-tail-warning" class="form-text text-danger d-none">
                                                        </div>
                                                    </div>
                                                    <div class="col-12 col-md-4 mb-2">
                                                        <label class="form-label" for="mf-flight">Vuelo</label>
                                                        <input type="text" class="form-control" id="mf-flight" />
                                                    </div>

                                                    <div class="col-12 col-md-4 mb-2">
                                                        <label class="form-label" for="mf-aircraft">Equipo</label>
                                                        <input type="text" class="form-control text-uppercase"
                                                            id="mf-aircraft" list="aircraft-type-icao-list"
                                                            placeholder="Ej. B77F / A21N / E195"
                                                            pattern="[A-Za-z0-9]{2,5}" autocomplete="off" />
                                                        <datalist id="aircraft-type-icao-list"></datalist>
                                                        <div class="form-text">Usa el código OACI del tipo de
                                                            aeronave
                                                            (ej.
                                                            B77F, A21N). Puedes editarlo manualmente.</div>
                                                    </div>
                                                    <div class="col-12 col-md-4">
                                                        <label class="form-label" for="mf-pilot">Piloto al
                                                            Mando</label>
                                                        <input type="text" class="form-control" id="mf-pilot" />
                                                    </div>
                                                    <div class="col-12 col-md-4">
                                                        <label class="form-label" for="mf-pilot-license">No. de
                                                            Licencia</label>
                                                        <input type="text" class="form-control" id="mf-pilot-license" />
                                                    </div>
                                                    <div class="col-12 col-md-4">
                                                        <label class="form-label" for="mf-crew-total">No. de
                                                            Tripulación</label>
                                                        <input type="number" min="0" class="form-control"
                                                            id="mf-crew-total" />
                                                    </div>

                                                    <div class="col-12">
                                                        <hr />
                                                    </div>
                                                    <!-- Sección 2: Movimiento de operaciones (Salida) -->
                                                    <div class="col-12" data-dir="departure-only">
                                                        <h6 class="mb-2"><i class="fas fa-route me-1"></i>Movimiento
                                                            de
                                                            operaciones</h6>
                                                        <div class="row g-2">
                                                            <!-- Columna 1: Origen -->
                                                            <div class="col-12 col-md-4">
                                                                <div class="mb-2">
                                                                    <label class="form-label"
                                                                        for="mf-origin-name">Origen de
                                                                        vuelo - Nombre completo del
                                                                        aeropuerto</label>
                                                                    <input type="text" class="form-control"
                                                                        id="mf-origin-name" list="airports-name-list"
                                                                        placeholder="Nombre completo del aeropuerto" />
                                                                    <small class="text-muted">Si es Hangar, agregue
                                                                        "H".
                                                                        Si
                                                                        es Pernocta, agregue "P".</small>
                                                                </div>
                                                                <div class="mb-2">
                                                                    <label class="form-label"
                                                                        for="mf-origin-code">Código de
                                                                        3 letras (origen)</label>
                                                                    <input type="text"
                                                                        class="form-control text-uppercase"
                                                                        id="mf-origin-code" maxlength="3"
                                                                        list="airports-iata-list"
                                                                        placeholder="IATA (3 letras)" />
                                                                </div>

                                                            </div>
                                                            <!-- Columna 2: Próxima escala -->
                                                            <div class="col-12 col-md-4">
                                                                <div class="mb-2">
                                                                    <label class="form-label" for="mf-next-stop">Próxima
                                                                        escala - Nombre completo del
                                                                        aeropuerto</label>
                                                                    <input type="text" class="form-control"
                                                                        id="mf-next-stop" list="airports-name-list"
                                                                        placeholder="Nombre completo del aeropuerto" />
                                                                </div>
                                                                <div class="mb-2">
                                                                    <label class="form-label"
                                                                        for="mf-next-stop-code">Código
                                                                        de 3 letras (próxima escala)</label>
                                                                    <input type="text"
                                                                        class="form-control text-uppercase"
                                                                        id="mf-next-stop-code" maxlength="3"
                                                                        list="airports-iata-list"
                                                                        placeholder="IATA (3 letras)" />
                                                                </div>

                                                            </div>
                                                            <!-- Columna 3: Destino -->
                                                            <div class="col-12 col-md-4">
                                                                <div class="mb-2">
                                                                    <label class="form-label"
                                                                        for="mf-final-dest">Destino
                                                                        del vuelo - Nombre completo del
                                                                        aeropuerto</label>
                                                                    <input type="text" class="form-control"
                                                                        id="mf-final-dest" list="airports-name-list"
                                                                        placeholder="Nombre completo del aeropuerto" />
                                                                </div>
                                                                <div class="mb-2">
                                                                    <label class="form-label"
                                                                        for="mf-final-dest-code">Código de
                                                                        3
                                                                        letras
                                                                        (destino)</label>
                                                                    <input type="text"
                                                                        class="form-control text-uppercase"
                                                                        id="mf-final-dest-code" maxlength="3"
                                                                        list="airports-iata-list"
                                                                        placeholder="IATA (3 letras)" />
                                                                </div>

                                                            </div>
                                                            <!-- Tipo de Operación (Salida) -->
                                                            <div class="col-12 col-md-4 mb-2">
                                                                <label class="form-label"
                                                                    for="mf-operation-type-dep">Tipo
                                                                    de Operación</label>
                                                                <input type="text" class="form-control"
                                                                    id="mf-operation-type-dep"
                                                                    placeholder="Doméstica / Internacional" readonly />
                                                                <div class="form-text">Se calcula con los
                                                                    aeropuertos
                                                                    (origen/destino).</div>
                                                            </div>
                                                            <!-- Grupo de tiempos (Salida) -->
                                                            <div class="col-12">
                                                                <div
                                                                    class="p-3 border rounded bg-light-subtle mf-times">
                                                                    <h6 class="mb-2">Tiempos (Salida)</h6>
                                                                    <div class="row g-2">
                                                                        <div class="col-6 col-md-3">
                                                                            <label class="form-label"
                                                                                for="mf-slot-assigned">Hora de
                                                                                slot
                                                                                asignado</label>
                                                                            <input type="text" class="form-control"
                                                                                id="mf-slot-assigned" data-time24="1"
                                                                                inputmode="numeric" placeholder="HH:MM"
                                                                                maxlength="5" />
                                                                            <div class="form-text">Hora local</div>
                                                                        </div>
                                                                        <div class="col-6 col-md-3">
                                                                            <label class="form-label"
                                                                                for="mf-slot-coordinated">Hora
                                                                                de slot
                                                                                coordinado</label>
                                                                            <input type="text" class="form-control"
                                                                                id="mf-slot-coordinated" data-time24="1"
                                                                                inputmode="numeric" placeholder="HH:MM"
                                                                                maxlength="5" />
                                                                            <div class="form-text">Hora local</div>
                                                                        </div>
                                                                        <div class="col-6 col-md-3">
                                                                            <label class="form-label"
                                                                                for="mf-termino-pernocta">Hora
                                                                                de
                                                                                término de
                                                                                pernocta</label>
                                                                            <input type="text" class="form-control"
                                                                                id="mf-termino-pernocta" data-time24="1"
                                                                                inputmode="numeric" placeholder="HH:MM"
                                                                                maxlength="5" />
                                                                            <div class="form-text">Hora local</div>
                                                                        </div>
                                                                        <div class="col-6 col-md-3">
                                                                            <label class="form-label"
                                                                                for="mf-inicio-embarque">Hora
                                                                                de inicio
                                                                                de
                                                                                maniobras de embarque</label>
                                                                            <input type="text" class="form-control"
                                                                                id="mf-inicio-embarque" data-time24="1"
                                                                                inputmode="numeric" placeholder="HH:MM"
                                                                                maxlength="5" />
                                                                            <div class="form-text">Hora local</div>
                                                                        </div>
                                                                        <div class="col-6 col-md-3">
                                                                            <label class="form-label"
                                                                                for="mf-salida-posicion">Hora
                                                                                de salida
                                                                                de
                                                                                la posición</label>
                                                                            <input type="text" class="form-control"
                                                                                id="mf-salida-posicion" data-time24="1"
                                                                                inputmode="numeric" placeholder="HH:MM"
                                                                                maxlength="5" />
                                                                            <div class="form-text">Hora local</div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <hr />
                                                    </div>
                                                    <!-- Sección 2 (Llegada): Movimiento de operaciones -->
                                                    <div class="col-12" data-dir="arrival-only">
                                                        <h6 class="mb-2 mf-section-title"><i
                                                                class="fas fa-route me-1"></i>Movimiento de
                                                            operaciones
                                                        </h6>
                                                        <div class="row g-2">
                                                            <!-- 1) Procedencia del vuelo (nombre completo) -->
                                                            <div class="col-12 col-md-6">
                                                                <label class="form-label"
                                                                    for="mf-arr-origin-name">Procedencia
                                                                    del
                                                                    vuelo -
                                                                    Nombre
                                                                    completo del aeropuerto</label>
                                                                <input type="text" class="form-control"
                                                                    id="mf-arr-origin-name" list="airports-name-list"
                                                                    placeholder="Nombre completo del aeropuerto" />
                                                            </div>
                                                            <!-- 2) Código de 3 letras (procedencia) -->
                                                            <div class="col-6 col-md-3">
                                                                <label class="form-label"
                                                                    for="mf-arr-origin-code">Código de
                                                                    3 letras (procedencia)</label>
                                                                <input type="text" class="form-control text-uppercase"
                                                                    id="mf-arr-origin-code" maxlength="3"
                                                                    list="airports-iata-list"
                                                                    placeholder="IATA (3 letras)" />
                                                            </div>

                                                            <!-- 5) Última escala - nombre completo del aeropuerto -->
                                                            <div class="col-12 col-md-6">
                                                                <label class="form-label" for="mf-arr-last-stop">Escala
                                                                    Anterior - Nombre completo del
                                                                    aeropuerto</label>
                                                                <input type="text" class="form-control"
                                                                    id="mf-arr-last-stop" list="airports-name-list"
                                                                    placeholder="Nombre completo del aeropuerto" />
                                                            </div>
                                                            <!-- 6) Código de 3 letras (última escala) -->
                                                            <div class="col-6 col-md-3">
                                                                <label class="form-label"
                                                                    for="mf-arr-last-stop-code">Código
                                                                    de 3 letras (escala anterior)</label>
                                                                <input type="text" class="form-control text-uppercase"
                                                                    id="mf-arr-last-stop-code" maxlength="3"
                                                                    list="airports-iata-list"
                                                                    placeholder="IATA (3 letras)" />

                                                                <datalist id="airports-iata-list"></datalist>
                                                                <datalist id="airports-name-list"></datalist>
                                                                <datalist id="hhmm-24-list">
                                                                    <!-- 24h options in 5-minute increments for convenience; you can still type any minute -->

                                                                </datalist>
                                                            </div>
                                                            <!-- Tipo de Operación (Llegada) -->
                                                            <div class="col-12 col-md-4 mb-2">
                                                                <label class="form-label"
                                                                    for="mf-operation-type-arr">Tipo
                                                                    de Operación</label>
                                                                <input type="text" class="form-control"
                                                                    id="mf-operation-type-arr"
                                                                    placeholder="Doméstica / Internacional" readonly />
                                                                <div class="form-text">Se calcula con los
                                                                    aeropuertos
                                                                    (procedencia/escala).</div>
                                                            </div>

                                                            <!-- Grupo de tiempos (Llegada) -->
                                                            <div class="col-12 mt-1">
                                                                <div
                                                                    class="p-3 border rounded bg-light-subtle mf-times">
                                                                    <h6 class="mb-2 mf-section-title">Tiempos
                                                                        (Llegada)
                                                                    </h6>
                                                                    <div class="row g-2">
                                                                        <div class="col-6 col-md-3">
                                                                            <label class="form-label"
                                                                                for="mf-arr-slot-assigned">Hora de
                                                                                slot
                                                                                asignado</label>
                                                                            <input type="text" class="form-control"
                                                                                id="mf-arr-slot-assigned"
                                                                                data-time24="1" inputmode="numeric"
                                                                                placeholder="HH:MM" maxlength="5" />
                                                                            <label
                                                                                class="form-check-label ms-2 d-inline-flex align-items-center"
                                                                                for="mf-arr-slot-assigned-na"><input
                                                                                    type="checkbox"
                                                                                    class="form-check-input me-1"
                                                                                    id="mf-arr-slot-assigned-na"
                                                                                    title="No aplica (N/A)">N/A</label>
                                                                            <div class="form-text">Hora local</div>
                                                                        </div>
                                                                        <div class="col-6 col-md-3">
                                                                            <label class="form-label"
                                                                                for="mf-arr-slot-coordinated">Hora
                                                                                de
                                                                                slot
                                                                                coordinado</label>
                                                                            <input type="text" class="form-control"
                                                                                id="mf-arr-slot-coordinated"
                                                                                data-time24="1" inputmode="numeric"
                                                                                placeholder="HH:MM" maxlength="5" />
                                                                            <label
                                                                                class="form-check-label ms-2 d-inline-flex align-items-center"
                                                                                for="mf-arr-slot-coordinated-na"><input
                                                                                    type="checkbox"
                                                                                    class="form-check-input me-1"
                                                                                    id="mf-arr-slot-coordinated-na"
                                                                                    title="No aplica (N/A)">N/A</label>
                                                                            <div class="form-text">Hora local</div>
                                                                        </div>
                                                                        <div class="col-6 col-md-3">
                                                                            <label class="form-label"
                                                                                for="mf-arr-arribo-posicion">Hora de
                                                                                entrada
                                                                                a la posición</label>
                                                                            <input type="text" class="form-control"
                                                                                id="mf-arr-arribo-posicion"
                                                                                data-time24="1" inputmode="numeric"
                                                                                placeholder="HH:MM" maxlength="5" />
                                                                            <label
                                                                                class="form-check-label ms-2 d-inline-flex align-items-center"
                                                                                for="mf-arr-arribo-posicion-na"><input
                                                                                    type="checkbox"
                                                                                    class="form-check-input me-1"
                                                                                    id="mf-arr-arribo-posicion-na"
                                                                                    title="No aplica (N/A)">N/A</label>
                                                                            <div class="form-text">Hora local</div>
                                                                        </div>
                                                                        <div class="col-6 col-md-3">
                                                                            <label class="form-label"
                                                                                for="mf-arr-inicio-desembarque">Hora
                                                                                de
                                                                                termino de maniobras de
                                                                                desembarque</label>
                                                                            <input type="text" class="form-control"
                                                                                id="mf-arr-inicio-desembarque"
                                                                                data-time24="1" inputmode="numeric"
                                                                                placeholder="HH:MM" maxlength="5" />
                                                                            <label
                                                                                class="form-check-label ms-2 d-inline-flex align-items-center"
                                                                                for="mf-arr-inicio-desembarque-na"><input
                                                                                    type="checkbox"
                                                                                    class="form-check-input me-1"
                                                                                    id="mf-arr-inicio-desembarque-na"
                                                                                    title="No aplica (N/A)">N/A</label>
                                                                            <div class="form-text">Hora local</div>
                                                                        </div>
                                                                        <div class="col-6 col-md-3">
                                                                            <label class="form-label"
                                                                                for="mf-arr-inicio-pernocta">Hora de
                                                                                inicio
                                                                                de pernocta</label>
                                                                            <input type="text" class="form-control"
                                                                                id="mf-arr-inicio-pernocta"
                                                                                data-time24="1" inputmode="numeric"
                                                                                placeholder="HH:MM" maxlength="5" />
                                                                            <label
                                                                                class="form-check-label ms-2 d-inline-flex align-items-center"
                                                                                for="mf-arr-inicio-pernocta-na"><input
                                                                                    type="checkbox"
                                                                                    class="form-check-input me-1"
                                                                                    id="mf-arr-inicio-pernocta-na"
                                                                                    title="No aplica (N/A)">N/A</label>
                                                                            <div class="form-text">Hora local</div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <!-- 9) Hora de inicio de pernocta -->

                                                        </div>
                                                        <hr />
                                                    </div>

                                                    <!-- Causas de la demora (3 filas fijas) -->
                                                    <div class="col-12">
                                                        <h6 class="mb-2 mf-section-title"><i
                                                                class="fas fa-clock me-1"></i>Causas de
                                                            la demora</h6>
                                                        <div class="row g-2 align-items-end mb-1">
                                                            <div class="col-12 col-md-3">
                                                                <label class="form-label" for="demora1-codigo">Código de
                                                                    demora</label>
                                                                <input type="text" class="form-control"
                                                                    id="demora1-codigo" list="delay-alpha-codes"
                                                                    placeholder="Escribe código (Alpha)" maxlength="3"
                                                                    autocomplete="off">
                                                            </div>
                                                            <div class="col-6 col-md-2">
                                                                <label class="form-label" for="demora1-tiempo">Tiempo
                                                                    (min)</label>
                                                                <input type="number" min="0" class="form-control"
                                                                    id="demora1-tiempo" placeholder="0">
                                                            </div>
                                                            <div class="col-12 col-md-7">
                                                                <label class="form-label"
                                                                    for="demora1-descripcion">Descripción</label>
                                                                <input type="text" class="form-control"
                                                                    id="demora1-descripcion"
                                                                    placeholder="Descripción del código">
                                                            </div>
                                                        </div>
                                                        <div class="row g-2 align-items-end mb-1">
                                                            <div class="col-12 col-md-3">
                                                                <label class="form-label" for="demora2-codigo">Código de
                                                                    demora</label>
                                                                <input type="text" class="form-control"
                                                                    id="demora2-codigo" list="delay-alpha-codes"
                                                                    placeholder="Escribe código (Alpha)" maxlength="3"
                                                                    autocomplete="off">
                                                            </div>
                                                            <div class="col-6 col-md-2">
                                                                <label class="form-label" for="demora2-tiempo">Tiempo
                                                                    (min)</label>
                                                                <input type="number" min="0" class="form-control"
                                                                    id="demora2-tiempo" placeholder="0">
                                                            </div>
                                                            <div class="col-12 col-md-7">
                                                                <label class="form-label"
                                                                    for="demora2-descripcion">Descripción</label>
                                                                <input type="text" class="form-control"
                                                                    id="demora2-descripcion"
                                                                    placeholder="Descripción del código">
                                                            </div>
                                                        </div>
                                                        <div class="row g-2 align-items-end mb-2">
                                                            <div class="col-12 col-md-3">
                                                                <label class="form-label" for="demora3-codigo">Código de
                                                                    demora</label>
                                                                <input type="text" class="form-control"
                                                                    id="demora3-codigo" list="delay-alpha-codes"
                                                                    placeholder="Escribe código (Alpha)" maxlength="3"
                                                                    autocomplete="off">
                                                            </div>
                                                            <div class="col-6 col-md-2">
                                                                <label class="form-label" for="demora3-tiempo">Tiempo
                                                                    (min)</label>
                                                                <input type="number" min="0" class="form-control"
                                                                    id="demora3-tiempo" placeholder="0">
                                                            </div>
                                                            <div class="col-12 col-md-7">
                                                                <label class="form-label"
                                                                    for="demora3-descripcion">Descripción</label>
                                                                <input type="text" class="form-control"
                                                                    id="demora3-descripcion"
                                                                    placeholder="Descripción del código">
                                                            </div>
                                                        </div>
                                                        <!-- Datalist para códigos de demora (Alpha code) con Description -->
                                                        <datalist id="delay-alpha-codes"></datalist>
                                                        <hr />
                                                    </div>

                                                    <!-- División: Pasajeros por categoría (después de Demoras) -->
                                                    <div class="col-12" data-dir="departure-only">
                                                        <h6 class="mb-2 mf-section-title"><i
                                                                class="fas fa-people-group me-1"></i>Pasajeros por
                                                            categoría
                                                        </h6>
                                                        <div class="row g-2">
                                                            <div class="col-6 col-md-3"><label class="form-label"
                                                                    for="pax-tua">Pagan TUA</label><input type="number"
                                                                    min="0" class="form-control" id="pax-tua"></div>
                                                            <div class="col-6 col-md-3"><label class="form-label"
                                                                    for="pax-diplomaticos">Diplomáticos</label><input
                                                                    type="number" min="0" class="form-control"
                                                                    id="pax-diplomaticos"></div>
                                                            <div class="col-6 col-md-3"><label class="form-label"
                                                                    for="pax-comision">En comisión</label><input
                                                                    type="number" min="0" class="form-control"
                                                                    id="pax-comision"></div>
                                                            <div class="col-6 col-md-3"><label class="form-label"
                                                                    for="pax-infantes">Infantes</label><input
                                                                    type="number" min="0" class="form-control"
                                                                    id="pax-infantes"></div>
                                                            <div class="col-6 col-md-3"><label class="form-label"
                                                                    for="pax-transitos">Tránsitos</label><input
                                                                    type="number" min="0" class="form-control"
                                                                    id="pax-transitos"></div>
                                                            <div class="col-6 col-md-3"><label class="form-label"
                                                                    for="pax-conexiones">Conexiones</label><input
                                                                    type="number" min="0" class="form-control"
                                                                    id="pax-conexiones"></div>
                                                            <div class="col-6 col-md-3"><label class="form-label"
                                                                    for="pax-exentos">Otros exentos</label><input
                                                                    type="number" min="0" class="form-control"
                                                                    id="pax-exentos"></div>
                                                            <div class="col-6 col-md-3"><label class="form-label"
                                                                    for="pax-total">Total</label><input type="number"
                                                                    min="0" class="form-control" id="pax-total"
                                                                    readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-2 mt-1">
                                                            <div class="col-12 col-md-6">
                                                                <div class="form-text">Nacionales</div>
                                                            </div>
                                                            <div class="col-12 col-md-6">
                                                                <div class="form-text">Internacionales</div>
                                                            </div>
                                                        </div>
                                                        <hr />
                                                    </div>

                                                    <!-- Embarque por estación -->
                                                    <div class="col-12" data-dir="departure-only">
                                                        <div class="d-flex align-items-center justify-content-between">
                                                            <h6 class="mb-2 mf-section-title"><i
                                                                    class="fas fa-people-carry-box me-1"></i>Tabla
                                                                de
                                                                embarque por estación</h6>
                                                            <div class="d-flex gap-2">
                                                                <button type="button" id="add-embarque-row"
                                                                    class="btn btn-sm btn-outline-secondary"><i
                                                                        class="fas fa-plus me-1"></i>Agregar
                                                                    estación</button>
                                                                <button type="button" id="clear-embarque"
                                                                    class="btn btn-sm btn-outline-secondary"><i
                                                                        class="fas fa-trash me-1"></i>Limpiar</button>
                                                            </div>
                                                        </div>
                                                        <div class="table-responsive">
                                                            <table class="table table-sm align-middle"
                                                                id="tabla-embarque">
                                                                <thead>
                                                                    <tr>
                                                                        <th>Estación</th>
                                                                        <th class="w-140px">Pax Nacional</th>
                                                                        <th class="w-160px">Pax Internacional</th>
                                                                        <th class="w-140px">Equipaje (kg)</th>
                                                                        <th class="w-140px">Carga (kg)</th>
                                                                        <th class="w-140px">Correo (kg)</th>
                                                                        <th class="w-60px"></th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody></tbody>
                                                                <tfoot>
                                                                    <tr class="table-light">
                                                                        <th>Totales</th>
                                                                        <th><label for="total-pax-nacional"
                                                                                class="visually-hidden">Total Pax
                                                                                Nacional</label><input type="number"
                                                                                class="form-control form-control-sm"
                                                                                id="total-pax-nacional" readonly>
                                                                        </th>
                                                                        <th><label for="total-pax-internacional"
                                                                                class="visually-hidden">Total Pax
                                                                                Internacional</label><input
                                                                                type="number"
                                                                                class="form-control form-control-sm"
                                                                                id="total-pax-internacional" readonly>
                                                                        </th>
                                                                        <th><label for="total-equipaje"
                                                                                class="visually-hidden">Total
                                                                                Equipaje</label><input type="text"
                                                                                class="form-control form-control-sm"
                                                                                id="total-equipaje" readonly></th>
                                                                        <th><label for="total-carga"
                                                                                class="visually-hidden">Total
                                                                                Carga</label><input type="text"
                                                                                class="form-control form-control-sm"
                                                                                id="total-carga" readonly></th>
                                                                        <th><label for="total-correo"
                                                                                class="visually-hidden">Total
                                                                                Correo</label><input type="text"
                                                                                class="form-control form-control-sm"
                                                                                id="total-correo" readonly></th>
                                                                        <th></th>
                                                                    </tr>
                                                                </tfoot>
                                                            </table>
                                                        </div>
                                                        <hr />
                                                    </div>
                                                    <div class="col-6 col-md-4" data-dir="departure-only">
                                                        <label class="form-label" for="mf-baggage-pcs">Equipaje
                                                            Piezas</label>
                                                        <input type="number" class="form-control" id="mf-baggage-pcs" />
                                                    </div>
                                                    <div class="col-6 col-md-4" data-dir="departure-only">
                                                        <label class="form-label" for="mf-cargo">Carga (kg)</label>
                                                        <input type="number" step="0.01" class="form-control"
                                                            id="mf-cargo" />
                                                    </div>
                                                    <div class="col-6 col-md-4" data-dir="departure-only">
                                                        <label class="form-label" for="mf-cargo-pieces">Carga
                                                            Piezas</label>
                                                        <input type="number" class="form-control"
                                                            id="mf-cargo-pieces" />
                                                    </div>
                                                    <div class="col-6 col-md-4" data-dir="departure-only">
                                                        <label class="form-label" for="mf-cargo-volume">Volumen
                                                            (m³)</label>
                                                        <input type="number" step="0.01" class="form-control"
                                                            id="mf-cargo-volume" />
                                                    </div>
                                                    <div class="col-6 col-md-4" data-dir="departure-only">
                                                        <label class="form-label" for="mf-mail">Correo (kg)</label>
                                                        <input type="number" step="0.01" class="form-control"
                                                            id="mf-mail" />
                                                    </div>
                                                    <div class="col-6 col-md-4" data-dir="departure-only">
                                                        <label class="form-label" for="mf-mail-pieces">Correo
                                                            Piezas</label>
                                                        <input type="number" class="form-control" id="mf-mail-pieces" />
                                                    </div>
                                                    <div class="col-12" data-dir="departure-only">
                                                        <div class="form-check form-check-inline">
                                                            <input class="form-check-input" type="checkbox"
                                                                id="mf-dangerous-goods">
                                                            <label class="form-check-label"
                                                                for="mf-dangerous-goods">Mercancías
                                                                Peligrosas</label>
                                                        </div>
                                                        <div class="form-check form-check-inline">
                                                            <input class="form-check-input" type="checkbox"
                                                                id="mf-live-animals">
                                                            <label class="form-check-label"
                                                                for="mf-live-animals">Animales
                                                                Vivos</label>
                                                        </div>
                                                        <div class="form-check form-check-inline">
                                                            <input class="form-check-input" type="checkbox"
                                                                id="mf-human-remains">
                                                            <label class="form-check-label"
                                                                for="mf-human-remains">Restos
                                                                Humanos</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-12">
                                                        <hr />
                                                    </div>
                                                    <div class="col-12 col-md-6" data-dir="departure-only">
                                                        <label class="form-label" for="mf-agent">Agente /
                                                            Responsable</label>
                                                        <input type="text" class="form-control" id="mf-agent" />
                                                    </div>
                                                    <div class="col-12 col-md-6" data-dir="departure-only">
                                                        <label class="form-label" for="mf-signature">Nombre y
                                                            Firma</label>
                                                        <input type="text" class="form-control" id="mf-signature" />
                                                    </div>
                                                    <div class="col-12" data-dir="departure-only">
                                                        <div class="row g-2">
                                                            <div class="col-12">
                                                                <label class="form-label"
                                                                    for="mf-notes">Observaciones</label>
                                                                <textarea class="form-control" id="mf-notes"
                                                                    rows="2"></textarea>
                                                            </div>
                                                            <div class="col-12 col-md-6">
                                                                <label class="form-label" for="mf-obs-transito">Carga en
                                                                    tránsito (destino/procedencia)</label>
                                                                <input type="text" class="form-control"
                                                                    id="mf-obs-transito" />
                                                            </div>
                                                            <div class="col-12 col-md-6">
                                                                <label class="form-label" for="mf-pax-dni">PAX
                                                                    DNI</label>
                                                                <input type="text" class="form-control"
                                                                    id="mf-pax-dni" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-12">
                                                        <hr />
                                                    </div>
                                                    <!-- Firmas y sellos -->
                                                    <div class="col-12" data-dir="departure-only">
                                                        <h6 class="mb-2 mf-section-title"><i
                                                                class="fas fa-signature me-1"></i>Firmas y sellos
                                                        </h6>
                                                        <div class="row g-2">
                                                            <div class="col-12 col-md-4">
                                                                <label class="form-label"
                                                                    for="mf-sign-operator">Operador
                                                                    (Nombre y Firma)</label>
                                                                <input type="text" class="form-control"
                                                                    id="mf-sign-operator" />
                                                            </div>
                                                            <div class="col-12 col-md-4">
                                                                <label class="form-label"
                                                                    for="mf-sign-coordinator">Coordinador
                                                                    de
                                                                    Rampa
                                                                    (Nombre y
                                                                    Firma)</label>
                                                                <input type="text" class="form-control"
                                                                    id="mf-sign-coordinator" />
                                                            </div>
                                                            <div class="col-12 col-md-4">
                                                                <label class="form-label"
                                                                    for="mf-sign-admin">Administrador
                                                                    AIFA - Recibido por</label>
                                                                <input type="text" class="form-control"
                                                                    id="mf-sign-admin" />
                                                            </div>
                                                            <div class="col-12 col-md-3">
                                                                <label class="form-label" for="mf-sign-admin-date">Fecha
                                                                    de
                                                                    Recepción</label>
                                                                <input type="date" class="form-control"
                                                                    id="mf-sign-admin-date" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-12 d-flex gap-2 mt-2">
                                                        <button type="button" class="btn btn-success"
                                                            id="manifest-save"><i
                                                                class="fas fa-save me-1"></i>Guardar</button>
                                                        <button type="button" class="btn btn-outline-secondary"
                                                            id="manifest-clear"><i
                                                                class="fas fa-eraser me-1"></i>Limpiar</button>
                                                        <button type="button" class="btn btn-outline-success"
                                                            id="manifest-add-to-table"
                                                            title="Agregar el formulario actual a la tabla (sin guardar)"><i
                                                                class="fas fa-plus me-1"></i>Añadir a tabla</button>
                                                        <button type="button" class="btn btn-outline-primary ms-auto"
                                                            id="manifest-export-csv"
                                                            title="Exportar registros rellenados a Excel"><i
                                                                class="fas fa-file-excel me-1"></i>Exportar
                                                            Excel</button>
                                                    </div>
                                                </form>
                                            </div>
                                            <div class="manifest-records-block mt-3">
                                                <hr />
                                                <h5 class="mb-2">Registros Guardados</h5>
                                                <p class="text-muted small mt-n2 mb-3">Tip: Usa “Añadir a tabla”
                                                    para
                                                    agregar el formulario actual aquí sin guardarlo; “Exportar
                                                    Excel”
                                                    exporta esta tabla tal cual se ve.</p>
                                                <div class="table-responsive">
                                                    <table class="table table-sm table-hover align-middle"
                                                        id="manifest-records-table">
                                                        <thead>
                                                            <tr>
                                                                <th>Tipo</th>
                                                                <th>Aerolínea</th>
                                                                <th>Vuelo</th>
                                                                <th>Matrícula</th>
                                                                <th>Fecha</th>
                                                                <th>Hora</th>
                                                                <th>Origen/Destino</th>
                                                                <th>Pax</th>
                                                                <th>Carga/Correo</th>
                                                                <th>Imagen</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody></tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>



                <!-- ABORDADORES MECANICOS SECTION -->
                <div id="abordadores-mecanicos-section" class="content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="section-heading mb-0"><i class="fas fa-cogs me-2"></i>Abordadores Mecánicos</h2>
                        <button class="btn btn-success text-white shadow-sm rounded-pill px-4"><i class="fas fa-plus me-1"></i>Registrar</button>
                    </div>

                    <div class="card shadow-sm border-0">
                         <div class="card-header bg-white border-bottom-0 pb-0">
                            <ul class="nav nav-tabs card-header-tabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link text-muted" data-bs-toggle="tab" data-bs-target="#pane-mech-aeropasillos" type="button" role="tab">Aeropasillos</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active fw-bold text-primary" data-bs-toggle="tab" data-bs-target="#pane-mech-aerocares" type="button" role="tab">Aerocares</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link text-muted" data-bs-toggle="tab" data-bs-target="#pane-mech-reportes" type="button" role="tab">Reportes</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link text-muted" data-bs-toggle="tab" data-bs-target="#pane-mech-catalogo" type="button" role="tab">Catálogo</button>
                                </li>
                            </ul>
                        </div>
                        
                        <div class="card-body bg-light">
                            <div class="tab-content">
                                <!-- Aerocares Content -->
                                <div class="tab-pane fade show active" id="pane-mech-aerocares" role="tabpanel">
                                    <h5 class="mb-3 fw-bold ps-1">Catálogo Aerocares</h5>
                                    
                                    <!-- Search Box -->
                                    <div class="card mb-3 border-0 shadow-sm">
                                        <div class="card-header bg-light fw-bold small text-muted border-0">Búsqueda</div>
                                        <div class="card-body">
                                            <div class="row g-3">
                                                <div class="col-md-5">
                                                    <label class="form-label small text-muted text-uppercase fw-bold">Aerocares:</label>
                                                    <input type="text" class="form-control" placeholder="Ingresar">
                                                </div>
                                                <div class="col-md-5">
                                                     <label class="form-label small text-muted text-uppercase fw-bold">Estatus:</label>
                                                     <select class="form-select text-muted" aria-label="Filtrar por estatus">
                                                         <option selected>Seleccionar estatus</option>
                                                         <option value="1">Activo</option>
                                                         <option value="0">Inactivo</option>
                                                     </select>
                                                </div>
                                                 <div class="col-md-2 d-flex align-items-end justify-content-end gap-2">
                                                      <button class="btn btn-light border rounded-pill px-3 text-muted">Limpiar</button>
                                                      <button class="btn btn-light border rounded-pill px-3 text-muted">Buscar</button>
                                                 </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Table -->
                                    <div class="card border-0 shadow-sm">
                                        <div class="table-responsive">
                                            <table class="table table-hover align-middle mb-0">
                                                <thead class="table-light">
                                                    <tr class="text-muted small text-uppercase">
                                                        <th class="ps-4 border-0 py-3 fw-semibold">Id</th>
                                                        <th class="border-0 py-3 fw-semibold">Aerocares</th>
                                                        <th class="border-0 py-3 fw-semibold">Fecha registro</th>
                                                        <th class="border-0 py-3 fw-semibold">Estatus</th>
                                                        <th class="text-end pe-4 border-0 py-3 fw-semibold">Acciones</th>
                                                    </tr>
                                                </thead>
                                                <tbody class="bg-white">
                                                    <!-- Mock Data -->
                                                    <tr>
                                                        <td class="ps-4 text-muted">1</td>
                                                        <td class="fw-bold text-dark">AIFA-57</td>
                                                        <td class="text-muted">12/11/2024</td>
                                                        <td><span class="badge bg-success-subtle text-success border border-success-subtle rounded-pill px-3 fw-normal">● Activo</span></td>
                                                        <td class="text-end pe-4"><button class="btn btn-sm btn-light text-primary rounded-circle" aria-label="Opciones"><i class="fas fa-ellipsis-v"></i></button></td>
                                                    </tr>
                                                    <tr>
                                                        <td class="ps-4 text-muted">2</td>
                                                        <td class="fw-bold text-dark">AIFA-58</td>
                                                        <td class="text-muted">12/11/2024</td>
                                                        <td><span class="badge bg-success-subtle text-success border border-success-subtle rounded-pill px-3 fw-normal">● Activo</span></td>
                                                        <td class="text-end pe-4"><button class="btn btn-sm btn-light text-primary rounded-circle" aria-label="Opciones"><i class="fas fa-ellipsis-v"></i></button></td>
                                                    </tr>
                                                    <tr>
                                                        <td class="ps-4 text-muted">3</td>
                                                        <td class="fw-bold text-dark">AIFA-59</td>
                                                        <td class="text-muted">12/11/2024</td>
                                                        <td><span class="badge bg-success-subtle text-success border border-success-subtle rounded-pill px-3 fw-normal">● Activo</span></td>
                                                        <td class="text-end pe-4"><button class="btn btn-sm btn-light text-primary rounded-circle" aria-label="Opciones"><i class="fas fa-ellipsis-v"></i></button></td>
                                                    </tr>
                                                    <tr>
                                                        <td class="ps-4 text-muted">4</td>
                                                        <td class="fw-bold text-dark">AIFA-60</td>
                                                        <td class="text-muted">12/11/2024</td>
                                                        <td><span class="badge bg-success-subtle text-success border border-success-subtle rounded-pill px-3 fw-normal">● Activo</span></td>
                                                        <td class="text-end pe-4"><button class="btn btn-sm btn-light text-primary rounded-circle" aria-label="Opciones"><i class="fas fa-ellipsis-v"></i></button></td>
                                                    </tr>
                                                    <tr>
                                                        <td class="ps-4 text-muted">5</td>
                                                        <td class="fw-bold text-dark">AIFA-61</td>
                                                        <td class="text-muted">12/11/2024</td>
                                                        <td><span class="badge bg-success-subtle text-success border border-success-subtle rounded-pill px-3 fw-normal">● Activo</span></td>
                                                        <td class="text-end pe-4"><button class="btn btn-sm btn-light text-primary rounded-circle" aria-label="Opciones"><i class="fas fa-ellipsis-v"></i></button></td>
                                                    </tr>
                                                     <tr>
                                                        <td class="ps-4 text-muted">6</td>
                                                        <td class="fw-bold text-dark">AIFA-62</td>
                                                        <td class="text-muted">12/11/2024</td>
                                                        <td><span class="badge bg-success-subtle text-success border border-success-subtle rounded-pill px-3 fw-normal">● Activo</span></td>
                                                        <td class="text-end pe-4"><button class="btn btn-sm btn-light text-primary rounded-circle" aria-label="Opciones"><i class="fas fa-ellipsis-v"></i></button></td>
                                                    </tr>
                                                     <tr>
                                                        <td class="ps-4 text-muted">7</td>
                                                        <td class="fw-bold text-dark">AFIFA-PR1</td>
                                                        <td class="text-muted">25/11/2024</td>
                                                        <td><span class="badge bg-success-subtle text-success border border-success-subtle rounded-pill px-3 fw-normal">● Activo</span></td>
                                                        <td class="text-end pe-4"><button class="btn btn-sm btn-light text-primary rounded-circle" aria-label="Opciones"><i class="fas fa-ellipsis-v"></i></button></td>
                                                    </tr>
                                                      <tr>
                                                        <td class="ps-4 text-muted">8</td>
                                                        <td class="fw-bold text-dark">AFA-PR2</td>
                                                        <td class="text-muted">25/11/2024</td>
                                                        <td><span class="badge bg-success-subtle text-success border border-success-subtle rounded-pill px-3 fw-normal">● Activo</span></td>
                                                        <td class="text-end pe-4"><button class="btn btn-sm btn-light text-primary rounded-circle" aria-label="Opciones"><i class="fas fa-ellipsis-v"></i></button></td>
                                                    </tr>
                                                       <tr>
                                                        <td class="ps-4 text-muted">9</td>
                                                        <td class="fw-bold text-dark">AIFA0119</td>
                                                        <td class="text-muted">10/12/2024</td>
                                                        <td><span class="badge bg-success-subtle text-success border border-success-subtle rounded-pill px-3 fw-normal">● Activo</span></td>
                                                        <td class="text-end pe-4"><button class="btn btn-sm btn-light text-primary rounded-circle" aria-label="Opciones"><i class="fas fa-ellipsis-v"></i></button></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="pane-mech-aeropasillos" role="tabpanel">
                                     <div class="d-flex flex-column align-items-center justify-content-center p-5 text-muted">
                                         <i class="fas fa-hard-hat fa-3x mb-3 text-secondary opacity-25"></i>
                                         <h5>Módulo Aeropasillos</h5>
                                         <p class="small">En construcción...</p>
                                     </div>
                                </div>
                                <div class="tab-pane fade" id="pane-mech-reportes" role="tabpanel">
                                     <div class="d-flex flex-column align-items-center justify-content-center p-5 text-muted">
                                         <i class="fas fa-file-alt fa-3x mb-3 text-secondary opacity-25"></i>
                                         <h5>Módulo Reportes</h5>
                                         <p class="small">En construcción...</p>
                                     </div>
                                </div>
                                <div class="tab-pane fade" id="pane-mech-catalogo" role="tabpanel">
                                    <div class="card shadow-sm border-0">
                                        <div class="card-header bg-white border-bottom-0">
                                            <ul class="nav nav-tabs card-header-tabs" id="mechCatalogsTabs" role="tablist">
                                                <li class="nav-item" role="presentation">
                                                    <button class="nav-link active" id="tab-mech-cat-aerocares"
                                                        data-bs-toggle="tab"
                                                        data-bs-target="#subpane-mech-cat-aerocares" type="button"
                                                        role="tab" aria-selected="true">Aerocares</button>
                                                </li>
                                                <li class="nav-item" role="presentation">
                                                    <button class="nav-link" id="tab-mech-cat-operadores"
                                                        data-bs-toggle="tab"
                                                        data-bs-target="#subpane-mech-cat-operadores" type="button"
                                                        role="tab" aria-selected="false">Operadores
                                                        Aerocares</button>
                                                </li>
                                                <li class="nav-item" role="presentation">
                                                    <button class="nav-link" id="tab-mech-cat-posiciones"
                                                        data-bs-toggle="tab"
                                                        data-bs-target="#subpane-mech-cat-posiciones" type="button"
                                                        role="tab" aria-selected="false">Posiciones
                                                        Aerocares</button>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="card-body">
                                            <div class="tab-content" id="mechCatalogsTabsContent">
                                                <!-- Aerocares -->
                                                <div class="tab-pane fade show active"
                                                    id="subpane-mech-cat-aerocares" role="tabpanel">
                                                    <div class="d-flex justify-content-between mb-3">
                                                        <h5>Listado de Aerocares</h5>
                                                        <!-- <button class="btn btn-sm btn-primary"><i class="fas fa-plus me-1"></i>Agregar</button> -->
                                                    </div>
                                                    <div id="table-aerocares-container"
                                                        class="table-responsive">
                                                        <div class="text-center py-5 text-muted">
                                                            <i class="fas fa-spinner fa-spin me-2"></i>Cargando datos de Aerocares...
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- Operadores -->
                                                <div class="tab-pane fade" id="subpane-mech-cat-operadores"
                                                    role="tabpanel">
                                                     <div class="d-flex justify-content-between mb-3">
                                                        <h5>Listado de Operadores</h5>
                                                        <!-- <button class="btn btn-sm btn-primary"><i class="fas fa-plus me-1"></i>Agregar</button> -->
                                                    </div>
                                                    <div id="table-operadores-aerocares-container"
                                                        class="table-responsive">
                                                        <div class="text-center py-5 text-muted">
                                                            <i class="fas fa-spinner fa-spin me-2"></i>Cargando datos de Operadores...
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- Posiciones -->
                                                <div class="tab-pane fade" id="subpane-mech-cat-posiciones"
                                                    role="tabpanel">
                                                     <div class="d-flex justify-content-between mb-3">
                                                        <h5>Listado de Posiciones</h5>
                                                        <!-- <button class="btn btn-sm btn-primary"><i class="fas fa-plus me-1"></i>Agregar</button> -->
                                                    </div>
                                                    <div id="table-posiciones-aerocares-container"
                                                        class="table-responsive">
                                                        <div class="text-center py-5 text-muted">
                                                            <i class="fas fa-spinner fa-spin me-2"></i>Cargando datos de Posiciones...
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <div id="pdf-lightbox" class="pdf-lightbox hidden">
        <button id="lightbox-close" class="lightbox-close">&times;</button>
        <div id="lightbox-content" class="lightbox-content"></div>
    </div>

    <!-- Modal: Instrucciones para instalar la app como PWA -->
    <div class="modal fade" id="install-app-modal" tabindex="-1" aria-labelledby="installAppModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="installAppModalLabel"><i class="fas fa-download me-2"></i>Instalar
                        Operaciones AIFA</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <div id="install-app-support" class="alert alert-info small mb-3 d-none" role="status"></div>
                    <div class="install-welcome-card mb-4">
                        <div class="install-icon-stack" role="figure"
                            aria-label="Vista previa instalada de Operaciones AIFA">
                            <span class="install-icon-glow" aria-hidden="true"></span>
                            <img src="images/icons/aifa-app-icon-192.png" alt="Icono de Operaciones AIFA"
                                class="install-icon-main" loading="lazy">
                            <span class="install-icon-caption">Operaciones AIFA</span>
                        </div>
                        <div class="install-welcome-copy">
                            <h2 class="install-welcome-title mb-2">Bienvenidos a AIFA Operaciones</h2>
                            <p class="install-welcome-text mb-3">Instala la app para acceder al panel táctil con
                                estadísticas en vivo, reportes y controles listos desde la pantalla de inicio de tu
                                dispositivo.</p>
                            <p class="install-welcome-meta small text-muted mb-0">Los íconos optimizados se generan
                                automáticamente en <code>images/icons/aifa-app-icon-512.png</code> y
                                <code>images/icons/aifa-app-icon-192.png</code>, listos para cualquier plataforma.
                            </p>
                        </div>
                    </div>
                    <p class="mb-3">Sigue estos pasos para agregar Operaciones AIFA a tu dispositivo y tener acceso
                        directo desde la pantalla de inicio o el menú de aplicaciones.</p>
                    <ul class="nav nav-pills mb-3" id="install-app-tabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="install-android-tab" data-bs-toggle="pill"
                                data-bs-target="#install-android-pane" type="button" role="tab"
                                aria-controls="install-android-pane" aria-selected="true"><i
                                    class="fab fa-android me-2"></i>Android (Chrome)</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="install-ios-tab" data-bs-toggle="pill"
                                data-bs-target="#install-ios-pane" type="button" role="tab"
                                aria-controls="install-ios-pane" aria-selected="false"><i
                                    class="fab fa-apple me-2"></i>iOS / iPadOS (Safari)</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="install-desktop-chrome-tab" data-bs-toggle="pill"
                                data-bs-target="#install-desktop-chrome-pane" type="button" role="tab"
                                aria-controls="install-desktop-chrome-pane" aria-selected="false"><i
                                    class="fab fa-chrome me-2"></i>Windows / macOS (Chrome, Edge)</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="install-desktop-safari-tab" data-bs-toggle="pill"
                                data-bs-target="#install-desktop-safari-pane" type="button" role="tab"
                                aria-controls="install-desktop-safari-pane" aria-selected="false"><i
                                    class="fas fa-compass me-2"></i>macOS (Safari)</button>
                        </li>
                    </ul>
                    <div class="tab-content" id="install-app-tab-content">
                        <div class="tab-pane fade show active" id="install-android-pane" role="tabpanel"
                            aria-labelledby="install-android-tab">
                            <ol class="ps-3">
                                <li>Abre esta página en Chrome para Android.</li>
                                <li>Toca el ícono de menú (tres puntos) en la esquina superior derecha.</li>
                                <li>Selecciona <strong>Añadir a pantalla principal</strong> y confirma.</li>
                                <li>Chrome creará el acceso directo con el ícono de Operaciones AIFA.</li>
                            </ol>
                        </div>
                        <div class="tab-pane fade" id="install-ios-pane" role="tabpanel"
                            aria-labelledby="install-ios-tab">
                            <ol class="ps-3">
                                <li>Abre la página en Safari.</li>
                                <li>Toca el botón <strong>Compartir</strong> (cuadro con flecha hacia arriba).</li>
                                <li>Elige <strong>Añadir a pantalla de inicio</strong>.</li>
                                <li>Opcional: ajusta el nombre a mostrar y toca <strong>Añadir</strong>.</li>
                            </ol>
                            <p class="small text-muted mb-0">iOS no muestra el aviso automático, por lo que estos pasos
                                son manuales.</p>
                        </div>
                        <div class="tab-pane fade" id="install-desktop-chrome-pane" role="tabpanel"
                            aria-labelledby="install-desktop-chrome-tab">
                            <ol class="ps-3">
                                <li>Abre la página en Chrome o Edge.</li>
                                <li>Haz clic en el ícono de <strong>Instalar</strong> (bandeja con flecha) en la barra
                                    de direcciones.</li>
                                <li>Confirma la instalación cuando el navegador lo solicite.</li>
                                <li>El acceso se añadirá al menú inicio o lista de aplicaciones.</li>
                            </ol>
                        </div>
                        <div class="tab-pane fade" id="install-desktop-safari-pane" role="tabpanel"
                            aria-labelledby="install-desktop-safari-tab">
                            <ol class="ps-3">
                                <li>Abre la página en Safari para macOS.</li>
                                <li>En el menú <strong>Archivo</strong>, selecciona <strong>Añadir a Dock</strong>.</li>
                                <li>Elige la ubicación y confirma.</li>
                                <li>El icono quedará disponible en el Dock para acceso directo.</li>
                            </ol>
                            <p class="small text-muted mb-0">Safari solo muestra el menú cuando la PWA cumple los
                                criterios de Apple.</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="install-app-modal-install-btn" class="btn btn-primary" type="button"><i
                            class="fas fa-download me-2"></i>Intentar instalación automática</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Selección de dirección del vuelo (Llegada/Salida) -->
    <div class="modal fade" id="mfDirectionModal" tabindex="-1" aria-labelledby="mfDirectionModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="mfDirectionModalLabel"><i class="fas fa-plane me-2"></i>¿Qué tipo de
                        documento es?</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-3">Selecciona la dirección del vuelo para completar el manifiesto.</p>
                    <div class="d-flex gap-2">
                        <button type="button" id="mfDirChooseArr" class="btn btn-primary flex-fill"><i
                                class="fas fa-plane-arrival me-1"></i>Llegada</button>
                        <button type="button" id="mfDirChooseDep" class="btn btn-success flex-fill"><i
                                class="fas fa-plane-departure me-1"></i>Salida</button>
                    </div>
                    <div class="form-text mt-2">Puedes cambiarlo después si es necesario.</div>
                </div>
            </div>
        </div>
    </div>

    <div class="position-fixed bottom-0 end-0 p-3 z-2050">
        <div id="action-toast" class="toast align-items-center text-bg-primary border-0" role="alert"
            aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body">Filtros limpiados</div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                    aria-label="Cerrar"></button>
            </div>
        </div>
    </div>

    <!-- Time Picker Modal (24h) -->
    <div class="modal fade" id="timePickerModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered max-w-360">
            <div class="modal-content">
                <div class="modal-header py-2">
                    <h6 class="modal-title"><i class="fas fa-clock me-2"></i>Seleccionar hora (24h)</h6>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex align-items-center justify-content-between mb-2">
                        <div class="w-50 pe-1">
                            <label class="form-label small">Horas (00–23)</label>
                            <input type="number" min="0" max="23" step="1" class="form-control" id="tp-hours"
                                value="00">
                        </div>
                        <div class="w-50 ps-1">
                            <label class="form-label small">Minutos (00–59)</label>
                            <input type="number" min="0" max="59" step="1" class="form-control" id="tp-mins" value="00">
                        </div>
                    </div>
                    <div class="d-flex flex-wrap gap-1 mt-2">
                        <div class="small text-muted">Atajos:</div>
                        <button type="button" class="btn btn-sm btn-outline-secondary" data-tp="00:00">00:00</button>
                        <button type="button" class="btn btn-sm btn-outline-secondary" data-tp="06:00">06:00</button>
                        <button type="button" class="btn btn-sm btn-outline-secondary" data-tp="12:00">12:00</button>
                        <button type="button" class="btn btn-sm btn-outline-secondary" data-tp="18:00">18:00</button>
                        <button type="button" class="btn btn-sm btn-outline-secondary" data-tp="23:59">23:59</button>
                    </div>
                </div>
                <div class="modal-footer py-2">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="tp-apply">Aplicar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <!-- SheetJS (XLSX) para exportar manifiestos a Excel en el cliente -->
    <!-- Cargar desde CDN; si no hay red, la exportación caerá a CSV automáticamente -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <!-- Fallbacks y manejador de errores de imágenes (se define antes de script.js) -->
    <script>
        // Wire "Ver en Pantalla Completa" button to open iframe src in a new tab (mobile-friendly)
        (function () {
            document.addEventListener('DOMContentLoaded', function () {
                document.querySelectorAll('[data-fullscreen-target]').forEach(btn => {
                    if (btn._wiredFullscreen) return; btn._wiredFullscreen = true;
                    btn.addEventListener('click', function () {
                        const sel = btn.getAttribute('data-fullscreen-target');
                        if (!sel) return;
                        const iframe = document.querySelector(sel);
                        const url = iframe && iframe.getAttribute('src');
                        if (url) {
                            // Construye URL absoluta para que funcione bajo file:// y http(s)
                            const fullUrl = new URL(url, window.location.href).href;
                            window.open(fullUrl, '_blank');
                        }
                    });
                });
            });
        })();
    </script>
    <script>
        (function () {
            // Fallback para renderDemoras si no existe
            if (typeof window.renderDemoras !== 'function') {
                window.renderDemoras = function (data) {
                    console.warn('renderDemoras() fallback ejecutado.');
                    try {
                        const tbody = document.getElementById('demoras-tbody');
                        const tfoot = document.getElementById('demoras-tfoot');
                        if (!tbody) return;

                        tbody.innerHTML = '';
                        let total = 0;

                        if (Array.isArray(data)) {
                            data.forEach(row => {
                                const tr = document.createElement('tr');
                                tr.innerHTML = `
                                    <td>${row?.causa ?? '—'}</td>
                                    <td>${row?.demoras ?? 0}</td>
                                    <td>${row?.porcentaje ?? 0}%</td>`;
                                tbody.appendChild(tr);
                                total += Number(row?.demoras ?? 0);
                            });
                        }

                        if (tfoot) {
                            tfoot.innerHTML = `<tr class="table-light"><th>Total</th><th>${total}</th><th></th></tr>`;
                        }

                        // Crea una gráfica simple si hay datos y canvas disponible
                        const ctx = document.getElementById('delaysChart')?.getContext?.('2d');
                        if (ctx && window.Chart && !window._delaysChart) {
                            const labels = (data || []).map(r => r?.causa ?? '');
                            const values = (data || []).map(r => Number(r?.demoras ?? 0));
                            window._delaysChart = new Chart(ctx, {
                                type: 'bar',
                                data: {
                                    labels,
                                    datasets: [{
                                        label: 'Demoras',
                                        data: values,
                                        backgroundColor: '#0d6efd77',
                                        borderColor: '#0d6efd'
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: { legend: { display: false } }
                                }
                            });
                        }
                    } catch (err) {
                        console.error('Fallback renderDemoras error:', err);
                    }
                };
            }

            // Fallback para computeDailyStats si no existe
            if (typeof window.computeDailyStats !== 'function') {
                window.computeDailyStats = function (itinerary) {
                    console.warn('computeDailyStats() fallback ejecutado.');
                    // Devuelve estructura mínima para no romper la UI; reemplace con lógica real en script.js
                    return {
                        comercial: { ayer: 0, hoy: 0, trend: '=' },
                        carga: { ayer: 0, hoy: 0, trend: '=' },
                        general: { ayer: 0, hoy: 0, trend: '=' }
                    };
                };
            }

            // Reemplazo global de imágenes que fallen (ej. logos de aerolíneas faltantes)
            document.addEventListener('error', function (e) {
                const t = e.target;
                if (t && t.tagName === 'IMG') {
                    // Deja que las imágenes de aerolíneas usen su propio fallback (handleLogoError)
                    if (t.classList && t.classList.contains('airline-logo')) return;
                    // Evita loops infinitos
                    if (t.dataset.fallbackApplied === '1') return;
                    t.dataset.fallbackApplied = '1';
                    console.warn('Reemplazando imagen no encontrada:', t.src);
                    // Usar fallback local consistente (evita dominios externos)
                    t.src = 'images/airlines/default-airline-logo.svg';
                }
            }, true);

            // Fallback de inicio de sesión: DESHABILITADO por seguridad (no se permite auto-login ni bypass del manejador principal)
            // Este bloque se dejó intencionalmente vacío.
        })();
    </script>


    <!-- Modular JS (non-invasive): delegates to existing functions in script.js -->
    <script src="js/core.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/inicio.js"></script>
    <script src="js/itinerario.js?v=3"></script>
    <script src="js/demoras.js"></script>
    <script src="js/analisis-operaciones.js?v=2"></script>
    <script src="js/operaciones.js"></script>
    <script src="js/frecuencias.js"></script>
    <script src="js/frecuencias_auto.js?v=2"></script>
    <script src="js/frecuencias_auto_int.js?v=2"></script>
    <script src="js/frecuencias_auto_cargo.js?v=2"></script>
    <script src="js/manifiestos.js"></script>
    <script src="js/manifiestos-analisis.js"></script>
    <script src="js/medicas.js?v=2"></script>
    <script src="js/fauna.js"></script>

    <script src="js/data-manager.js"></script>
    <script src="js/permissions.js"></script>
    <script src="js/admin-ui.js"></script>
    <script src="js/aerocares.js"></script>
    <script src="js/init-data.js"></script>
    <script src="js/data-management.js"></script>
    <script src="js/parte-ops-tab.js"></script>
    <script src="js/itinerario-tab.js"></script>
    <script src="js/comparativa.js"></script>
    <script src="js/parte-ops-flights.js?v=2.2"></script>
    <script>
    // ---- Conciliación Board View ----
    async function toggleConciliacionBoard() {
        const board   = document.getElementById('conciliacion-board-view');
        const csvView = document.getElementById('conciliacion-csv-view');
        const btn     = document.getElementById('btn-conciliacion-board');
        if (!board || !csvView) return;

        const showingBoard = !board.classList.contains('d-none');

        if (showingBoard) {
            // Regresar a CSV
            board.classList.add('d-none');
            csvView.classList.remove('d-none');
            if (btn) { btn.classList.remove('btn-primary'); btn.classList.add('btn-outline-primary'); }
            return;
        }

        // Mostrar Board, ocultar CSV
        csvView.classList.add('d-none');
        board.classList.remove('d-none');
        if (btn) { btn.classList.add('btn-primary'); btn.classList.remove('btn-outline-primary'); }

        // Spinners mientras carga
        const tbodyArr = document.getElementById('tbody-board-arrivals');
        const tbodyDep = document.getElementById('tbody-board-departures');
        const spinner  = `<tr><td colspan="7" class="text-center py-3"><span class="spinner-border spinner-border-sm text-secondary"></span></td></tr>`;
        if (tbodyArr) tbodyArr.innerHTML = spinner;
        if (tbodyDep) tbodyDep.innerHTML = spinner;

        // Cargar datos si no hay
        let data = (window.opsFlights && typeof window.opsFlights.getData === 'function') ? window.opsFlights.getData() : [];
        if (!data || data.length === 0) {
            if (window.opsFlights && typeof window.opsFlights.loadFlights === 'function') {
                await window.opsFlights.loadFlights();
            }
        }

        renderConciliacionBoard();
    }

    function renderConciliacionBoard() {
        const data = (window.opsFlights && typeof window.opsFlights.getData === 'function')
            ? window.opsFlights.getData()
            : [];

        const tbodyArr = document.getElementById('tbody-board-arrivals');
        const tbodyDep = document.getElementById('tbody-board-departures');
        const cntArr   = document.getElementById('board-arr-count');
        const cntDep   = document.getElementById('board-dep-count');
        const footArr  = document.getElementById('board-arr-footer');
        const footDep  = document.getElementById('board-dep-footer');

        const arrivals   = (data || []).filter(r => (r['[Arr] Flight Designator'] || '').trim());
        const departures = (data || []).filter(r => (r['[Dep] Flight Designator'] || '').trim());

        if (cntArr)  cntArr.textContent  = arrivals.length   + ' vuelos';
        if (cntDep)  cntDep.textContent  = departures.length + ' vuelos';
        if (footArr) footArr.textContent = arrivals.length;
        if (footDep) footDep.textContent = departures.length;

        function statusBadge(status) {
            const s = (status || '').toLowerCase();
            let cls = 'bg-secondary';
            if (s.includes('block'))                                   cls = 'bg-success';
            else if (s.includes('activated') || s.includes('active')) cls = 'bg-success';
            else if (s.includes('cancel'))                             cls = 'bg-danger';
            else if (s.includes('delay'))                              cls = 'bg-warning text-dark';
            return `<span class="badge ${cls} text-wrap" style="min-width:80px;font-size:.75rem;">${status || ''}</span>`;
        }
        function esc(v) {
            return String(v || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
        }
        // Alternating bg: even rows white, odd rows light gray
        function rowBg(i) { return i % 2 === 0 ? '#ffffff' : '#f0f4f8'; }

        if (tbodyArr) {
            if (!arrivals.length) {
                tbodyArr.innerHTML = '<tr><td colspan="7" class="text-muted py-4">Sin datos de llegadas. Importa un CSV primero.</td></tr>';
            } else {
                tbodyArr.innerHTML = arrivals.map((r, i) => {
                    const reg = esc(r['Registration']);
                    const fecha = parseBoardDate(r['[Arr] SIBT'] || r['[Arr] AIBT'] || '');
                    return `
                    <tr data-registration="${reg}" data-board-type="arr" data-fecha="${fecha}"
                        onclick="selectBoardFlight(this,'arr')"
                        style="cursor:pointer;background:${rowBg(i)};transition:background .15s;">
                        <td>${statusBadge(r['Status'])}</td>
                        <td class="fw-bold">${esc(r['[Arr] Flight Designator'])}</td>
                        <td>${esc(r['[Arr] SIBT'])}</td>
                        <td>${esc(r['[Arr] AIBT'])}</td>
                        <td>${esc(r['Routing'])}</td>
                        <td>${esc(r['Aircraft type'])}</td>
                        <td><span class="badge bg-light text-dark border">${reg}</span></td>
                    </tr>`;
                }).join('');
            }
        }

        if (tbodyDep) {
            if (!departures.length) {
                tbodyDep.innerHTML = '<tr><td colspan="7" class="text-muted py-4">Sin datos de salidas. Importa un CSV primero.</td></tr>';
            } else {
                tbodyDep.innerHTML = departures.map((r, i) => {
                    const reg = esc(r['Registration']);
                    const fecha = parseBoardDate(r['[Dep] SOBT'] || r['[Dep] AOBT'] || '');
                    return `
                    <tr data-registration="${reg}" data-board-type="dep" data-fecha="${fecha}"
                        onclick="selectBoardFlight(this,'dep')"
                        style="cursor:pointer;background:${rowBg(i)};transition:background .15s;">
                        <td>${statusBadge(r['Status'])}</td>
                        <td class="fw-bold">${esc(r['[Dep] Flight Designator'])}</td>
                        <td>${esc(r['[Dep] SOBT'])}</td>
                        <td>${esc(r['[Dep] AOBT'])}</td>
                        <td>${esc(r['Routing'])}</td>
                        <td>${esc(r['Aircraft type'])}</td>
                        <td><span class="badge bg-light text-dark border">${reg}</span></td>
                    </tr>`;
                }).join('');
            }
        }

        // Re-apply any active filters after a fresh render
        filterBoardTables();
    }

    /**
     * Filters both board tables (Llegadas + Salidas) cooperatively:
     * global search + per-column inputs all work together.
     */
    function filterBoardTables() {
        const globalTerm = (document.getElementById('board-global-search') || {}).value || '';
        const gt = globalTerm.trim().toLowerCase();

        ['arr', 'dep'].forEach(side => {
            const tbody = document.getElementById(`tbody-board-${side === 'arr' ? 'arrivals' : 'departures'}`);
            const badge = document.getElementById(`board-${side}-count`);
            const footer = document.getElementById(`board-${side}-footer`);
            if (!tbody) return;

            // Collect column filter values for this table
            const colInputs = Array.from(
                document.querySelectorAll(`.board-col-filter[data-table="${side}"]`)
            );

            // Date window for this side
            const ds = boardDateState[side];
            let dateFrom = null, dateTo = null;
            if (ds && ds.active) {
                const win = _getBoardDateWindow(side);
                dateFrom = win.from;
                dateTo   = win.to;
            }

            let visible = 0;
            const rows = Array.from(tbody.querySelectorAll('tr'));
            const total = rows.length;

            rows.forEach(r => {
                const text = r.textContent.toLowerCase();

                // Global search
                if (gt && !text.includes(gt)) {
                    r.style.display = 'none';
                    return;
                }

                // Column filters (cooperative: all must match)
                let show = true;
                colInputs.forEach((inp, colIdx) => {
                    const term = inp.value.trim().toLowerCase();
                    if (!term) return;
                    const cell = r.cells[colIdx];
                    if (cell && !cell.textContent.toLowerCase().includes(term)) {
                        show = false;
                    }
                });

                // Date filter
                if (show && dateFrom && dateTo) {
                    const fecha = r.getAttribute('data-fecha') || '';
                    if (!fecha || fecha < dateFrom || fecha > dateTo) show = false;
                }

                r.style.display = show ? '' : 'none';
                if (show) visible++;
            });

            // Update badges + footer with filtered / total count
            const hasFilter = gt || colInputs.some(i => i.value.trim()) || (ds && ds.active);
            const label = hasFilter ? `${visible} / ${total} vuelos` : `${total} vuelos`;
            if (badge)  badge.textContent  = label;
            if (footer) footer.textContent = hasFilter ? `${visible} / ${total}` : String(total);
        });
    }

    function clearBoardColFilters(side) {
        document.querySelectorAll(`.board-col-filter[data-table="${side}"]`).forEach(inp => inp.value = '');
        filterBoardTables();
    }

    /* ── Board Date Filter State & Functions ───────────────────────── */
    const boardDateState = {
        arr: { mode: 'rel', relStart: -4, relEnd: 0, absDate: '', active: false },
        dep: { mode: 'rel', relStart: -4, relEnd: 0, absDate: '', active: false }
    };

    /** Parse "26JAN 13:05" or "26JAN\n13:05" → "YYYY-MM-DD" */
    function parseBoardDate(str) {
        if (!str) return '';
        const months = { JAN:0,FEB:1,MAR:2,APR:3,MAY:4,JUN:5,JUL:6,AUG:7,SEP:8,OCT:9,NOV:10,DEC:11 };
        const m = String(str).trim().match(/^(\d{1,2})([A-Z]{3})/);
        if (!m) return '';
        const day = parseInt(m[1], 10);
        const mon = months[m[2]];
        if (mon === undefined) return '';
        const now = new Date();
        let year = now.getFullYear();
        const candidate = new Date(year, mon, day);
        // If the date is more than 60 days in the future, it belongs to the previous year
        if (candidate - now > 60 * 86400 * 1000) year--;
        return `${year}-${String(mon + 1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
    }

    function _getBoardDateWindow(side) {
        const ds = boardDateState[side];
        if (ds.mode === 'abs') {
            return { from: ds.absDate, to: ds.absDate };
        }
        const today = new Date();
        function offsetDate(d, days) {
            const r = new Date(d); r.setDate(r.getDate() + days);
            return r.toISOString().slice(0,10);
        }
        const s = parseInt(document.getElementById(`board-${side}-rel-start`)?.value ?? ds.relStart, 10);
        const e = parseInt(document.getElementById(`board-${side}-rel-end`)?.value   ?? ds.relEnd,   10);
        const from = offsetDate(today, Math.min(s, e));
        const to   = offsetDate(today, Math.max(s, e));
        return { from, to };
    }

    function _updateBoardDateLabels(side) {
        const win = _getBoardDateWindow(side);
        const fmt = d => d ? new Date(d + 'T12:00:00').toLocaleDateString('es-MX',{day:'numeric',month:'short',year:'numeric'}) : '—';
        const sl = document.getElementById(`board-${side}-rel-start-label`);
        const el = document.getElementById(`board-${side}-rel-end-label`);
        if (sl) sl.textContent = fmt(win.from);
        if (el) el.textContent = fmt(win.to);
    }

    function toggleBoardDatePanel(side) {
        const panel = document.getElementById(`board-date-panel-${side}`);
        if (!panel) return;
        const opening = panel.classList.contains('d-none');
        // Close both panels first
        ['arr','dep'].forEach(s => {
            document.getElementById(`board-date-panel-${s}`)?.classList.add('d-none');
        });
        if (opening) {
            panel.classList.remove('d-none');
            // Only update labels — do NOT auto-apply the filter.
            // The filter activates only when the user explicitly changes a control.
            _updateBoardDateLabels(side);
        }
    }

    function setBoardDateMode(side, mode) {
        const ds = boardDateState[side];
        ds.mode = mode;
        const relEl  = document.getElementById(`board-${side}-rel-mode`);
        const absEl  = document.getElementById(`board-${side}-abs-mode`);
        const btnRel = document.getElementById(`board-${side}-mode-rel`);
        const btnAbs = document.getElementById(`board-${side}-mode-abs`);
        if (relEl) relEl.classList.toggle('d-none', mode !== 'rel');
        if (absEl) absEl.classList.toggle('d-none', mode !== 'abs');
        if (btnRel) { btnRel.classList.toggle('active', mode === 'rel'); }
        if (btnAbs) { btnAbs.classList.toggle('active', mode === 'abs'); }
        if (mode === 'rel') _updateBoardDateLabels(side);
        // Do NOT auto-apply on mode switch — wait for user to press Aplicar or pick a date.
    }

    function stepBoardOffset(side, which, delta) {
        const inp = document.getElementById(`board-${side}-rel-${which}`);
        if (!inp) return;
        inp.value = parseInt(inp.value, 10) + delta;
        applyBoardDateFilter(side);
    }

    function applyBoardDateFilter(side) {
        const ds = boardDateState[side];
        const win = _getBoardDateWindow(side);
        ds.active = !!(win.from && win.to);
        if (ds.mode === 'rel') {
            ds.relStart = parseInt(document.getElementById(`board-${side}-rel-start`)?.value ?? ds.relStart, 10);
            ds.relEnd   = parseInt(document.getElementById(`board-${side}-rel-end`)?.value   ?? ds.relEnd,   10);
            _updateBoardDateLabels(side);
        } else {
            ds.absDate = document.getElementById(`board-${side}-abs-date`)?.value || '';
            ds.active  = !!ds.absDate;
        }
        const btn = document.getElementById(`btn-board-date-${side}`);
        if (btn) btn.classList.toggle('active-date-filter', ds.active);
        // Close the panel after applying so the view stays clean.
        // The yellow funnel shows the filter is active; click it again to adjust.
        document.getElementById(`board-date-panel-${side}`)?.classList.add('d-none');
        filterBoardTables();
    }

    function clearBoardDateFilter(side) {
        const ds = boardDateState[side];
        ds.active = false; ds.mode = 'rel'; ds.relStart = -4; ds.relEnd = 0;
        ds.absDate = '';
        const rs = document.getElementById(`board-${side}-rel-start`);
        const re = document.getElementById(`board-${side}-rel-end`);
        const ad = document.getElementById(`board-${side}-abs-date`);
        if (rs) rs.value = '-4'; if (re) re.value = '0';
        if (ad) ad.value = '';
        setBoardDateMode(side, 'rel');
        const btn = document.getElementById(`btn-board-date-${side}`);
        if (btn) btn.classList.remove('active-date-filter');
        _updateBoardDateLabels(side);
        filterBoardTables();
    }

    function selectBoardFlight(row, type) {
        const reg = row.getAttribute('data-registration');
        const wasSelected = row.classList.contains('board-selected');

        // Apply bg to every <td> in the row to override Bootstrap's CSS-variable hover system
        function paintRow(tr, color) {
            tr.style.background = color;
            Array.from(tr.cells).forEach(td => td.style.setProperty('background-color', color, 'important'));
        }
        function clearRow(tr, i) {
            const bg = i % 2 === 0 ? '#ffffff' : '#f0f4f8';
            tr.style.background = bg;
            Array.from(tr.cells).forEach(td => td.style.removeProperty('background-color'));
        }
        function restoreBg(tbody) {
            Array.from(tbody.children).forEach((r, i) => {
                r.classList.remove('board-selected', 'board-linked', 'board-paired');
                clearRow(r, i);
            });
        }

        const tbodyArr = document.getElementById('tbody-board-arrivals');
        const tbodyDep = document.getElementById('tbody-board-departures');
        restoreBg(tbodyArr);
        restoreBg(tbodyDep);

        if (wasSelected) return; // Second click → deselect

        // Highlight selected row amber/yellow
        paintRow(row, '#ffe082');
        row.classList.add('board-selected');

        if (!reg) return;

        // Find linked row in the other table (same Registration).
        // Only highlight if it is currently visible (not hidden by an active filter).
        const otherTbodyId = type === 'arr' ? 'tbody-board-departures' : 'tbody-board-arrivals';
        const escReg = reg.replace(/"/g, '\\"');
        const linked = document.querySelector(`#${otherTbodyId} tr[data-registration="${escReg}"]`);
        if (linked && linked.style.display !== 'none') {
            paintRow(linked, '#ffe082');
            linked.classList.add('board-linked');
            linked.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
    }
    </script>
    <script src="js/analisis-mensual.js?v=1.0"></script>
    <script src="js/analisis-anual.js?v=1.0"></script>
    <script>
    (function() { 
        /* 
           EMERGENCY COLUMN VISIBILITY PATCH (v3)
           This script runs immediately and periodically to enforce column hiding 
           regardless of caching or specificity issues in external files.
        */
        function forceUpdateVisibility() {
            const tableId = '#table-ops-flights-csv';
            const table = document.querySelector(tableId);
            if (!table) return;

            // Gather hidden columns from checkboxes
            const hiddenCols = new Set();
            document.querySelectorAll('.col-toggle-csv').forEach(cb => {
                if (!cb.checked) {
                    const col = cb.getAttribute('data-col');
                    if(col) hiddenCols.add(col);
                }
            });

            // Map headers to classes to handle indices
            const headers = [
                'Status', '[Arr] Airline code', '[Arr] Flight Designator', '[Arr] ALDT', '[Arr] SIBT', '[Arr] AIBT',
                '[Arr] Stand', '[Arr] Gates', '[Arr] Boarded', '[Arr] Baggage Belts', '[Arr] Service Type', 'Routing',
                '[Dep] Service Type', 'Aircraft type', 'Registration', '[Dep] Airline code', '[Dep] Flight Designator',
                '[Dep] Stand', '[Dep] Gates', '[Dep] Boarded', '[Dep] SOBT', '[Dep] AOBT', '[Dep] ATOT', '[Dep] ATTT'
            ];
            const headerMap = {
                'Status': 'col-cvs-status',
                '[Arr] Airline code': 'col-cvs-arr-airline',
                '[Arr] Flight Designator': 'col-cvs-arr-flight',
                '[Arr] ALDT': 'col-cvs-arr-aldt',
                '[Arr] SIBT': 'col-cvs-arr-sibt',
                '[Arr] AIBT': 'col-cvs-arr-aibt',
                '[Arr] Stand': 'col-cvs-arr-stand',
                '[Arr] Gates': 'col-cvs-arr-gates',
                '[Arr] Boarded': 'col-cvs-arr-boarded',
                '[Arr] Baggage Belts': 'col-cvs-arr-belts',
                '[Arr] Service Type': 'col-cvs-arr-type',
                'Routing': 'col-cvs-routing',
                '[Dep] Service Type': 'col-cvs-dep-type',
                'Aircraft type': 'col-cvs-aircraft',
                'Registration': 'col-cvs-reg',
                '[Dep] Airline code': 'col-cvs-dep-airline',
                '[Dep] Flight Designator': 'col-cvs-dep-flight',
                '[Dep] Stand': 'col-cvs-dep-stand',
                '[Dep] Gates': 'col-cvs-dep-gates',
                '[Dep] Boarded': 'col-cvs-dep-boarded',
                '[Dep] SOBT': 'col-cvs-dep-sobt',
                '[Dep] AOBT': 'col-cvs-dep-aobt',
                '[Dep] ATOT': 'col-cvs-dep-atot',
                '[Dep] ATTT': 'col-cvs-dep-attt'
            };

            // 1. Apply Global CSS
            let css = '';
            hiddenCols.forEach(cls => {
                // Class selector
                css += `${tableId} .${cls}, ${tableId} th.${cls}, ${tableId} td.${cls} { display: none !important; } `;
                // Index selector
                const index = headers.findIndex(h => headerMap[h] === cls);
                if (index !== -1) {
                    css += `${tableId} tr > *:nth-child(${index + 1}) { display: none !important; } `;
                }
            });

            let style = document.getElementById('force-csv-style-inline');
            if (!style) {
                style = document.createElement('style');
                style.id = 'force-csv-style-inline';
                document.head.appendChild(style);
            }
            if (style.textContent !== css) {
                style.textContent = css;
            }

            // 2. Apply Inline Styles (Iterate rows)
            const rows = table.querySelectorAll('tr');
            rows.forEach(row => {
               const cells = Array.from(row.children);
               cells.forEach((cell, idx) => {
                   let shouldHide = false;
                   
                   // Check by Class
                   if (cell.className && typeof cell.className === 'string') {
                       const classes = cell.className.split(/\s+/);
                       if (classes.some(c => hiddenCols.has(c))) shouldHide = true;
                   }
                   
                   // Check by Index
                   if (!shouldHide && idx < headers.length) {
                       const hName = headers[idx];
                       const hClass = headerMap[hName];
                       if (hiddenCols.has(hClass)) shouldHide = true;
                   }

                   if (shouldHide) {
                       cell.style.setProperty('display', 'none', 'important');
                   } else {
                       // Only remove if it was set by us (optimization: check if it is 'none')
                       if (cell.style.display === 'none') {
                            // If we are here, it means it is NOT in hiddenCols currently
                            cell.style.display = '';
                       }
                   }
               });
            });
        }

        // Attach to window for debug
        window.forceCsvUpdate = forceUpdateVisibility;

        // Auto-run loop
        setInterval(forceUpdateVisibility, 500);

        // Listen for changes
        document.addEventListener('change', (e) => {
            if (e.target && e.target.classList.contains('col-toggle-csv')) {
                // Delay slightly to let the checkbox state update
                setTimeout(forceUpdateVisibility, 10);
            }
        });
    })();
    </script>
    <script src="js/frecuencias_upload_test.js"></script>
    <script src="script.js?v=20260203"></script>
    <script src="js/puntualidad.js"></script>
    <script>
        // Modo DEV: bloquear por completo el registro de Service Workers en localhost/127.0.0.1 o con bandera noSW
        (function noSWDevGuard() {
            try {
                const params = new URLSearchParams(location.search);
                const flag = params.get('noSW') === '1' || localStorage.getItem('aifa.noSW') === '1';
                const isLocalHost = /^(localhost|127\.0\.0\.1)$/i.test(location.hostname) || location.protocol === 'file:';
                const devNoSW = flag || isLocalHost;
                if (!devNoSW) { window.__NO_SW__ = false; return; }
                window.__NO_SW__ = true;
                if (navigator.serviceWorker && typeof navigator.serviceWorker.register === 'function') {
                    const sw = navigator.serviceWorker;
                    const originalRegister = sw.register.bind(sw);
                    sw.register = async function () {
                        console.warn('[noSW] Registro de Service Worker bloqueado en modo dev');
                        throw new Error('Dev mode: Service Worker disabled');
                    };
                    // Opcional: informar si algún script intenta registrar
                    console.info('[noSW] Modo DEV activo: Service Worker deshabilitado (host local o flag noSW)');
                }
            } catch (e) { /* noop */ }
        })();
    </script>
    <script>
        // Mostrar advertencia si se abre con file:// (CORS bloqueará fetch de CSV/JSON)
        (function warnIfFileProtocol() {
            try {
                if (location.protocol === 'file:') {
                    const el = document.getElementById('file-protocol-warning');
                    if (el) el.classList.remove('d-none');
                }
            } catch (_) { }
        })();
    </script>
    <script>
        // Asegurar que el overlay del sidebar nunca quede activo por error al cargar
        (function ensureOverlayOff() {
            try {
                const ov = document.getElementById('sidebar-overlay');
                if (ov) ov.classList.remove('active');
            } catch (_) { }
        })();
    </script>
    <script>
        (function initServicioMedicoDoc() {
            function formatGoogleDocUrl(raw) {
                if (!raw) return '';
                const trimmed = String(raw).trim();
                if (!trimmed || trimmed.includes('TU_ID_DE_DOCUMENTO')) return '';
                try {
                    const candidate = new URL(trimmed, window.location.href);
                    if (!/docs\.google\.com$/i.test(candidate.hostname)) return trimmed;
                    const match = candidate.pathname.match(/\/document\/d\/([^/]+)/);
                    if (match && match[1]) {
                        return `https://docs.google.com/document/d/${match[1]}/preview`;
                    }
                    const sheetMatch = candidate.pathname.match(/\/spreadsheets\/d\/([^/]+)/);
                    if (sheetMatch && sheetMatch[1]) {
                        const gid = candidate.searchParams.get('gid');
                        const hash = gid ? `#gid=${gid}` : '';
                        return `https://docs.google.com/spreadsheets/d/${sheetMatch[1]}/preview${hash}`;
                    }
                } catch (_) {
                    return trimmed;
                }
                return trimmed;
            }

            document.addEventListener('DOMContentLoaded', function () {
                const wrapper = document.getElementById('servicio-medico-embed');
                if (!wrapper) return;
                const frameShell = wrapper.querySelector('.doc-embed-frame');
                const frame = frameShell ? frameShell.querySelector('iframe') : null;
                if (!frame) return;

                let url = wrapper.dataset.docUrl || '';
                url = formatGoogleDocUrl(url);
                if (!url) return;

                frame.src = url;
                const placeholder = wrapper.querySelector('.doc-embed-placeholder');
                if (placeholder) placeholder.classList.add('d-none');
                if (frameShell) frameShell.classList.remove('d-none');
                frame.classList.remove('d-none');
                wrapper.classList.add('doc-embed-ready');

                const openBtn = document.getElementById('servicio-medico-open');
                if (openBtn) {
                    const editUrl = url.includes('/preview') ? url.replace('/preview', '/edit') : url;
                    openBtn.href = editUrl;
                    openBtn.classList.remove('d-none');
                }
            });
        })();
    </script>
    <script>
        // Limpieza agresiva de Service Workers previos y caches.
        // Si se detecta alguno, se hace reload UNA sola vez para que dejen de interceptar inmediatamente.
        (async function cleanupSW() {
            try {
                const params = new URLSearchParams(location.search);
                const flag = params.get('noSW') === '1' || localStorage.getItem('aifa.noSW') === '1';
                const isLocalHost = /^(localhost|127\.0\.0\.1)$/i.test(location.hostname) || location.protocol === 'file:';
                const devNoSW = flag || isLocalHost;
                if (!devNoSW) return; // Solo en modo DEV
                const FLAG = 'aifa.sw.cleaned.once';
                const already = sessionStorage.getItem(FLAG) === '1';
                if ('serviceWorker' in navigator) {
                    const regs = await navigator.serviceWorker.getRegistrations().catch(() => []);
                    if (Array.isArray(regs) && regs.length) {
                        await Promise.all(regs.map(r => r.unregister().catch(() => { })));
                        if (window.caches && caches.keys) {
                            try { const keys = await caches.keys(); await Promise.all(keys.map(k => caches.delete(k))); } catch (_) { }
                        }
                        if (!already) {
                            sessionStorage.setItem(FLAG, '1');
                            // Forzar un refresco inmediato para que el SW deje de interceptar en esta sesión
                            location.reload();
                            return;
                        }
                    }
                }
                // Reset de bandera cuando ya no hay SWs activos
                if (already && (!('serviceWorker' in navigator))) {
                    sessionStorage.removeItem(FLAG);
                }
            } catch (_) { }
        })();

        // Evitar errores de PDFs cuando no hay conexión: quitar src hasta que haya red
        (function managePDFs() {
            function applyOnlineState() {
                const frames = document.querySelectorAll('iframe[src$=\".pdf\"]');
                if (!navigator.onLine) {
                    frames.forEach(f => {
                        if (!f.dataset.src) f.dataset.src = f.getAttribute('src') || '';
                        f.removeAttribute('src');
                        // Mostrar un placeholder breve
                        if (!f._ph) {
                            const ph = document.createElement('div');
                            ph.className = 'text-muted small';
                            ph.textContent = 'PDF no disponible sin conexión';
                            f.parentElement && f.parentElement.appendChild(ph);
                            f._ph = ph;
                        }
                    });
                } else {
                    frames.forEach(f => {
                        if (f.dataset.src && !f.getAttribute('src')) {
                            f.setAttribute('src', f.dataset.src);
                        }
                        if (f._ph) { try { f._ph.remove(); } catch (_) { } f._ph = null; }
                    });
                }
            }
            window.addEventListener('online', applyOnlineState);
            window.addEventListener('offline', applyOnlineState);
            applyOnlineState();
        })();
    </script>
    <script>
        // Ajustar la paleta del login según el color medio del video de fondo
        (function adaptLoginPaletteToVideo() {
            const video = document.getElementById('login-bg-video');
            if (!video) return;
            const root = document.documentElement;
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext && canvas.getContext('2d', { willReadFrequently: true });
            if (!ctx) return;

            const clamp = (v) => Math.max(0, Math.min(255, Math.round(v)));
            const lighten = (rgb, amount) => rgb.map(ch => clamp(ch + (255 - ch) * amount));
            const darken = (rgb, amount) => rgb.map(ch => clamp(ch * (1 - amount)));
            const rgba = (rgb, alpha) => `rgba(${clamp(rgb[0])},${clamp(rgb[1])},${clamp(rgb[2])},${alpha})`;

            let sampling = false;
            let lastApplied = null;

            function applyPalette(avg) {
                const [r, g, b] = avg.map(clamp);
                const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
                const isBright = luminance > 0.55;

                const base = darken(avg, 0.18);
                const edge = lighten(avg, 0.25);
                const highlight1 = lighten(avg, 0.48);
                const highlight2 = lighten(avg, 0.68);
                const frame = lighten(avg, 0.32);
                const formBgColor = isBright ? darken(avg, 0.12) : darken(avg, 0.42);
                const formBgAlpha = isBright ? 0.28 : 0.4;
                const formBorder = lighten(avg, isBright ? 0.22 : 0.58);
                const textRGB = isBright ? darken(avg, 0.68) : lighten(avg, 0.92);
                const labelRGB = isBright ? darken(avg, 0.46) : lighten(avg, 0.82);
                const helperRGB = isBright ? darken(avg, 0.36) : lighten(avg, 0.74);

                root.style.setProperty('--login-glass-base', rgba(base, 0.52));
                root.style.setProperty('--login-glass-edge', rgba(edge, 0.24));
                root.style.setProperty('--login-glass-highlight-1', rgba(highlight1, 0.32));
                root.style.setProperty('--login-glass-highlight-2', rgba(highlight2, 0.22));
                root.style.setProperty('--login-glass-frame', rgba(frame, 0.26));
                root.style.setProperty('--login-form-bg', rgba(formBgColor, formBgAlpha));
                root.style.setProperty('--login-form-border', rgba(formBorder, 0.24));
                root.style.setProperty('--login-form-text', rgba(textRGB, 0.96));
                root.style.setProperty('--login-label-color', rgba(labelRGB, 0.88));
                root.style.setProperty('--login-helper-color', rgba(helperRGB, 0.78));
            }

            function sampleFrame() {
                if (sampling) return;
                sampling = true;
                requestAnimationFrame(() => {
                    try {
                        if (!video.videoWidth || !video.videoHeight) { sampling = false; return; }
                        const targetWidth = 140;
                        const targetHeight = Math.max(1, Math.round((video.videoHeight / video.videoWidth) * targetWidth));
                        canvas.width = targetWidth;
                        canvas.height = targetHeight;
                        ctx.drawImage(video, 0, 0, targetWidth, targetHeight);
                        const { data } = ctx.getImageData(0, 0, targetWidth, targetHeight);
                        let r = 0, g = 0, b = 0, count = 0;
                        for (let i = 0; i < data.length; i += 4) {
                            const alpha = data[i + 3];
                            if (alpha < 32) continue;
                            r += data[i];
                            g += data[i + 1];
                            b += data[i + 2];
                            count++;
                        }
                        if (count) {
                            const avg = [r / count, g / count, b / count];
                            const key = avg.map(v => clamp(v)).join(',');
                            if (key !== lastApplied) {
                                applyPalette(avg);
                                lastApplied = key;
                            }
                        }
                    } catch (_) { /* ignore sampling errors */ }
                    sampling = false;
                });
            }

            const triggerSample = () => sampleFrame();
            if (video.readyState >= 2) { triggerSample(); }
            else video.addEventListener('loadeddata', triggerSample, { once: true });

            ['play', 'playing', 'timeupdate'].forEach(evt => {
                video.addEventListener(evt, triggerSample, { passive: true });
            });
        })();
    </script>
    <!-- Edit Parte Operaciones Modal -->
    <div class="modal fade" id="editParteOpsModal" tabindex="-1" aria-labelledby="editParteOpsModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0 shadow">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="editParteOpsModalLabel">
                        <i class="fas fa-edit me-2"></i>Editar Parte de Operaciones
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <p class="text-muted mb-4">Completa los campos a continuación para registrar las operaciones
                        diarias. Los campos obligatorios están marcados.</p>
                    <form id="form-parte-ops">
                        <input type="hidden" id="edit-parte-ops-id">
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label for="edit-parte-ops-date" class="form-label fw-semibold">Fecha</label>
                                <div class="input-group">
                                    <input type="date" class="form-control" id="edit-parte-ops-date" readonly>
                                    <button class="btn btn-outline-primary" type="button" id="btn-calc-from-itinerary"
                                        title="Calcular desde Itinerario">
                                        <i class="fas fa-calculator"></i> Calcular
                                    </button>
                                </div>
                                <div class="form-text">Usa el botón para obtener datos del Itinerario.</div>
                            </div>
                        </div>

                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-primary fw-bold mb-3"><i class="fas fa-plane me-2"></i>Aviación
                                    Comercial</h6>
                            </div>
                            <div class="col-md-6">
                                <label for="edit-comercial-llegada"
                                    class="form-label text-muted small fw-semibold">Llegadas</label>
                                <input type="number" class="form-control" id="edit-comercial-llegada" min="0"
                                    placeholder="0">
                            </div>
                            <div class="col-md-6">
                                <label for="edit-comercial-salida"
                                    class="form-label text-muted small fw-semibold">Salidas</label>
                                <input type="number" class="form-control" id="edit-comercial-salida" min="0"
                                    placeholder="0">
                            </div>
                        </div>

                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-warning fw-bold mb-3"><i class="fas fa-box-open me-2"></i>Aviación de
                                    Carga</h6>
                            </div>
                            <div class="col-md-6">
                                <label for="edit-carga-llegada"
                                    class="form-label text-muted small fw-semibold">Llegadas</label>
                                <input type="number" class="form-control" id="edit-carga-llegada" min="0"
                                    placeholder="0">
                            </div>
                            <div class="col-md-6">
                                <label for="edit-carga-salida"
                                    class="form-label text-muted small fw-semibold">Salidas</label>
                                <input type="number" class="form-control" id="edit-carga-salida" min="0"
                                    placeholder="0">
                            </div>
                        </div>

                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-success fw-bold mb-3"><i class="fas fa-paper-plane me-2"></i>Aviación
                                    General</h6>
                            </div>
                            <div class="col-md-6">
                                <label for="edit-general-llegada"
                                    class="form-label text-muted small fw-semibold">Llegadas</label>
                                <input type="number" class="form-control" id="edit-general-llegada" min="0"
                                    placeholder="0">
                            </div>
                            <div class="col-md-6">
                                <label for="edit-general-salida"
                                    class="form-label text-muted small fw-semibold">Salidas</label>
                                <input type="number" class="form-control" id="edit-general-salida" min="0"
                                    placeholder="0">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12">
                                <h6 class="text-secondary fw-bold mb-3"><i class="fas fa-file-pdf me-2"></i>Documento
                                    Adjunto</h6>
                            </div>
                            <div class="col-12">
                                <label for="edit-parte-ops-pdf" class="form-label text-muted small fw-semibold">Reporte
                                    PDF</label>
                                <input class="form-control" type="file" id="edit-parte-ops-pdf"
                                    accept="application/pdf">
                                <div id="current-pdf-info" class="form-text mt-2"></div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-success text-white" id="btn-save-parte-ops">
                        <i class="fas fa-save me-1"></i> Guardar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Itinerary JSON Modal -->
    <div class="modal fade" id="uploadItineraryJsonModal" tabindex="-1" aria-labelledby="uploadItineraryJsonModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0 shadow">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="uploadItineraryJsonModalLabel">
                        <i class="fas fa-code me-2"></i>Cargar Itinerario (JSON)
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <p class="text-muted mb-3">Pega el contenido JSON del itinerario a continuación. El sistema
                        procesará y guardará los vuelos automáticamente.</p>
                    <div class="mb-3">
                        <label for="itinerary-json-content" class="form-label fw-semibold">Contenido JSON</label>
                        <textarea class="form-control font-monospace" id="itinerary-json-content" rows="10"
                            placeholder='[{"fecha_llegada": "...", ...}]'></textarea>
                    </div>
                </div>
                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-success text-white" id="btn-process-itinerary-json">
                        <i class="fas fa-save me-1"></i> Procesar y Guardar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Itinerary JSON Modal -->
    <div class="modal fade" id="viewItineraryJsonModal" tabindex="-1" aria-labelledby="viewItineraryJsonModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0 shadow">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title" id="viewItineraryJsonModalLabel">
                        <i class="fas fa-code me-2"></i>JSON del Día
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <p class="text-muted mb-0">Datos actuales en base de datos para la fecha seleccionada. Puedes
                            editar y guardar cambios.</p>
                        <button class="btn btn-sm btn-outline-secondary" id="btn-copy-json"><i class="fas fa-copy"></i>
                            Copiar</button>
                    </div>
                    <textarea class="form-control font-monospace" id="view-json-content"
                        style="height: 500px; font-size: 0.85rem;"></textarea>
                </div>
                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary" id="btn-save-json-changes"><i
                            class="fas fa-save me-2"></i>Guardar Cambios</button>
                </div>
            </div>
        </div>
    </div>

    <!-- PDF Upload Modal -->
    <div class="modal fade" id="pdfUploadModal" tabindex="-1" aria-labelledby="pdfUploadModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <div>
                        <h5 class="modal-title" id="pdfUploadModalLabel">Adjuntar Parte de Operaciones</h5>
                        <p class="mb-0 text-muted small" id="upload-modal-date-display"></p>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="drop-zone"
                        class="upload-drop-zone text-center p-5 border border-2 border-dashed rounded-3 bg-light">
                        <i class="fas fa-cloud-upload-alt fa-3x text-primary mb-3"></i>
                        <h5 class="mb-2">Arrastra y suelta tu archivo PDF aquí</h5>
                        <p class="text-muted mb-3">o</p>
                        <button type="button" class="btn btn-outline-primary" id="btn-browse-files">Seleccionar
                            archivo</button>
                        <input type="file" id="modal-pdf-input" accept="application/pdf" style="display: none;">
                        <div id="file-info" class="mt-3 d-none">

                            <div class="alert alert-info d-flex align-items-center" role="alert">
                                <i class="fas fa-file-pdf me-2"></i>
                                <div class="text-truncate" id="selected-filename" style="max-width: 250px;"></div>
                                <button type="button" class="btn-close ms-auto" id="btn-clear-file"
                                    aria-label="Close"></button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="btn-confirm-upload" disabled>
                        <i class="fas fa-upload"></i> Subir PDF
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- PDF Preview Modal -->
    <div class="modal fade" id="pdfPreviewModal" tabindex="-1" aria-labelledby="pdfPreviewModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content" style="height: 90vh;">
                <div class="modal-header">
                    <h5 class="modal-title" id="pdfPreviewModalLabel">Vista Previa del Reporte</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0">
                    <iframe id="pdf-preview-frame" src="" style="width: 100%; height: 100%; border: none;"></iframe>
                </div>
                <div class="modal-footer">
                    <a href="#" id="btn-full-screen-pdf-modal" class="btn btn-outline-primary" target="_blank">
                        <i class="fas fa-expand"></i> Pantalla Completa
                    </a>
                    <a href="#" id="btn-download-pdf-modal" class="btn btn-primary" target="_blank" download>
                        <i class="fas fa-download"></i> Descargar
                    </a>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Copiar Semana -->
    <div class="modal fade" id="modal-copy-week" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Copiar Plantilla Semanal</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Se copiarán todas las frecuencias de la semana: <strong id="copy-source-week-label"></strong></p>

                    <div class="mb-3">
                        <label for="copy-start-date" class="form-label">Fecha Inicio (Lunes)</label>
                        <input type="date" class="form-control" id="copy-start-date">
                    </div>
                    <div class="mb-3">
                        <label for="copy-end-date" class="form-label">Fecha Fin (Domingo)</label>
                        <input type="date" class="form-control" id="copy-end-date">
                    </div>

                    <div class="alert alert-info">
                        <small>La nueva etiqueta de semana se generará automáticamente basada en estas fechas.</small>
                        <div class="mt-1 fw-bold" id="copy-preview-label"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary"
                        onclick="dataManagement.confirmCopyWeek()">Copiar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Cargar JSON Itinerario (Parte de Operaciones) -->
    <div class="modal fade" id="uploadOpsItineraryModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Cargar Parte de Operaciones (PDF)</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="ops-itinerary-pdf-file" class="form-label">Cargar PDF (Parte de Operaciones)</label>
                        <input type="file" class="form-control mb-2" id="ops-itinerary-pdf-file" accept=".pdf">
                        <div class="text-muted small mb-3">Sube el archivo PDF del Parte de Operaciones para extraer los
                            vuelos automáticamente.</div>

                        <div class="text-center text-muted my-2">- O -</div>

                        <label for="ops-itinerary-json-text" class="form-label">Pegar JSON de Itinerario</label>
                        <textarea class="form-control font-monospace" id="ops-itinerary-json-text" rows="5"
                            placeholder='[{"flight_number":"AI101","airline":"..."}, ...]'></textarea>
                    </div>
                    <div class="progress d-none mb-3" id="ops-itinerary-upload-progress">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"
                            style="width: 100%">Procesando...</div>
                    </div>
                    <div class="alert alert-info small">
                        <i class="fas fa-info-circle me-1"></i> Este proceso sobrescribirá los vuelos existentes para
                        las fechas detectadas.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="btn-save-ops-itinerary-json">Guardar
                        Itinerario</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Cargar Itinerario (JSON) -->
    <div class="modal fade" id="loadOpsItineraryJsonModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title"><i class="fas fa-code me-2"></i>Cargar Itinerario (JSON)</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted mb-3">Pega el contenido JSON del itinerario a continuación. El sistema
                        procesará y guardará los vuelos automáticamente.</p>
                    <div class="mb-3">
                        <label for="ops-json-textarea" class="form-label fw-bold">Contenido JSON</label>
                        <textarea class="form-control font-monospace small" id="ops-json-textarea" rows="10"
                            placeholder='[{"fecha_llegada": "...", ...}]'></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-success" id="btn-process-ops-json"><i
                            class="fas fa-save me-2"></i>Procesar y Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Cargar CSV Itinerario (Parte de Operaciones) -->
    <div class="modal fade" id="uploadOpsCsvModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Cargar Parte de Operaciones (CSV)</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="ops-itinerary-csv-file" class="form-label">Cargar CSV (Software de aeropuerto)</label>
                        <input type="file" class="form-control mb-2" id="ops-itinerary-csv-file" accept=".csv">
                        <div class="text-muted small">El CSV debe contener exactamente los encabezados de la tabla de
                            Vuelos del Parte de Operaciones.</div>
                    </div>
                    <div class="alert alert-info small">
                        <i class="fas fa-info-circle me-1"></i> Este proceso sobrescribirá los vuelos existentes.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="btn-save-ops-itinerary-csv">Importar CSV</button>
                </div>
            </div>
        </div>
    </div>

    <div id="orientation-hint" class="orientation-hint" aria-live="polite" aria-hidden="true">
        <div class="orientation-hint-card" role="dialog" aria-modal="true" aria-labelledby="orientation-hint-title">
            <div class="orientation-hint-icon" aria-hidden="true">
                <i class="fas fa-mobile-screen-button"></i>
            </div>
            <h2 id="orientation-hint-title" class="orientation-hint-title">Mejor en horizontal</h2>
            <p class="orientation-hint-message">Gira tu dispositivo para ver la información completa.</p>
            <button type="button" class="btn btn-primary btn-sm orientation-hint-dismiss"
                data-dismiss-orientation="true">Entendido</button>
        </div>
    </div>
    <button id="orientation-quick-toggle" class="orientation-quick-toggle" type="button"
        aria-label="Forzar modo horizontal" aria-hidden="true">
        <i class="fas fa-arrows-rotate" aria-hidden="true"></i>
        <span>Rotar</span>
    </button>
    <!-- Loader Global -->
    <div id="global-loader" class="global-loader hidden" role="alert" aria-live="assertive" aria-busy="true">
        <div class="loader-content">
            <div class="plane-orbit">
                <span class="orbit-ring"></span>
                <span class="plane-icon">✈</span>
                <img src="images/logo_aifa.jpg" alt="AIFA" class="loader-aifa-logo" />
            </div>
            <div class="loader-text" id="global-loader-text">Cargando...</div>
        </div>
    </div>

    <!-- MODAL: HISTORIAL DE CONCILIACIÓN -->
    <div class="modal fade" id="modalConciliacionHistory" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title"><i class="fas fa-history me-2"></i>Historial de Conciliación</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Cerrar"></button>
                </div>
                <div class="modal-body p-4">
                    <!-- Info actual -->
                    <div class="text-center mb-4">
                        <div id="conci-modal-icon" class="mb-2 display-4"></div>
                        <h4 id="conci-modal-status" class="fw-bold mb-1"></h4>
                        <div id="conci-modal-flight-info" class="text-muted small"></div>
                    </div>

                    <!-- Detalles -->
                    <div class="card bg-light border-0 mb-3">
                        <div class="card-body">
                            <h6 class="card-subtitle mb-2 text-muted text-uppercase small fw-bold">Última Acción</h6>
                            <div id="conci-modal-details">
                                <!-- JS llenará esto -->
                                <p class="mb-0 text-muted">Sin información de historial.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Warn for Action -->
                    <div id="conci-modal-action-warn" class="alert alert-warning d-none">
                        <i class="fas fa-exclamation-triangle me-2"></i> ¿Estás seguro de cambiar el estado de este
                        vuelo?
                    </div>

                </div>
                <div class="modal-footer justify-content-between p-3 bg-light">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <!-- El botón de acción se configurará dinámicamente -->
                    <button type="button" class="btn btn-primary" id="btn-conci-action">
                        <i class="fas fa-sync-alt me-2"></i>Cambiar Estado
                    </button>
                </div>
            </div>
        </div>
    </div>


<!-- MODAL: CATÁLOGO TIPO DE SERVICIO -->
<div class="modal fade" id="modalFlightServiceType" tabindex="-1" aria-labelledby="modalFlightServiceTypeLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header" style="background:linear-gradient(135deg,#1a3a5c,#2563a8);color:#fff;">
                <h5 class="modal-title" id="modalFlightServiceTypeLabel">
                    <i class="fas fa-tag me-2"></i>Catálogo de Tipos de Servicio
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body p-3">
                <p class="text-muted small mb-3">
                    <i class="fas fa-info-circle me-1 text-primary"></i>
                    Cada vuelo en el itinerario lleva un código de una letra que identifica su categoría y tipo de operación. Consulta la tabla para interpretar los valores de las columnas <strong>[Arr] Type</strong> y <strong>[Dep] Type</strong>.
                </p>
                <div class="table-responsive">
                    <table class="table table-sm table-bordered table-hover align-middle mb-0" style="font-size:.875rem;">
                        <thead class="table-dark text-uppercase small">
                            <tr>
                                <th class="text-center" style="width:60px">Código</th>
                                <th>Categoría</th>
                                <th>Tipo de Operación</th>
                                <th>Descripción</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td class="text-center fw-bold fs-5"><span class="badge bg-primary">A</span></td><td><span class="badge bg-primary bg-opacity-10 text-primary border border-primary-subtle">Vuelos adicionales</span></td><td>Carga, Correo</td><td>Carga/Correo</td></tr>
                            <tr><td class="text-center fw-bold fs-5"><span class="badge bg-primary">B</span></td><td><span class="badge bg-primary bg-opacity-10 text-primary border border-primary-subtle">Vuelos adicionales</span></td><td>Pasajeros</td><td>Modo Compartido</td></tr>
                            <tr><td class="text-center fw-bold fs-5"><span class="badge bg-warning text-dark">C</span></td><td><span class="badge bg-warning bg-opacity-10 text-warning border border-warning-subtle">Fletamento</span></td><td>Pasajeros</td><td>Solo Pasajeros</td></tr>
                            <tr><td class="text-center fw-bold fs-5"><span class="badge bg-secondary">D</span></td><td><span class="badge bg-secondary bg-opacity-10 text-secondary border border-secondary-subtle">Otros</span></td><td>Sin especificar</td><td>Aviación General</td></tr>
                            <tr><td class="text-center fw-bold fs-5"><span class="badge bg-secondary">E</span></td><td><span class="badge bg-secondary bg-opacity-10 text-secondary border border-secondary-subtle">Otros</span></td><td>Sin especificar</td><td>Especial (Gubernamentales)</td></tr>
                            <tr><td class="text-center fw-bold fs-5"><span class="badge bg-success">F</span></td><td><span class="badge bg-success bg-opacity-10 text-success border border-success-subtle">Regular</span></td><td>Carga, Correo</td><td>Servicio Normal</td></tr>
                            <tr><td class="text-center fw-bold fs-5"><span class="badge bg-primary">G</span></td><td><span class="badge bg-primary bg-opacity-10 text-primary border border-primary-subtle">Vuelos adicionales</span></td><td>Pasajeros</td><td>Servicio Normal</td></tr>
                            <tr><td class="text-center fw-bold fs-5"><span class="badge bg-warning text-dark">H</span></td><td><span class="badge bg-warning bg-opacity-10 text-warning border border-warning-subtle">Fletamento</span></td><td>Carga, Correo</td><td>Carga y/o Correo</td></tr>
                            <tr><td class="text-center fw-bold fs-5"><span class="badge bg-secondary">I</span></td><td><span class="badge bg-secondary bg-opacity-10 text-secondary border border-secondary-subtle">Otros</span></td><td>Sin especificar</td><td>Estatal / Diplomático / Ambulancia Aérea</td></tr>
                            <tr><td class="text-center fw-bold fs-5"><span class="badge bg-success">J</span></td><td><span class="badge bg-success bg-opacity-10 text-success border border-success-subtle">Regular</span></td><td>Pasajeros</td><td>Servicio Normal</td></tr>
                            <tr><td class="text-center fw-bold fs-5"><span class="badge bg-secondary">K</span></td><td><span class="badge bg-secondary bg-opacity-10 text-secondary border border-secondary-subtle">Otros</span></td><td>Sin especificar</td><td>Entrenamiento (Escuela / Vuelo de Verificación)</td></tr>
                            <tr><td class="text-center fw-bold fs-5"><span class="badge bg-warning text-dark">L</span></td><td><span class="badge bg-warning bg-opacity-10 text-warning border border-warning-subtle">Fletamento</span></td><td>Pasajeros, Carga, Correo</td><td>Pasajeros y Carga y/o Correo</td></tr>
                            <tr><td class="text-center fw-bold fs-5"><span class="badge bg-success">M</span></td><td><span class="badge bg-success bg-opacity-10 text-success border border-success-subtle">Regular</span></td><td>Carga, Correo</td><td>Solo Correo</td></tr>
                            <tr><td class="text-center fw-bold fs-5"><span class="badge bg-secondary">N</span></td><td><span class="badge bg-secondary bg-opacity-10 text-secondary border border-secondary-subtle">Otros</span></td><td>Sin especificar</td><td>Aviación Ejecutiva / Taxi Aéreo</td></tr>
                            <tr><td class="text-center fw-bold fs-5"><span class="badge bg-warning text-dark">O</span></td><td><span class="badge bg-warning bg-opacity-10 text-warning border border-warning-subtle">Fletamento</span></td><td>Manejo Especial</td><td>Manejo Especial (Migrantes / Inmigrantes)</td></tr>
                            <tr><td class="text-center fw-bold fs-5"><span class="badge bg-secondary">P</span></td><td><span class="badge bg-secondary bg-opacity-10 text-secondary border border-secondary-subtle">Otros</span></td><td>Sin especificar</td><td>Sin ganancia — Posicionamiento / Ferry / Entrega / Demo</td></tr>
                            <tr><td class="text-center fw-bold fs-5"><span class="badge bg-success">Q</span></td><td><span class="badge bg-success bg-opacity-10 text-success border border-success-subtle">Regular</span></td><td>Pasajeros, Carga</td><td>Pasajeros y Carga en Cabina (aviones de configuración mixta)</td></tr>
                            <tr><td class="text-center fw-bold fs-5"><span class="badge bg-primary">R</span></td><td><span class="badge bg-primary bg-opacity-10 text-primary border border-primary-subtle">Vuelos adicionales</span></td><td>Pasajeros, Carga</td><td>Pasajeros / Carga en Cabina (aviones de configuración mixta)</td></tr>
                            <tr><td class="text-center fw-bold fs-5"><span class="badge bg-success">S</span></td><td><span class="badge bg-success bg-opacity-10 text-success border border-success-subtle">Regular</span></td><td>Pasajeros</td><td>Modo Compartido</td></tr>
                            <tr><td class="text-center fw-bold fs-5"><span class="badge bg-secondary">T</span></td><td><span class="badge bg-secondary bg-opacity-10 text-secondary border border-secondary-subtle">Otros</span></td><td>Sin especificar</td><td>Vuelos de Prueba</td></tr>
                            <tr><td class="text-center fw-bold fs-5"><span class="badge bg-success">U</span></td><td><span class="badge bg-success bg-opacity-10 text-success border border-success-subtle">Regular</span></td><td>Pasajeros</td><td>Servicio operado por un vehículo en plataforma</td></tr>
                            <tr><td class="text-center fw-bold fs-5"><span class="badge bg-success">V</span></td><td><span class="badge bg-success bg-opacity-10 text-success border border-success-subtle">Regular</span></td><td>Carga, Correo</td><td>Servicio operado por un vehículo en plataforma</td></tr>
                            <tr><td class="text-center fw-bold fs-5"><span class="badge bg-secondary">W</span></td><td><span class="badge bg-secondary bg-opacity-10 text-secondary border border-secondary-subtle">Otros</span></td><td>Sin especificar</td><td>Militar</td></tr>
                            <tr><td class="text-center fw-bold fs-5"><span class="badge bg-secondary">X</span></td><td><span class="badge bg-secondary bg-opacity-10 text-secondary border border-secondary-subtle">Otros</span></td><td>Sin especificar</td><td>Escala Técnica</td></tr>
                        </tbody>
                    </table>
                </div>
                <div class="d-flex gap-2 flex-wrap mt-3">
                    <span class="badge bg-success"><i class="fas fa-circle me-1"></i>Regular</span>
                    <span class="badge bg-primary"><i class="fas fa-circle me-1"></i>Vuelos adicionales</span>
                    <span class="badge bg-warning text-dark"><i class="fas fa-circle me-1"></i>Fletamento</span>
                    <span class="badge bg-secondary"><i class="fas fa-circle me-1"></i>Otros</span>
                </div>
            </div>
            <div class="modal-footer bg-light py-2">
                <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<!-- ── Heatmap Drill-down Modal ─────────────────────────────────────────── -->
<div class="modal fade" id="heatmap-drilldown-modal" tabindex="-1"
     aria-labelledby="heatmap-drilldown-title" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header py-2">
                <h6 class="modal-title mb-0" id="heatmap-drilldown-title">Vuelos</h6>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body" id="heatmap-drilldown-body">
            </div>
            <div class="modal-footer py-2">
                <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<!-- ══ Column Help: hidden HTML templates (no JS string escaping needed) ════ -->
<div class="d-none" id="colhelp-templates">

  <div id="colhelp-status">
    <p>Indica la situación actual del vuelo. Valores más comunes:</p>
    <ul>
      <li><strong>En Tiempo (On Time):</strong> llegó o salió dentro del margen permitido.</li>
      <li><strong>Retrasado (Delayed):</strong> más tarde de lo programado.</li>
      <li><strong>Cancelado (Cancelled):</strong> el vuelo no operó.</li>
      <li><strong>Desviado (Diverted):</strong> fue redirigido a otro aeropuerto.</li>
    </ul>
    <p class="text-muted small mb-0">&#x1F4A1; En términos simples: es el semáforo del vuelo &mdash; verde si llegó/salió bien, rojo si hubo problemas.</p>
  </div>

  <div id="colhelp-arr-airline">
    <p>El código IATA de dos letras que identifica a la aerolínea operadora del vuelo de llegada.</p>
    <p><strong>Ejemplos:</strong> <code>AM</code> = Aeroméxico &middot; <code>Y4</code> = Volaris &middot; <code>VB</code> = VivaAerobus</p>
    <p class="text-muted small mb-0">&#x1F4A1; En términos simples: la "marca" de la aerolínea. Junto con el número forman el nombre completo del vuelo, ej: AM + 100 = AM100.</p>
  </div>

  <div id="colhelp-arr-flight">
    <p>El designador completo del vuelo de llegada: código de aerolínea + número de vuelo.</p>
    <p><strong>Ejemplo:</strong> <code>AM100</code> = vuelo 100 de Aeroméxico llegando a AIFA.</p>
    <p class="text-muted small mb-0">&#x1F4A1; En términos simples: el número del vuelo que ves en el tablero de llegadas o en tu app de rastreo de vuelos.</p>
  </div>

  <div id="colhelp-arr-aldt">
    <p><strong>ALDT</strong> = <em>Actual Landing Time</em> &mdash; la hora exacta en que las ruedas del avión tocaron la pista al aterrizar.</p>
    <p>&#x26A0;&#xFE0F; Esta hora es <strong>diferente</strong> a la hora de llegada a la puerta. Después de aterrizar el avión todavía rueda hasta su posición, lo que puede tomar 5&ndash;20 minutos adicionales.</p>
    <p class="text-muted small mb-0">&#x1F4A1; En términos simples: el momento exacto en que el avión "toca tierra" &mdash; cuando sus ruedas tocan la pista por primera vez.</p>
  </div>

  <div id="colhelp-arr-sibt">
    <p><strong>SIBT</strong> = <em>Scheduled In-Block Time</em> &mdash; la hora a la que estaba <strong>programado</strong> que el avión llegara a su posición de estacionamiento.</p>
    <p>&ldquo;In-Block&rdquo; es cuando se colocan los <em>calzos</em> (cuñas de seguridad) en las ruedas, marcando la llegada oficial.</p>
    <p>Esta es la hora de llegada que aparece en los boletos y en el tablero del aeropuerto.</p>
    <p class="text-muted small mb-0">&#x1F4A1; En términos simples: la hora de llegada que dice tu boleto. <em>Scheduled</em> = programado.</p>
  </div>

  <div id="colhelp-arr-aibt">
    <p><strong>AIBT</strong> = <em>Actual In-Block Time</em> &mdash; la hora <strong>real</strong> en que el avión llegó a su posición y se colocaron los calzos.</p>
    <p>Determina si el vuelo llegó a tiempo o retrasado:</p>
    <p class="text-center fw-bold">Retraso = AIBT &minus; SIBT</p>
    <p class="text-muted small mb-0">&#x1F4A1; En términos simples: la hora en que el avión realmente llegó a la puerta. Si es más tarde que el SIBT, el vuelo llegó tarde.</p>
  </div>

  <div id="colhelp-arr-stand">
    <p>El número o código de la posición de estacionamiento (<em>parking</em>) donde el avión se detuvo al llegar a AIFA.</p>
    <p>Puede ser de <strong>contacto</strong> (con pasarela/finger directo a la terminal) o <strong>remota</strong> (los pasajeros usan camión rampero).</p>
    <p class="text-muted small mb-0">&#x1F4A1; En términos simples: el "cajón de estacionamiento" del avión dentro del aeropuerto.</p>
  </div>

  <div id="colhelp-arr-gates">
    <p>El número de la puerta de la terminal por donde los pasajeros salieron del avión al llegar.</p>
    <p>Cuando hay pasarela (<em>jetway</em>), conecta directamente la terminal con el avión. En posiciones remotas, los pasajeros llegan en camión.</p>
    <p class="text-muted small mb-0">&#x1F4A1; En términos simples: la puerta de la terminal donde salen los pasajeros que llegaron, o donde tus familiares te esperan.</p>
  </div>

  <div id="colhelp-arr-boarded">
    <p>El número total de pasajeros que viajaron en el vuelo de llegada.</p>
    <p class="text-muted small mb-0">&#x1F4A1; En términos simples: cuántas personas venían en el avión que llegó.</p>
  </div>

  <div id="colhelp-arr-belts">
    <p>El número o identificador de la <strong>banda transportadora</strong> (carrusel o cinta de equipaje) asignada para que los pasajeros de este vuelo recojan su equipaje.</p>
    <p>Esta información aparece en las pantallas de la sala de reclamación de equipaje del aeropuerto.</p>
    <p class="text-muted small mb-0">&#x1F4A1; En términos simples: el número del carrusel donde recoges tu maleta al llegar. El mismo que anuncian en las pantallas de la sala de equipaje.</p>
  </div>

  <div id="colhelp-arr-type">
    <p class="mb-2">Código de una sola letra que identifica la <strong>categoría y tipo de operación</strong> del vuelo de llegada, según el estándar IATA:</p>
    <div class="col-help-svc-wrap">
    <div class="d-flex gap-2 mb-2 flex-wrap align-items-center">
      <div class="input-group input-group-sm" style="max-width:220px;">
        <span class="input-group-text bg-white"><i class="fas fa-search text-muted"></i></span>
        <input type="text" class="form-control" placeholder="Filtrar por código o descripción…" oninput="filterServiceTypeTable(this)" autocomplete="off">
        <button class="btn btn-outline-secondary" type="button" onclick="this.previousElementSibling.value='';filterServiceTypeTable(this.previousElementSibling)" title="Limpiar"><i class="fas fa-times"></i></button>
      </div>
      <div class="d-flex gap-1 flex-wrap">
        <button type="button" class="btn btn-sm btn-success svc-cat-btn" onclick="filterServiceTypeCat(this,'Regular')">Regular</button>
        <button type="button" class="btn btn-sm btn-primary svc-cat-btn" onclick="filterServiceTypeCat(this,'Vuelos adicionales')">Vuelos adicionales</button>
        <button type="button" class="btn btn-sm btn-warning svc-cat-btn" onclick="filterServiceTypeCat(this,'Fletamento')">Fletamento</button>
        <button type="button" class="btn btn-sm btn-secondary svc-cat-btn" onclick="filterServiceTypeCat(this,'Otros')">Otros</button>
        <button type="button" class="btn btn-sm btn-outline-secondary svc-cat-btn" onclick="filterServiceTypeCat(this,'')">Todos</button>
      </div>
      <small class="text-muted ms-auto svc-row-count"></small>
    </div>
    <div class="table-responsive">
      <table class="table table-sm table-bordered table-hover align-middle mb-2" style="font-size:.8rem;">
        <thead class="table-dark text-uppercase" style="font-size:.7rem;">
          <tr><th style="width:46px">Código</th><th>Categoría</th><th>Tipo de Operación</th><th>Descripción</th></tr>
        </thead>
        <tbody>
          <tr><td class="text-center fw-bold"><span class="badge bg-success">A</span></td><td>Vuelos adicionales</td><td>Carga, Correo</td><td>Carga/Correo</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-primary">B</span></td><td>Vuelos adicionales</td><td>Pasajeros</td><td>Modo Compartido</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-warning text-dark">C</span></td><td>Fletamento</td><td>Pasajeros</td><td>Solo Pasajeros</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-secondary">D</span></td><td>Otros</td><td>Sin especificar</td><td>Aviación General</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-secondary">E</span></td><td>Otros</td><td>Sin especificar</td><td>Especial (Gubernamentales)</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-success">F</span></td><td>Regular</td><td>Carga, Correo</td><td>Servicio Normal</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-primary">G</span></td><td>Vuelos adicionales</td><td>Pasajeros</td><td>Servicio Normal</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-warning text-dark">H</span></td><td>Fletamento</td><td>Carga, Correo</td><td>Carga y/o Correo</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-secondary">I</span></td><td>Otros</td><td>Sin especificar</td><td>Estatal / Diplomático / Ambulancia Aérea</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-success">J</span></td><td>Regular</td><td>Pasajeros</td><td>Servicio Normal</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-secondary">K</span></td><td>Otros</td><td>Sin especificar</td><td>Entrenamiento (Escuela / Vuelo de Verificación)</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-warning text-dark">L</span></td><td>Fletamento</td><td>Pasajeros, Carga, Correo</td><td>Pasajeros y Carga y/o Correo</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-success">M</span></td><td>Regular</td><td>Carga, Correo</td><td>Solo Correo</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-secondary">N</span></td><td>Otros</td><td>Sin especificar</td><td>Aviación Ejecutiva / Taxi Aéreo</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-warning text-dark">O</span></td><td>Fletamento</td><td>Manejo Especial</td><td>Manejo Especial (Migrantes / Inmigrantes)</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-secondary">P</span></td><td>Otros</td><td>Sin especificar</td><td>Sin ganancia — Posicionamiento / Ferry / Entrega / Demo</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-success">Q</span></td><td>Regular</td><td>Pasajeros, Carga</td><td>Pasajeros y Carga en Cabina (aviones mixtos)</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-primary">R</span></td><td>Vuelos adicionales</td><td>Pasajeros, Carga</td><td>Pasajeros / Carga en Cabina (aviones mixtos)</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-success">S</span></td><td>Regular</td><td>Pasajeros</td><td>Modo Compartido</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-secondary">T</span></td><td>Otros</td><td>Sin especificar</td><td>Vuelos de Prueba</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-success">U</span></td><td>Regular</td><td>Pasajeros</td><td>Servicio operado por vehículo en plataforma</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-success">V</span></td><td>Regular</td><td>Carga, Correo</td><td>Servicio operado por vehículo en plataforma</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-secondary">W</span></td><td>Otros</td><td>Sin especificar</td><td>Militar</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-secondary">X</span></td><td>Otros</td><td>Sin especificar</td><td>Escala Técnica</td></tr>
        </tbody>
      </table>
    </div>
    </div><!-- /col-help-svc-wrap -->
    <p class="text-muted small mb-0 mt-1">&#x1F4A1; Fuente: catálogo IATA de tipos de servicio (flightservicetype).</p>
  </div>

  <div id="colhelp-routing">
    <p>La ruta completa de la operación: aeropuerto de origen del vuelo de llegada y destino del vuelo de salida del mismo avión.</p>
    <p>Se usan códigos IATA de 3 letras: <code>CUN</code> = Cancún &middot; <code>GDL</code> = Guadalajara &middot; <code>NLU</code> = AIFA &middot; <code>MEX</code> = AICM</p>
    <p><strong>Ejemplo:</strong> <code>CUN &rarr; NLU &rarr; GDL</code> &mdash; el avión llegó de Cancún y sale hacia Guadalajara.</p>
    <p class="text-muted small mb-0">&#x1F4A1; En términos simples: el "itinerario" del avión &mdash; de dónde viene y hacia dónde va el mismo avión.</p>
  </div>

  <div id="colhelp-dep-type">
    <p class="mb-2">Código de una sola letra que identifica la <strong>categoría y tipo de operación</strong> del vuelo de salida, según el estándar IATA:</p>
    <div class="col-help-svc-wrap">
    <div class="d-flex gap-2 mb-2 flex-wrap align-items-center">
      <div class="input-group input-group-sm" style="max-width:220px;">
        <span class="input-group-text bg-white"><i class="fas fa-search text-muted"></i></span>
        <input type="text" class="form-control" placeholder="Filtrar por código o descripción…" oninput="filterServiceTypeTable(this)" autocomplete="off">
        <button class="btn btn-outline-secondary" type="button" onclick="this.previousElementSibling.value='';filterServiceTypeTable(this.previousElementSibling)" title="Limpiar"><i class="fas fa-times"></i></button>
      </div>
      <div class="d-flex gap-1 flex-wrap">
        <button type="button" class="btn btn-sm btn-success svc-cat-btn" onclick="filterServiceTypeCat(this,'Regular')">Regular</button>
        <button type="button" class="btn btn-sm btn-primary svc-cat-btn" onclick="filterServiceTypeCat(this,'Vuelos adicionales')">Vuelos adicionales</button>
        <button type="button" class="btn btn-sm btn-warning svc-cat-btn" onclick="filterServiceTypeCat(this,'Fletamento')">Fletamento</button>
        <button type="button" class="btn btn-sm btn-secondary svc-cat-btn" onclick="filterServiceTypeCat(this,'Otros')">Otros</button>
        <button type="button" class="btn btn-sm btn-outline-secondary svc-cat-btn" onclick="filterServiceTypeCat(this,'')">Todos</button>
      </div>
      <small class="text-muted ms-auto svc-row-count"></small>
    </div>
    <div class="table-responsive">
      <table class="table table-sm table-bordered table-hover align-middle mb-2" style="font-size:.8rem;">
        <thead class="table-dark text-uppercase" style="font-size:.7rem;">
          <tr><th style="width:46px">Código</th><th>Categoría</th><th>Tipo de Operación</th><th>Descripción</th></tr>
        </thead>
        <tbody>
          <tr><td class="text-center fw-bold"><span class="badge bg-success">A</span></td><td>Vuelos adicionales</td><td>Carga, Correo</td><td>Carga/Correo</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-primary">B</span></td><td>Vuelos adicionales</td><td>Pasajeros</td><td>Modo Compartido</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-warning text-dark">C</span></td><td>Fletamento</td><td>Pasajeros</td><td>Solo Pasajeros</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-secondary">D</span></td><td>Otros</td><td>Sin especificar</td><td>Aviación General</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-secondary">E</span></td><td>Otros</td><td>Sin especificar</td><td>Especial (Gubernamentales)</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-success">F</span></td><td>Regular</td><td>Carga, Correo</td><td>Servicio Normal</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-primary">G</span></td><td>Vuelos adicionales</td><td>Pasajeros</td><td>Servicio Normal</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-warning text-dark">H</span></td><td>Fletamento</td><td>Carga, Correo</td><td>Carga y/o Correo</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-secondary">I</span></td><td>Otros</td><td>Sin especificar</td><td>Estatal / Diplomático / Ambulancia Aérea</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-success">J</span></td><td>Regular</td><td>Pasajeros</td><td>Servicio Normal</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-secondary">K</span></td><td>Otros</td><td>Sin especificar</td><td>Entrenamiento (Escuela / Vuelo de Verificación)</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-warning text-dark">L</span></td><td>Fletamento</td><td>Pasajeros, Carga, Correo</td><td>Pasajeros y Carga y/o Correo</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-success">M</span></td><td>Regular</td><td>Carga, Correo</td><td>Solo Correo</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-secondary">N</span></td><td>Otros</td><td>Sin especificar</td><td>Aviación Ejecutiva / Taxi Aéreo</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-warning text-dark">O</span></td><td>Fletamento</td><td>Manejo Especial</td><td>Manejo Especial (Migrantes / Inmigrantes)</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-secondary">P</span></td><td>Otros</td><td>Sin especificar</td><td>Sin ganancia — Posicionamiento / Ferry / Entrega / Demo</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-success">Q</span></td><td>Regular</td><td>Pasajeros, Carga</td><td>Pasajeros y Carga en Cabina (aviones mixtos)</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-primary">R</span></td><td>Vuelos adicionales</td><td>Pasajeros, Carga</td><td>Pasajeros / Carga en Cabina (aviones mixtos)</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-success">S</span></td><td>Regular</td><td>Pasajeros</td><td>Modo Compartido</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-secondary">T</span></td><td>Otros</td><td>Sin especificar</td><td>Vuelos de Prueba</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-success">U</span></td><td>Regular</td><td>Pasajeros</td><td>Servicio operado por vehículo en plataforma</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-success">V</span></td><td>Regular</td><td>Carga, Correo</td><td>Servicio operado por vehículo en plataforma</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-secondary">W</span></td><td>Otros</td><td>Sin especificar</td><td>Militar</td></tr>
          <tr><td class="text-center fw-bold"><span class="badge bg-secondary">X</span></td><td>Otros</td><td>Sin especificar</td><td>Escala Técnica</td></tr>
        </tbody>
      </table>
    </div>
    </div><!-- /col-help-svc-wrap -->
    <p class="text-muted small mb-0 mt-1">&#x1F4A1; Fuente: catálogo IATA de tipos de servicio (flightservicetype).</p>
  </div>

  <div id="colhelp-aircraft">
    <p>El modelo específico del avión. Define el tamaño, capacidad de pasajeros y características técnicas de la operación.</p>
    <p><strong>Ejemplos comunes en AIFA:</strong></p>
    <ul>
      <li><strong>B737 / B738:</strong> Boeing 737-800 &mdash; avión de pasillo único para ~165 pasajeros. Muy común en rutas nacionales.</li>
      <li><strong>A320 / A321:</strong> Airbus A320/321 &mdash; también de pasillo único, muy usado por Volaris y VivaAerobus.</li>
      <li><strong>B787:</strong> Boeing 787 Dreamliner &mdash; dos pasillos, rutas internacionales de largo alcance.</li>
    </ul>
    <p class="text-muted small mb-0">&#x1F4A1; En términos simples: el "modelo de coche" del avión. Un B737 es como un auto familiar; un B787 sería como una camioneta grande de lujo.</p>
  </div>

  <div id="colhelp-registration">
    <p>La <strong>matrícula</strong> es el identificador único de cada avión físico, equivalente a las placas de un automóvil.</p>
    <p>En México inician con <strong>XA-</strong> (ej: <code>XA-AMX</code>). Otros países: <code>N</code> (EE.UU.), <code>EC</code> (España), <code>G</code> (Reino Unido).</p>
    <p>La matrícula es clave para <strong>conciliar</strong> vuelos: si una llegada y una salida comparten matrícula, es el <em>mismo avión físico</em> haciendo turnaround en AIFA. En la Vista Board, al hacer clic en un vuelo el enlazado con la misma matrícula se resalta en amarillo.</p>
    <p class="text-muted small mb-0">&#x1F4A1; En términos simples: la "placa" del avión. Con ella se puede saber que el avión que llegó en AM100 es el mismo que sale en AM101.</p>
  </div>

  <div id="colhelp-dep-airline">
    <p>El código IATA de dos letras de la aerolínea que opera el vuelo de salida desde AIFA.</p>
    <p><strong>Ejemplos:</strong> <code>AM</code> = Aeroméxico &middot; <code>Y4</code> = Volaris &middot; <code>VB</code> = VivaAerobus</p>
    <p>Puede diferir de la aerolínea de llegada si hay cambio de operador o acuerdo de código compartido (<em>codeshare</em>).</p>
    <p class="text-muted small mb-0">&#x1F4A1; En términos simples: la aerolínea del vuelo que sale.</p>
  </div>

  <div id="colhelp-dep-flight">
    <p>El designador completo del vuelo de salida: código de aerolínea + número de vuelo.</p>
    <p><strong>Ejemplo:</strong> <code>AM101</code> = vuelo 101 de Aeroméxico saliendo de AIFA.</p>
    <p class="text-muted small mb-0">&#x1F4A1; En términos simples: el número del vuelo en el tablero de salidas del aeropuerto, o el que aparece en tu pase de abordar.</p>
  </div>

  <div id="colhelp-dep-stand">
    <p>La posición de estacionamiento donde el avión estuvo mientras se preparaba para salir: limpieza, combustible, carga de equipaje y embarque de pasajeros.</p>
    <p class="text-muted small mb-0">&#x1F4A1; En términos simples: el cajón de estacionamiento del avión antes de salir &mdash; donde realizaron todos los preparativos para el siguiente vuelo.</p>
  </div>

  <div id="colhelp-dep-gates">
    <p>El número de la puerta de la terminal por donde los pasajeros abordaron el avión antes de partir.</p>
    <p>Es el lugar donde los pasajeros esperan y presentan su pase de abordar antes de subir al avión.</p>
    <p class="text-muted small mb-0">&#x1F4A1; En términos simples: la puerta de embarque que aparece en tu pase de abordar como "Gate 5" o "Puerta B3".</p>
  </div>

  <div id="colhelp-dep-boarded">
    <p>El número total de pasajeros que subieron al avión para el vuelo de salida.</p>
    <p>Se puede comparar con la capacidad del avión para calcular el <em>factor de ocupación</em> (qué tan lleno iba el vuelo).</p>
    <p class="text-muted small mb-0">&#x1F4A1; En términos simples: cuántas personas subieron al avión en la salida.</p>
  </div>

  <div id="colhelp-dep-sobt">
    <p><strong>SOBT</strong> = <em>Scheduled Off-Block Time</em> &mdash; la hora <strong>programada</strong> de salida de posición: el momento en que estaba previsto que el avión comenzara a moverse.</p>
    <p>La <strong>salida de posición</strong> ocurre cuando se retiran los <em>calzos</em> (cuñas de seguridad) de las ruedas del avión, marcando el inicio oficial del vuelo de salida. Después el avión rueda hasta la pista para despegar.</p>
    <p>Esta es la hora de salida que aparece en los boletos y tableros de salidas.</p>
    <p class="text-muted small mb-0">&#x1F4A1; En términos simples: la hora de salida que dice tu boleto &mdash; cuando el avión debía empezar a moverse de su posición.</p>
  </div>

  <div id="colhelp-dep-aobt">
    <p><strong>AOBT</strong> = <em>Actual Off-Block Time</em> &mdash; la hora <strong>real</strong> de salida de posición: el momento exacto en que se retiraron los calzos y el avión comenzó a moverse.</p>
    <p>Con esta hora se determina si el vuelo salió a tiempo:</p>
    <p class="text-center fw-bold">Retraso de salida = AOBT &minus; SOBT</p>
    <p class="text-muted small mb-0">&#x1F4A1; En términos simples: la hora en que el avión realmente se fue de la puerta. Si es más tarde que el SOBT, el vuelo salió tarde.</p>
  </div>

  <div id="colhelp-dep-atot">
    <p><strong>ATOT</strong> = <em>Actual Take-Off Time</em> &mdash; la hora exacta en que el avión <strong>despegó</strong> de alguna de las pistas del AIFA.</p>
    <p>Es el momento en que las ruedas se levantan del suelo (<em>wheels-up</em>). Es diferente al AOBT porque entre salir de la posición y despegar, el avión puede esperar en fila para entrar a la pista.</p>
    <p class="text-muted small mb-0">&#x1F4A1; En términos simples: la hora exacta en que el avión levantó el vuelo &mdash; cuando sus ruedas dejaron alguna de las pistas del AIFA.</p>
  </div>

  <div id="colhelp-dep-attt">
    <p><strong>ATTT</strong> = <em>Actual Turnaround Time</em> &mdash; el tiempo total que el avión estuvo en tierra en AIFA entre su llegada y su salida.</p>
    <p>Se calcula como: <strong>ATTT = AOBT &minus; AIBT</strong></p>
    <p>Durante este tiempo se realizan todos los servicios en tierra: limpieza de cabina, combustible, descarga y carga de equipaje, catering, revisión técnica y embarque de pasajeros.</p>
    <p>Un turnaround corto (~30&ndash;45 min) refleja eficiencia operativa. Uno largo puede provocar que la salida también se retrase.</p>
    <p class="text-muted small mb-0">&#x1F4A1; En términos simples: el tiempo que el avión estuvo siendo preparado en AIFA entre que llegó y volvió a salir &mdash; como el tiempo que tarda un taxi entre un pasajero y el siguiente.</p>
  </div>

  <div id="colhelp-b-arr-status">
    <p>Estado actual del vuelo en el sistema operativo de AIFA. Indica si llegó/salió a tiempo, con retraso, fue cancelado u otras condiciones operativas.</p>
    <p class="text-muted small mb-0">&#x1F4A1; En términos simples: el "semáforo" del vuelo.</p>
  </div>

  <div id="colhelp-b-arr-flight">
    <p>El designador del vuelo de llegada: código de aerolínea + número (ej: <code>AM100</code>).</p>
    <p class="text-muted small mb-0">&#x1F4A1; En términos simples: el nombre del vuelo en el tablero de llegadas del aeropuerto.</p>
  </div>

  <div id="colhelp-b-arr-routing">
    <p>El aeropuerto desde el cual llegó el vuelo, identificado con su código IATA de 3 letras.</p>
    <p><strong>Ejemplos:</strong> <code>CUN</code> = Cancún &middot; <code>GDL</code> = Guadalajara &middot; <code>JFK</code> = Nueva York</p>
    <p class="text-muted small mb-0">&#x1F4A1; En términos simples: de dónde viene el avión.</p>
  </div>

  <div id="colhelp-b-dep-flight">
    <p>El designador del vuelo de salida: código de aerolínea + número (ej: <code>AM101</code>).</p>
    <p class="text-muted small mb-0">&#x1F4A1; En términos simples: el nombre del vuelo en el tablero de salidas del aeropuerto.</p>
  </div>

  <div id="colhelp-b-dep-routing">
    <p>El aeropuerto hacia el cual se dirige el vuelo de salida, identificado con su código IATA de 3 letras.</p>
    <p><strong>Ejemplos:</strong> <code>CUN</code> = Cancún &middot; <code>GDL</code> = Guadalajara &middot; <code>LAX</code> = Los Ángeles</p>
    <p class="text-muted small mb-0">&#x1F4A1; En términos simples: adónde va el avión.</p>
  </div>

</div><!-- /colhelp-templates -->

<!-- ══ Column Help Modal ════════════════════════════════════════════════════ -->
<div class="modal fade" id="col-help-modal" tabindex="-1" aria-labelledby="col-help-modal-title" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header bg-light py-2">
                <h6 class="modal-title mb-0 fw-bold" id="col-help-modal-title"></h6>
                <button type="button" class="btn-close btn-sm" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body" id="col-help-modal-body"></div>
            <div class="modal-footer py-2">
                <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<style>
    th[data-col-help] { cursor: pointer; }
    th[data-col-help]:hover { background-color: rgba(0,0,0,.05); }
</style>

<script>
    // Nombres legibles por clave para el modal
    var COL_HELP_TITLES = {
        'status':        'Status \u2014 Estado del vuelo',
        'arr-airline':   '[Arr] Airline \u2014 Aerolínea de Llegada',
        'arr-flight':    '[Arr] Flight \u2014 N\u00famero de Vuelo de Llegada',
        'arr-aldt':      '[Arr] ALDT \u2014 Actual Landing Time',
        'arr-sibt':      '[Arr] SIBT \u2014 Scheduled In-Block Time',
        'arr-aibt':      '[Arr] AIBT \u2014 Actual In-Block Time',
        'arr-stand':     '[Arr] Stand \u2014 Posición de Estacionamiento (Llegada)',
        'arr-gates':     '[Arr] Gates \u2014 Puerta de Desembarque',
        'arr-boarded':   '[Arr] Boarded \u2014 Pasajeros del Vuelo de Llegada',
        'arr-belts':     '[Arr] Belts \u2014 Banda de Equipaje',
        'arr-type':      '[Arr] Type \u2014 Tipo de Servicio de Llegada',
        'routing':       'Routing \u2014 Ruta del Vuelo',
        'dep-type':      '[Dep] Type \u2014 Tipo de Servicio de Salida',
        'aircraft':      'Aircraft Type \u2014 Modelo de Aeronave',
        'registration':  'Registration \u2014 Matrícula de la Aeronave',
        'dep-airline':   '[Dep] Airline \u2014 Aerolínea de Salida',
        'dep-flight':    '[Dep] Flight \u2014 N\u00famero de Vuelo de Salida',
        'dep-stand':     '[Dep] Stand \u2014 Posición de Estacionamiento (Salida)',
        'dep-gates':     '[Dep] Gates \u2014 Puerta de Embarque',
        'dep-boarded':   '[Dep] Boarded \u2014 Pasajeros Embarcados',
        'dep-sobt':      '[Dep] SOBT \u2014 Hora Programada de Salida de Posici\u00f3n',
        'dep-aobt':      '[Dep] AOBT \u2014 Hora Real de Salida de Posici\u00f3n',
        'dep-atot':      '[Dep] ATOT \u2014 Actual Take-Off Time',
        'dep-attt':      '[Dep] ATTT \u2014 Actual Turnaround Time',
        'b-arr-status':  'Status \u2014 Estado del Vuelo',
        'b-arr-flight':  'Flight \u2014 N\u00famero de Vuelo de Llegada',
        'b-arr-routing': 'Routing \u2014 Aeropuerto de Origen',
        'b-dep-flight':  'Flight \u2014 N\u00famero de Vuelo de Salida',
        'b-dep-routing': 'Routing \u2014 Aeropuerto de Destino'
    };

    var COL_HELP_WIDE_KEYS = ['arr-type', 'dep-type'];

    function _svcUpdateCount(wrap, visible, total) {
        var el = wrap.querySelector('.svc-row-count');
        if (el) el.textContent = visible === total ? total + ' tipos' : visible + ' de ' + total + ' tipos';
    }

    window.filterServiceTypeTable = function (input) {
        var wrap = input.closest('.col-help-svc-wrap');
        if (!wrap) return;
        var q = input.value.trim().toLowerCase();
        // clear category active state when typing
        wrap.querySelectorAll('.svc-cat-btn').forEach(function(b){ b.classList.remove('active','opacity-100'); b.style.opacity=''; });
        var rows = wrap.querySelectorAll('tbody tr');
        var visible = 0;
        rows.forEach(function (tr) {
            var text = tr.textContent.toLowerCase();
            var show = !q || text.includes(q);
            tr.style.display = show ? '' : 'none';
            if (show) visible++;
        });
        _svcUpdateCount(wrap, visible, rows.length);
    };

    window.filterServiceTypeCat = function (btn, cat) {
        var wrap = btn.closest('.col-help-svc-wrap');
        if (!wrap) return;
        // clear text input
        var input = wrap.querySelector('input[type="text"]');
        if (input) input.value = '';
        // highlight active button
        wrap.querySelectorAll('.svc-cat-btn').forEach(function(b){ b.classList.remove('active'); b.style.opacity='.65'; });
        btn.classList.add('active'); btn.style.opacity='';
        var rows = wrap.querySelectorAll('tbody tr');
        var visible = 0;
        rows.forEach(function (tr) {
            var catCell = tr.cells[1] ? tr.cells[1].textContent.trim() : '';
            var show = !cat || catCell === cat;
            tr.style.display = show ? '' : 'none';
            if (show) visible++;
        });
        _svcUpdateCount(wrap, visible, rows.length);
    };

    function showColHelp(key) {
        var titleEl  = document.getElementById('col-help-modal-title');
        var bodyEl   = document.getElementById('col-help-modal-body');
        var template = document.getElementById('colhelp-' + key);
        if (!template || !titleEl || !bodyEl) return;
        titleEl.textContent = COL_HELP_TITLES[key] || key;
        bodyEl.innerHTML    = template.innerHTML;
        // Widen modal for catalogs with tables
        var dlg = document.querySelector('#col-help-modal .modal-dialog');
        if (dlg) {
            if (COL_HELP_WIDE_KEYS.indexOf(key) !== -1) {
                dlg.classList.add('modal-lg');
            } else {
                dlg.classList.remove('modal-lg');
            }
        }
        bootstrap.Modal.getOrCreateInstance(document.getElementById('col-help-modal')).show();
    }

    // Inicializar tooltips + delegar clicks en encabezados
    document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(function (el) {
            new bootstrap.Tooltip(el, { trigger: 'hover', boundary: 'window' });
        });
        document.addEventListener('click', function (e) {
            var th = e.target.closest('th[data-col-help]');
            if (!th) return;
            showColHelp(th.getAttribute('data-col-help'));
        });
    });
</script>

<!-- ====== Conciliación Admin Module ====== -->
<script>
window.opsFlightsAdmin = (function () {
    'use strict';

    var adminData = [];
    var adminFilters = {};

    function getEl(id) { return document.getElementById(id); }

    function updateBadge() {
        var badge = getEl('admin-flight-count-badge');
        if (!badge) return;
        badge.textContent = adminData.length + ' vuelo' + (adminData.length !== 1 ? 's' : '');
        badge.style.display = adminData.length > 0 ? '' : 'none';
    }

    function showStatus(msg, type) {
        var el = getEl('admin-status-msg');
        if (!el) return;
        el.className = 'alert alert-' + (type || 'info') + ' py-2 px-3 small mb-2';
        el.textContent = msg;
        el.classList.remove('d-none');
        clearTimeout(el._hideTimer);
        el._hideTimer = setTimeout(function () { el.classList.add('d-none'); }, 5000);
    }

    function updateDeleteBtn() {
        var checkboxes = document.querySelectorAll('.admin-row-chk:checked');
        var btn = getEl('btn-delete-admin-selected');
        var countEl = getEl('admin-selected-count');
        var count = checkboxes.length;
        if (!btn || !countEl) return;
        countEl.textContent = count;
        btn.classList.toggle('d-none', count === 0);
    }

    function toggleSelectAll(checked) {
        document.querySelectorAll('.admin-row-chk').forEach(function (chk) { chk.checked = checked; });
        updateDeleteBtn();
    }

    function escHtml(str) {
        if (str === null || str === undefined) return '';
        return String(str)
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;');
    }

    function renderTable() {
        var tbody = getEl('tbody-admin-flights-csv');
        if (!tbody) return;

        // Reset select-all checkbox
        var selAll = getEl('admin-select-all');
        if (selAll) selAll.checked = false;

        if (adminData.length === 0) {
            tbody.innerHTML = '<tr><td colspan="25" class="text-muted py-4">No se encontraron vuelos para el rango seleccionado.</td></tr>';
            updateDeleteBtn();
            return;
        }

        var rows = adminData.map(function (row) {
            var id = row.id;
            var v = function (field) { return escHtml(row[field]); };
            return (
                '<tr data-admin-id="' + id + '">' +
                '<td style="background:#fff5f5"><input type="checkbox" class="form-check-input admin-row-chk" data-id="' + id + '" onchange="window.opsFlightsAdmin.updateDeleteBtn()"></td>' +
                '<td>' + v('Status') + '</td>' +
                '<td>' + v('[Arr] Airline code') + '</td>' +
                '<td>' + v('[Arr] Flight Designator') + '</td>' +
                '<td>' + v('[Arr] ALDT') + '</td>' +
                '<td>' + v('[Arr] SIBT') + '</td>' +
                '<td>' + v('[Arr] AIBT') + '</td>' +
                '<td>' + v('[Arr] Stand') + '</td>' +
                '<td>' + v('[Arr] Gates') + '</td>' +
                '<td>' + v('[Arr] Boarded') + '</td>' +
                '<td>' + v('[Arr] Service Type') + '</td>' +
                '<td>' + v('Routing') + '</td>' +
                '<td>' + v('[Dep] Service Type') + '</td>' +
                '<td>' + v('Aircraft type') + '</td>' +
                '<td>' + v('Registration') + '</td>' +
                '<td>' + v('[Dep] Airline code') + '</td>' +
                '<td>' + v('[Dep] Flight Designator') + '</td>' +
                '<td>' + v('[Dep] Stand') + '</td>' +
                '<td>' + v('[Dep] Gates') + '</td>' +
                '<td>' + v('[Dep] Boarded') + '</td>' +
                '<td>' + v('[Dep] SOBT') + '</td>' +
                '<td>' + v('[Dep] AOBT') + '</td>' +
                '<td>' + v('[Dep] ATOT') + '</td>' +
                '<td>' + v('[Dep] ATTT') + '</td>' +
                '<td style="background:#fff0f0;border-left:2px solid #f5c6c6">' +
                '<button class="btn btn-danger btn-sm py-0 px-2" onclick="window.opsFlightsAdmin.deleteById(' + id + ')" title="Eliminar vuelo"><i class="fas fa-trash-alt"></i></button>' +
                '</td>' +
                '</tr>'
            );
        });
        tbody.innerHTML = rows.join('');

        // Attach inline filter listeners
        document.querySelectorAll('#table-admin-flights-csv thead input[data-admin-field]').forEach(function (inp) {
            inp.oninput = function () {
                adminFilters[this.getAttribute('data-admin-field')] = this.value.trim().toLowerCase();
                applyAdminFilters();
            };
        });

        updateDeleteBtn();
        updateBadge();
        buildDaySummary();
    }

    function applyAdminFilters() {
        var dateEl = getEl('admin-delete-date');
        var dayPrefix = dateEl && dateEl.value ? isoToAirportDay(dateEl.value) : '';
        var rows = document.querySelectorAll('#tbody-admin-flights-csv tr[data-admin-id]');
        var visibleCount = 0;
        rows.forEach(function (tr) {
            var id = parseInt(tr.getAttribute('data-admin-id'), 10);
            var row = adminData.find(function (r) { return r.id === id; });
            if (!row) { tr.style.display = ''; return; }
            // Text filter pass
            var pass = Object.keys(adminFilters).every(function (field) {
                var q = adminFilters[field];
                if (!q) return true;
                var val = row[field];
                return val !== null && val !== undefined && String(val).toLowerCase().includes(q);
            });
            // Day filter pass
            if (pass && dayPrefix) {
                pass = rowMatchesDay(row, dayPrefix);
            }
            tr.style.display = pass ? '' : 'none';
            if (pass) visibleCount++;
        });
        // Update badge with filtered count
        var badge = getEl('admin-flight-count-badge');
        if (badge) {
            badge.textContent = visibleCount + ' vuelo' + (visibleCount !== 1 ? 's' : '') + (dayPrefix ? ' (' + dayPrefix + ')' : '');
            badge.style.display = visibleCount > 0 ? '' : 'none';
        }
    }

    function filterByDeleteDate() {
        applyAdminFilters();
        buildDaySummary();
    }

    // Convert airport day prefix "15FEB" → ISO date string "2026-02-15"
    function dayPrefixToISO(prefix) {
        var MONTH_IDX = {JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12};
        var m = String(prefix).toUpperCase().match(/^(\d{2})([A-Z]{3})$/);
        if (!m) return '';
        var day = parseInt(m[1], 10);
        var month = MONTH_IDX[m[2]];
        if (!month) return '';
        var year = new Date().getFullYear();
        // If resulting date is more than 60 days in the future, use prior year
        var candidate = new Date(year, month - 1, day);
        if ((candidate - new Date()) > 60 * 86400000) year--;
        return year + '-' + String(month).padStart(2, '0') + '-' + String(day).padStart(2, '0');
    }

    function collectDayPrefixes() {
        var FIELDS = ['[Arr] ALDT','[Arr] SIBT','[Arr] AIBT','[Dep] SOBT','[Dep] AOBT','[Dep] ATOT'];
        var set = new Set();
        adminData.forEach(function (row) {
            FIELDS.forEach(function (f) {
                var v = String(row[f] || '').trim().toUpperCase();
                var match = v.match(/^(\d{2}[A-Z]{3})/);
                if (match) set.add(match[1]);
            });
        });
        return Array.from(set).sort(function (a, b) {
            return (dayPrefixToISO(a) || a).localeCompare(dayPrefixToISO(b) || b);
        });
    }

    function buildDaySummary() {
        var grid = getEl('admin-days-grid');
        if (!grid) return;
        if (adminData.length === 0) {
            grid.innerHTML = '<p class="text-muted small mb-0">No hay datos cargados.</p>';
            return;
        }
        var days = collectDayPrefixes();
        var activeDateEl = getEl('admin-delete-date');
        var activeISO = activeDateEl ? activeDateEl.value : '';
        var html = '<div class="d-flex flex-wrap gap-2 align-items-start">';
        // "Todos" chip
        html += '<button class="btn btn-sm ' + (activeISO ? 'btn-outline-secondary' : 'btn-primary') + ' py-1" '
              + 'onclick="window.opsFlightsAdmin.clearDayFilter()" '
              + 'style="min-width:80px;text-align:center;border-radius:10px">'
              + '<div style="font-size:.68rem;opacity:.7;letter-spacing:.05em">TODOS</div>'
              + '<div style="font-size:1.15rem;font-weight:800;line-height:1.1">' + adminData.length + '</div>'
              + '<div style="font-size:.7rem">vuelos</div>'
              + '</button>';
        days.forEach(function (prefix) {
            var iso  = dayPrefixToISO(prefix);
            var isActive = iso && iso === activeISO;
            var day  = prefix.slice(0, 2);
            var mon  = prefix.slice(2);
            var count = adminData.filter(function (r) { return rowMatchesDay(r, prefix); }).length;
            html += '<button class="btn btn-sm ' + (isActive ? 'btn-primary shadow' : 'btn-outline-primary') + ' py-1" '
                  + 'onclick="window.opsFlightsAdmin.filterToDay(\'' + prefix + '\')" '
                  + 'style="min-width:90px;text-align:center;border-radius:10px" '
                  + 'title="' + count + ' vuelos el ' + prefix + '">'
                  + '<div style="font-size:.68rem;text-transform:uppercase;opacity:.7;letter-spacing:.05em">' + mon + '</div>'
                  + '<div style="font-size:1.4rem;font-weight:800;line-height:1.1">' + day + '</div>'
                  + '<div style="font-size:.75rem;font-weight:600">' + count + ' <i class=\'fas fa-plane\' style=\'font-size:.6rem\'></i></div>'
                  + '</button>';
        });
        html += '</div>';
        grid.innerHTML = html;
    }

    function filterToDay(prefix) {
        var iso = dayPrefixToISO(prefix);
        var dateEl = getEl('admin-delete-date');
        if (dateEl && iso) dateEl.value = iso;
        applyAdminFilters();
        buildDaySummary();
    }

    function clearDayFilter() {
        var dateEl = getEl('admin-delete-date');
        if (dateEl) dateEl.value = '';
        applyAdminFilters();
        buildDaySummary();
    }
    function isoToAirportDay(iso) {
        if (!iso) return '';
        var MONTHS = ['JAN','FEB','MAR','APR','MAY','JUN','JUL','AUG','SEP','OCT','NOV','DEC'];
        var d = new Date(iso + 'T00:00:00');
        return String(d.getDate()).padStart(2,'0') + MONTHS[d.getMonth()];
    }

    // Check if any time field in row contains dayPrefix (e.g. "15FEB")
    function rowMatchesDay(row, dayPrefix) {
        var fields = ['[Arr] ALDT','[Arr] SIBT','[Arr] AIBT','[Dep] SOBT','[Dep] AOBT','[Dep] ATOT'];
        return fields.some(function (f) {
            var v = row[f];
            return v && String(v).toUpperCase().startsWith(dayPrefix);
        });
    }

    async function loadData() {
        var tbody = getEl('tbody-admin-flights-csv');
        if (tbody) tbody.innerHTML = '<tr><td colspan="25" class="text-muted py-4"><i class="fas fa-spinner fa-spin me-2"></i>Cargando…</td></tr>';

        try {
            var sb = window.supabaseClient;
            if (!sb) throw new Error('Supabase no disponible');

            var result = await sb.from('vuelos_parte_operaciones_csv').select('*').order('id', { ascending: true });
            if (result.error) throw result.error;

            adminData = result.data || [];
            adminFilters = {};
            document.querySelectorAll('#table-admin-flights-csv thead input[data-admin-field]').forEach(function (inp) { inp.value = ''; });

            renderTable();
            showStatus('Cargados ' + adminData.length + ' registro(s).', 'success');
        } catch (e) {
            adminData = [];
            updateBadge();
            if (tbody) tbody.innerHTML = '<tr><td colspan="25" class="text-danger py-3"><i class="fas fa-exclamation-triangle me-2"></i>Error al cargar: ' + escHtml(e.message || String(e)) + '</td></tr>';
        }
    }

    async function deleteByDate() {
        var dateEl = getEl('admin-delete-date');
        var date = dateEl ? dateEl.value : '';
        if (!date) {
            showStatus('Elige una fecha en el campo "Eliminar día".', 'warning');
            return;
        }
        var dayPrefix = isoToAirportDay(date); // e.g. "15FEB"
        var vuelos = adminData.filter(function (r) { return rowMatchesDay(r, dayPrefix); });
        if (vuelos.length === 0) {
            showStatus('No se encontraron vuelos del día ' + date + ' (' + dayPrefix + ') en los datos cargados.', 'warning');
            return;
        }
        var ids = vuelos.map(function (r) { return r.id; });
        var ok = confirm('¿Eliminar TODOS los vuelos del día ' + date + ' (' + dayPrefix + ')?' +
            '\n' + vuelos.length + ' registro(s) serán eliminados.' +
            '\n\nEsta acción NO se puede deshacer.');
        if (!ok) return;
        try {
            var sb = window.supabaseClient;
            var result = await sb.from('vuelos_parte_operaciones_csv').delete().in('id', ids);
            if (result.error) throw result.error;
            showStatus('Vuelos del día ' + dayPrefix + ' eliminados correctamente (' + ids.length + ' registros).', 'success');
            adminData = adminData.filter(function (r) { return !ids.includes(r.id); });
            renderTable();
        } catch (e) {
            showStatus('Error al eliminar: ' + (e.message || e), 'danger');
        }
    }

    // Returns all rows whose canonical date (first SOBT/SIBT value parsed) falls in [startISO, endISO]
    function rowsInRange(startISO, endISO) {
        var start = new Date(startISO + 'T00:00:00');
        var end   = new Date(endISO   + 'T23:59:59');
        var MONTHS = {JAN:0,FEB:1,MAR:2,APR:3,MAY:4,JUN:5,JUL:6,AUG:7,SEP:8,OCT:9,NOV:10,DEC:11};
        var TIME_FIELDS = ['[Dep] SOBT','[Arr] SIBT','[Arr] ALDT','[Arr] AIBT','[Dep] AOBT','[Dep] ATOT'];
        var year = start.getFullYear();

        function parseField(val) {
            if (!val) return null;
            var m = String(val).trim().toUpperCase().match(/(\d{2})([A-Z]{3})\s+(\d{2}):(\d{2})/);
            if (!m) return null;
            var mon = MONTHS[m[2]];
            if (mon === undefined) return null;
            return new Date(year, mon, parseInt(m[1],10), parseInt(m[3],10), parseInt(m[4],10));
        }

        return adminData.filter(function (row) {
            // Include row if ANY time field falls within the range
            return TIME_FIELDS.some(function (f) {
                var dt = parseField(row[f]);
                if (!dt) return false;
                return dt >= start && dt <= end;
            });
        });
    }

    function previewRange() {
        var s = getEl('admin-range-start');
        var e = getEl('admin-range-end');
        var badge = getEl('admin-range-preview');
        if (!s || !e || !badge) return;
        var startVal = s.value;
        var endVal   = e.value;
        if (!startVal || !endVal) {
            badge.classList.add('d-none');
            return;
        }
        if (endVal < startVal) {
            badge.textContent = 'Fin anterior al inicio';
            badge.className = 'badge bg-danger text-white';
            return;
        }
        var count = rowsInRange(startVal, endVal).length;
        badge.textContent = count + ' vuelo' + (count !== 1 ? 's' : '') + ' en rango';
        badge.className = 'badge ' + (count > 0 ? 'bg-warning text-dark' : 'bg-secondary text-white');
    }

    async function deleteByRange() {
        var startEl = getEl('admin-range-start');
        var endEl   = getEl('admin-range-end');
        var startVal = startEl ? startEl.value : '';
        var endVal   = endEl   ? endEl.value   : '';
        if (!startVal || !endVal) {
            showStatus('Selecciona fecha de inicio y fin del rango.', 'warning');
            return;
        }
        if (endVal < startVal) {
            showStatus('La fecha de fin debe ser igual o posterior a la de inicio.', 'warning');
            return;
        }
        var vuelos = rowsInRange(startVal, endVal);
        if (vuelos.length === 0) {
            showStatus('No se encontraron vuelos en el rango ' + startVal + ' — ' + endVal + '.', 'warning');
            return;
        }
        var startPfx = isoToAirportDay(startVal);
        var endPfx   = isoToAirportDay(endVal);
        var ok = confirm('¿Eliminar TODOS los vuelos del ' + startPfx + ' al ' + endPfx + '?\n' +
            vuelos.length + ' registro(s) serán eliminados.\n\nEsta acción NO se puede deshacer.');
        if (!ok) return;
        var ids = vuelos.map(function (r) { return r.id; });
        try {
            var sb = window.supabaseClient;
            var result = await sb.from('vuelos_parte_operaciones_csv').delete().in('id', ids);
            if (result.error) throw result.error;
            showStatus('Eliminados ' + ids.length + ' vuelo(s) del rango ' + startPfx + ' — ' + endPfx + '.', 'success');
            adminData = adminData.filter(function (r) { return !ids.includes(r.id); });
            var badge = getEl('admin-range-preview');
            if (badge) badge.classList.add('d-none');
            renderTable();
            buildDaySummary();
        } catch (e) {
            showStatus('Error al eliminar: ' + (e.message || e), 'danger');
        }
    }

    async function deleteById(id) {
        var ok = confirm('¿Eliminar este vuelo (ID: ' + id + ')?\n\nEsta acción NO se puede deshacer.');
        if (!ok) return;
        try {
            var sb = window.supabaseClient;
            var result = await sb.from('vuelos_parte_operaciones_csv').delete().eq('id', id);
            if (result.error) throw result.error;
            adminData = adminData.filter(function (r) { return r.id !== id; });
            renderTable();
            showStatus('Vuelo eliminado.', 'success');
        } catch (e) {
            showStatus('Error al eliminar: ' + (e.message || e), 'danger');
        }
    }

    async function deleteSelected() {
        var checkboxes = document.querySelectorAll('.admin-row-chk:checked');
        if (checkboxes.length === 0) return;
        var ids = Array.from(checkboxes).map(function (chk) { return parseInt(chk.getAttribute('data-id'), 10); });
        var ok = confirm('¿Eliminar ' + ids.length + ' vuelo(s) seleccionado(s)?\n\nEsta acción NO se puede deshacer.');
        if (!ok) return;
        try {
            var sb = window.supabaseClient;
            var result = await sb.from('vuelos_parte_operaciones_csv').delete().in('id', ids);
            if (result.error) throw result.error;
            adminData = adminData.filter(function (r) { return !ids.includes(r.id); });
            renderTable();
            showStatus('Se eliminaron ' + ids.length + ' vuelo(s).', 'success');
        } catch (e) {
            showStatus('Error al eliminar: ' + (e.message || e), 'danger');
        }
    }

    // Init: set default dates, wire tab activation
    document.addEventListener('DOMContentLoaded', function () {
        var today    = new Date();
        var fmt = function (d) { return d.toISOString().slice(0, 10); };

        var ddEl = getEl('admin-delete-date');
        if (ddEl) ddEl.value = fmt(today);

        // Load data automatically when tab is first activated
        var tabBtn = getEl('tab-conciliacion-admin');
        if (tabBtn) {
            var loaded = false;
            tabBtn.addEventListener('shown.bs.tab', function () {
                if (!loaded) { loaded = true; loadData(); }
            });
        }
    });

    return {
        loadData:           loadData,
        deleteByDate:       deleteByDate,
        deleteByRange:      deleteByRange,
        previewRange:       previewRange,
        deleteById:         deleteById,
        deleteSelected:     deleteSelected,
        toggleSelectAll:    toggleSelectAll,
        updateDeleteBtn:    updateDeleteBtn,
        filterByDeleteDate: filterByDeleteDate,
        filterToDay:        filterToDay,
        clearDayFilter:     clearDayFilter
    };
}());
</script>
</body>

</html>



