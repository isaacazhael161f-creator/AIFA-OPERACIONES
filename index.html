<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Operaciones AIFA</title>
    <meta name="theme-color" content="#0a1f44" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Roboto+Mono:wght@400;700&family=Roboto+Condensed:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" sizes="192x192" href="images/icons/aifa-app-icon-192.png">
    <link rel="manifest" href="manifest.webmanifest">
</head>

<body>

    <div id="login-screen" class="login-screen">
        <video id="login-bg-video" class="login-bg-video" autoplay muted loop playsinline poster="images/fondo-aifa.jpg">
            <source src="videos/Aterrizaje%20AIFA.mp4" type="video/mp4">
        </video>
        <div id="login-sky" aria-hidden="true"></div>
        <div class="login-overlay"></div>
        <div class="login-container">
            <div class="login-header">
                <img src="images/emblema-aviacion.png" alt="Emblema de la Aviación" class="login-logo" />
                <h1 id="login-title" class="h3">OPERACIONES-AIFA</h1>
                <p class="text-muted">Ingrese sus credenciales para continuar</p>
            </div>
            <form id="login-form" class="login-form">
                <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="username" name="username" required placeholder=" " autocomplete="username">
                    <label for="username">Usuario</label>
                </div>
                <div class="form-floating mb-3">
                    <input type="password" class="form-control" id="password" name="password" required placeholder=" " autocomplete="current-password">
                    <label for="password">Contraseña</label>
                </div>
                <button type="submit" id="login-button" class="btn btn-primary w-100 py-2">
                    <span class="btn-text">Iniciar Sesión</span>
                    <span class="spinner-plane" aria-hidden="true"></span>
                </button>
                <div id="login-error" class="text-danger mt-2"></div>
            </form>
        </div>
    </div>

    <div id="main-app" class="main-app hidden">
        <header class="header p-3">
            <div id="flying-plane">
                <div class="contrail"></div>
            </div>
            <div class="container-fluid">
                <div class="header-content d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <button class="btn sidebar-toggler-btn" type="button" id="sidebar-toggler">
                            <i class="fas fa-bars"></i>
                        </button>
                        <img src="images/aifa-logo.png" alt="Logo AIFA" class="aifa-logo" />
                    </div>
                    <div class="text-center header-center-content">
                        <div class="d-flex align-items-center justify-content-between gap-3 header-title-row">
                            <img src="images/nlu-operacion.png" alt="Logo de Operación NLU" class="header-logo" />
                            <h1 class="main-title">AEROPUERTO INTERNACIONAL FELIPE ÁNGELES</h1>
                            <img src="images/emblema-aviacion.png" alt="Logo de Aviación" class="header-logo" />
                        </div>
                        <div class="header-subtext">
                            <div id="current-user" class="current-user-display fw-bold"></div>
                            <p id="current-date" class="current-date-display fw-bold mb-0"></p>
                        </div>
                    </div>
                    <div class="d-flex align-items-center gap-3 header-right-content">
                        <div class="clocks-wrapper d-flex gap-2 align-items-center">
                            <div class="formal-clock-container">
                                <div class="clock-label">HORA LOCAL</div>
                                <div class="formal-clock" id="formal-clock">00:00:00</div>
                            </div>
                            <div class="utc-clock-container">
                                <div class="clock-label">HORA UTC</div>
                                <div class="utc-clock" id="utc-clock">00:00:00</div>
                            </div>
                        </div>
                        <button id="install-app-btn" class="btn btn-outline-primary btn-sm d-none align-items-center gap-2" type="button" aria-label="Instalar la app en este dispositivo">
                            <i class="fas fa-download"></i>
                            <span>Instalar app</span>
                        </button>
                        
                        <img src="images/gobierno-mexico.png" alt="Logo del Gobierno de México" class="gob-logo" />
                        <!-- Tema fijo claro: se elimina el botón de cambio de tema -->
                        <a href="#" class="btn btn-outline-danger d-lg-none logout-button-mobile" data-action="logout" title="Cerrar Sesión">
                            <i class="fas fa-sign-out-alt"></i>
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <div class="app-body">
            <aside class="sidebar d-flex flex-column p-2" id="sidebar">
                <nav class="nav flex-column" id="sidebar-nav">
                    <a class="menu-item active" href="#" data-section="operaciones-totales"><i class="fas fa-home"></i><span>Inicio</span></a>
                    <a class="menu-item" href="#" data-section="parte-operaciones"><i class="fas fa-file-invoice"></i><span>Parte de Operaciones</span></a>
                    <a class="menu-item" href="#" data-section="inicio"><i class="fas fa-calendar-day"></i><span>Itinerario diario</span></a>
                    <a class="menu-item" href="#" data-section="itinerario"><i class="fas fa-chart-area"></i><span>Gráficas Itinerario</span></a>
                    <a class="menu-item" href="#" data-section="frecuencias-semana"><i class="fas fa-chart-bar"></i><span>Frecuencias semanales</span></a>
                    <a class="menu-item" href="#" data-section="puntualidad-agosto">
                        <span class="icon-clock-check" aria-hidden="true">
                            <i class="fas fa-clock"></i>
                            <i class="fas fa-check check" aria-hidden="true"></i>
                        </span>
                        <span>Puntualidad</span>
                    </a>
                    <a class="menu-item" href="#" data-section="demoras"><i class="fas fa-clock"></i><span>Demoras</span></a>
                    <a class="menu-item" id="itinerario-mensual-menu" href="#" data-section="itinerario-mensual"><i class="fas fa-table"></i><span>Itinerario Mensual</span></a>
                    <a class="menu-item" href="#" data-section="comparativa"><i class="fas fa-chart-line"></i><span>Comparativa</span></a>
                    <a class="menu-item" href="#" data-section="manifiestos"><i class="fas fa-file-signature"></i><span>Manifiestos</span></a>
                    <a class="menu-item" href="#" data-section="fauna"><i class="fas fa-shield-alt"></i><span>GSO</span></a>
                    <a class="menu-item" href="#" data-section="medicas"><i class="fas fa-briefcase-medical"></i><span>Servicio Médico</span></a>
                    <a class="menu-item" href="#" data-install-app-info><i class="fas fa-download"></i><span>Instalar como app</span></a>
                    
                    <a class="menu-item logout-item" href="#" data-action="logout"><i class="fas fa-sign-out-alt"></i><span>Cerrar Sesión</span></a>
                </nav>
            </aside>
            <!-- Overlay para dispositivos móviles: permite cerrar el sidebar al tocar fuera -->
            <div id="sidebar-overlay" class="sidebar-overlay"></div>
            <main class="main-content flex-grow-1 p-3 p-md-4">
                <div id="file-protocol-warning" class="alert alert-warning alert-dismissible fade show d-none" role="alert">
                    <strong>Advertencia:</strong> Estás abriendo el archivo directamente (file://). Para evitar errores CORS al cargar CSV/JSON, inicia el servidor local y abre: <a href="http://localhost:3000" target="_blank" rel="noopener">http://localhost:3000</a>.
                    
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
                </div>

                <div id="inicio-section" class="content-section">
                    <div class="card">
                        <div class="card-header">
                            <ul class="nav nav-tabs card-header-tabs" id="inicioTab" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="interactivo-inicio-tab" data-bs-toggle="tab" data-bs-target="#interactivo-inicio-pane" type="button" role="tab" aria-controls="interactivo-inicio-pane" aria-selected="true"><i class="fas fa-table me-2"></i>Vista Interactiva</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="graficas-itinerario-tab" data-bs-toggle="tab" data-bs-target="#graficas-itinerario-pane" type="button" role="tab" aria-controls="graficas-itinerario-pane" aria-selected="false"><i class="fas fa-chart-area me-2"></i>Gráficas Itinerario</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="pdf-inicio-tab" data-bs-toggle="tab" data-bs-target="#pdf-inicio-pane" type="button" role="tab" aria-controls="pdf-inicio-pane" aria-selected="false"><i class="fas fa-file-pdf me-2"></i>Documento PDF Original</button>
                                </li>
                            </ul>
                        </div>
                        <div class="card-body">
                            <div class="tab-content" id="inicioTabContent">
                                <div class="tab-pane fade show active" id="interactivo-inicio-pane" role="tabpanel" aria-labelledby="interactivo-inicio-tab" tabindex="0">
                                    <div class="mb-3">
                                        <button class="btn btn-outline-primary w-100" data-bs-toggle="collapse" data-bs-target="#summary-collapse" aria-expanded="false" aria-controls="summary-collapse">
                                            Resumen de Operaciones
                                        </button>
                                        <span class="d-block small text-muted mt-2">Cifras preliminares del día.</span>
                                    </div>
                                    <div class="collapse" id="summary-collapse">
                                        <h4 class="section-subheading mb-3"><i class="fas fa-list-ul me-2"></i>Resumen por Aerolínea</h4>
                                        <div id="summary-table-container" class="table-container-tech"></div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12">
                                            <div id="filter-controls" class="filter-container mb-4">
                                                <div class="filter-header">
                                                    <i class="fas fa-filter me-2"></i>
                                                    <h5 class="mb-0">Filtros de Búsqueda</h5>
                                                </div>
                                                <div class="filters-bar">
                                                    <div class="chip">
                                                        <label><i class="fas fa-suitcase me-1"></i>Banda</label>
                                                        <input type="text" id="claim-filter" class="form-control" placeholder="Número/Nombre de banda...">
                                                    </div>
                                                    <div class="chip">
                                                        <label><i class="fas fa-map-pin me-1"></i>Posición</label>
                                                        <select id="position-filter" class="form-select">
                                                            <option value="all" selected>Todas las posiciones</option>
                                                        </select>
                                                    </div>
                                                    <div class="chip">
                                                        <label><i class="fas fa-plane-arrival me-1"></i>Origen</label>
                                                        <select id="origin-filter" class="form-select">
                                                            <option value="all" selected>Todos los orígenes</option>
                                                        </select>
                                                    </div>
                                                    <div class="chip">
                                                        <label><i class="fas fa-plane-departure me-1"></i>Destino</label>
                                                        <select id="destination-filter" class="form-select">
                                                            <option value="all" selected>Todos los destinos</option>
                                                        </select>
                                                    </div>
                                                    <div class="chip">
                                                        <label><i class="fas fa-search me-1"></i>Buscar</label>
                                                        <input type="text" id="global-search" class="form-control" placeholder="Aerolínea, origen, destino, vuelo...">
                                                    </div>
                                                    <div class="chip">
                                                        <label><i class="fas fa-calendar-day me-1"></i>Fecha</label>
                                                        <input type="date" id="date-filter" class="form-control">
                                                    </div>
                                                    <div class="chip">
                                                        <label><i class="fas fa-clock me-1"></i>Hora</label>
                                                        <select id="hour-filter" class="form-select">
                                                            <option value="all" selected>Todas</option>
                                                            <option value="00">00</option>
                                                            <option value="01">01</option>
                                                            <option value="02">02</option>
                                                            <option value="03">03</option>
                                                            <option value="04">04</option>
                                                            <option value="05">05</option>
                                                            <option value="06">06</option>
                                                            <option value="07">07</option>
                                                            <option value="08">08</option>
                                                            <option value="09">09</option>
                                                            <option value="10">10</option>
                                                            <option value="11">11</option>
                                                            <option value="12">12</option>
                                                            <option value="13">13</option>
                                                            <option value="14">14</option>
                                                            <option value="15">15</option>
                                                            <option value="16">16</option>
                                                            <option value="17">17</option>
                                                            <option value="18">18</option>
                                                            <option value="19">19</option>
                                                            <option value="20">20</option>
                                                            <option value="21">21</option>
                                                            <option value="22">22</option>
                                                            <option value="23">23</option>
                                                        </select>
                                                    </div>
                                                    <div class="chip">
                                                        <label><i class="fas fa-exchange-alt me-1"></i>Tipo de hora</label>
                                                        <select id="hour-type-filter" class="form-select">
                                                            <option value="both" selected>Ambas</option>
                                                            <option value="arr">Llegada</option>
                                                            <option value="dep">Salida</option>
                                                        </select>
                                                    </div>
                                                    <div class="filters-actions">
                                                        <button id="clear-filters" class="btn btn-outline-secondary btn-sm">Limpiar</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="itinerary-airline-toolbar">
                                                <div class="itinerary-airline-picker">
                                                    <label for="airline-filter" class="airline-picker-label"><i class="fas fa-plane me-1"></i>Aerolínea</label>
                                                    <select id="airline-filter" class="form-select">
                                                        <option value="all" selected>Todas las Aerolíneas</option>
                                                    </select>
                                                </div>
                                                <div class="airline-summary-card is-empty" id="airline-summary-card" aria-live="polite">
                                                    <div class="airline-summary-placeholder"><i class="fas fa-plane-arrival me-2"></i>Selecciona una aerolínea para ver su resumen diario.</div>
                                                </div>
                                            </div>
                                            <div id="itinerary-airline-detail" class="itinerary-airline-detail d-none" aria-live="polite"></div>
                                            <div class="itinerary-table-block" id="itinerary-passenger-block">
                                                <div id="passenger-itinerary-container" class="itinerary-general-host"></div>
                                            </div>

                                            <div class="itinerary-table-block" id="itinerary-cargo-block">
                                                <div id="cargo-itinerary-container" class="itinerary-general-host"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="graficas-itinerario-pane" role="tabpanel" aria-labelledby="graficas-itinerario-tab" tabindex="0">
                                    <div class="pt-3">
                                        <div id="itinerario-section">
                                            <div class="card">
                                                <div class="card-header flex-column flex-md-row d-flex justify-content-between align-items-center">
                                                    <h2 class="section-title mb-3 mb-md-0">ITINERARIO DETALLADO <small id="it-stats-badge" class="text-muted ms-2" style="font-size:0.8rem"></small></h2>
                                                    <div class="d-flex gap-2">
                                                        <a href="excel/itinerario_completo.xlsx" class="btn btn-success download-btn" download><i class="fas fa-file-excel me-2"></i><span class="btn-text">Descargar Excel</span></a>
                                                    </div>
                                                </div>
                                                <div class="card-body">
                                                    <!-- Controles de fecha (vuelos del día) -->
                                                    <div class="d-flex flex-wrap align-items-center justify-content-end gap-2 mb-2" id="itinerary-day-controls">
                                                        <button class="btn btn-sm btn-outline-secondary" id="it-day-prev" title="Día anterior"><i class="fas fa-chevron-left"></i></button>
                                                        <input type="date" id="it-day-input" class="form-control form-control-sm" />
                                                        <button class="btn btn-sm btn-outline-secondary" id="it-day-next" title="Día siguiente"><i class="fas fa-chevron-right"></i></button>
                                                        <button class="btn btn-sm btn-outline-primary" id="it-day-today" title="Hoy"><i class="fas fa-calendar-day me-1"></i>Hoy</button>
                                                    </div>

                                                    <ul class="nav nav-tabs" id="itineraryTab" role="tablist">
                                                        <li class="nav-item" role="presentation"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#pasajeros-grafica-pane">1. Gráfica (Pasajeros)</button></li>
                                                        <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#carga-grafica-pane">2. Gráfica (Carga)</button></li>
                                                    </ul>
                                                    <div class="tab-content pt-3" id="itineraryTabContent">
                                                        <!-- Pasajeros: Llegadas/Salidas del día -->
                                                        <div class="tab-pane fade show active" id="pasajeros-grafica-pane">
                                                            <div class="itinerary-charts-scroll itinerary-pane-block charts-block">
                                                                <div class="row g-3 chart-row-mobile-scroll">
                                                                <div class="col-lg-6">
                                                                    <h6 class="text-muted mb-2"><i class="fas fa-person-walking me-1"></i>Llegadas (Pasajeros) por hora</h6>
                                                                    <div class="chart-container" style="height:360px"><canvas id="paxArrivalsChart"></canvas></div>
                                                                </div>
                                                                <div class="col-lg-6">
                                                                    <h6 class="text-muted mb-2"><i class="fas fa-person-walking-luggage me-1"></i>Salidas (Pasajeros) por hora</h6>
                                                                    <div class="chart-container" style="height:360px"><canvas id="paxDeparturesChart"></canvas></div>
                                                                </div>
                                                                </div>
                                                            </div>
                                                            <div class="itinerary-top-block itinerary-pane-block">
                                                                <div class="d-flex align-items-center gap-2 mb-2">
                                                                    <i class="fas fa-star text-warning"></i>
                                                                    <strong>Top horas (Pasajeros)</strong>
                                                                    <span class="ms-auto small text-muted">Mostrar</span>
                                                                    <select id="pax-topN" class="form-select form-select-sm" style="width:auto;">
                                                                        <option value="3">Top 3</option>
                                                                        <option value="5" selected>Top 5</option>
                                                                        <option value="10">Top 10</option>
                                                                    </select>
                                                                </div>
                                                                <div class="row g-3">
                                                                    <div class="col-md-6">
                                                                        <div class="card"><div class="card-body">
                                                                            <h6 class="text-muted">Llegadas</h6>
                                                                            <ol id="pax-top-arr" class="m-0"></ol>
                                                                        </div></div>
                                                                    </div>
                                                                    <div class="col-md-6">
                                                                        <div class="card"><div class="card-body">
                                                                            <h6 class="text-muted">Salidas</h6>
                                                                            <ol id="pax-top-dep" class="m-0"></ol>
                                                                        </div></div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- Carga: Llegadas/Salidas del día -->
                                                        <div class="tab-pane fade" id="carga-grafica-pane">
                                                            <div class="itinerary-charts-scroll itinerary-pane-block charts-block">
                                                                <div class="row g-3 chart-row-mobile-scroll">
                                                                <div class="col-lg-6">
                                                                    <h6 class="text-muted mb-2"><i class="fas fa-box-open me-1"></i>Llegadas (Carga) por hora</h6>
                                                                    <div class="chart-container" style="height:360px"><canvas id="cargoArrivalsChart"></canvas></div>
                                                                </div>
                                                                <div class="col-lg-6">
                                                                    <h6 class="text-muted mb-2"><i class="fas fa-truck-ramp-box me-1"></i>Salidas (Carga) por hora</h6>
                                                                    <div class="chart-container" style="height:360px"><canvas id="cargoDeparturesChart"></canvas></div>
                                                                </div>
                                                                </div>
                                                            </div>
                                                            <div class="itinerary-top-block itinerary-pane-block">
                                                                <div class="d-flex align-items-center gap-2 mb-2">
                                                                    <i class="fas fa-star text-warning"></i>
                                                                    <strong>Top horas (Carga)</strong>
                                                                    <span class="ms-auto small text-muted">Mostrar</span>
                                                                    <select id="cargo-topN" class="form-select form-select-sm" style="width:auto;">
                                                                        <option value="3">Top 3</option>
                                                                        <option value="5" selected>Top 5</option>
                                                                        <option value="10">Top 10</option>
                                                                    </select>
                                                                </div>
                                                                <div class="row g-3">
                                                                    <div class="col-md-6">
                                                                        <div class="card"><div class="card-body">
                                                                            <h6 class="text-muted">Llegadas</h6>
                                                                            <ol id="cargo-top-arr" class="m-0"></ol>
                                                                        </div></div>
                                                                    </div>
                                                                    <div class="col-md-6">
                                                                        <div class="card"><div class="card-body">
                                                                            <h6 class="text-muted">Salidas</h6>
                                                                            <ol id="cargo-top-dep" class="m-0"></ol>
                                                                        </div></div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="pdf-inicio-pane" role="tabpanel" aria-labelledby="pdf-inicio-tab" tabindex="0">
                                    <div class="pdf-container">
                                        <iframe src="pdfs/Itinerario.pdf" width="100%" height="700px" class="border-0"></iframe>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="parte-operaciones-section" class="content-section">
                    <div class="card">
                        <div class="card-header flex-column flex-md-row d-flex justify-content-between align-items-center">
                            <h2 class="section-title mb-3 mb-md-0" id="operations-summary-title" data-default-title="Resumen de operaciones">Resumen de operaciones</h2>
                            <div class="d-flex gap-2">
                                <a href="pdfs/parte_operaciones_completo.pdf" class="btn btn-danger download-btn" download><i class="fas fa-file-pdf me-2"></i><span class="btn-text">Descargar PDF</span></a>
                                <a href="excel/parte_operaciones_completo.xlsx" class="btn btn-success download-btn" download><i class="fas fa-file-excel me-2"></i><span class="btn-text">Descargar Excel</span></a>
                            </div>
                        </div>
                        <div class="card-body">
                            <ul class="nav nav-tabs" id="operationsTab" role="tablist">
                                <li class="nav-item" role="presentation"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#resumen1-pane">Resumen 1</button></li>
                                <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#resumen2-pane">Resumen 2</button></li>
                            </ul>
                            <div class="tab-content pt-3" id="operationsTabContent">
                                <div class="tab-pane fade show active" id="resumen1-pane">
                                    <div id="ops-entry-panel" class="card border-primary-subtle mb-4 d-none">
                                        <div class="card-body">
                                            <div class="d-flex flex-column flex-lg-row justify-content-between gap-3">
                                                <div>
                                                    <h5 class="mb-1 d-flex align-items-center gap-2">
                                                        <i class="fas fa-user-pen text-primary"></i>
                                                        <span>Captura rápida del parte de operaciones</span>
                                                    </h5>
                                                    <p class="small text-muted mb-0">Solo Isaac López puede registrar llegadas y salidas manuales para complementar el resumen diario.</p>
                                                </div>
                                                <div class="text-lg-end">
                                                    <span class="small text-muted d-block">Usuario activo</span>
                                                    <span class="badge bg-primary-subtle text-primary" id="ops-entry-active-user">-</span>
                                                </div>
                                            </div>
                                            <hr class="my-3">
                                            <form id="ops-entry-form" class="ops-entry-form">
                                                <div class="row g-3 align-items-end">
                                                    <div class="col-12 col-md-4">
                                                        <label for="ops-entry-date" class="form-label">Fecha del parte</label>
                                                        <input type="date" class="form-control" id="ops-entry-date" required>
                                                    </div>
                                                    <div class="col-12 col-md-8 text-md-end d-flex flex-wrap justify-content-md-end gap-2">
                                                        <button type="button" class="btn btn-outline-secondary btn-sm" id="ops-entry-sync-summary"><i class="fas fa-link me-1"></i>Usar fecha del resumen</button>
                                                        <button type="button" class="btn btn-outline-secondary btn-sm" id="ops-entry-today"><i class="fas fa-calendar-day me-1"></i>Hoy</button>
                                                        <button type="button" class="btn btn-outline-danger btn-sm" id="ops-entry-clear-day"><i class="fas fa-trash me-1"></i>Eliminar captura</button>
                                                    </div>
                                                </div>
                                                <div class="table-responsive mt-3">
                                                    <table class="table table-sm align-middle mb-0" id="ops-entry-table">
                                                        <thead class="table-light">
                                                            <tr>
                                                                <th scope="col">Tipo de operación</th>
                                                                <th scope="col" class="text-center">Llegadas</th>
                                                                <th scope="col" class="text-center">Salidas</th>
                                                                <th scope="col" class="text-center">Subtotal</th>
                                                                <th scope="col" class="text-center" style="width:48px"></th>
                                                            </tr>
                                                        </thead>
                                                        <tbody></tbody>
                                                    </table>
                                                </div>
                                                <datalist id="ops-entry-type-suggestions">
                                                    <option value="Aviación de pasajeros"></option>
                                                    <option value="Aviación de carga"></option>
                                                    <option value="Aviación general"></option>
                                                    <option value="Militar"></option>
                                                    <option value="Ambulancia aérea"></option>
                                                    <option value="Servicios complementarios"></option>
                                                </datalist>
                                                <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mt-3">
                                                    <div class="d-flex flex-wrap gap-2">
                                                        <button type="button" class="btn btn-outline-secondary btn-sm" id="ops-entry-add-row"><i class="fas fa-plus me-1"></i>Agregar fila</button>
                                                        <button type="button" class="btn btn-outline-secondary btn-sm" id="ops-entry-reset-table"><i class="fas fa-broom me-1"></i>Vaciar tabla</button>
                                                    </div>
                                                    <div class="d-flex flex-wrap gap-2">
                                                        <button type="button" class="btn btn-primary btn-sm" id="ops-entry-save"><i class="fas fa-save me-1"></i>Guardar y aplicar</button>
                                                    </div>
                                                </div>
                                                <p id="ops-entry-feedback" class="small text-muted mt-2 mb-0" role="status"></p>
                                            </form>
                                        </div>
                                    </div>
                                    <div class="alert alert-info d-flex align-items-center gap-2 ops-calendar-hint" role="note">
                                        <i class="fas fa-calendar-day" aria-hidden="true"></i>
                                        <span class="small mb-0">Elige cualquier día del 2025 con los controles o el calendario para consultar su parte operativo.</span>
                                    </div>
                                    <div class="ops-calendar-controls d-flex flex-wrap align-items-center justify-content-between gap-3 mb-3" data-ops-calendar-controls>
                                        <div class="d-flex flex-wrap align-items-center gap-2">
                                            <button class="btn btn-outline-secondary btn-sm" type="button" id="operations-summary-prev" aria-label="Día anterior"><i class="fas fa-chevron-left"></i></button>
                                            <input type="date" class="form-control form-control-sm" id="operations-summary-date" aria-label="Seleccionar fecha del parte de operaciones">
                                            <button class="btn btn-outline-secondary btn-sm" type="button" id="operations-summary-next" aria-label="Día siguiente"><i class="fas fa-chevron-right"></i></button>
                                            <button class="btn btn-outline-primary btn-sm" type="button" id="operations-summary-today"><i class="fas fa-calendar-day me-1"></i>Hoy</button>
                                        </div>
                                        <div class="small text-muted d-flex align-items-center gap-2" id="operations-summary-date-label">
                                            <i class="fas fa-calendar-alt"></i>
                                            <span id="operations-summary-date-human">Selecciona una fecha</span>
                                        </div>
                                    </div>
                                    <div class="ops-summary-wrapper" id="operations-summary-wrapper">
                                            <div class="section-loader hidden" id="operations-summary-loader" role="status" aria-live="polite" aria-busy="false" aria-hidden="true">
                                            <div class="loader-content text-center">
                                                <div class="plane-orbit">
                                                    <span class="orbit-ring"></span>
                                                    <span class="plane-icon" aria-hidden="true">✈</span>
                                                    <img src="images/logo_aifa.jpg" alt="AIFA" class="loader-aifa-logo">
                                                </div>
                                                <div class="loader-text" id="operations-summary-loader-text">Preparando el total de vuelos del día...</div>
                                            </div>
                                        </div>
                                        <div id="operations-summary-table"></div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="resumen2-pane">
                                    <div class="pdf-container"><iframe src="pdfs/resumen_2.pdf" width="100%" height="700px" class="border-0"></iframe></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- GSO Section (Impactos de Ave + Fauna Rescatada) -->
                <div id="fauna-section" class="content-section">
                    <div class="card border-0">
                        <div class="card-body px-0">
                            <div class="gso-media-wrapper mb-4 px-3 px-md-0">
                                <div class="ratio ratio-16x9 gso-hero">
                                    <video class="gso-hero-media" src="videos/Aterrizaje%20Cargo.mp4" autoplay muted loop playsinline preload="metadata" aria-label="Gerencia de Seguridad Operacional"></video>
                                    <div class="gso-hero-overlay">
                                        <div class="gso-hero-inner">
                                            <div class="gso-hero-copy text-center">
                                                <h3 class="gso-hero-title mb-0">Gerencia de Seguridad Operacional (GSO)</h3>
                                                <p class="gso-hero-caption mb-0"><i class="fas fa-plane-departure me-2"></i>Selecciona la opción en la que deseas navegar</p>
                                            </div>
                                            <div class="gso-hero-actions">
                                                <div class="gso-tab-buttons">
                                                    <button type="button" class="gso-nav-btn" data-nav-button="gso-impactos-tab">
                                                        <span class="gso-nav-icon"><i class="fas fa-dove" aria-hidden="true"></i></span>
                                                        <span class="gso-nav-label">Impactos de Ave</span>
                                                    </button>
                                                    <button type="button" class="gso-nav-btn" data-nav-button="gso-rescate-tab">
                                                        <span class="gso-nav-icon"><i class="fas fa-paw" aria-hidden="true"></i></span>
                                                        <span class="gso-nav-label">Fauna Rescatada</span>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <ul class="nav nav-tabs d-none" id="gsoTab" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="gso-impactos-tab" data-bs-toggle="tab" data-bs-target="#gso-impactos-pane" type="button" role="tab" aria-controls="gso-impactos-pane" aria-selected="false" tabindex="-1"><i class="fas fa-dove me-2"></i>Registro de Impactos de Ave</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="gso-rescate-tab" data-bs-toggle="tab" data-bs-target="#gso-fauna-rescate-pane" type="button" role="tab" aria-controls="gso-fauna-rescate-pane" aria-selected="false" tabindex="-1"><i class="fas fa-paw me-2"></i>Fauna Rescatada</button>
                                </li>
                            </ul>
                            <div class="tab-content pt-3 d-none" id="gsoTabContent">
                                <div class="tab-pane fade" id="gso-impactos-pane" role="tabpanel" aria-labelledby="gso-impactos-tab" tabindex="0">
                                    <div class="gso-return mb-3">
                                        <button type="button" class="btn btn-outline-secondary btn-sm gso-return-btn"><i class="fas fa-arrow-left me-2"></i>Regresar al menú GSO</button>
                                    </div>
                                    <div class="text-center mb-3"><h3 class="fw-bold mb-0"><i class="fas fa-dove me-2"></i>Registros de Impactos de Ave 2025</h3></div>
                                    <div class="card">
                                        <div class="card-header d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-2">
                                            <div class="d-flex flex-wrap align-items-center gap-2 fauna-filters filters-bar">
                                                <div class="chip">
                                                    <label class="me-1"><i class="fas fa-calendar-alt me-1"></i>Fecha</label>
                                                    <input type="date" id="fauna-date-from" class="form-control form-control-sm" />
                                                    <span class="mx-1">a</span>
                                                    <input type="date" id="fauna-date-to" class="form-control form-control-sm" />
                                                </div>
                                                <div class="chip">
                                                    <label class="me-1"><i class="fas fa-calendar me-1"></i>Mes</label>
                                                    <select id="fauna-month" class="form-select form-select-sm">
                                                        <option value="all" selected>Todos</option>
                                                        <option value="01">Enero</option>
                                                        <option value="02">Febrero</option>
                                                        <option value="03">Marzo</option>
                                                        <option value="04">Abril</option>
                                                        <option value="05">Mayo</option>
                                                        <option value="06">Junio</option>
                                                        <option value="07">Julio</option>
                                                        <option value="08">Agosto</option>
                                                        <option value="09">Septiembre</option>
                                                        <option value="10">Octubre</option>
                                                        <option value="11">Noviembre</option>
                                                        <option value="12">Diciembre</option>
                                                    </select>
                                                </div>
                                                <div class="chip">
                                                    <label class="me-1"><i class="fas fa-paw me-1"></i>Especie</label>
                                                    <select id="fauna-species" class="form-select form-select-sm"><option value="all" selected>Todas</option></select>
                                                </div>
                                                <div class="chip">
                                                    <label class="me-1"><i class="fas fa-arrows-to-dot me-1"></i>Tamaño</label>
                                                    <select id="fauna-size" class="form-select form-select-sm"><option value="all" selected>Todos</option></select>
                                                </div>
                                                <div class="chip">
                                                    <label class="me-1"><i class="fas fa-plane-departure me-1"></i>Fase</label>
                                                    <select id="fauna-phase" class="form-select form-select-sm"><option value="all" selected>Todas</option></select>
                                                </div>
                                                    <div class="chip">
                                                        <label class="me-1"><i class="fas fa-plane me-1"></i>Aerolínea</label>
                                                        <select id="fauna-airline" class="form-select form-select-sm"><option value="all" selected>Todas</option></select>
                                                    </div>
                                                <div class="chip chip-actions">
                                                    <label class="me-1"><i class="fas fa-broom me-1"></i>Acciones</label>
                                                    <button id="fauna-clear" class="btn btn-outline-secondary btn-sm">Restablecer</button>
                                                    <button id="fauna-export-csv" class="btn btn-outline-primary btn-sm"><i class="fas fa-file-csv me-1"></i>CSV</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="d-flex flex-wrap align-items-center gap-3 mb-2">
                                                <span class="badge bg-primary" id="fauna-total-badge">Total: 0</span>
                                                <span class="badge bg-info text-dark" id="fauna-period-badge">Periodo: Todos</span>
                                                <button class="btn btn-outline-primary btn-sm active" id="fauna-summary-toggle" data-bs-toggle="collapse" data-bs-target="#fauna-summary-collapse" aria-expanded="true" aria-controls="fauna-summary-collapse">
                                                    <i class="fas fa-list-ul me-1"></i>Resumen por Aerolínea
                                                </button>
                                            </div>
                                            <div class="collapse show" id="fauna-summary-collapse">
                                                <h6 class="mb-2"><i class="fas fa-plane me-2"></i>Resumen por Aerolínea</h6>
                                                <div id="fauna-summary-container" class="table-container-tech"></div>
                                            </div>
                                            <!-- Top horas críticas arriba -->
                                            <div class="mb-3">
                                                <div class="d-flex align-items-center gap-2">
                                                    <i class="fas fa-bolt text-warning"></i>
                                                    <strong>Top horas críticas</strong>
                                                    <span class="small text-muted">(con filtros aplicados)</span>
                                                </div>
                                                <div id="fauna-top-hours" class="mt-2 d-flex flex-wrap gap-2"></div>
                                            </div>
                                            <!-- Resumen despegues vs aterrizajes -->
                                            <div class="mb-3">
                                                <div class="d-flex align-items-center gap-2">
                                                    <i class="fas fa-plane me-1 text-primary"></i>
                                                    <strong>Resumen por fase de operación</strong>
                                                </div>
                                                <div id="fauna-phase-summary" class="mt-2 d-flex flex-wrap gap-2"></div>
                                            </div>
                                            <!-- Resumen visual: gráficas -->
                                            <div class="row g-3 mb-3">
                                                <div class="col-lg-6">
                                                    <h6 class="text-muted mb-2"><i class="fas fa-chart-column me-1"></i>Eventos por mes</h6>
                                                    <div class="chart-container" style="height:360px"><canvas id="fauna-by-month"></canvas></div>
                                                </div>
                                                <div class="col-lg-6">
                                                    <h6 class="text-muted mb-2"><i class="fas fa-paw me-1"></i>Eventos por nombre común</h6>
                                                    <div class="chart-container" style="height:360px"><canvas id="fauna-by-species"></canvas></div>
                                                </div>
                                                <div class="col-12">
                                                    <h6 class="text-muted mb-2"><i class="fas fa-grip-vertical me-1"></i>Matriz Mes × Condiciones (Heatmap)</h6>
                                                    <div class="chart-container heatmap-container" style="height:420px"><div id="fauna-heatmap" style="width:100%; height:100%"></div></div>
                                                </div>
                                                <div class="col-12">
                                                    <h6 class="text-muted mb-2"><i class="fas fa-clock me-1"></i>Distribución por hora del día</h6>
                                                    <div class="chart-container" style="height:360px"><canvas id="fauna-by-hour"></canvas></div>
                                                </div>
                                            </div>
                                            <!-- Tabla completa sin paginación -->
                                            <div class="table-responsive" id="fauna-table-container"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="gso-fauna-rescate-pane" role="tabpanel" aria-labelledby="gso-rescate-tab" tabindex="0">
                                    <div class="gso-return mb-3">
                                        <button type="button" class="btn btn-outline-secondary btn-sm gso-return-btn"><i class="fas fa-arrow-left me-2"></i>Regresar al menú GSO</button>
                                    </div>
                                    <div class="text-center mb-3">
                                        <h3 class="fw-bold mb-1"><i class="fas fa-paw me-2"></i>Fauna Rescatada <span id="fauna-rescate-year-label"></span></h3>
                                        <div class="btn-group btn-group-sm fauna-rescate-year-switch" id="fauna-rescate-year-switch" role="group" aria-label="Selecciona año">
                                            <!-- botones dinámicos -->
                                        </div>
                                    </div>
                                    <div class="card">
                                        <div class="card-header d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-2">
                                            <div class="d-grid d-md-flex flex-wrap align-items-center gap-2 fauna-rescate-filters filters-bar">
                                                <div class="chip">
                                                    <label class="me-1"><i class="fas fa-calendar-day me-1"></i>Desde</label>
                                                    <input type="date" id="fauna-rescate-date-from" class="form-control form-control-sm" />
                                                </div>
                                                <div class="chip">
                                                    <label class="me-1"><i class="fas fa-calendar-day me-1"></i>Hasta</label>
                                                    <input type="date" id="fauna-rescate-date-to" class="form-control form-control-sm" />
                                                </div>
                                                <div class="chip">
                                                    <label class="me-1"><i class="fas fa-calendar-alt me-1"></i>Mes</label>
                                                    <select id="fauna-rescate-month" class="form-select form-select-sm">
                                                        <option value="all" selected>Todos</option>
                                                    </select>
                                                </div>
                                                <div class="chip">
                                                    <label class="me-1"><i class="fas fa-paw me-1"></i>Clase</label>
                                                    <select id="fauna-rescate-class" class="form-select form-select-sm">
                                                        <option value="all" selected>Todas</option>
                                                    </select>
                                                </div>
                                                <div class="chip">
                                                    <label class="me-1"><i class="fas fa-tools me-1"></i>Método</label>
                                                    <select id="fauna-rescate-method" class="form-select form-select-sm">
                                                        <option value="all" selected>Todos</option>
                                                    </select>
                                                </div>
                                                <div class="chip">
                                                    <label class="me-1"><i class="fas fa-route me-1"></i>Cuadrante</label>
                                                    <select id="fauna-rescate-quadrant" class="form-select form-select-sm">
                                                        <option value="all" selected>Todos</option>
                                                    </select>
                                                </div>
                                                <div class="chip">
                                                    <label class="me-1"><i class="fas fa-warehouse me-1"></i>Disposición</label>
                                                    <select id="fauna-rescate-disposal" class="form-select form-select-sm">
                                                        <option value="all" selected>Todas</option>
                                                    </select>
                                                </div>
                                                <div class="chip chip-actions">
                                                    <label class="me-1"><i class="fas fa-broom me-1"></i>Acciones</label>
                                                    <button id="fauna-rescate-clear" class="btn btn-outline-secondary btn-sm">Restablecer</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="fauna-rescate-badges d-flex flex-wrap align-items-center gap-3 mb-4">
                                                <span class="fauna-rescate-metric metric-total" id="fauna-rescate-total-badge" role="status" aria-live="polite">
                                                    <span class="fauna-rescate-label">Total rescates</span>
                                                    <span class="fauna-rescate-value">0</span>
                                                </span>
                                                <span class="fauna-rescate-metric metric-individuals" id="fauna-rescate-individuals-badge" role="status" aria-live="polite">
                                                    <span class="fauna-rescate-label">Individuos atendidos</span>
                                                    <span class="fauna-rescate-value">0</span>
                                                </span>
                                                <span class="badge bg-info-subtle text-info fw-semibold d-none" id="fauna-rescate-active-filter"></span>
                                            </div>
                                            <div class="row g-3 mb-4">
                                                <div class="col-lg-6">
                                                    <h6 class="text-muted mb-2"><i class="fas fa-calendar-alt me-1"></i>Capturas por mes</h6>
                                                    <div class="chart-container" style="height: 320px;"><div id="fauna-rescate-by-month" class="echart-host"></div></div>
                                                </div>
                                                <div class="col-lg-6">
                                                    <h6 class="text-muted mb-2"><i class="fas fa-paw me-1"></i>Eventos por clase</h6>
                                                    <div class="chart-container" style="height: 320px;"><div id="fauna-rescate-by-class" class="echart-host"></div></div>
                                                </div>
                                                <div class="col-lg-6">
                                                    <h6 class="text-muted mb-2"><i class="fas fa-map-location-dot me-1"></i>Sitios de reubicación</h6>
                                                    <div class="chart-container" style="height: 320px;"><div id="fauna-rescate-by-relocation" class="echart-host fauna-relocation-chart"></div></div>
                                                </div>
                                                <div class="col-lg-6">
                                                    <h6 class="text-muted mb-2"><i class="fas fa-tools me-1"></i>Método de rescate</h6>
                                                    <div class="chart-container" style="height: 320px;"><div id="fauna-rescate-by-method" class="echart-host"></div></div>
                                                </div>
                                                <div class="col-12">
                                                    <h6 class="text-muted mb-2"><i class="fas fa-clock me-1"></i>Distribución por hora del día</h6>
                                                    <div class="chart-container" style="height: 320px;"><div id="fauna-rescate-by-hour" class="echart-host"></div></div>
                                                </div>
                                            </div>
                                            <div class="fauna-rescate-top-chipset mb-4">
                                                <h6 class="text-muted mb-2"><i class="fas fa-leaf me-1"></i>Especies más frecuentes</h6>
                                                <div id="fauna-rescate-top-species" class="d-flex flex-wrap gap-2"></div>
                                            </div>
                                            <div class="d-flex justify-content-end mb-3">
                                                <button class="btn btn-outline-primary btn-sm" id="fauna-rescate-export"><i class="fas fa-file-csv me-1"></i>Exportar CSV</button>
                                            </div>
                                            <div id="fauna-rescate-table" class="table-responsive"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="medicas-section" class="content-section">
                    <div class="card border-0">
                        <div class="card-header bg-transparent d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between">
                            <div>
                                <h2 class="section-title mb-1">Servicio Médico</h2>
                            </div>
                            <a id="servicio-medico-open" class="btn btn-outline-primary btn-sm d-none" href="#" target="_blank" rel="noopener">
                                <i class="fas fa-external-link-alt me-1"></i>Abrir en Google Docs
                            </a>
                        </div>
                        <div class="card-body">
                            <ul class="nav nav-tabs mb-3" id="medicasTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="medicas-directorio-tab" data-bs-toggle="tab" data-bs-target="#medicas-directorio-pane" type="button" role="tab" aria-controls="medicas-directorio-pane" aria-selected="true"><i class="fas fa-address-book me-2"></i>Directorio</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="medicas-analytics-tab" data-bs-toggle="tab" data-bs-target="#medicas-analytics-pane" type="button" role="tab" aria-controls="medicas-analytics-pane" aria-selected="false"><i class="fas fa-chart-column me-2"></i>Indicadores</button>
                                </li>
                            </ul>
                            <div class="tab-content" id="medicasTabsContent">
                                <div id="medicas-directorio-pane" class="tab-pane fade show active" role="tabpanel" aria-labelledby="medicas-directorio-tab" tabindex="0">
                                    <div class="card border-0 shadow-sm medicas-directorio-card">
                                        <div class="card-body">
                                            <div class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-between gap-3 mb-3">
                                                <div>
                                                    <h3 class="h6 mb-1 text-uppercase text-muted">Directorio operativo 2025</h3>
                                                    <p class="mb-0 small text-muted">Haz clic en el nombre de cada documento para abrir el PDF correspondiente.</p>
                                                </div>
                                                <div class="d-flex flex-wrap gap-2">
                                                    <button type="button" class="btn btn-outline-secondary btn-sm" id="medicas-directorio-reload">
                                                        <i class="fas fa-rotate-right me-1"></i>Actualizar
                                                    </button>
                                                </div>
                                            </div>
                                            <div id="medicas-directorio-alert" class="alert alert-info d-none" role="status"></div>
                                            <div id="medicas-directorio-loader" class="text-center py-4" role="status" aria-live="polite">
                                                <div class="spinner-border text-primary" role="status" aria-hidden="true"></div>
                                                <div class="mt-2 small text-muted">Cargando directorio...</div>
                                            </div>
                                            <div id="medicas-directorio-list" class="row g-3" data-doc-base="pdfs/directorio"></div>
                                            <div id="medicas-directorio-empty" class="alert alert-warning d-none mb-0" role="status">
                                                No hay registros de directorio disponibles. Verifica el archivo <code>data/directorio.json</code> y vuelve a intentarlo.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="medicas-analytics-pane" class="tab-pane fade medicas-analytics-pane" role="tabpanel" aria-labelledby="medicas-analytics-tab" tabindex="0">
                                        <div class="d-flex flex-wrap align-items-center gap-3 mb-3">
                                            <span class="badge bg-success-subtle text-success fw-semibold" id="medicas-top-badge">Top mes: -</span>
                                            <div class="d-flex flex-wrap align-items-center gap-3 ms-auto">
                                                <div class="form-check form-switch m-0" title="Mostrar siempre etiquetas">
                                                    <input class="form-check-input" type="checkbox" id="medicasLabelsAlways">
                                                    <label class="form-check-label small" for="medicasLabelsAlways">Etiquetas</label>
                                                </div>
                                                <div class="form-check form-switch m-0" title="Mostrar porcentaje cuando sea relevante">
                                                    <input class="form-check-input" type="checkbox" id="medicasShowPct" checked>
                                                    <label class="form-check-label small" for="medicasShowPct">Porcentaje</label>
                                                </div>
                                                <div class="d-flex align-items-center gap-2">
                                                    <label for="medicasTipo" class="small text-muted fw-semibold mb-0"><i class="fas fa-filter me-1"></i>Filtro</label>
                                                    <select id="medicasTipo" class="form-select form-select-sm">
                                                        <option value="all" selected>Todo el personal</option>
                                                        <option value="aifa">AIFA</option>
                                                        <option value="otra">Otra Empresa</option>
                                                        <option value="pasajeros">Pasajeros</option>
                                                        <option value="visitantes">Visitantes</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="chart-container" style="height: 420px;">
                                            <div id="medicasChart" class="echart-host w-100 h-100"></div>
                                        </div>
                                        <p class="small text-muted mt-3 mb-0">Fuente: Servicio Médico AIFA. Datos históricos 2022, clasificados por tipo de atención.</p>
                                    </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="demoras-section" class="content-section">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h2 class="section-title mb-0" id="demoras-title">Análisis de Demoras</h2>
                        </div>
                        <div class="card-body">
                            <div class="demoras-interactive-hint" id="demoras-interactive-hint" role="note">
                                <div class="hint-icon" aria-hidden="true"><i class="fas fa-compass"></i></div>
                                <div>
                                    <strong class="d-block">Explora las causas</strong>
                                    <span class="small">Selecciona una fila o una porción de la gráfica para ver motivos, incidentes y observaciones.</span>
                                </div>
                                <button type="button" class="btn btn-sm btn-light demoras-hint-cta ms-auto" id="demoras-hint-cta">
                                    <i class="fas fa-hand-pointer me-1" aria-hidden="true"></i>Recorrer ahora
                                </button>
                            </div>
                            <div class="row g-4 align-items-start">
                                <div class="col-12 col-xl-6">
                                    <div class="mb-4">
                                        <h3 class="h5 text-center mb-3">Demoras en vuelos de salida</h3>
                                        <div class="table-responsive">
                                            <table class="table table-bordered table-sm align-middle text-center">
                                                <thead class="table-dark">
                                                    <tr>
                                                        <th>Causa</th>
                                                        <th>Demoras</th>
                                                        <th>Porcentaje</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="demoras-tbody"></tbody>
                                                <tfoot id="demoras-tfoot"></tfoot>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="demoras-detail card border-0 shadow-sm" id="demoras-detail-card">
                                        <div class="card-body">
                                            <div class="demoras-detail-header">
                                                <div class="demoras-detail-icon" id="demoras-detail-icon" aria-hidden="true">
                                                    <i class="fas fa-chart-pie"></i>
                                                </div>
                                                <div class="demoras-detail-titles">
                                                    <span class="demoras-detail-badge">Detalle interactivo</span>
                                                    <h3 class="demoras-detail-title" id="demoras-detail-title">Selecciona una causa</h3>
                                                    <p class="demoras-detail-description text-muted" id="demoras-detail-description">Haz clic en la tabla o en la gráfica para ver el motivo y observaciones.</p>
                                                </div>
                                                <div class="demoras-detail-metric" id="demoras-detail-metric" aria-live="polite">--</div>
                                            </div>
                                            <div class="demoras-detail-tags d-none" id="demoras-detail-tags" aria-live="polite"></div>
                                            <div class="demoras-incidentes demoras-detail-section d-none" id="demoras-detail-incidentes">
                                                <h4 class="demoras-detail-section-title">Casos registrados</h4>
                                                <ul class="demoras-timeline" id="demoras-detail-incidentes-list"></ul>
                                            </div>
                                            <div class="demoras-observaciones demoras-detail-section d-none" id="demoras-detail-observaciones">
                                                <h4 class="demoras-detail-section-title">Observaciones</h4>
                                                <p class="demoras-detail-observacion" id="demoras-detail-observaciones-text"></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 col-xl-6">
                                    <div class="demoras-chart-wrapper position-relative" id="demoras-chart-wrapper">
                                        <div class="demoras-chart-hint" id="demoras-chart-hint">
                                            <i class="fas fa-chart-pie me-2" aria-hidden="true"></i>
                                            <span>Interactúa con la gráfica</span>
                                        </div>
                                        <div class="chart-container"><canvas id="delaysPieChart"></canvas></div>
                                        <div class="demoras-chart-legend" id="demoras-chart-legend" aria-live="polite"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="operaciones-totales-section" class="content-section active">
                    <div class="card border-0">
                        <div class="card-header bg-transparent d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
                            <div class="d-flex flex-column">
                                <h2 class="section-title mb-2 mb-md-0">Operaciones Totales</h2>
                            </div>
                            
                        </div>
                        <div class="card-body">
                            <ul class="nav nav-tabs mb-3" id="opsTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="ops-resumen-tab" data-bs-toggle="tab" data-bs-target="#ops-resumen-pane" type="button" role="tab" aria-controls="ops-resumen-pane" aria-selected="true"><i class="fas fa-chart-line me-2"></i>Resumen general</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="aviacion-comercial-tab" data-bs-toggle="tab" data-bs-target="#aviacion-comercial-pane" type="button" role="tab" aria-controls="aviacion-comercial-pane" aria-selected="false"><i class="fas fa-plane-up me-2"></i>Aviación comercial</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="aviacion-general-tab" data-bs-toggle="tab" data-bs-target="#aviacion-general-pane" type="button" role="tab" aria-controls="aviacion-general-pane" aria-selected="false"><i class="fas fa-paper-plane me-2"></i>Aviación general</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="aviacion-carga-tab" data-bs-toggle="tab" data-bs-target="#aviacion-carga-pane" type="button" role="tab" aria-controls="aviacion-carga-pane" aria-selected="false"><i class="fas fa-box-open me-2"></i>Aviación de carga</button>
                                </li>
                            </ul>
                            <div class="tab-content pt-3" id="opsTabsContent">
                                <div class="tab-pane fade show active" id="ops-resumen-pane" role="tabpanel" aria-labelledby="ops-resumen-tab" tabindex="0">
                                    <!-- Toolbar compacta -->
                                    <div class="d-flex flex-wrap align-items-center gap-2 mb-3">
                                        <div id="ops-summary" class="ops-summary-slot me-auto"></div>
                                        <div class="d-flex gap-2 ms-auto">
                                            <button class="btn btn-outline-secondary btn-sm" id="ops-tooltips-toggle-btn" type="button" aria-pressed="false" title="Mostrar tooltips siempre visibles">
                                                <i class="fas fa-eye-slash me-1"></i>Tooltips fijos
                                            </button>
                                            <button class="btn btn-outline-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#opsFiltersModal"><i class="fas fa-sliders-h me-1"></i>Configurar vista</button>
                                            <button class="btn btn-outline-primary btn-sm" id="ops-export-all-btn" title="Descargar todas las gráficas en PDF"><i class="fas fa-file-pdf me-1"></i>Descargar todas</button>
                                        </div>
                                    </div>

                                    <!-- Modal de Filtros de Operaciones Totales -->
                                    <div class="modal fade" id="opsFiltersModal" tabindex="-1" aria-labelledby="opsFiltersModalLabel" aria-hidden="true">
                                      <div class="modal-dialog modal-lg modal-dialog-scrollable">
                                        <div class="modal-content">
                                          <div class="modal-header">
                                            <h5 class="modal-title" id="opsFiltersModalLabel"><i class="fas fa-sliders-h me-2"></i>Configurar visualización</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                          </div>
                                          <div class="modal-body">
                                            <div class="mb-3">
                                                <h6 class="text-muted">Visual</h6>
                                                <div class="d-flex flex-wrap align-items-center gap-3">
                                                    <div class="form-check form-switch m-0" title="Comparativo semanal reciente">
                                                        <input class="form-check-input" type="checkbox" id="toggle-weekly-view">
                                                        <label class="form-check-label small" for="toggle-weekly-view">Semanal</label>
                                                    </div>
                                                    <div class="form-check form-switch m-0" title="Activa los filtros por meses del año 2025">
                                                        <input class="form-check-input" type="checkbox" id="toggle-monthly-2025">
                                                        <label class="form-check-label small" for="toggle-monthly-2025">Mensual 2025</label>
                                                        <span class="badge bg-info text-dark ms-2 d-none" id="years-disabled-hint">Años inactivos</span>
                                                    </div>
                                                    <div class="form-check form-switch m-0" title="Vista acumulada por año">
                                                        <input class="form-check-input" type="checkbox" id="toggle-yearly-view">
                                                        <label class="form-check-label small" for="toggle-yearly-view">Anual</label>
                                                    </div>
                                                    <div id="weekly-week-filter" class="d-none d-flex align-items-center gap-2">
                                                        <label for="weekly-week-select" class="small text-muted fw-semibold mb-0"><i class="fas fa-calendar-week me-1"></i>Semana</label>
                                                        <select id="weekly-week-select" class="form-select form-select-sm"></select>
                                                    </div>
                                                    <div id="weekly-day-filter" class="d-none d-flex align-items-center gap-2">
                                                        <label for="weekly-day-select" class="small text-muted fw-semibold mb-0">Día</label>
                                                        <select id="weekly-day-select" class="form-select form-select-sm"></select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="mb-3">
                                                <h6 class="text-muted">Vistas rápidas</h6>
                                                <div class="d-flex flex-wrap align-items-center gap-2">
                                                    <button type="button" class="btn btn-outline-secondary btn-sm" id="preset-ops"><i class="fas fa-tachometer-alt me-1"></i>Operaciones</button>
                                                    <button type="button" class="btn btn-outline-secondary btn-sm" id="preset-passengers"><i class="fas fa-users me-1"></i>Pasajeros</button>
                                                    <button type="button" class="btn btn-outline-secondary btn-sm" id="preset-cargo-ton"><i class="fas fa-weight-hanging me-1"></i>Toneladas Carga</button>
                                                    <button type="button" class="btn btn-outline-secondary btn-sm" id="preset-full"><i class="fas fa-layer-group me-1"></i>Completa</button>
                                                </div>
                                            </div>
                                            <div class="row g-3">
                                                <div class="col-12 col-lg-6">
                                                    <h6 class="text-muted">Secciones</h6>
                                                    <div class="d-flex flex-wrap gap-3" id="ops-sections-filters">
                                                        <div class="form-check m-0">
                                                            <input class="form-check-input" type="checkbox" id="filter-section-comercial" checked>
                                                            <label class="form-check-label" for="filter-section-comercial">Comercial</label>
                                                        </div>
                                                        <div class="form-check m-0">
                                                            <input class="form-check-input" type="checkbox" id="filter-section-carga" checked>
                                                            <label class="form-check-label" for="filter-section-carga">Carga</label>
                                                        </div>
                                                        <div class="form-check m-0">
                                                            <input class="form-check-input" type="checkbox" id="filter-section-general" checked>
                                                            <label class="form-check-label" for="filter-section-general">General</label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-12 col-lg-6">
                                                    <h6 class="text-muted">Años <small class="text-muted">(se desactivan en modo mensual)</small></h6>
                                                    <div class="d-flex flex-wrap gap-3" id="ops-years-filters">
                                                        <div class="form-check m-0">
                                                            <input class="form-check-input" type="checkbox" id="filter-year-2022" data-year="2022" checked>
                                                            <label class="form-check-label" for="filter-year-2022">2022</label>
                                                        </div>
                                                        <div class="form-check m-0">
                                                            <input class="form-check-input" type="checkbox" id="filter-year-2023" data-year="2023" checked>
                                                            <label class="form-check-label" for="filter-year-2023">2023</label>
                                                        </div>
                                                        <div class="form-check m-0">
                                                            <input class="form-check-input" type="checkbox" id="filter-year-2024" data-year="2024" checked>
                                                            <label class="form-check-label" for="filter-year-2024">2024</label>
                                                        </div>
                                                        <div class="form-check m-0">
                                                            <input class="form-check-input" type="checkbox" id="filter-year-2025" data-year="2025" checked>
                                                            <label class="form-check-label" for="filter-year-2025">2025</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="mt-4" id="ops-months-2025" style="display:none;">
                                                <h6 class="text-muted">Meses 2025</h6>
                                                <p class="small text-muted mb-2">Selecciona los meses que deseas visualizar; las gráficas solo mostrarán datos de los meses marcados.</p>
                                                <div class="d-flex flex-wrap align-items-center gap-2">
                                                    <div class="months-chips d-flex flex-wrap gap-1">
                                                        <label class="chip"><input type="checkbox" data-month="01" checked><span class="chip-text">Ene</span></label>
                                                        <label class="chip"><input type="checkbox" data-month="02" checked><span class="chip-text">Feb</span></label>
                                                        <label class="chip"><input type="checkbox" data-month="03" checked><span class="chip-text">Mar</span></label>
                                                        <label class="chip"><input type="checkbox" data-month="04" checked><span class="chip-text">Abr</span></label>
                                                        <label class="chip"><input type="checkbox" data-month="05" checked><span class="chip-text">May</span></label>
                                                        <label class="chip"><input type="checkbox" data-month="06" checked><span class="chip-text">Jun</span></label>
                                                        <label class="chip"><input type="checkbox" data-month="07" checked><span class="chip-text">Jul</span></label>
                                                        <label class="chip"><input type="checkbox" data-month="08" checked><span class="chip-text">Ago</span></label>
                                                        <label class="chip"><input type="checkbox" data-month="09" checked><span class="chip-text">Sep</span></label>
                                                        <label class="chip"><input type="checkbox" data-month="10" checked><span class="chip-text">Oct</span></label>
                                                        <label class="chip"><input type="checkbox" data-month="11" checked><span class="chip-text">Nov</span></label>
                                                        <label class="chip"><input type="checkbox" data-month="12" checked><span class="chip-text">Dic</span></label>
                                                    </div>
                                                    <div class="ms-auto d-flex gap-2">
                                                        <button class="btn btn-sm btn-outline-secondary" id="months-select-all">Todos</button>
                                                        <button class="btn btn-sm btn-outline-secondary" id="months-select-none">Ninguno</button>
                                                    </div>
                                                </div>
                                            </div>
                                          </div>
                                          <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                                            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Aplicar</button>
                                          </div>
                                        </div>
                                      </div>
                                    </div>

                                    <h5 class="text-uppercase text-muted fw-bold mb-3" id="commercial-heading"><span class="section-icon icon-commercial">✈</span>Aviación Comercial</h5>
                                    <div class="row g-3 mb-4" id="commercial-group">
                                        <div class="col-12 col-xxl-6">
                                            <div class="chart-container ops-chart"><canvas id="commercialOpsChart"></canvas></div>
                                        </div>
                                        <div class="col-12 col-xxl-6">
                                            <div class="chart-container ops-chart"><canvas id="commercialPaxChart"></canvas></div>
                                        </div>
                                    </div>
                                    <h5 class="text-uppercase text-muted fw-bold mb-3 mt-4" id="cargo-heading"><span class="section-icon icon-cargo">⛟</span>Operaciones de Carga</h5>
                                    <div class="update-note d-flex align-items-center mb-2" id="cargo-update-note">
                                        <i class="fas fa-calendar-check me-2" aria-hidden="true"></i>
                                        <small>Datos actualizados al <strong>31 de octubre 2025</strong></small>
                                    </div>
                                    <div class="row g-3 mb-4" id="cargo-group">
                                        <div class="col-12 col-xxl-6">
                                            <div class="chart-container ops-chart"><canvas id="cargoOpsChart"></canvas></div>
                                        </div>
                                        <div class="col-12 col-xxl-6">
                                            <div class="chart-container ops-chart"><canvas id="cargoTonsChart"></canvas></div>
                                        </div>
                                    </div>
                                    <h5 class="text-uppercase text-muted fw-bold mb-3 mt-4" id="general-heading"><span class="section-icon icon-general">🛩</span>Aviación General</h5>
                                    <div class="row g-3 mb-4" id="general-group">
                                        <div class="col-12 col-xxl-6">
                                            <div class="chart-container ops-chart"><canvas id="generalOpsChart"></canvas></div>
                                        </div>
                                        <div class="col-12 col-xxl-6">
                                            <div class="chart-container ops-chart"><canvas id="generalPaxChart"></canvas></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="aviacion-comercial-pane" role="tabpanel" aria-labelledby="aviacion-comercial-tab" tabindex="0">
                                    <div class="ag-wrapper">
                                        <div class="row g-3 align-items-stretch" id="ag-controls-row">
                                            <div class="col-12 col-lg-4 col-xxl-3">
                                                <div class="card ag-controls-card h-100">
                                                    <div class="card-body">
                                                        <div class="d-flex align-items-center justify-content-between mb-3">
                                                            <div class="d-flex align-items-center gap-2 text-uppercase small fw-semibold text-muted">
                                                                <i class="fas fa-sliders-h text-primary"></i>
                                                                <span>Configuración</span>
                                                            </div>
                                                            <button class="btn btn-outline-secondary btn-sm" id="ag-reset-btn"><i class="fas fa-rotate-left me-1"></i>Restablecer</button>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="ag-metric-select" class="form-label text-uppercase small fw-semibold"><i class="fas fa-chart-column me-1"></i>Indicador</label>
                                                            <select id="ag-metric-select" class="form-select form-select-sm">
                                                                <option value="operaciones" selected>Operaciones</option>
                                                                <option value="pasajeros">Pasajeros</option>
                                                            </select>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="ag-view-select" class="form-label text-uppercase small fw-semibold"><i class="fas fa-layer-group me-1"></i>Detalle</label>
                                                            <select id="ag-view-select" class="form-select form-select-sm">
                                                                <option value="anual" selected>Vista anual</option>
                                                                <option value="mensual">Detalle mensual</option>
                                                            </select>
                                                        </div>
                                                        <div class="mb-3 d-none" id="ag-year-group">
                                                            <label for="ag-year-select" class="form-label text-uppercase small fw-semibold"><i class="fas fa-calendar me-1"></i>Año base</label>
                                                            <select id="ag-year-select" class="form-select form-select-sm"></select>
                                                        </div>
                                                        <div class="mb-0 d-none" id="ag-comparison-group">
                                                            <label for="ag-comparison-select" class="form-label text-uppercase small fw-semibold"><i class="fas fa-balance-scale me-1"></i>Comparar con</label>
                                                            <select id="ag-comparison-select" class="form-select form-select-sm"></select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-lg-8 col-xxl-9">
                                                <div class="card h-100">
                                                    <div class="card-body">
                                                        <div class="d-flex flex-column gap-3">
                                                            <div>
                                                                <h5 class="mb-1 d-flex align-items-center gap-2">
                                                                    <i class="fas fa-chart-area text-primary"></i>
                                                                    <span>Inteligencia operacional</span>
                                                                </h5>
                                                                <p class="text-muted small mb-0">Explora la evolución de operaciones y pasajeros en aviación comercial con comparativos automáticos y contexto histórico.</p>
                                                            </div>
                                                            <ul class="list-unstyled small text-muted mb-0">
                                                                <li class="d-flex align-items-center gap-2"><i class="fas fa-arrow-trend-up text-success"></i><span>Detecta variaciones contra años anteriores en segundos.</span></li>
                                                                <li class="d-flex align-items-center gap-2"><i class="fas fa-calendar-alt text-primary"></i><span>Activa el detalle mensual para un seguimiento puntual.</span></li>
                                                                <li class="d-flex align-items-center gap-2"><i class="fas fa-lightbulb text-warning"></i><span>Recibe hallazgos clave generados automáticamente.</span></li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row g-3">
                                            <div class="col-12">
                                                <div class="row g-3" id="ag-summary-cards"></div>
                                            </div>
                                        </div>
                                        <div class="row g-3 align-items-start">
                                            <div class="col-12 col-xxl-6">
                                                <div class="card h-100">
                                                    <div class="card-body">
                                                        <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
                                                            <span class="badge bg-primary-subtle text-primary fw-semibold" id="ag-chart-tag">Vista anual</span>
                                                            <small class="text-muted" id="ag-chart-subtitle"></small>
                                                        </div>
                                                        <div class="chart-container" style="height: 420px;"><canvas id="ag-chart"></canvas></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-xxl-6">
                                                <div class="card h-100">
                                                    <div class="card-body">
                                                        <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
                                                            <span class="badge bg-secondary-subtle text-secondary fw-semibold" id="ag-table-tag">Variación interanual</span>
                                                            <small class="text-muted" id="ag-table-caption"></small>
                                                        </div>
                                                        <div id="ag-table-wrapper">
                                                            <div class="table-responsive">
                                                                <table class="table table-sm align-middle mb-0" id="ag-data-table">
                                                                    <thead></thead>
                                                                    <tbody></tbody>
                                                                </table>
                                                            </div>
                                                            <div class="ag-table-meta mt-2" id="ag-footnote"></div>
                                                        </div>
                                                        <div class="alert alert-info d-none mt-2 mb-0" id="ag-empty-state">
                                                            No hay datos para el periodo seleccionado.
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ag-insights d-none mt-3" id="ag-insights"></div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="aviacion-general-pane" role="tabpanel" aria-labelledby="aviacion-general-tab" tabindex="0">
                                    <div class="ag-wrapper">
                                        <div class="row g-3 align-items-stretch" id="gen-controls-row">
                                            <div class="col-12 col-lg-4 col-xxl-3">
                                                <div class="card ag-controls-card h-100">
                                                    <div class="card-body">
                                                        <div class="d-flex align-items-center justify-content-between mb-3">
                                                            <div class="d-flex align-items-center gap-2 text-uppercase small fw-semibold text-muted">
                                                                <i class="fas fa-sliders-h text-primary"></i>
                                                                <span>Configuración</span>
                                                            </div>
                                                            <button class="btn btn-outline-secondary btn-sm" id="gen-reset-btn"><i class="fas fa-rotate-left me-1"></i>Restablecer</button>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="gen-metric-select" class="form-label text-uppercase small fw-semibold"><i class="fas fa-chart-column me-1"></i>Indicador</label>
                                                            <select id="gen-metric-select" class="form-select form-select-sm">
                                                                <option value="operaciones" selected>Operaciones</option>
                                                                <option value="pasajeros">Pasajeros</option>
                                                            </select>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="gen-view-select" class="form-label text-uppercase small fw-semibold"><i class="fas fa-layer-group me-1"></i>Detalle</label>
                                                            <select id="gen-view-select" class="form-select form-select-sm">
                                                                <option value="anual" selected>Vista anual</option>
                                                                <option value="mensual">Detalle mensual</option>
                                                            </select>
                                                        </div>
                                                        <div class="mb-3 d-none" id="gen-year-group">
                                                            <label for="gen-year-select" class="form-label text-uppercase small fw-semibold"><i class="fas fa-calendar me-1"></i>Año base</label>
                                                            <select id="gen-year-select" class="form-select form-select-sm"></select>
                                                        </div>
                                                        <div class="mb-0 d-none" id="gen-comparison-group">
                                                            <label for="gen-comparison-select" class="form-label text-uppercase small fw-semibold"><i class="fas fa-balance-scale me-1"></i>Comparar con</label>
                                                            <select id="gen-comparison-select" class="form-select form-select-sm"></select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-lg-8 col-xxl-9">
                                                <div class="card h-100">
                                                    <div class="card-body">
                                                        <div class="d-flex flex-column gap-3">
                                                            <div>
                                                                <h5 class="mb-1 d-flex align-items-center gap-2">
                                                                    <i class="fas fa-chart-area text-primary"></i>
                                                                    <span>Panorama táctico</span>
                                                                </h5>
                                                                <p class="text-muted small mb-0">Monitorea el pulso operativo de la aviación general con métricas históricas y comparativos inmediatos.</p>
                                                            </div>
                                                            <ul class="list-unstyled small text-muted mb-0">
                                                                <li class="d-flex align-items-center gap-2"><i class="fas fa-compass text-primary"></i><span>Identifica variaciones relevantes por temporada.</span></li>
                                                                <li class="d-flex align-items-center gap-2"><i class="fas fa-calendar-alt text-primary"></i><span>Activa el detalle mensual para detectar meses pico.</span></li>
                                                                <li class="d-flex align-items-center gap-2"><i class="fas fa-lightbulb text-warning"></i><span>Recibe hallazgos clave calculados automáticamente.</span></li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row g-3">
                                            <div class="col-12">
                                                <div class="row g-3" id="gen-summary-cards"></div>
                                            </div>
                                        </div>
                                        <div class="row g-3 align-items-start">
                                            <div class="col-12 col-xxl-6">
                                                <div class="card h-100">
                                                    <div class="card-body">
                                                        <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
                                                            <span class="badge bg-primary-subtle text-primary fw-semibold" id="gen-chart-tag">Vista anual</span>
                                                            <small class="text-muted" id="gen-chart-subtitle"></small>
                                                        </div>
                                                        <div class="chart-container" style="height: 420px;"><canvas id="gen-chart"></canvas></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-xxl-6">
                                                <div class="card h-100">
                                                    <div class="card-body">
                                                        <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
                                                            <span class="badge bg-secondary-subtle text-secondary fw-semibold" id="gen-table-tag">Variación interanual</span>
                                                            <small class="text-muted" id="gen-table-caption"></small>
                                                        </div>
                                                        <div id="gen-table-wrapper">
                                                            <div class="table-responsive">
                                                                <table class="table table-sm align-middle mb-0" id="gen-data-table">
                                                                    <thead></thead>
                                                                    <tbody></tbody>
                                                                </table>
                                                            </div>
                                                            <div class="ag-table-meta mt-2" id="gen-footnote"></div>
                                                        </div>
                                                        <div class="alert alert-info d-none mt-2 mb-0" id="gen-empty-state">
                                                            No hay datos para el periodo seleccionado.
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ag-insights d-none mt-3" id="gen-insights"></div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="aviacion-carga-pane" role="tabpanel" aria-labelledby="aviacion-carga-tab" tabindex="0">
                                    <div class="ag-wrapper">
                                        <div class="row g-3 align-items-stretch" id="cargo-controls-row">
                                            <div class="col-12 col-lg-4 col-xxl-3">
                                                <div class="card ag-controls-card h-100">
                                                    <div class="card-body">
                                                        <div class="d-flex align-items-center justify-content-between mb-3">
                                                            <div class="d-flex align-items-center gap-2 text-uppercase small fw-semibold text-muted">
                                                                <i class="fas fa-sliders-h text-primary"></i>
                                                                <span>Configuración</span>
                                                            </div>
                                                            <button class="btn btn-outline-secondary btn-sm" id="cargo-reset-btn"><i class="fas fa-rotate-left me-1"></i>Restablecer</button>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="cargo-metric-select" class="form-label text-uppercase small fw-semibold"><i class="fas fa-chart-column me-1"></i>Indicador</label>
                                                            <select id="cargo-metric-select" class="form-select form-select-sm">
                                                                <option value="operaciones" selected>Operaciones</option>
                                                                <option value="tons_transportadas">Toneladas transportadas</option>
                                                            </select>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="cargo-view-select" class="form-label text-uppercase small fw-semibold"><i class="fas fa-layer-group me-1"></i>Detalle</label>
                                                            <select id="cargo-view-select" class="form-select form-select-sm">
                                                                <option value="anual" selected>Vista anual</option>
                                                                <option value="mensual">Detalle mensual</option>
                                                            </select>
                                                        </div>
                                                        <div class="mb-3 d-none" id="cargo-year-group">
                                                            <label for="cargo-year-select" class="form-label text-uppercase small fw-semibold"><i class="fas fa-calendar me-1"></i>Año base</label>
                                                            <select id="cargo-year-select" class="form-select form-select-sm"></select>
                                                        </div>
                                                        <div class="mb-0 d-none" id="cargo-comparison-group">
                                                            <label for="cargo-comparison-select" class="form-label text-uppercase small fw-semibold"><i class="fas fa-balance-scale me-1"></i>Comparar con</label>
                                                            <select id="cargo-comparison-select" class="form-select form-select-sm"></select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-lg-8 col-xxl-9">
                                                <div class="card h-100">
                                                    <div class="card-body">
                                                        <div class="d-flex flex-column gap-3">
                                                            <div>
                                                                <h5 class="mb-1 d-flex align-items-center gap-2">
                                                                    <i class="fas fa-chart-area text-primary"></i>
                                                                    <span>Visión logística</span>
                                                                </h5>
                                                                <p class="text-muted small mb-0">Supervisa el desempeño de la aviación de carga con comparativos históricos de operaciones y toneladas transportadas.</p>
                                                            </div>
                                                            <ul class="list-unstyled small text-muted mb-0">
                                                                <li class="d-flex align-items-center gap-2"><i class="fas fa-dolly text-primary"></i><span>Evalúa la tracción mensual y acumulada de las operaciones de carga.</span></li>
                                                                <li class="d-flex align-items-center gap-2"><i class="fas fa-weight-hanging text-secondary"></i><span>Contrasta las toneladas transportadas contra periodos previos.</span></li>
                                                                <li class="d-flex align-items-center gap-2"><i class="fas fa-lightbulb text-warning"></i><span>Obtén hallazgos clave generados automáticamente.</span></li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row g-3">
                                            <div class="col-12">
                                                <div class="row g-3" id="cargo-summary-cards"></div>
                                            </div>
                                        </div>
                                        <div class="row g-3 align-items-start">
                                            <div class="col-12 col-xxl-6">
                                                <div class="card h-100">
                                                    <div class="card-body">
                                                        <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
                                                            <span class="badge bg-primary-subtle text-primary fw-semibold" id="cargo-chart-tag">Vista anual</span>
                                                            <small class="text-muted" id="cargo-chart-subtitle"></small>
                                                        </div>
                                                        <div class="chart-container" style="height: 420px;"><canvas id="cargo-chart"></canvas></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-xxl-6">
                                                <div class="card h-100">
                                                    <div class="card-body">
                                                        <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
                                                            <span class="badge bg-secondary-subtle text-secondary fw-semibold" id="cargo-table-tag">Variación interanual</span>
                                                            <small class="text-muted" id="cargo-table-caption"></small>
                                                        </div>
                                                        <div id="cargo-table-wrapper">
                                                            <div class="table-responsive">
                                                                <table class="table table-sm align-middle mb-0" id="cargo-data-table">
                                                                    <thead></thead>
                                                                    <tbody></tbody>
                                                                </table>
                                                            </div>
                                                            <div class="ag-table-meta mt-2" id="cargo-footnote"></div>
                                                        </div>
                                                        <div class="alert alert-info d-none mt-2 mb-0" id="cargo-empty-state">
                                                            No hay datos para el periodo seleccionado.
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ag-insights d-none mt-3" id="cargo-insights"></div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- Frecuencias de la semana (tabbed PDFs) -->
                <div id="frecuencias-semana-section" class="content-section">
                    <div class="card border-0">
                        <div class="card-header bg-transparent d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
                            <h2 class="section-title mb-2 mb-md-0">Frecuencias semanales</h2>
                            <div class="small text-muted">Documentos oficiales (PDF)</div>
                        </div>
                        <div class="card-body pdf-container">
                            <ul class="nav nav-tabs" id="frecuenciasTab" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="frecuencias-nac-tab" data-bs-toggle="tab" data-bs-target="#frecuencias-nac-pane" type="button" role="tab" aria-controls="frecuencias-nac-pane" aria-selected="true">Frecuencias semanales Nacionales</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="frecuencias-int-tab" data-bs-toggle="tab" data-bs-target="#frecuencias-int-pane" type="button" role="tab" aria-controls="frecuencias-int-pane" aria-selected="false">Frecuencias semanales Internacionales</button>
                                </li>
                            </ul>
                            <div class="tab-content pt-3" id="frecuenciasTabContent">
                                <div class="tab-pane fade show active" id="frecuencias-nac-pane" role="tabpanel" aria-labelledby="frecuencias-nac-tab" tabindex="0">
                                    <div id="frecuencias-viewer-nac" class="pdf-singlepage-viewer" data-src="pdfs/frecuencias_semanales.pdf" style="position:relative; width:100%; max-width:100%;">
                                        <canvas style="width:100%; height:auto; display:block;"></canvas>
                                        <div class="links-layer" style="position:absolute; left:0; top:0; pointer-events:none;"></div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="frecuencias-int-pane" role="tabpanel" aria-labelledby="frecuencias-int-tab" tabindex="0">
                                    <div id="frecuencias-viewer-int" class="pdf-singlepage-viewer" data-src="pdfs/frecuencias_semanales_internacionales.pdf" style="position:relative; width:100%; max-width:100%;">
                                        <canvas style="width:100%; height:auto; display:block;"></canvas>
                                        <div class="links-layer" style="position:absolute; left:0; top:0; pointer-events:none;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="itinerario-mensual-section" class="content-section">
                    <div class="card">
                        <div class="card-header text-center">
                            <h2 class="section-title mb-0">ITINERARIO MENSUAL DEL MES DE NOVIEMBRE </h2>
                        </div>
                        <div class="card-body pdf-container">
                            <iframe id="pdf-itinerario-mensual" src="pdfs/itinerario_mensual.pdf" width="100%" height="800px" class="border-0"></iframe>
                            <button class="btn btn-outline-primary w-100 mt-2" data-fullscreen-target="#pdf-itinerario-mensual"><i class="fas fa-expand me-2"></i>Ver en Pantalla Completa</button>
                        </div>
                    </div>
                </div>
                <div id="puntualidad-agosto-section" class="content-section">
                    <div class="card">
                        <div class="card-header d-flex align-items-center justify-content-center">
                            <i class="fas fa-clock-check fa-2x text-primary me-3"></i>
                            <h2 class="section-title mb-0">PUNTUALIDAD DE AEROLÍNEAS DEL MES DE SEPTIEMBRE</h2>
                        </div>
                        <div class="card-body">
                            <ul class="nav nav-tabs" id="puntualidadTab" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="punc-interactivo-tab" data-bs-toggle="tab" data-bs-target="#punc-interactivo-pane" type="button" role="tab" aria-controls="punc-interactivo-pane" aria-selected="true"><i class="fas fa-table me-2"></i>Vista Interactiva</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="punc-pdf-tab" data-bs-toggle="tab" data-bs-target="#punc-pdf-pane" type="button" role="tab" aria-controls="punc-pdf-pane" aria-selected="false"><i class="fas fa-file-pdf me-2"></i>Documento PDF Original</button>
                                </li>
                            </ul>
                            <div class="tab-content pt-3" id="puntualidadTabContent">
                                <div class="tab-pane fade show active" id="punc-interactivo-pane" role="tabpanel" aria-labelledby="punc-interactivo-tab" tabindex="0">
                                    <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
                                        <div class="d-flex align-items-center gap-2">
                                            <span class="small text-muted">Umbral puntualidad:</span>
                                            <span class="badge bg-success">≥ 85% Puntual</span>
                                            <span class="badge bg-danger">&lt; 85% Impuntual</span>
                                        </div>
                                        <div class="d-flex align-items-center gap-2">
                                            <label for="puntualidad-minflights" class="small text-muted m-0">Mín. vuelos
                                                <i id="minflights-help" class="fas fa-circle-question ms-1 text-muted" data-bs-toggle="tooltip" data-bs-placement="top" title="Sólo afecta los TOPs: excluye aerolíneas con menos vuelos que este mínimo."></i>
                                            </label>
                                            <select id="puntualidad-minflights" class="form-select form-select-sm" style="width:auto;">
                                                <option value="1">1</option>
                                                <option value="3">3</option>
                                                <option value="5" selected>5</option>
                                                <option value="10">10</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row g-3 mb-3">
                                        <div class="col-12 col-lg-6">
                                            <div class="card h-100 punc-card punc-passengers">
                                                <div class="card-header d-flex align-items-center gap-2"><i class="fas fa-user-friends text-primary"></i><strong>Pasajeros</strong></div>
                                                <div class="card-body">
                                                    <div class="row g-3">
                                                        <div class="col-12 col-md-6 punc-best-col">
                                                            <h6 class="text-success mb-2 punc-col-title punc-col-best"><i class="fas fa-trophy me-1"></i>Más puntuales</h6>
                                                            <ol id="puntualidad-top-pax-best" class="m-0"></ol>
                                                            <div class="mt-2"><canvas id="punc-pax-best-chart" height="140"></canvas></div>
                                                        </div>
                                                        <div class="col-12 col-md-6 punc-worst-col">
                                                            <h6 class="text-danger mb-2 punc-col-title punc-col-worst"><i class="fas fa-triangle-exclamation me-1"></i>Más impuntuales</h6>
                                                            <ol id="puntualidad-top-pax-worst" class="m-0"></ol>
                                                            <div class="mt-2"><canvas id="punc-pax-worst-chart" height="140"></canvas></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12 col-lg-6">
                                            <div class="card h-100 punc-card punc-cargo">
                                                <div class="card-header d-flex align-items-center gap-2"><i class="fas fa-box-open text-warning"></i><strong>Carga</strong></div>
                                                <div class="card-body">
                                                    <div class="row g-3">
                                                        <div class="col-12 col-md-6 punc-best-col">
                                                            <h6 class="text-success mb-2 punc-col-title punc-col-best"><i class="fas fa-trophy me-1"></i>Más puntuales</h6>
                                                            <ol id="puntualidad-top-cargo-best" class="m-0"></ol>
                                                            <div class="mt-2"><canvas id="punc-cargo-best-chart" height="140"></canvas></div>
                                                        </div>
                                                        <div class="col-12 col-md-6 punc-worst-col">
                                                            <h6 class="text-danger mb-2 punc-col-title punc-col-worst"><i class="fas fa-triangle-exclamation me-1"></i>Más impuntuales</h6>
                                                            <ol id="puntualidad-top-cargo-worst" class="m-0"></ol>
                                                            <div class="mt-2"><canvas id="punc-cargo-worst-chart" height="140"></canvas></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="table-responsive" id="puntualidad-table-container"></div>
                                </div>
                                <div class="tab-pane fade" id="punc-pdf-pane" role="tabpanel" aria-labelledby="punc-pdf-tab" tabindex="0">
                                    <div class="pdf-container">
                                        <div class="pdf-singlepage-viewer v-scroll" data-src="pdfs/puntualidad_agosto.pdf" style="position:relative; width:100%; max-width:100%;">
                                            <canvas style="width:100%; height:auto; display:block;"></canvas>
                                            <div class="links-layer" style="position:absolute; left:0; top:0; pointer-events:none;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="comparativa-section" class="content-section">
                    <div class="card border-0">
                        <div class="card-header bg-transparent">
                            <h2 class="section-title mb-0">Análisis Comparativo</h2>
                        </div>
                        <div class="card-body">
                            <div class="pdf-preview-container shadow-sm">
                                <iframe id="pdf-preview-2" src="pdfs/operatividad_aerolineas.pdf"></iframe>
                            </div>
                            <button class="btn btn-outline-primary w-100 mt-2" data-fullscreen-target="#pdf-preview-2"><i class="fas fa-expand me-2"></i>Ver en Pantalla Completa</button>
                        </div>
                    </div>
                </div>

                <!-- Manifiestos -->
                <div id="manifiestos-section" class="content-section">
                    <div class="card border-0">
                        <div class="card-header bg-transparent text-center">
                            <h2 class="section-title mb-1 d-inline-flex align-items-center justify-content-center gap-2">
                                <span>Manifiestos</span>
                            </h2>
                            
                        </div>
                        <div class="card-body">
                            <div class="row g-3 manifest-layout">
                                <div class="col-12 col-lg-5">
                                    <div class="manifest-sidebar d-flex flex-column gap-3">
                                        <div class="manifest-pane manifest-pane-controls">
                                            <div class="manifest-controls mb-2 d-flex gap-2 flex-wrap align-items-center">
                                        <input type="file" id="manifest-upload" accept=".pdf,application/pdf,image/*" class="form-control form-control-sm" style="max-width:320px;">
                                        <div class="d-flex gap-2">
                                            <button id="manifest-upload-btn-pdf" type="button" class="btn btn-outline-secondary btn-sm"><i class="fas fa-file-pdf me-1"></i>Adjuntar PDF</button>
                                            <button id="manifest-upload-btn-img" type="button" class="btn btn-outline-secondary btn-sm"><i class="fas fa-image me-1"></i>Adjuntar imagen</button>
                                        </div>
                                        <button id="manifest-scan-pdf" class="btn btn-primary btn-sm ms-2"><i class="fas fa-wand-magic-sparkles me-1"></i>Escanear PDF</button>
                                        <div class="form-check form-switch ms-2">
                                            <input class="form-check-input" type="checkbox" id="manifest-fast-mode" checked>
                                            <label class="form-check-label small" for="manifest-fast-mode" title="Usa texto del PDF primero y OCR dirigido solo si faltan campos clave. Igual de preciso, más rápido.">Modo rápido</label>
                                        </div>
                                        <button id="manifest-scan-ocr" class="btn btn-outline-secondary btn-sm"><i class="fas fa-magic me-1"></i>Escaneo alternativo (OCR)</button>
                                        <select id="manifest-ocr-pages" class="form-select form-select-sm" style="width:auto; display:inline-block">
                                            <option value="1">1 pág</option>
                                            <option value="2" selected>2 págs</option>
                                            <option value="3">3 págs</option>
                                            <option value="5">5 págs</option>
                                        </select>
                                            
                                            </div>
                                            <div class="manifest-mobile-hint small text-muted mb-2">En móviles: usa “Adjuntar PDF” para abrir Archivos/Files y seleccionar documentos .pdf; usa “Adjuntar imagen” para abrir Fotos/Cámara.</div>
                                        </div>
                                        <div class="manifest-pane manifest-pane-preview">
                                            <!-- Progreso estilo avión (arriba de la previsualización) -->
                                            <div id="manifest-plane-progress" class="plane-progress mb-2 d-none" aria-hidden="false">
                                                <div class="plane-progress-track">
                                                    <div class="plane-progress-fill" id="manifest-plane-fill"></div>
                                                    <div class="plane-progress-plane" id="manifest-plane-icon" title="Procesando">✈</div>
                                                </div>
                                                <div class="plane-progress-label small text-muted" id="manifest-plane-label">0%</div>
                                            </div>
                                            <div class="manifest-preview-shell">
                                                <div id="manifest-preview-container" class="manifest-preview-card" style="position:relative; overflow:auto;">
                                                    <!-- Loader de sección Manifiestos (tipo login con avión orbitando) -->
                                                    <div id="manifiestos-loader" class="section-loader hidden" role="alert" aria-live="assertive" aria-busy="true">
                                                        <div class="loader-content text-center">
                                                            <div class="plane-orbit">
                                                                <span class="orbit-ring"></span>
                                                                <span class="plane-icon">✈</span>
                                                                <img src="images/logo_aifa.jpg" alt="AIFA" class="loader-aifa-logo" />
                                                            </div>
                                                            <div class="loader-text">Escaneando…</div>
                                                        </div>
                                                    </div>
                                                    <div id="manifest-preview-placeholder" class="text-muted small">Seleccione un PDF de manifiesto y presione "Escanear PDF" para procesarlo automáticamente.</div>
                                                    <!-- Previsualización: imagen (para JPG/PNG) o canvas (para PDF) -->
                                                    <img id="manifest-preview" alt="Previsualización" class="img-fluid d-none" style="position:relative; z-index:0;" />
                                                    <canvas id="manifest-preview-canvas" class="d-none" style="display:block; margin:auto; position:relative; z-index:1;"></canvas>
                                                    <div id="manifest-text-layer" style="position:absolute; left:0; top:0; right:0; bottom:0; pointer-events:auto; user-select:text; white-space:pre-wrap; overflow:hidden; padding:0.25rem; font: 12px/1.2 'Roboto Mono', monospace; z-index:5;"></div>
                                                </div>
                                            </div>
                                            <div class="manifest-status-stack">
                                                <div id="manifest-ocr-status" class="small text-muted"></div>
                                                <div class="progress my-1 d-none" style="height: 18px;" id="manifest-progress-bar-container">
                                                    <div class="progress-bar progress-bar-striped progress-bar-animated" id="manifest-progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">Escaneando PDF...</div>
                                                </div>
                                                <div id="manifest-pdf-status" class="small text-info"></div>
                                                <details class="mt-1 manifest-debug-toggle">
                                                    <summary class="small">Ver texto detectado (debug)</summary>
                                                    <textarea id="manifest-ocr-debug" class="form-control form-control-sm mt-2" rows="8" style="font-family: 'Roboto Mono', monospace;"></textarea>
                                                </details>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 col-lg-7">
                                    <div class="manifest-pane manifest-pane-form h-100">
                                        <div class="mf-sheet mf-ntp manifest-form-shell">
                                    <div class="mf-header d-flex align-items-center justify-content-between flex-wrap gap-2">
                                        <div class="d-flex align-items-center gap-2">
                                            <img src="images/logo_aifa.jpg" alt="AIFA" class="mf-header-logo" />
                                            <div>
                                                <div class="mf-header-title">Manifiestos</div>
                                                <div class="mf-header-subtitle">Aeropuerto Internacional Felipe Ángeles</div>
                                            </div>
                                        </div>
                                        <div class="d-flex align-items-end gap-2 mf-header-meta">
                                            <div>
                                                <label class="form-label small mb-1 text-light-ntp">Fecha del Documento</label>
                                                <input type="date" class="form-control form-control-sm mf-header-input" id="mf-doc-date" />
                                            </div>
                                            <div>
                                                <label class="form-label small mb-1 text-light-ntp">Folio</label>
                                                <input type="text" class="form-control form-control-sm mf-header-input" id="mf-folio" />
                                            </div>
                                        </div>
                                    </div>
                                    <form id="manifest-form" class="row g-2 mf-body">
                                        <div class="col-12">
                                            <label class="form-label me-3">Tipo de Manifiesto</label>
                                            <div class="btn-group" role="group" aria-label="Tipo de Manifiesto">
                                                <input type="radio" class="btn-check" name="mf-dir" id="mf-dir-arr" autocomplete="off" checked>
                                                <label class="btn btn-outline-secondary" for="mf-dir-arr"><i class="fas fa-plane-arrival me-1"></i>Llegada</label>
                                                <input type="radio" class="btn-check" name="mf-dir" id="mf-dir-dep" autocomplete="off">
                                                <label class="btn btn-outline-secondary" for="mf-dir-dep"><i class="fas fa-plane-departure me-1"></i>Salida</label>
                                            </div>
                                        </div>
                                            <!-- Encabezado del documento (cuerpo) -->
                                            <div class="col-12">
                                                <div class="d-flex flex-wrap align-items-end gap-3">
                                                    <div class="flex-grow-1">
                                                        <label class="form-label">Título</label>
                                                        <input type="text" class="form-control" id="mf-title" value="MANIFIESTO DE LLEGADA" readonly>
                                                    </div>
                                                </div>
                                                <hr />
                                            </div>
                                        <!-- Sección 1: Datos generales (en orden solicitado) -->
                                        <div class="col-12">
                                            <h6 class="mb-2"><i class="fas fa-list me-1"></i>Datos generales</h6>
                                        </div>
                                        <!-- Nuevos primeros campos en Datos generales -->
                                        <div class="col-12 col-md-6 mb-2">
                                            <label class="form-label" id="mf-airport-main-label">Aeropuerto de Llegada</label>
                                            <input type="text" class="form-control" id="mf-airport-main" placeholder="IATA (3 letras)" maxlength="3" style="text-transform:uppercase" list="airports-iata-list" />
                                        </div>
                                        <div class="col-12 col-md-6 mb-2">
                                            <label class="form-label">Tipo de vuelo</label>
                                            <input type="text" class="form-control" id="mf-flight-type" placeholder="Escribe la letra del tipo (A–Z)" maxlength="1" pattern="[A-Za-z]" style="text-transform:uppercase" list="flight-type-list" autocomplete="off" />
                                            <datalist id="flight-type-list"></datalist>
                                            <div id="mf-flight-type-info" class="form-text small text-muted"></div>
                                        </div>
                                        
                                        <div class="col-12 col-md-4 mb-2">
                                            <label class="form-label">Transportista (OACI - 3 letras)</label>
                                            <input type="text" class="form-control" id="mf-carrier-3l" maxlength="3" placeholder="Ej. AMX" style="text-transform:uppercase" list="airlines-icao-list" pattern="[A-Za-z]{3}" autocomplete="off" />
                                            <datalist id="airlines-icao-list"></datalist>
                                            <div class="form-text">Usa el código OACI (ICAO) de 3 letras. Ejemplos: AMX (Aeroméxico), CLX (Cargolux), THY (Turkish).</div>
                                        </div>
                                        <div class="col-12 col-md-8 mb-2">
                                            <label class="form-label">Nombre o razón social del transportista / operador aéreo</label>
                                            <input type="text" class="form-control" id="mf-operator-name" />
                                        </div>
                                        <div class="col-12 col-md-4 mb-2">
                                            <label class="form-label">Transportista / Operador (Nombre comercial)</label>
                                            <input type="text" class="form-control" id="mf-airline" />
                                        </div>
                                        <div class="col-12 col-md-4 mb-2">
                                            <label class="form-label">Matrícula</label>
                                            <input type="text" class="form-control" id="mf-tail" list="aircraft-reg-list" placeholder="Ej. N851GT / XAABC" style="text-transform:uppercase" autocomplete="off" />
                                            <datalist id="aircraft-reg-list"></datalist>
                                            <div class="form-text">Selecciona una matrícula del catálogo o escríbela manualmente.</div>
                                            <div id="mf-tail-warning" class="form-text text-danger d-none"></div>
                                        </div>
                                        <div class="col-12 col-md-4 mb-2">
                                            <label class="form-label">Vuelo</label>
                                            <input type="text" class="form-control" id="mf-flight" />
                                        </div>
                                        
                                        <div class="col-12 col-md-4 mb-2">
                                            <label class="form-label">Equipo</label>
                                            <input type="text" class="form-control" id="mf-aircraft" list="aircraft-type-icao-list" placeholder="Ej. B77F / A21N / E195" style="text-transform:uppercase" pattern="[A-Za-z0-9]{2,5}" autocomplete="off" />
                                            <datalist id="aircraft-type-icao-list"></datalist>
                                            <div class="form-text">Usa el código OACI del tipo de aeronave (ej. B77F, A21N). Puedes editarlo manualmente.</div>
                                        </div>
                                        <div class="col-12 col-md-4">
                                            <label class="form-label">Piloto al Mando</label>
                                            <input type="text" class="form-control" id="mf-pilot" />
                                        </div>
                                        <div class="col-12 col-md-4">
                                            <label class="form-label">No. de Licencia</label>
                                            <input type="text" class="form-control" id="mf-pilot-license" />
                                        </div>
                                        <div class="col-12 col-md-4">
                                            <label class="form-label">No. de Tripulación</label>
                                            <input type="number" min="0" class="form-control" id="mf-crew-total" />
                                        </div>
                                        
                                        <div class="col-12">
                                            <hr />
                                        </div>
                                        <!-- Sección 2: Movimiento de operaciones (Salida) -->
                                        <div class="col-12" data-dir="departure-only">
                                            <h6 class="mb-2"><i class="fas fa-route me-1"></i>Movimiento de operaciones</h6>
                                            <div class="row g-2">
                                                <!-- Columna 1: Origen -->
                                                <div class="col-12 col-md-4">
                                                    <div class="mb-2">
                                                        <label class="form-label">Origen de vuelo - Nombre completo del aeropuerto</label>
                                                        <input type="text" class="form-control" id="mf-origin-name" list="airports-name-list" placeholder="Nombre completo del aeropuerto" />
                                                        <small class="text-muted">Si es Hangar, agregue "H". Si es Pernocta, agregue "P".</small>
                                                    </div>
                                                    <div class="mb-2">
                                                        <label class="form-label">Código de 3 letras (origen)</label>
                                                        <input type="text" class="form-control" id="mf-origin-code" maxlength="3" style="text-transform:uppercase" list="airports-iata-list" placeholder="IATA (3 letras)" />
                                                    </div>
                                                                                                        
                                                </div>
                                                <!-- Columna 2: Próxima escala -->
                                                <div class="col-12 col-md-4">
                                                    <div class="mb-2">
                                                        <label class="form-label">Próxima escala - Nombre completo del aeropuerto</label>
                                                        <input type="text" class="form-control" id="mf-next-stop" list="airports-name-list" placeholder="Nombre completo del aeropuerto" />
                                                    </div>
                                                    <div class="mb-2">
                                                        <label class="form-label">Código de 3 letras (próxima escala)</label>
                                                        <input type="text" class="form-control" id="mf-next-stop-code" maxlength="3" style="text-transform:uppercase" list="airports-iata-list" placeholder="IATA (3 letras)" />
                                                    </div>
                                                    
                                                </div>
                                                <!-- Columna 3: Destino -->
                                                <div class="col-12 col-md-4">
                                                    <div class="mb-2">
                                                        <label class="form-label">Destino del vuelo - Nombre completo del aeropuerto</label>
                                                        <input type="text" class="form-control" id="mf-final-dest" list="airports-name-list" placeholder="Nombre completo del aeropuerto" />
                                                    </div>
                                                    <div class="mb-2">
                                                        <label class="form-label">Código de 3 letras (destino)</label>
                                                        <input type="text" class="form-control" id="mf-final-dest-code" maxlength="3" style="text-transform:uppercase" list="airports-iata-list" placeholder="IATA (3 letras)" />
                                                    </div>
                                                    
                                                </div>
                                                <!-- Tipo de Operación (Salida) -->
                                                <div class="col-12 col-md-4 mb-2">
                                                    <label class="form-label">Tipo de Operación</label>
                                                    <input type="text" class="form-control" id="mf-operation-type-dep" placeholder="Doméstica / Internacional" readonly />
                                                    <div class="form-text">Se calcula con los aeropuertos (origen/destino).</div>
                                                </div>
                                                <!-- Grupo de tiempos (Salida) -->
                                                <div class="col-12">
                                                    <div class="p-3 border rounded bg-light-subtle mf-times">
                                                        <h6 class="mb-2">Tiempos (Salida)</h6>
                                                        <div class="row g-2">
                                                            <div class="col-6 col-md-3">
                                                                <label class="form-label">Hora de slot asignado</label>
                                                                <input type="text" class="form-control" id="mf-slot-assigned" data-time24="1" inputmode="numeric" placeholder="HH:MM" maxlength="5" />
                                                                <div class="form-text">Hora local</div>
                                                            </div>
                                                            <div class="col-6 col-md-3">
                                                                <label class="form-label">Hora de slot coordinado</label>
                                                                <input type="text" class="form-control" id="mf-slot-coordinated" data-time24="1" inputmode="numeric" placeholder="HH:MM" maxlength="5" />
                                                                <div class="form-text">Hora local</div>
                                                            </div>
                                                            <div class="col-6 col-md-3">
                                                                <label class="form-label">Hora de término de pernocta</label>
                                                                <input type="text" class="form-control" id="mf-termino-pernocta" data-time24="1" inputmode="numeric" placeholder="HH:MM" maxlength="5" />
                                                                <div class="form-text">Hora local</div>
                                                            </div>
                                                            <div class="col-6 col-md-3">
                                                                <label class="form-label">Hora de inicio de maniobras de embarque</label>
                                                                <input type="text" class="form-control" id="mf-inicio-embarque" data-time24="1" inputmode="numeric" placeholder="HH:MM" maxlength="5" />
                                                                <div class="form-text">Hora local</div>
                                                            </div>
                                                            <div class="col-6 col-md-3">
                                                                <label class="form-label">Hora de salida de la posición</label>
                                                                <input type="text" class="form-control" id="mf-salida-posicion" data-time24="1" inputmode="numeric" placeholder="HH:MM" maxlength="5" />
                                                                <div class="form-text">Hora local</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <hr />
                                        </div>
                                        <!-- Sección 2 (Llegada): Movimiento de operaciones -->
                                        <div class="col-12" data-dir="arrival-only">
                                            <h6 class="mb-2 mf-section-title"><i class="fas fa-route me-1"></i>Movimiento de operaciones</h6>
                                            <div class="row g-2">
                                                <!-- 1) Procedencia del vuelo (nombre completo) -->
                                                <div class="col-12 col-md-6">
                                                    <label class="form-label">Procedencia del vuelo - Nombre completo del aeropuerto</label>
                                                    <input type="text" class="form-control" id="mf-arr-origin-name" list="airports-name-list" placeholder="Nombre completo del aeropuerto" />
                                                </div>
                                                <!-- 2) Código de 3 letras (procedencia) -->
                                                <div class="col-6 col-md-3">
                                                    <label class="form-label">Código de 3 letras (procedencia)</label>
                                                    <input type="text" class="form-control" id="mf-arr-origin-code" maxlength="3" style="text-transform:uppercase" list="airports-iata-list" placeholder="IATA (3 letras)" />
                                                </div>
                                                
                                                <!-- 5) Última escala - nombre completo del aeropuerto -->
                                                <div class="col-12 col-md-6">
                                                    <label class="form-label">Escala Anterior - Nombre completo del aeropuerto</label>
                                                    <input type="text" class="form-control" id="mf-arr-last-stop" list="airports-name-list" placeholder="Nombre completo del aeropuerto" />
                                                </div>
                                                <!-- 6) Código de 3 letras (última escala) -->
                                                <div class="col-6 col-md-3">
                                                    <label class="form-label">Código de 3 letras (escala anterior)</label>
                                                        <input type="text" class="form-control" id="mf-arr-last-stop-code" maxlength="3" style="text-transform:uppercase" list="airports-iata-list" placeholder="IATA (3 letras)" />

                        <datalist id="airports-iata-list"></datalist>
                        <datalist id="airports-name-list"></datalist>
                        <datalist id="hhmm-24-list">
                            <!-- 24h options in 5-minute increments for convenience; you can still type any minute -->

                        </datalist>
                                                </div>
                                                <!-- Tipo de Operación (Llegada) -->
                                                <div class="col-12 col-md-4 mb-2">
                                                    <label class="form-label">Tipo de Operación</label>
                                                    <input type="text" class="form-control" id="mf-operation-type-arr" placeholder="Doméstica / Internacional" readonly />
                                                    <div class="form-text">Se calcula con los aeropuertos (procedencia/escala).</div>
                                                </div>
                                                
                                                <!-- Grupo de tiempos (Llegada) -->
                                                <div class="col-12 mt-1">
                                                    <div class="p-3 border rounded bg-light-subtle mf-times">
                                                        <h6 class="mb-2 mf-section-title">Tiempos (Llegada)</h6>
                                                        <div class="row g-2">
                                                            <div class="col-6 col-md-3">
                                                                <label class="form-label">Hora de slot asignado</label>
                                                                <input type="text" class="form-control" id="mf-arr-slot-assigned" data-time24="1" inputmode="numeric" placeholder="HH:MM" maxlength="5" />
                                                                <label class="form-check-label ms-2 d-inline-flex align-items-center"><input type="checkbox" class="form-check-input me-1" id="mf-arr-slot-assigned-na" title="No aplica (N/A)">N/A</label>
                                                                <div class="form-text">Hora local</div>
                                                            </div>
                                                            <div class="col-6 col-md-3">
                                                                <label class="form-label">Hora de slot coordinado</label>
                                                                <input type="text" class="form-control" id="mf-arr-slot-coordinated" data-time24="1" inputmode="numeric" placeholder="HH:MM" maxlength="5" />
                                                                <label class="form-check-label ms-2 d-inline-flex align-items-center"><input type="checkbox" class="form-check-input me-1" id="mf-arr-slot-coordinated-na" title="No aplica (N/A)">N/A</label>
                                                                <div class="form-text">Hora local</div>
                                                            </div>
                                                            <div class="col-6 col-md-3">
                                                                <label class="form-label">Hora de entrada a la posición</label>
                                                                <input type="text" class="form-control" id="mf-arr-arribo-posicion" data-time24="1" inputmode="numeric" placeholder="HH:MM" maxlength="5" />
                                                                <label class="form-check-label ms-2 d-inline-flex align-items-center"><input type="checkbox" class="form-check-input me-1" id="mf-arr-arribo-posicion-na" title="No aplica (N/A)">N/A</label>
                                                                <div class="form-text">Hora local</div>
                                                            </div>
                                                            <div class="col-6 col-md-3">
                                                                <label class="form-label">Hora de termino de maniobras de desembarque</label>
                                                                <input type="text" class="form-control" id="mf-arr-inicio-desembarque" data-time24="1" inputmode="numeric" placeholder="HH:MM" maxlength="5" />
                                                                <label class="form-check-label ms-2 d-inline-flex align-items-center"><input type="checkbox" class="form-check-input me-1" id="mf-arr-inicio-desembarque-na" title="No aplica (N/A)">N/A</label>
                                                                <div class="form-text">Hora local</div>
                                                            </div>
                                                            <div class="col-6 col-md-3">
                                                                <label class="form-label">Hora de inicio de pernocta</label>
                                                                <input type="text" class="form-control" id="mf-arr-inicio-pernocta" data-time24="1" inputmode="numeric" placeholder="HH:MM" maxlength="5" />
                                                                <label class="form-check-label ms-2 d-inline-flex align-items-center"><input type="checkbox" class="form-check-input me-1" id="mf-arr-inicio-pernocta-na" title="No aplica (N/A)">N/A</label>
                                                                <div class="form-text">Hora local</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- 9) Hora de inicio de pernocta -->
                                                
                                            </div>
                                            <hr />
                                        </div>
                                        
                                        <!-- Causas de la demora (3 filas fijas) -->
                                        <div class="col-12">
                                            <h6 class="mb-2 mf-section-title"><i class="fas fa-clock me-1"></i>Causas de la demora</h6>
                                            <div class="row g-2 align-items-end mb-1">
                                                <div class="col-12 col-md-3">
                                                    <label class="form-label">Código de demora</label>
                                                    <input type="text" class="form-control" id="demora1-codigo" list="delay-alpha-codes" placeholder="Escribe código (Alpha)" maxlength="3" autocomplete="off">
                                                </div>
                                                <div class="col-6 col-md-2">
                                                    <label class="form-label">Tiempo (min)</label>
                                                    <input type="number" min="0" class="form-control" id="demora1-tiempo" placeholder="0">
                                                </div>
                                                <div class="col-12 col-md-7">
                                                    <label class="form-label">Descripción</label>
                                                    <input type="text" class="form-control" id="demora1-descripcion" placeholder="Descripción del código">
                                                </div>
                                            </div>
                                            <div class="row g-2 align-items-end mb-1">
                                                <div class="col-12 col-md-3">
                                                    <label class="form-label">Código de demora</label>
                                                    <input type="text" class="form-control" id="demora2-codigo" list="delay-alpha-codes" placeholder="Escribe código (Alpha)" maxlength="3" autocomplete="off">
                                                </div>
                                                <div class="col-6 col-md-2">
                                                    <label class="form-label">Tiempo (min)</label>
                                                    <input type="number" min="0" class="form-control" id="demora2-tiempo" placeholder="0">
                                                </div>
                                                <div class="col-12 col-md-7">
                                                    <label class="form-label">Descripción</label>
                                                    <input type="text" class="form-control" id="demora2-descripcion" placeholder="Descripción del código">
                                                </div>
                                            </div>
                                            <div class="row g-2 align-items-end mb-2">
                                                <div class="col-12 col-md-3">
                                                    <label class="form-label">Código de demora</label>
                                                    <input type="text" class="form-control" id="demora3-codigo" list="delay-alpha-codes" placeholder="Escribe código (Alpha)" maxlength="3" autocomplete="off">
                                                </div>
                                                <div class="col-6 col-md-2">
                                                    <label class="form-label">Tiempo (min)</label>
                                                    <input type="number" min="0" class="form-control" id="demora3-tiempo" placeholder="0">
                                                </div>
                                                <div class="col-12 col-md-7">
                                                    <label class="form-label">Descripción</label>
                                                    <input type="text" class="form-control" id="demora3-descripcion" placeholder="Descripción del código">
                                                </div>
                                            </div>
                                            <!-- Datalist para códigos de demora (Alpha code) con Description -->
                                            <datalist id="delay-alpha-codes"></datalist>
                                            <hr />
                                        </div>

                                        <!-- División: Pasajeros por categoría (después de Demoras) -->
                                        <div class="col-12" data-dir="departure-only">
                                            <h6 class="mb-2 mf-section-title"><i class="fas fa-people-group me-1"></i>Pasajeros por categoría</h6>
                                            <div class="row g-2">
                                                <div class="col-6 col-md-3"><label class="form-label">Pagan TUA</label><input type="number" min="0" class="form-control" id="pax-tua"></div>
                                                <div class="col-6 col-md-3"><label class="form-label">Diplomáticos</label><input type="number" min="0" class="form-control" id="pax-diplomaticos"></div>
                                                <div class="col-6 col-md-3"><label class="form-label">En comisión</label><input type="number" min="0" class="form-control" id="pax-comision"></div>
                                                <div class="col-6 col-md-3"><label class="form-label">Infantes</label><input type="number" min="0" class="form-control" id="pax-infantes"></div>
                                                <div class="col-6 col-md-3"><label class="form-label">Tránsitos</label><input type="number" min="0" class="form-control" id="pax-transitos"></div>
                                                <div class="col-6 col-md-3"><label class="form-label">Conexiones</label><input type="number" min="0" class="form-control" id="pax-conexiones"></div>
                                                <div class="col-6 col-md-3"><label class="form-label">Otros exentos</label><input type="number" min="0" class="form-control" id="pax-exentos"></div>
                                                <div class="col-6 col-md-3"><label class="form-label">Total</label><input type="number" min="0" class="form-control" id="pax-total" readonly></div>
                                            </div>
                                            <div class="row g-2 mt-1">
                                                <div class="col-12 col-md-6"><div class="form-text">Nacionales</div></div>
                                                <div class="col-12 col-md-6"><div class="form-text">Internacionales</div></div>
                                            </div>
                                            <hr />
                                        </div>
                                        
                                        <!-- Embarque por estación -->
                                        <div class="col-12" data-dir="departure-only">
                                            <div class="d-flex align-items-center justify-content-between">
                                                <h6 class="mb-2 mf-section-title"><i class="fas fa-people-carry-box me-1"></i>Tabla de embarque por estación</h6>
                                                <div class="d-flex gap-2">
                                                    <button type="button" id="add-embarque-row" class="btn btn-sm btn-outline-secondary"><i class="fas fa-plus me-1"></i>Agregar estación</button>
                                                    <button type="button" id="clear-embarque" class="btn btn-sm btn-outline-secondary"><i class="fas fa-trash me-1"></i>Limpiar</button>
                                                </div>
                                            </div>
                                            <div class="table-responsive">
                                                <table class="table table-sm align-middle" id="tabla-embarque">
                                                    <thead>
                                                        <tr>
                                                            <th>Estación</th>
                                                            <th style="width:140px;">Pax Nacional</th>
                                                            <th style="width:160px;">Pax Internacional</th>
                                                            <th style="width:140px;">Equipaje (kg)</th>
                                                            <th style="width:140px;">Carga (kg)</th>
                                                            <th style="width:140px;">Correo (kg)</th>
                                                            <th style="width:60px;"></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                    <tfoot>
                                                        <tr class="table-light">
                                                            <th>Totales</th>
                                                            <th><input type="number" class="form-control form-control-sm" id="total-pax-nacional" readonly></th>
                                                            <th><input type="number" class="form-control form-control-sm" id="total-pax-internacional" readonly></th>
                                                            <th><input type="text" class="form-control form-control-sm" id="total-equipaje" readonly></th>
                                                            <th><input type="text" class="form-control form-control-sm" id="total-carga" readonly></th>
                                                            <th><input type="text" class="form-control form-control-sm" id="total-correo" readonly></th>
                                                            <th></th>
                                                        </tr>
                                                    </tfoot>
                                                </table>
                                            </div>
                                            <hr />
                                        </div>
                                        <div class="col-6 col-md-4" data-dir="departure-only">
                                            <label class="form-label">Equipaje Piezas</label>
                                            <input type="number" class="form-control" id="mf-baggage-pcs" />
                                        </div>
                                        <div class="col-6 col-md-4" data-dir="departure-only">
                                            <label class="form-label">Carga (kg)</label>
                                            <input type="number" step="0.01" class="form-control" id="mf-cargo" />
                                        </div>
                                        <div class="col-6 col-md-4" data-dir="departure-only">
                                            <label class="form-label">Carga Piezas</label>
                                            <input type="number" class="form-control" id="mf-cargo-pieces" />
                                        </div>
                                        <div class="col-6 col-md-4" data-dir="departure-only">
                                            <label class="form-label">Volumen (m³)</label>
                                            <input type="number" step="0.01" class="form-control" id="mf-cargo-volume" />
                                        </div>
                                        <div class="col-6 col-md-4" data-dir="departure-only">
                                            <label class="form-label">Correo (kg)</label>
                                            <input type="number" step="0.01" class="form-control" id="mf-mail" />
                                        </div>
                                        <div class="col-6 col-md-4" data-dir="departure-only">
                                            <label class="form-label">Correo Piezas</label>
                                            <input type="number" class="form-control" id="mf-mail-pieces" />
                                        </div>
                                        <div class="col-12" data-dir="departure-only">
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="checkbox" id="mf-dangerous-goods">
                                                <label class="form-check-label" for="mf-dangerous-goods">Mercancías Peligrosas</label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="checkbox" id="mf-live-animals">
                                                <label class="form-check-label" for="mf-live-animals">Animales Vivos</label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="checkbox" id="mf-human-remains">
                                                <label class="form-check-label" for="mf-human-remains">Restos Humanos</label>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <hr />
                                        </div>
                                        <div class="col-12 col-md-6" data-dir="departure-only">
                                            <label class="form-label">Agente / Responsable</label>
                                            <input type="text" class="form-control" id="mf-agent" />
                                        </div>
                                        <div class="col-12 col-md-6" data-dir="departure-only">
                                            <label class="form-label">Nombre y Firma</label>
                                            <input type="text" class="form-control" id="mf-signature" />
                                        </div>
                                        <div class="col-12" data-dir="departure-only">
                                            <div class="row g-2">
                                                <div class="col-12">
                                                    <label class="form-label">Observaciones</label>
                                                    <textarea class="form-control" id="mf-notes" rows="2"></textarea>
                                                </div>
                                                <div class="col-12 col-md-6">
                                                    <label class="form-label">Carga en tránsito (destino/procedencia)</label>
                                                    <input type="text" class="form-control" id="mf-obs-transito" />
                                                </div>
                                                <div class="col-12 col-md-6">
                                                    <label class="form-label">PAX DNI</label>
                                                    <input type="text" class="form-control" id="mf-pax-dni" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <hr />
                                        </div>
                                        <!-- Firmas y sellos -->
                                        <div class="col-12" data-dir="departure-only">
                                            <h6 class="mb-2 mf-section-title"><i class="fas fa-signature me-1"></i>Firmas y sellos</h6>
                                            <div class="row g-2">
                                                <div class="col-12 col-md-4">
                                                    <label class="form-label">Operador (Nombre y Firma)</label>
                                                    <input type="text" class="form-control" id="mf-sign-operator" />
                                                </div>
                                                <div class="col-12 col-md-4">
                                                    <label class="form-label">Coordinador de Rampa (Nombre y Firma)</label>
                                                    <input type="text" class="form-control" id="mf-sign-coordinator" />
                                                </div>
                                                <div class="col-12 col-md-4">
                                                    <label class="form-label">Administrador AIFA - Recibido por</label>
                                                    <input type="text" class="form-control" id="mf-sign-admin" />
                                                </div>
                                                <div class="col-12 col-md-3">
                                                    <label class="form-label">Fecha de Recepción</label>
                                                    <input type="date" class="form-control" id="mf-sign-admin-date" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12 d-flex gap-2 mt-2">
                                            <button type="button" class="btn btn-success" id="manifest-save"><i class="fas fa-save me-1"></i>Guardar</button>
                                            <button type="button" class="btn btn-outline-secondary" id="manifest-clear"><i class="fas fa-eraser me-1"></i>Limpiar</button>
                                            <button type="button" class="btn btn-outline-success" id="manifest-add-to-table" title="Agregar el formulario actual a la tabla (sin guardar)"><i class="fas fa-plus me-1"></i>Añadir a tabla</button>
                                            <button type="button" class="btn btn-outline-primary ms-auto" id="manifest-export-csv" title="Exportar registros rellenados a Excel"><i class="fas fa-file-excel me-1"></i>Exportar Excel</button>
                                        </div>
                                    </form>
                                    </div>
                                    <div class="manifest-records-block mt-3">
                                        <hr />
                                        <h5 class="mb-2">Registros Guardados</h5>
                                        <p class="text-muted small mt-n2 mb-3">Tip: Usa “Añadir a tabla” para agregar el formulario actual aquí sin guardarlo; “Exportar Excel” exporta esta tabla tal cual se ve.</p>
                                        <div class="table-responsive">
                                            <table class="table table-sm table-hover align-middle" id="manifest-records-table">
                                                <thead>
                                                    <tr>
                                                        <th>Tipo</th>
                                                        <th>Aerolínea</th>
                                                        <th>Vuelo</th>
                                                        <th>Matrícula</th>
                                                        <th>Fecha</th>
                                                        <th>Hora</th>
                                                        <th>Origen/Destino</th>
                                                        <th>Pax</th>
                                                        <th>Carga/Correo</th>
                                                        <th>Imagen</th>
                                                    </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                

            </main>
        </div>
    </div>

    <div id="pdf-lightbox" class="pdf-lightbox hidden">
        <button id="lightbox-close" class="lightbox-close">&times;</button>
        <div id="lightbox-content" class="lightbox-content"></div>
    </div>

    <!-- Modal: Instrucciones para instalar la app como PWA -->
    <div class="modal fade" id="install-app-modal" tabindex="-1" aria-labelledby="installAppModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="installAppModalLabel"><i class="fas fa-download me-2"></i>Instalar Operaciones AIFA</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <div id="install-app-support" class="alert alert-info small mb-3 d-none" role="status"></div>
                    <div class="install-welcome-card mb-4">
                        <div class="install-icon-stack" role="figure" aria-label="Vista previa instalada de Operaciones AIFA">
                            <span class="install-icon-glow" aria-hidden="true"></span>
                            <img src="images/icons/aifa-app-icon-192.png" alt="Icono de Operaciones AIFA" class="install-icon-main" loading="lazy">
                            <span class="install-icon-caption">Operaciones AIFA</span>
                        </div>
                        <div class="install-welcome-copy">
                            <h2 class="install-welcome-title mb-2">Bienvenidos a AIFA Operaciones</h2>
                            <p class="install-welcome-text mb-3">Instala la app para acceder al panel táctil con estadísticas en vivo, reportes y controles listos desde la pantalla de inicio de tu dispositivo.</p>
                            <p class="install-welcome-meta small text-muted mb-0">Los íconos optimizados se generan automáticamente en <code>images/icons/aifa-app-icon-512.png</code> y <code>images/icons/aifa-app-icon-192.png</code>, listos para cualquier plataforma.</p>
                        </div>
                    </div>
                    <p class="mb-3">Sigue estos pasos para agregar Operaciones AIFA a tu dispositivo y tener acceso directo desde la pantalla de inicio o el menú de aplicaciones.</p>
                    <ul class="nav nav-pills mb-3" id="install-app-tabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="install-android-tab" data-bs-toggle="pill" data-bs-target="#install-android-pane" type="button" role="tab" aria-controls="install-android-pane" aria-selected="true"><i class="fab fa-android me-2"></i>Android (Chrome)</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="install-ios-tab" data-bs-toggle="pill" data-bs-target="#install-ios-pane" type="button" role="tab" aria-controls="install-ios-pane" aria-selected="false"><i class="fab fa-apple me-2"></i>iOS / iPadOS (Safari)</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="install-desktop-chrome-tab" data-bs-toggle="pill" data-bs-target="#install-desktop-chrome-pane" type="button" role="tab" aria-controls="install-desktop-chrome-pane" aria-selected="false"><i class="fab fa-chrome me-2"></i>Windows / macOS (Chrome, Edge)</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="install-desktop-safari-tab" data-bs-toggle="pill" data-bs-target="#install-desktop-safari-pane" type="button" role="tab" aria-controls="install-desktop-safari-pane" aria-selected="false"><i class="fas fa-compass me-2"></i>macOS (Safari)</button>
                        </li>
                    </ul>
                    <div class="tab-content" id="install-app-tab-content">
                        <div class="tab-pane fade show active" id="install-android-pane" role="tabpanel" aria-labelledby="install-android-tab">
                            <ol class="ps-3">
                                <li>Abre esta página en Chrome para Android.</li>
                                <li>Toca el ícono de menú (tres puntos) en la esquina superior derecha.</li>
                                <li>Selecciona <strong>Añadir a pantalla principal</strong> y confirma.</li>
                                <li>Chrome creará el acceso directo con el ícono de Operaciones AIFA.</li>
                            </ol>
                        </div>
                        <div class="tab-pane fade" id="install-ios-pane" role="tabpanel" aria-labelledby="install-ios-tab">
                            <ol class="ps-3">
                                <li>Abre la página en Safari.</li>
                                <li>Toca el botón <strong>Compartir</strong> (cuadro con flecha hacia arriba).</li>
                                <li>Elige <strong>Añadir a pantalla de inicio</strong>.</li>
                                <li>Opcional: ajusta el nombre a mostrar y toca <strong>Añadir</strong>.</li>
                            </ol>
                            <p class="small text-muted mb-0">iOS no muestra el aviso automático, por lo que estos pasos son manuales.</p>
                        </div>
                        <div class="tab-pane fade" id="install-desktop-chrome-pane" role="tabpanel" aria-labelledby="install-desktop-chrome-tab">
                            <ol class="ps-3">
                                <li>Abre la página en Chrome o Edge.</li>
                                <li>Haz clic en el ícono de <strong>Instalar</strong> (bandeja con flecha) en la barra de direcciones.</li>
                                <li>Confirma la instalación cuando el navegador lo solicite.</li>
                                <li>El acceso se añadirá al menú inicio o lista de aplicaciones.</li>
                            </ol>
                        </div>
                        <div class="tab-pane fade" id="install-desktop-safari-pane" role="tabpanel" aria-labelledby="install-desktop-safari-tab">
                            <ol class="ps-3">
                                <li>Abre la página en Safari para macOS.</li>
                                <li>En el menú <strong>Archivo</strong>, selecciona <strong>Añadir a Dock</strong>.</li>
                                <li>Elige la ubicación y confirma.</li>
                                <li>El icono quedará disponible en el Dock para acceso directo.</li>
                            </ol>
                            <p class="small text-muted mb-0">Safari solo muestra el menú cuando la PWA cumple los criterios de Apple.</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="install-app-modal-install-btn" class="btn btn-primary" type="button"><i class="fas fa-download me-2"></i>Intentar instalación automática</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Selección de dirección del vuelo (Llegada/Salida) -->
    <div class="modal fade" id="mfDirectionModal" tabindex="-1" aria-labelledby="mfDirectionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="mfDirectionModalLabel"><i class="fas fa-plane me-2"></i>¿Qué tipo de documento es?</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-3">Selecciona la dirección del vuelo para completar el manifiesto.</p>
                    <div class="d-flex gap-2">
                        <button type="button" id="mfDirChooseArr" class="btn btn-primary flex-fill"><i class="fas fa-plane-arrival me-1"></i>Llegada</button>
                        <button type="button" id="mfDirChooseDep" class="btn btn-success flex-fill"><i class="fas fa-plane-departure me-1"></i>Salida</button>
                    </div>
                    <div class="form-text mt-2">Puedes cambiarlo después si es necesario.</div>
                </div>
            </div>
        </div>
    </div>

    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 2050">
        <div id="action-toast" class="toast align-items-center text-bg-primary border-0" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body">Filtros limpiados</div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Cerrar"></button>
            </div>
        </div>
    </div>

        <!-- Time Picker Modal (24h) -->
        <div class="modal fade" id="timePickerModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" style="max-width:360px">
                <div class="modal-content">
                    <div class="modal-header py-2">
                        <h6 class="modal-title"><i class="fas fa-clock me-2"></i>Seleccionar hora (24h)</h6>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                    </div>
                    <div class="modal-body">
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <div class="w-50 pe-1">
                                <label class="form-label small">Horas (00–23)</label>
                                <input type="number" min="0" max="23" step="1" class="form-control" id="tp-hours" value="00">
                            </div>
                            <div class="w-50 ps-1">
                                <label class="form-label small">Minutos (00–59)</label>
                                <input type="number" min="0" max="59" step="1" class="form-control" id="tp-mins" value="00">
                            </div>
                        </div>
                        <div class="d-flex flex-wrap gap-1 mt-2">
                            <div class="small text-muted">Atajos:</div>
                            <button type="button" class="btn btn-sm btn-outline-secondary" data-tp="00:00">00:00</button>
                            <button type="button" class="btn btn-sm btn-outline-secondary" data-tp="06:00">06:00</button>
                            <button type="button" class="btn btn-sm btn-outline-secondary" data-tp="12:00">12:00</button>
                            <button type="button" class="btn btn-sm btn-outline-secondary" data-tp="18:00">18:00</button>
                            <button type="button" class="btn btn-sm btn-outline-secondary" data-tp="23:59">23:59</button>
                        </div>
                    </div>
                    <div class="modal-footer py-2">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-primary" id="tp-apply">Aplicar</button>
                    </div>
                </div>
            </div>
        </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <!-- SheetJS (XLSX) para exportar manifiestos a Excel en el cliente -->
    <!-- Cargar desde CDN; si no hay red, la exportación caerá a CSV automáticamente -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <!-- Fallbacks y manejador de errores de imágenes (se define antes de script.js) -->
    <script>
        // Wire "Ver en Pantalla Completa" button to open iframe src in a new tab (mobile-friendly)
        (function(){
            document.addEventListener('DOMContentLoaded', function(){
                document.querySelectorAll('[data-fullscreen-target]').forEach(btn => {
                    if (btn._wiredFullscreen) return; btn._wiredFullscreen = true;
                    btn.addEventListener('click', function(){
                        const sel = btn.getAttribute('data-fullscreen-target');
                        if (!sel) return;
                        const iframe = document.querySelector(sel);
                        const url = iframe && iframe.getAttribute('src');
                        if (url) {
                            // Construye URL absoluta para que funcione bajo file:// y http(s)
                            const fullUrl = new URL(url, window.location.href).href;
                            window.open(fullUrl, '_blank');
                        }
                    });
                });
            });
        })();
    </script>
    <script>
        (function () {
            // Fallback para renderDemoras si no existe
            if (typeof window.renderDemoras !== 'function') {
                window.renderDemoras = function (data) {
                    console.warn('renderDemoras() fallback ejecutado.');
                    try {
                        const tbody = document.getElementById('demoras-tbody');
                        const tfoot = document.getElementById('demoras-tfoot');
                        if (!tbody) return;

                        tbody.innerHTML = '';
                        let total = 0;

                        if (Array.isArray(data)) {
                            data.forEach(row => {
                                const tr = document.createElement('tr');
                                tr.innerHTML = `
                                    <td>${row?.causa ?? '—'}</td>
                                    <td>${row?.demoras ?? 0}</td>
                                    <td>${row?.porcentaje ?? 0}%</td>`;
                                tbody.appendChild(tr);
                                total += Number(row?.demoras ?? 0);
                            });
                        }

                        if (tfoot) {
                            tfoot.innerHTML = `<tr class="table-light"><th>Total</th><th>${total}</th><th></th></tr>`;
                        }

                        // Crea una gráfica simple si hay datos y canvas disponible
                        const ctx = document.getElementById('delaysChart')?.getContext?.('2d');
                        if (ctx && window.Chart && !window._delaysChart) {
                            const labels = (data || []).map(r => r?.causa ?? '');
                            const values = (data || []).map(r => Number(r?.demoras ?? 0));
                            window._delaysChart = new Chart(ctx, {
                                type: 'bar',
                                data: {
                                    labels,
                                    datasets: [{
                                        label: 'Demoras',
                                        data: values,
                                        backgroundColor: '#0d6efd77',
                                        borderColor: '#0d6efd'
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: { legend: { display: false } }
                                }
                            });
                        }
                    } catch (err) {
                        console.error('Fallback renderDemoras error:', err);
                    }
                };
            }

            // Fallback para computeDailyStats si no existe
            if (typeof window.computeDailyStats !== 'function') {
                window.computeDailyStats = function (itinerary) {
                    console.warn('computeDailyStats() fallback ejecutado.');
                    // Devuelve estructura mínima para no romper la UI; reemplace con lógica real en script.js
                    return {
                        comercial: { ayer: 0, hoy: 0, trend: '=' },
                        carga: { ayer: 0, hoy: 0, trend: '=' },
                        general: { ayer: 0, hoy: 0, trend: '=' }
                    };
                };
            }

            // Reemplazo global de imágenes que fallen (ej. logos de aerolíneas faltantes)
            document.addEventListener('error', function (e) {
                const t = e.target;
                if (t && t.tagName === 'IMG') {
                    // Deja que las imágenes de aerolíneas usen su propio fallback (handleLogoError)
                    if (t.classList && t.classList.contains('airline-logo')) return;
                    // Evita loops infinitos
                    if (t.dataset.fallbackApplied === '1') return;
                    t.dataset.fallbackApplied = '1';
                    console.warn('Reemplazando imagen no encontrada:', t.src);
                    // Usar fallback local consistente (evita dominios externos)
                    t.src = 'images/airlines/default-airline-logo.svg';
                }
            }, true);

            // Fallback de inicio de sesión: DESHABILITADO por seguridad (no se permite auto-login ni bypass del manejador principal)
            // Este bloque se dejó intencionalmente vacío.
        })();
    </script>

    
    <!-- Modular JS (non-invasive): delegates to existing functions in script.js -->
    <script src="js/core.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/inicio.js"></script>
    <script src="js/itinerario.js"></script>
    <script src="js/demoras.js"></script>
    <script src="js/operaciones.js"></script>
    <script src="js/frecuencias.js"></script>
    <script src="js/manifiestos.js"></script>
    <script src="js/medicas.js"></script>
    <script src="js/fauna.js"></script>
    
        <script src="script.js"></script>
        <script src="js/puntualidad.js"></script>
        <script>
            // Modo DEV: bloquear por completo el registro de Service Workers en localhost/127.0.0.1 o con bandera noSW
            (function noSWDevGuard(){
                try {
                    const params = new URLSearchParams(location.search);
                    const flag = params.get('noSW') === '1' || localStorage.getItem('aifa.noSW') === '1';
                    const isLocalHost = /^(localhost|127\.0\.0\.1)$/i.test(location.hostname) || location.protocol === 'file:';
                    const devNoSW = flag || isLocalHost;
                    if (!devNoSW) { window.__NO_SW__ = false; return; }
                    window.__NO_SW__ = true;
                    if (navigator.serviceWorker && typeof navigator.serviceWorker.register === 'function') {
                        const sw = navigator.serviceWorker;
                        const originalRegister = sw.register.bind(sw);
                        sw.register = async function(){
                            console.warn('[noSW] Registro de Service Worker bloqueado en modo dev');
                            throw new Error('Dev mode: Service Worker disabled');
                        };
                        // Opcional: informar si algún script intenta registrar
                        console.info('[noSW] Modo DEV activo: Service Worker deshabilitado (host local o flag noSW)');
                    }
                } catch(e) { /* noop */ }
            })();
        </script>
        <script>
            // Mostrar advertencia si se abre con file:// (CORS bloqueará fetch de CSV/JSON)
            (function warnIfFileProtocol(){
                try{
                    if (location.protocol === 'file:'){
                        const el = document.getElementById('file-protocol-warning');
                        if (el) el.classList.remove('d-none');
                    }
                }catch(_){}
            })();
        </script>
        <script>
            // Asegurar que el overlay del sidebar nunca quede activo por error al cargar
            (function ensureOverlayOff(){
                try{
                    const ov = document.getElementById('sidebar-overlay');
                    if (ov) ov.classList.remove('active');
                }catch(_){}
            })();
        </script>
        <script>
            (function initServicioMedicoDoc(){
                function formatGoogleDocUrl(raw){
                    if (!raw) return '';
                    const trimmed = String(raw).trim();
                    if (!trimmed || trimmed.includes('TU_ID_DE_DOCUMENTO')) return '';
                    try {
                        const candidate = new URL(trimmed, window.location.href);
                        if (!/docs\.google\.com$/i.test(candidate.hostname)) return trimmed;
                        const match = candidate.pathname.match(/\/document\/d\/([^/]+)/);
                        if (match && match[1]) {
                            return `https://docs.google.com/document/d/${match[1]}/preview`;
                        }
                        const sheetMatch = candidate.pathname.match(/\/spreadsheets\/d\/([^/]+)/);
                        if (sheetMatch && sheetMatch[1]) {
                            const gid = candidate.searchParams.get('gid');
                            const hash = gid ? `#gid=${gid}` : '';
                            return `https://docs.google.com/spreadsheets/d/${sheetMatch[1]}/preview${hash}`;
                        }
                    } catch (_) {
                        return trimmed;
                    }
                    return trimmed;
                }

                document.addEventListener('DOMContentLoaded', function(){
                    const wrapper = document.getElementById('servicio-medico-embed');
                    if (!wrapper) return;
                    const frameShell = wrapper.querySelector('.doc-embed-frame');
                    const frame = frameShell ? frameShell.querySelector('iframe') : null;
                    if (!frame) return;

                    let url = wrapper.dataset.docUrl || '';
                    url = formatGoogleDocUrl(url);
                    if (!url) return;

                    frame.src = url;
                    const placeholder = wrapper.querySelector('.doc-embed-placeholder');
                    if (placeholder) placeholder.classList.add('d-none');
                    if (frameShell) frameShell.classList.remove('d-none');
                    frame.classList.remove('d-none');
                    wrapper.classList.add('doc-embed-ready');

                    const openBtn = document.getElementById('servicio-medico-open');
                    if (openBtn) {
                        const editUrl = url.includes('/preview') ? url.replace('/preview', '/edit') : url;
                        openBtn.href = editUrl;
                        openBtn.classList.remove('d-none');
                    }
                });
            })();
        </script>
        <script>
            // Limpieza agresiva de Service Workers previos y caches.
            // Si se detecta alguno, se hace reload UNA sola vez para que dejen de interceptar inmediatamente.
            (async function cleanupSW(){
                try {
                    const params = new URLSearchParams(location.search);
                    const flag = params.get('noSW') === '1' || localStorage.getItem('aifa.noSW') === '1';
                    const isLocalHost = /^(localhost|127\.0\.0\.1)$/i.test(location.hostname) || location.protocol === 'file:';
                    const devNoSW = flag || isLocalHost;
                    if (!devNoSW) return; // Solo en modo DEV
                    const FLAG = 'aifa.sw.cleaned.once';
                    const already = sessionStorage.getItem(FLAG) === '1';
                    if ('serviceWorker' in navigator) {
                        const regs = await navigator.serviceWorker.getRegistrations().catch(()=>[]);
                        if (Array.isArray(regs) && regs.length) {
                            await Promise.all(regs.map(r=>r.unregister().catch(()=>{})));
                            if (window.caches && caches.keys) {
                                try { const keys = await caches.keys(); await Promise.all(keys.map(k => caches.delete(k))); } catch(_) {}
                            }
                            if (!already) {
                                sessionStorage.setItem(FLAG, '1');
                                // Forzar un refresco inmediato para que el SW deje de interceptar en esta sesión
                                location.reload();
                                return;
                            }
                        }
                    }
                    // Reset de bandera cuando ya no hay SWs activos
                    if (already && (!('serviceWorker' in navigator))) {
                        sessionStorage.removeItem(FLAG);
                    }
                } catch(_) {}
            })();

            // Evitar errores de PDFs cuando no hay conexión: quitar src hasta que haya red
            (function managePDFs(){
                function applyOnlineState(){
                    const frames = document.querySelectorAll('iframe[src$=\".pdf\"]');
                    if (!navigator.onLine) {
                        frames.forEach(f => {
                            if (!f.dataset.src) f.dataset.src = f.getAttribute('src') || '';
                            f.removeAttribute('src');
                            // Mostrar un placeholder breve
                            if (!f._ph) {
                                const ph = document.createElement('div');
                                ph.className = 'text-muted small';
                                ph.textContent = 'PDF no disponible sin conexión';
                                f.parentElement && f.parentElement.appendChild(ph);
                                f._ph = ph;
                            }
                        });
                    } else {
                        frames.forEach(f => {
                            if (f.dataset.src && !f.getAttribute('src')) {
                                f.setAttribute('src', f.dataset.src);
                            }
                            if (f._ph) { try { f._ph.remove(); } catch(_) {} f._ph = null; }
                        });
                    }
                }
                window.addEventListener('online', applyOnlineState);
                window.addEventListener('offline', applyOnlineState);
                applyOnlineState();
            })();
        </script>
        <script>
            // Ajustar la paleta del login según el color medio del video de fondo
            (function adaptLoginPaletteToVideo(){
                const video = document.getElementById('login-bg-video');
                if (!video) return;
                const root = document.documentElement;
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext && canvas.getContext('2d', { willReadFrequently: true });
                if (!ctx) return;

                const clamp = (v)=> Math.max(0, Math.min(255, Math.round(v)));
                const lighten = (rgb, amount)=> rgb.map(ch => clamp(ch + (255 - ch) * amount));
                const darken = (rgb, amount)=> rgb.map(ch => clamp(ch * (1 - amount)));
                const rgba = (rgb, alpha)=> `rgba(${clamp(rgb[0])},${clamp(rgb[1])},${clamp(rgb[2])},${alpha})`;

                let sampling = false;
                let lastApplied = null;

                function applyPalette(avg){
                    const [r,g,b] = avg.map(clamp);
                    const luminance = (0.299*r + 0.587*g + 0.114*b) / 255;
                    const isBright = luminance > 0.55;

                    const base = darken(avg, 0.18);
                    const edge = lighten(avg, 0.25);
                    const highlight1 = lighten(avg, 0.48);
                    const highlight2 = lighten(avg, 0.68);
                    const frame = lighten(avg, 0.32);
                    const formBgColor = isBright ? darken(avg, 0.12) : darken(avg, 0.42);
                    const formBgAlpha = isBright ? 0.28 : 0.4;
                    const formBorder = lighten(avg, isBright ? 0.22 : 0.58);
                    const textRGB = isBright ? darken(avg, 0.68) : lighten(avg, 0.92);
                    const labelRGB = isBright ? darken(avg, 0.46) : lighten(avg, 0.82);
                    const helperRGB = isBright ? darken(avg, 0.36) : lighten(avg, 0.74);

                    root.style.setProperty('--login-glass-base', rgba(base, 0.52));
                    root.style.setProperty('--login-glass-edge', rgba(edge, 0.24));
                    root.style.setProperty('--login-glass-highlight-1', rgba(highlight1, 0.32));
                    root.style.setProperty('--login-glass-highlight-2', rgba(highlight2, 0.22));
                    root.style.setProperty('--login-glass-frame', rgba(frame, 0.26));
                    root.style.setProperty('--login-form-bg', rgba(formBgColor, formBgAlpha));
                    root.style.setProperty('--login-form-border', rgba(formBorder, 0.24));
                    root.style.setProperty('--login-form-text', rgba(textRGB, 0.96));
                    root.style.setProperty('--login-label-color', rgba(labelRGB, 0.88));
                    root.style.setProperty('--login-helper-color', rgba(helperRGB, 0.78));
                }

                function sampleFrame(){
                    if (sampling) return;
                    sampling = true;
                    requestAnimationFrame(()=>{
                        try {
                            if (!video.videoWidth || !video.videoHeight){ sampling = false; return; }
                            const targetWidth = 140;
                            const targetHeight = Math.max(1, Math.round((video.videoHeight / video.videoWidth) * targetWidth));
                            canvas.width = targetWidth;
                            canvas.height = targetHeight;
                            ctx.drawImage(video, 0, 0, targetWidth, targetHeight);
                            const { data } = ctx.getImageData(0, 0, targetWidth, targetHeight);
                            let r = 0, g = 0, b = 0, count = 0;
                            for (let i=0; i<data.length; i+=4){
                                const alpha = data[i+3];
                                if (alpha < 32) continue;
                                r += data[i];
                                g += data[i+1];
                                b += data[i+2];
                                count++;
                            }
                            if (count){
                                const avg = [r/count, g/count, b/count];
                                const key = avg.map(v=> clamp(v)).join(',');
                                if (key !== lastApplied){
                                    applyPalette(avg);
                                    lastApplied = key;
                                }
                            }
                        } catch(_){ /* ignore sampling errors */ }
                        sampling = false;
                    });
                }

                const triggerSample = ()=> sampleFrame();
                if (video.readyState >= 2){ triggerSample(); }
                else video.addEventListener('loadeddata', triggerSample, { once: true });

                ['play','playing','timeupdate'].forEach(evt =>{
                    video.addEventListener(evt, triggerSample, { passive: true });
                });
            })();
        </script>
    <div id="orientation-hint" class="orientation-hint" aria-live="polite" aria-hidden="true">
        <div class="orientation-hint-card" role="dialog" aria-modal="true" aria-labelledby="orientation-hint-title">
            <div class="orientation-hint-icon" aria-hidden="true">
                <i class="fas fa-mobile-screen-button"></i>
            </div>
            <h2 id="orientation-hint-title" class="orientation-hint-title">Mejor en horizontal</h2>
            <p class="orientation-hint-message">Gira tu dispositivo para ver la información completa.</p>
            <button type="button" class="btn btn-primary btn-sm orientation-hint-dismiss" data-dismiss-orientation="true">Entendido</button>
        </div>
    </div>
    <button id="orientation-quick-toggle" class="orientation-quick-toggle" type="button" aria-label="Forzar modo horizontal" aria-hidden="true">
        <i class="fas fa-arrows-rotate" aria-hidden="true"></i>
        <span>Rotar</span>
    </button>
    <!-- Loader Global -->
    <div id="global-loader" class="global-loader hidden" role="alert" aria-live="assertive" aria-busy="true">
        <div class="loader-content">
            <div class="plane-orbit">
                <span class="orbit-ring"></span>
                <span class="plane-icon">✈</span>
                <img src="images/logo_aifa.jpg" alt="AIFA" class="loader-aifa-logo" />
            </div>
            <div class="loader-text" id="global-loader-text">Cargando...</div>
        </div>
    </div>
</body>
</html>